Mini2.define("Mini2.ui.form.field.Date",{extend:"Mini2.ui.form.field.Trigger",displayField:"text",valueField:"value",isLoaded:false,dateEl:null,defaultValue:null,useStrict:undefined,format:"Y-m-d",initTimeFormat:"H",initTime:"24",showTime:false,timeEl:null,setWidth:function(c){var b=this,a=b.el;b.width=c,a.css("width",c)},getWidth:function(){return this.width},getTriggerMarkup:function(){var a=this;var b=Mini2.$joinStr(['<div class="mi-layer mi-border-box" style="z-index:39001;" >',"</div>"]);return b},callDatepickerShow:function(a){var b=this;b.initLocalMessage();$.datepicker.formatDate("yy-mm-dd",new Date(2014,1,1,26));$(a).datepicker({dateFormat:"yy-mm-dd",showOn:"",changeMonth:true,changeYear:true,buttonImageOnly:false,showOptions:{direction:""},showButtonPanel:true,inline:false,onSelect:function(c,d){b.inputEl.val(c);b.hideDropDownPanel();b.focus();b.clearInvalid()}})},initTimeBox:function(){var a=this,b=a.dropDownPanel;if(a.showTime&&!a.timeEl){var c=Mini2.$joinStr(['<div class="ui-datepicker-time">',"<span>时间：</span>",'<input type="text" class="ui-time" style="width:80px;" value="12:59:59" />',"</div>"]);$(b).append(c);a.timeEl=c.find(".ui-time:first")}},initCloseBtn:function(){var c=this;var a=$(c.dateEl).find(".ui-datepicker-buttonpane:first");if(a.children(".ui-datepicker-close").size()>0){return}var b=Mini2.$joinStr(["<button type='button' ","class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' ","data-handler='hide' data-event='click'>关闭</button>"]);$(a).append(b);$(b).click(function(){c.hideDropDownPanel()})},getBoundPanel:function(){var a=this;a.dateEl=Mini2.$joinStr(['<div style="font-size:12px; "></div>']);if($.fn.datepicker){a.callDatepickerShow(a.dateEl)}else{In("jq.ui.datepicker",function(){a.callDatepickerShow.call(a,a.dateEl)})}return a.dateEl},beforeShowDropDownPanel:function(){var b=this;b.init_DropDwonPanel();if(b.isLoaded){b.initCloseBtn();b.initTimeBox();return}var c=b.dropDownPanel;var a=b.getBoundPanel();$(c).children().remove();$(c).append(a);b.initCloseBtn();b.initTimeBox();b.isLoaded=true},loadDataPicker:function(){var e=this,c=e.el,d=e.fieldEl,g,a=e.dateEl,f=e.dropDownPanel,h=e.timeEl;g=d.offset();var b=e.inputEl.val();if(e.pw==undefined||e.ph==undefined){e.pw=a.width();e.ph=a.height()}$(a).datepicker({currentText:b});if(h){if(b==""){h.val("00:00:00")}else{var j=new Date(b);var i=Mini2.Date.format(j,"H:i:s");h.val(i)}}f.css({width:e.pw,height:e.ph+30,left:g.left+c.width()-e.pw,top:g.top+c.height()-2});f.show()},initLocalMessage:function(){if($.datepicker.regional["zh-CN"]){return}$.datepicker.regional["zh-CN"]={closeText:"关闭",prevText:"&#x3C;上月",nextText:"下月&#x3E;",currentText:"今天",monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],weekHeader:"周",dateFormat:"yy-mm-dd",firstDay:1,isRTL:false,showMonthAfterYear:true,yearSuffix:"年"};$.datepicker.setDefaults($.datepicker.regional["zh-CN"])},showDropDownPanel:function(){var a=this;a.init_DropDwonPanel();if($.fn.datepicker){a.loadDataPicker()}else{In("jq.ui.datepicker",function(){a.loadDataPicker.call(a)})}},parseDate:function(g){if(!g||Mini2.isDate(g)){return g}var e=this,f=e.safeParse(g,e.format),a=e.altFormats,b=e.altFormatsArray,c=0,d;if(!f&&a){b=b||a.split("|");d=b.length;for(;c<d&&!f;++c){f=e.safeParse(g,b[c])}}return f},safeParse:function(g,a){var b=this,f=Mini2.Date,d=null,e=b.useStrict,c;if(f.formatContainsHourInfo(a)){d=f.parse(g,a,e)}else{c=f.parse(g+" "+b.initTime,a+" "+b.initTimeFormat,e);log.debug(a+" "+b.initTimeFormat);if(c){d=f.clearTime(c)}}return d},getValue:function(){var b=this,a=b.defaultValue;var c=this.constructor.base.getValue.call(b);if(c==""){return b.defaultValue}c=new Date(c);c=Mini2.Date.format(c,b.format);return c},setValue:function(d){var a=this,e=d,b="";if(!d){this.constructor.base.setValue.call(a,"");return}if(Mini2.isDate(e)){e=Mini2.Date.format(d,a.format);b=Mini2.Date.format(d,"H:i:s")}else{if(Mini2.isString(e)){if(e!=""){var c=new Date(e);e=Mini2.Date.format(c,a.format);b=Mini2.Date.format(c,"H:i:s")}}}this.constructor.base.setValue.call(a,e)}});