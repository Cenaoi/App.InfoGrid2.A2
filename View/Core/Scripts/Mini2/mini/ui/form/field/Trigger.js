Mini2.define("Mini2.ui.form.field.Trigger",{extend:"Mini2.ui.form.field.Text",buttonEl:null,dropDownPanel:null,emptyText:"",focusCls:"mi-form-focus",readOnly:false,store:false,itemBody:null,content:false,changed:Mini2.emptyFn,initComponent:function(){var a=this;a.fieldCls="mi-form-type-text";$(a).muBind("focusout",function(){a.fieldEl.removeClass("mi-form-focus");a.el.removeClass("mi-form-trigger-wrap-focus");a.hideDropDownPanel()});a.initStore();a.initLabelable()},initStore:function(){var b=this;var c=b.store;var d;if(Mini2.isString(c)){d=Mini2.data.StoreManager.lookup(b.store);delete b.store}else{if(Mini2.isArray(c)){var a=b.fields||[];d=Mini2.create("Mini2.data.Store",{storeId:"MiniStore_"+Mini2.getIdentity(),fields:a,data:c,autoSave:false});delete b.store}else{d=b.store}}b.store=d;b.bindStore(d)},getStore:function(){var a=this;return a.store},bindStore:function(a){},getTriggerMarkup:function(){var a=this,b=Mini2.$joinStr(['<div class="mi-boundlist ',"mi-layer ",'mi-border-box" ','style="border-width: 1px; right: auto; z-index: 39001; display:none; ">',"","</div>"]);return b},hide:function(){var a=this;a.hideDropDownPanel()},layoutReset:function(){var a=this;a.hideDropDownPanel()},init_DropDwonPanel:function(){var a=this;if(a.dropDownPanel!=null){return}var b=a.getTriggerMarkup();a.dropDownPanel=$(b);$(document.body).append(a.dropDownPanel);$(a.dropDownPanel).mousedown(function(c){}).mousemove(function(c){}).mouseup(function(c){Mini2.EventManager.stopEvent(c);Mini2.EventManager.clear(a.scope||a.el)})},getBoundPanel:Mini2.emptyFn,initContentPanel:function(){var b=this;if(!b.isCustom){var a=null;if(Mini2.isString(b.content)){if(window[b.content]){a=window[b.content]}else{a=$(b.content)}delete b.content}b.isCustom=true;$(a).addCls("mi-boundlist","mi-layer","mi-border-box").css({right:"auto","z-index":39001}).show();b.dropDownPanel=a}},beforeShowDropDownPanel:function(){var b=this;if(b.content){b.initContentPanel()}if(!b.isCustom){b.init_DropDwonPanel();var c=b.dropDownPanel;var a=b.getBoundPanel();$(c).children().remove();$(c).append(a)}},showDropDownPanel:function(){var e=this;e.init_DropDwonPanel();if(e.dropDown){try{e.dropDown.call(e,e)}catch(c){throw new Error("执行 Trigger.dropDown(...) 事件发生错误")}}var b=e.el,g=e.dropDownPanel,i=e.dropDownWidth||(e.dropDownWidth>0)||b.width(),d=e.dropDownHeight,f=e.fieldEl.offset();if(!e.isCustom){g.css({width:i-4,height:d})}var a=f.top+b.height()-2+d;g.css({left:f.left,top:f.top+b.height()-2}).show()},hideDropDownPanel:function(){var b=this,a=b.dropDownPanel;if(a==null){return}a.hide()},triggerDropDownPanel:function(){var b=this,a=b.dropDownPanel;if(a!=null&&a.is(":visible")){b.hideDropDownPanel()}else{b.beforeShowDropDownPanel();b.showDropDownPanel()}},onPositionChanged:function(){var a=this,b,c=a.dropDownPanel;if(c){b=a.el.offset();c.css({left:b.left,top:b.top+a.el.height()-2})}},onButtonClick:function(){var b=this,a=b.buttonClick;if(a&&Mini2.isFunction(a)){a.call(b)}else{b.triggerDropDownPanel()}},bindEvent_Button:function(b){var d=this,a="mi-form",e=a+"-trigger-over",c=a+"-trigger-click";$(b).mouseenter(function(){$(this).addClass(e)}).mouseleave(function(){$(this).removeClass(e)});$(b).mousedown(function(f){d.focus();Mini2.EventManager.stopEvent(f)}).mouseup(function(f){$(this).removeClass(c);d.onButtonClick();Mini2.EventManager.stopEvent(f)})},focus:function(){var a=this;a.fieldEl.addClass("mi-form-focus");a.el.addClass("mi-form-trigger-wrap-focus");setTimeout(function(){a.inputEl.focus()},200);Mini2.ui.FocusManager.setControl(a.scope||a)},bindInputEl_Mouse2:function(a){var b=this;if("none"==b.mode){a.css("current","pointer");$(a).mousedown(function(c){b.focus();Mini2.EventManager.stopEvent(c)}).mouseup(function(c){b.onButtonClick();Mini2.EventManager.stopPropagation(c)});$(a).keyup(function(c){if(46==c.keyCode){b.setValue("")}})}},getFieldEl:function(){var c=this,d,b,a;d=Mini2.$joinStr(['<table class="mi-form-trigger-wrap" cellpadding="0" cellspacing="0" style="table-layout: fixed; width: 100%; ">',"<tbody>","<tr>",'<td class="mi-form-trigger-input-cell" style="width: 100%; "></td>','<td valign="top" class="mi-trigger-cell mi-unselectable" style="width:22px;" role="button" ></td>',"</tr>","</tbody>","</table>"]);c.inputEl=b=Mini2.$joinStr(['<input type="text" class="mi-form-field mi-form-required-field mi-form-text" ','autocomplete="off" aria-invalid="false" data-errorqtip="" style="width: 100%; ">']);a=Mini2.$joinStr(['<div class="mi-form-trigger mi-form-arrow-trigger " role="button"></div>']);c.buttonEl=a;if(c.buttonCls){a.addCls(c.buttonCls)}b.attr("id",c.clientId);if(c.name){b.attr("name",c.name)}c.appendCell(d,b,"td.mi-form-trigger-input-cell");c.appendCell(d,a,"td.mi-trigger-cell");if(undefined!=c.value){c.setValue(c.value);c.srcValue=c.value;delete c.value}c.bindEvent_Button(a);c.bindInputEl_Mouse(b);c.bindInputEl_Key(b);c.bindInputEl_Mouse2(b);if("none"==c.mode){c.setReadOnly(true)}return d}});