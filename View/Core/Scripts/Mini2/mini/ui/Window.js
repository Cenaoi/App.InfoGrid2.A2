Mini2.define("Mini2.ui.Window",{extend:"Mini2.ui.Component",text:"Window",formClosed:function(a){this.bind("formClosed",a)},formClosing:function(a){this.bind("formClosing",a)},windwoBoxTpl:['<div class="mi-window ',"mi-layer ","mi-window-default ","mi-closable ","mi-window-closable ","mi-window-default-closable ","mi-border-box ","mi-resizable ","mi-window-resizable ",'mi-window-default-resizable" ','style="right: auto;">',"</div>"],ghostTpl:['<div class="mi-window-proxy" style="right: auto;display:none;"></div>'],bodyTpl:['<div class="mi-window-body mi-window-body-default mi-closable mi-window-body-closable mi-window-body-default-closable ','mi-window-body-default mi-window-body-default-closable mi-noborder-trbl " ','style="padding: 0px; overflow: hide; left: 0px;">',"</div>"],shadowTpl:['<div class="mi-css-shadow" role="presentation" style="right: auto; ',"left: 572px; top: 186px; width: 400px; height: 261px; ",'box-shadow: rgb(136, 136, 136) 0px 0px 6px; display: block;">',"</div>"],maskTpl:['<div class="mi-mask" style="right: auto; left: 0px; top: 0px;"></div>'],contentTpl:['<iframe src="" frameborder="0" dock="full">¿ò¼Ü´°Ìå</iframe>'],url:"",iframe:true,startPosition:"default",autoScroll:false,width:600,height:400,left:100,top:20,headerVisible:true,shadowVisible:true,header:null,onInit:Mini2.emptyFn,onLoad:Mini2.emptyFn,zIndex:19000,mode:false,buttons:false,buttonPanel:false,buttonAlign:"right",initComponent:function(){var a=this;Mini2.ui.WindowManager.regWin(this);a.onInit();a.onLoad()},render_ButtonPanel:function(d){var b=this,c,a=b.buttons;if(a){c=Mini2.create("Mini2.ui.panel.Panel",{baseCls:Mini2.baseCSSPrefix+"toolbar",dock:"bottom",ui:"footer",height:24,renderTo:d});c.render();b.render_Button(c.boxTarget);b.buttonPanel=c}},render_Button:function(g){var e=this,c,a,d,b=e.buttons,f=[];if(b){for(d=0;d<b.length;d++){c=Mini2.applyIf(Mini2.clone(b[d]),{renderTo:g,ownerWindow:e});f[d]=a=Mini2.create("Mini2.ui.button.Button",c);a.render();a.el.addClass("mi-box-item")}delete e.buttons;e.buttons=f}},focus:function(){var a=this;Mini2.ui.WindowManager.moveFirst(a);Mini2.ui.FocusMgr.setControl(a)},setZIndex:function(c){var b=this,a=b.el;b.zIndex=c;if(!b.el){return}a.css("z-index",c);if(b.shadowVisible){b.shadowEl.css({"z-index":c-1})}},header_Action:function(a,c){var b=a.data;switch(c){case"close":b.close();break;default:}},getOffset:function(){return $(this.el).offset()},getBtnWidth:function(a){var c=0,b=a.length;while(b--){c+=a[b].getWidth()}return c},setButtonLayout:function(f,b){var e=this,c,a,d=b.length;for(c=0;c<d;c++){a=b[c];a.setLeft(f);f+=a.getWidth()+6}},updateLayout:function(){var e=this,a,f,c,d,b=e.buttons;if(b){c=b.length;f=e.getBtnWidth(b);d=e.width-f-c*6-20;switch(e.buttonAlign){case"left":e.setButtonLayout(0,b);break;case"center":e.setButtonLayout(d/2,b);break;case"right":e.setButtonLayout(d,b);break}}},setSize:function(l,i){var j=this,g=j.el,a=i-10,b=0,d,e=j.buttons,c=l-10,f=j.contentEl,k;j.width=l||j.width;j.height=i||j.height;g.css({width:l,height:i});if(j.buttonPanel){j.buttonPanel.setSize(l-10,24);a-=36;j.updateLayout()}if(j.headerVisible){j.header.setWidth(l);a-=31;b+=31}if(j.buttonPanel){j.buttonPanel.setTop(b+a)}k={width:c,height:a};j.bodyEl.css(k).css({top:b});if(f&&"full"==f.attr("dock")){if(f.get(0).tagName=="IFRAME"){f.attr(k)}else{f.css(k);f.bind("mousedown",function(h){Mini2.ui.FocusMgr.setControl(this)});f.muBind("mouseup",Mini2.emptyFn)}}if(j.shadowVisible){j.shadowEl.css({width:l,height:i-8})}},setLocation:function(c,d,a){var b=this;if(!Mini2.isNumber(c)){c=parseInt(c)}if(!Mini2.isNumber(d)){d=parseInt(d)}if(a&&"center_screen"==b.startPosition){c=($(window).width()-b.width)/2;d=($(window).height()-b.height)/2}b.el.css({left:c,top:d});if(b.shadowVisible){b.shadowEl.css({left:c,top:d+8})}},initGhost:function(){var a=this;if(!a.ghostEl){a.ghostEl=Mini2.$joinStr(a.ghostTpl);$(a.renderTo).append(a.ghostEl)}},setGhostLocation:function(c,d){var b=this,a=b.ghostEl;a.css({left:c,top:d})},beginDrag:function(){var c=this,b,a=c.el,d=a.css("z-index");d=parseInt(d);c.initGhost();b=c.ghostEl;b.css({left:a.css("left"),top:a.css("top"),width:a.css("width"),height:a.css("height"),"z-index":d+100});b.muBind("mouseup",Mini2.emptyFn);b.show();if(c.shadowVisible){c.shadowEl.hide()}a.hide()},endDrag:function(){var c=this,b=c.ghostEl,a=c.el,d,e;b.hide();d=b.css("left");e=b.css("top");c.setLocation(d,e);if(c.shadowVisible){c.shadowEl.show()}a.show()},renderMask:function(){var c=this,a,b,d=$(window);if(c.mode){c.maskEl=b=Mini2.$joinStr(c.maskTpl);b.css({width:d.width(),height:d.height(),"z-index":c.zIndex-2});c.renderTo.append(b);b.muBind("mousedown",Mini2.emptyFn);b.muBind("mouseup",Mini2.emptyFn)}},getText:function(){return this.text},setText:function(b){var a=this;a.text=b;a.header.setText(b)},renderHeader:function(a){var c=this;if(c.headerVisible){var b=c.header=Mini2.create("Mini2.ui.WindowHeader",{width:c.width,owner:c,renderTo:a,text:c.text});b.render();$(b).bind("action",c,c.header_Action)}},renderShadow:function(){var a=this;if(a.shadowVisible){a.shadowEl=Mini2.$joinStr(a.shadowTpl);a.shadowEl.css("z-index",a.zIndex-1);a.renderTo.append(a.shadowEl)}},renderEl:function(){var d=this,b,a,c;d.el=b=Mini2.$joinStr(d.windwoBoxTpl);b.mouseup(function(){Mini2.EventManager.stopEvent()});b.data("me",d);b.css("z-index",d.zIndex);d.bodyEl=a=Mini2.$joinStr(d.bodyTpl);if(d.autoScroll){a.css("overflow","auto")}a.css("border-style","none");d.renderHeader(b);d.renderShadow();b.append(a);d.renderTo.append(b);d.render_ButtonPanel(b);return d.el},setUrl:function(c){var b=this,a=b.contentEl;if(b.iframe){a.attr("src",b.url)}},renderContent:function(){var b=this,a;b.contentEl=a=Mini2.$joinStr(b.contentTpl);b.bodyEl.append(a);if(b.iframe){a.attr("src",b.url).attr("muid",b.muid);if(!b.autoScroll){a.attr("scrolling","no")}a.bind("load",{owner:b},b.iframe_load)}return a},iframe_load:function(c){var f=this,d=$(f).attr("muid"),g=f.contentWindow,b=g.document,a=b.body;g.ownerWindow=c.data.owner},render:function(){var b=this,a,c=$(window);b.renderMask();a=b.renderEl();b.renderContent();if("max"==b.state){b.win_resize.call(b);c.resize(function(){b.win_resize.call(b)})}else{b.setSize(b.width,b.height);b.setLocation(b.left,b.top,true)}return a},win_resize:function(){var b=this,d=$(window),c=d.width()-20,a=d.height()-20;b.setSize(c,a);b.setLocation(10,10,true)},show:function(){if(!this.el){this.render()}var b=this,a=b.el,c=b.shadowEl;if(b.shadowVisible){c.show()}a.show();b.focus();return b},hide:function(){var c=this,a=c.el,d=c.shadowEl,b=c.maskEl;if(a){a.hide()}if(c.shadowVisible){d.hide()}if(c.mode){b.hide()}return c},close:function(b){var c=this,a;b=b||{};a=c.trigger("formClosing",b);if(!a){c.trigger("formClosed",b);c.dispose()}return c},dispose:function(){var c=this,a=c.el,d=c.shadowEl,b=c.maskEl;if(b){b.remove()}if(a){a.remove()}if(d){d.remove()}if(c.ghostEl){c.ghostEl.remove()}Mini2.ui.WindowManager.removeWin(c)}});