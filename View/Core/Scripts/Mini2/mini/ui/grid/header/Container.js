Mini2.define("Mini2.ui.grid.header.Container",{renderTo:Mini2.getBody(),height:31,width:600,m_divMarker1:null,m_divMarker2:null,m_CurMoveHead:null,m_IsLineMove:false,headerElMoveWidth:0,headerEl:null,innerEl:null,targetEl:null,columns:[],curIndex:-1,baseCls:"mi-column-header",m_ColumnWidthResize:Mini2.emptyFn,columnWidthResize:function(a){this.m_ColumnWidthResize=a},strJoin:function(a){var b,c="";for(b=0;b<a.length;b++){c+=a[b]}return c},headTpl:['<div class="mi-column-header mi-box-item mi-column-header-default mi-unselectable " ','style="right: auto; left: 0px; top: 0px; margin: 0px; ">','<div class="mi-column-header-inner ">','<span class="mi-column-header-text">',"&nbsp;","</span>","</div>","</div>"],checkColumns:[],lastSortColumn:null,createHead:function(b){var j=this,c=j.grid,a=j.baseCls,d,g,f;d=$(j.headTpl).addClass(a+"-align-"+b.headerAlign);d.data("exObj",b);g=d.find("."+a+"-text:first");if(b.getHeaderConfig){var e=b.getHeaderConfig();b=Mini2.apply(b,e);j.checkColumns.push(b);if(c&&"SINGLE"==c.checkedMode){var k=b.headerText;g.html(k)}else{var h=b.renderer.call(b,false,c);g.append(h)}}else{g.html(b.headerText)}f=d.find("."+a+"-inner");if(!b.menuDisabled){var i=$('<div class="'+a+'-trigger" ></div>');f.append(i);f.bind("mousedown",function(m){var p,o,n,l=$(this).data("exObj");if(l&&l.resizable){n=$(this).offset().left;p=event.clientX-n;o=$(this).width();if(p<o-4){Mini2.EventManager.setMouseDown(this,m)}}}).muBind("mouseup",function(m,l){})}j.head_bindEvent(d);return d},head_bindEvent:function(a){var b=this;a.muBind("mousedown",function(d,c){}).muBind("mouseup",function(d,c){b.head_click.call(this,d,c,b)}).muBind("dblclick",function(d,c){b.head_dblclick.call(this,d,c,b)})},head_click:function(i,d,h){var g=h,b="mi-grid-checkcolumn-checked",f,a,c=$(this).data("exObj");if(!g.m_IsLineMove){Mini2.ui.FocusMgr.setControl(this);if(c.isCheckerHd){f=$(this).find("img:first");f.toggleClass(b);a=$(f).hasClass(b);c.onHeaderClick(this,c,a);Mini2.EventManager.stopEvent(d)}}},head_dblclick:function(l,g,k){var j=k,h=j.grid,b=j.baseCls,i=b+"-sort",c="mi-grid-checkcolumn-checked",f=i+"-DESC",a=i+"-ASC",d=$(this).data("exObj");if(!j.m_IsLineMove){Mini2.ui.FocusMgr.setControl(this);if(!d.isCheckerHd){if(!h.sortable||!d.sortable){return}if(j.lastSortColumn===this){d.doSort()}else{d.doSort("ASC")}$(j.lastSortColumn).removeCls(f,a);if("ASC"==d.direction){$(this).addClass(f)}else{if("DESC"==d.direction){$(this).addClass(a)}}j.lastSortColumn=this;Mini2.EventManager.stopEvent(g)}}},setHeaderCheck:function(g){var h=this,b,d=h.checkColumns,e,f,c,j=h.targetEl,a="mi-grid-checkcolumn-checked";for(e=0;e<d.length;e++){b=d[e];c=$(j).children(":eq("+b.index+")");f=$(c).find("img:first");$(f).toggleClass(a,g)}},createHeadGroups:function(){var k=this,h,d,a=k.baseCls,e=k.columns,g,j=0;var f=$(k.strJoin(['<div unselectable="on" >','<div class="mi-box-inner" role="presentation" style="width: 644px; height: 29px; ">','<div class="mi-box-target" style="width: 644px; "></div>',"</div>","</div>"]));f.addCls(a+"-ct",a+"-ct-docked-top",a+"-ct-default-docked-top",a+"-ct-default","mi-box-layout-ct","mi-noborder-rl");var b=f.cFirst(".mi-box-inner");var c=$(b).cFirst(".mi-box-target");for(h=0;h<e.length;h++){d=e[h];if(d.isCheckerHd){k.checkColumns.push(d)}g=k.createHead(d);g=$(g).css({left:j+"px",width:(d.width-1)+"px"});c.append(g);j+=d.width}b.css("width",j);return f},createMarker:function(){var d=this,a,b=d.m_divMarker1,c=d.m_divMarker2;if(b!=null&&c!=null){return}a='<div class="mi-grid-resize-marker" style="top:0;height:200px; right: auto; left: -9999px; pointer-events: none;" ></div>';d.m_divMarker1=b=$(a);d.m_divMarker2=c=$(a);$(d.renderTo).append([b,c])},onInit:function(){var a=this;a.headTpl=a.strJoin(a.headTpl)},render:function(){var d=this;d.onInit();var c=d.createHeadGroups();$(d.renderTo).append(c);var a=$(c).cFirst(".mi-box-inner");var b=$(a).cFirst(".mi-box-target");d.headerEl=c;d.innerEl=a;d.targetEl=b;d.setWidth(d.width);d.IntiHeaderInner();d.InitHeadGroups()},setWidth:function(b){var a=this;a.width=b;a.innerEl.css("width",b-1);a.targetEl.css("width",b)},scrollLeft:function(b){var a=this;a.innerEl.scrollLeft(b)},preventDefault:function(a){a=a||window.event;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}},HeadDroging:function(d,g){var f=this;var b=$(g).width();var a=$(g).offset().left;var i=d.clientX+a;var j=f.m_divMarker1.offset().left;var k=d.clientX;var h=k-j;if(h<=4){return}var c=k-$(f.renderTo).offset().left;f.m_divMarker2.css({left:c});f.headerElMoveWidth=k-j},EndHeadDrog:function(c,g){var d=this,a=d.m_divMarker1,b=d.m_divMarker2,f=d.headerElMoveWidth;if(a&&b){a.css({left:-9999});b.css({left:-9999});$(d.m_CurMoveHead).css({width:f});d.m_IsLineMove=false;d.m_CurMoveHead=null;d.columns[d.curIndex].width=f;d.resetWidth();d.setWidth(d.grid.width)}},StartHeadDrog:function(c){var f=this;f.createMarker();f.m_IsLineMove=true;f.curIndex=$(f.m_CurMoveHead).index();var b=$(f.m_CurMoveHead).width();var a=f.m_CurMoveHead.offset().left-$(f.renderTo).offset().left;var g=c.clientX-a;var d=$(f.renderTo).height()+$(f.headerEl).height();f.m_divMarker1.css({left:a,top:0,height:d});f.m_divMarker2.css({left:a+b,top:0,height:d});f.headerElMoveWidth=b;Mini2.ui.FocusMgr.setControl(this.headerEl)},InitHeadGroups:function(){var b=this;var a=$(b.headerEl).find(".mi-box-inner:first");a.mousemove(function(c){if(b.m_IsLineMove){b.HeadDroging(c,this);b.preventDefault(c)}}).mouseup(function(c){if(b.m_IsLineMove){b.EndHeadDrog(c,this)}b.preventDefault(c)})},IntiHeaderInner:function(){var e=this,b=$(e.headerEl),a=e.baseCls,c=b.find("."+a+"-inner"),d=b.find("."+a);$(c).muBind("mouseenter",function(){}).muBind("mouseleave",function(){});$(d).muBind("mousedown",function(g,f){if(e.m_CurMoveHead!=null){var f=event||window.event;Mini2.EventManager.drag=true;e.StartHeadDrog(f)}e.preventDefault(event)}).muBind("mouseup",function(g,f){f=f||window.event;e.m_IsLineMove=false;Mini2.EventManager.drag=false;e.EndHeadDrog(f,this)}).muBind("mousemove",function(p,l){var m=$(this);if(e.m_IsLineMove){e.HeadDroging(l,this);return}var k=m;var h=m.width()+20;var g=m.offset().left;var q=l.clientX-g;var i=false,j=false,f;var o=m.index();if(q<=4){if(o>0){o=m.prev().index();f=e.columns[o];if(f&&f.resizable&&m.prev().index()>0){m.css("cursor","col-resize");e.m_CurMoveHead=m.prev();i=true}}}else{if(q>=20){}else{m.css("cursor","")}}o=m.index();f=e.columns[o];if(f.resizable&&q>h-24){m.find("."+a+"-trigger:first").css("cursor","col-resize");e.m_CurMoveHead=m;j=true}else{m.find("."+a+"-trigger:first").css("cursor","")}if(i==false&&j==false){e.m_CurMoveHead=null}Mini2.EventManager.stopEvent(l)})},resetWidth:function(){var g=this,k=0,h=0,f,b,d,c=g.columns;var j=$(g.headerEl).find(".mi-box-target:first");var a=$(g.headerEl).cFirst(".mi-box-inner");var e=$(j).children();for(f=0;f<c.length;f++){b=c[f];d=e[f];d=$(d);d.width(b.width-1).css("left",k);k+=b.width}a.css("width",k);j.css("width",k);g.m_ColumnWidthResize()}});