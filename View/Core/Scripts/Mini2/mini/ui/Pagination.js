Mini2.define("Mini2.ui.Pagination",{renderTo:Mini2.getBody(),urlFormat:"?page={0}",prevText:"上一页",nextText:"下一页",firstText:"首页",lastText:"尾页",curPage:0,itemTotal:0,rowCount:20,pageCount:0,startPage:0,endPage:0,visible:true,constructor:function(b){var a=this;if(Mini2.isString(a.store)){var c=Mini2.data.StoreManager.lookup(a.store);a.store=c}a.bindStore(a.store)},bindStore:function(b){var a=this;if(!b){return}a.itemTotal=b.getTotalCount();a.renderButton();$(b).muBind("datachanged",a,a.store_dataChanged);$(b).muBind("load",a,a.store_load)},store_load:function(a,c){var b=a.data;b.itemTotal=c.getTotalCount();b.rowCount=c.pageSize;b.curPage=c.currentPage;b.renderButton()},store_dataChanged:function(a,c){var b=a.data;b.itemTotal=c.getTotalCount();b.rowCount=c.pageSize;b.curPage=c.currentPage;b.renderButton()},click:function(b,c){var a=this;if(c){c.loadPage(b)}},getFirstUrl:function(){var a=this;return $.format(a.urlFormat,0)},getPrevUrl:function(){var a=this,b=a.curPage-1;if(b<0){b=0}return $.format(a.urlFormat,b)},getNextUrl:function(){var a=this,b=a.curPage+1;if(b>=a.pageCount){b=a.pageCount-1}return $.format(a.urlFormat,b)},getLastUrl:function(){var a=this;return $.format(a.urlFormat,a.pageCount-1)},resetParam:function(){var f=this,a=f.curPage,d=f.itemTotal||0,h=f.rowCount,g,i,b,j,c;var e=d%h;g=(d-e)/h;if(e>0){g++}i=a-4;b=a+5;if(i<0){i=0}if(b>=g){b=g-1}j=a*h;c=j+h;if(c>d){c=d}f.pageCount=g;f.startPage=i;f.endPage=b;f.startRow=j;f.endRow=c},render:function(){var a=this;a.el=$("<div class='flickr'></div>");if(a.applyTo){$(a.applyTo).append(a.el)}else{$(a.renderTo).append(a.el)}a.visible=(a.visible==undefined)?true:a.visible;if(!a.visible){a.el.hide()}a.renderButton()},renderButton:function(){var j=this,f;j.resetParam();var c=j.curPage,h=j.itemTotal||0,l=j.rowCount,k=j.pageCount,m=j.startPage,e=j.endPage,d=$(j.el),b="loadPage";d.html("");var a="<a href='{0}' command='{3}' commandParam='{2}' page='{2}' class='button' valid='false'>{1}</a>";if(c>0){d.append($.format(a,j.getFirstUrl(),j.firstText,0,b))}else{d.append($.format("<span class='disabled'>{0}</span>",j.firstText))}if(c>0){d.append($.format(a,j.getPrevUrl(),j.prevText,c-1,b))}else{d.append($.format("<span class='disabled'>{0}</span>",j.prevText))}for(f=m;f<=e;f++){var n=$.format(j.urlFormat,f);if(f==c){d.append($.format("<span class='current'>{0}</span>",f+1))}else{d.append($.format(a,n,f+1,f,b))}}if(c<k-1){d.append($.format(a,j.getNextUrl(),j.nextText,c+1,b));d.append($.format(a,j.getLastUrl(),j.lastText,k-1,b))}else{d.append($.format("<span class='disabled'>{0}</span>",j.nextText));d.append($.format("<span class='disabled'>{0}</span>",j.lastText))}if(j.click){var g=d.children("a.button");$(g).click(function(){var i=parseInt($(this).attr("page"));j.click.call(this,i,j.store);return false})}d.append($.format("当前记录 {0}--{1} 条,共 {2} 条记录",j.startRow+1,j.endRow,h))},show:function(){var b=this,a=b.el;a.show()},hide:function(){var b=this,a=b.el;a.hide()}},function(){var a=this;Mini2.apply(this,arguments[0]);a.constructor()});