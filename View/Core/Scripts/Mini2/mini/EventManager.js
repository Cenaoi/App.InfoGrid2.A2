Mini2.EventManager=new function(){var b=this,a=document,c=window;Mini2.apply(b,{con:null,scope:null,data:null,drag:false,stopEvent:function(d){d=d||window.event;if(d){this.stopPropagation(d);this.preventDefault(d)}},stopPropagation:function(d){d=d||window.event;if(d.stopPropagation){d.stopPropagation()}else{d.cancelBubble=false}},preventDefault:function(d){d=d||window.event;if(d.preventDefault){d.preventDefault()}else{d.returnValue=false}},withinOne:function(e,h,d){var f=this;if(d&&typeof d=="object"&&d.el){d=d.el}if(d){if(e==d||e===d){return true}var g=$(d).find(e);return(g.length>0)}},within:function(f,k,d){var j=this;if(f&&typeof f=="object"&&f.el){f=f.el}if(!f){return false}if(d instanceof Array){var e=d,g=0,l,h;for(;g<e.length;g++){l=e[g];h=j.withinOne(f,k,l);if(h){return true}}}else{return j.withinOne(f,k,d)}return false},offsetParent:function(e){var d=$(e),f=0;if(d.hasClass("mi-border-box")){return e}for(;f<99;f++){d=d.parent();if(d.hasClass("mi-border-box")){break}}return d},getBorderBox:function(e){var g=this;if(e==undefined||e==null){return g}if(e.toString()=="[object Window]"){e=window.document.body}if(e&&e.el){if(e.el.jquery){e=e.el.get(0)}else{if(Mini2.isDom(e.el)){e=e.el}}}if(!Mini2.isDom(e)){return g}var d;if($(e).hasClass("mi-border-box")){d=$(e)}else{d=g.offsetParent(e)}var f=null;if(d.size()>0){f=d.data("EVENT_MANAGER");if(!f){f={control:null,data:null,scope:null,el:d.get(0),typeString:d.get(0).toString(),muid:"F_"+Mini2.getIdentity()};d.data("EVENT_MANAGER",f)}return f}return g},curControl:function(){var d=this,e=d.getBorderBox(con);return e.con},clear:function(d){var e=this,f=e.getBorderBox(d);f.con=null;f.scope=null},setScope:function(d,g){var e=this,f=e.getBorderBox(d);f.con=d;f.scope=g},setKeyDown:function(d,f,i){var g=this,h=this.getBorderBox(d);if(h.con!=null){return}h.con=d;h.scope=i;$(d).trigger("keydown",f);g.stopEvent(f)},setKeyUp:function(f,g){var h=this,i=this.getBorderBox(f);var d=h.within(f,null,h.scope);if(d){$(f).trigger("keyup",g)}else{Mini2.ui.FocusMgr.setControl(f)}i.con=null;h.stopEvent(g)},setMouseDown:function(d,f,j,g,e){var h=this,i=this.getBorderBox(j||d);h.borderBox=i;i.mouseUp_repetition="no";if(i.con!=null){return}if(j==undefined){j=d}i.con=d;i.scope=j;i.data=f;if(d&&!e){h.stopEvent(g)}},borderBox:null,setMouseMove:function(d,e){var h=this,i=h.borderBox||this.getBorderBox(d),f=i.con,g=i.scope;if(f){$(f).triggerHandler("mu_mousemove",[e])}else{$(d).triggerHandler("mu_mousemove",[e])}h.stopEvent(e)},setMouseUp:function(d,e){var h=this,i=h.borderBox||this.getBorderBox(d);var f=i.con,g=i.scope;if(i.con&&i.mouseUp_repetition=="no"){i.mouseUp_repetition="yes";$(i.con).triggerHandler("mu_mouseup",[e]);i.con=null;i.data=null;if(e==null){alert("没有事件啊")}h.stopPropagation(e);h.borderBox=null}},addListener:function(d,e,f,h,g){},removeListener:function(d,e,f,g){}})};$(window).keydown(function(b){var d=b.keyCode,c=Mini2.ui.FocusMgr.control,f=b.target.tagName;if(f=="TEXTAREA"){return}if(d==9){var a=Mini2.ui.FocusMgr.data;if(c!=null){$(c).triggerHandler("keydown",{data:a})}Mini2.EventManager.stopEvent(b)}else{if(d==13){Mini2.EventManager.stopEvent(b)}}});$(window).mousedown(function(a){}).mouseup(function(a){var c=a.keyCode,b=Mini2.ui.FocusMgr.control,f=a.target,d=f.tagName;if(f&&$(f).hasClass("mi-mask")){Mini2.EventManager.stopEvent(a);return}Mini2.ui.FocusMgr.setControl(this);Mini2.EventManager.setMouseUp(this,a)}).mousemove(function(a){Mini2.EventManager.setMouseMove(this,a)});