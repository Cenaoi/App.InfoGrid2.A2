/// Mini2.js 创建日期:2021/6/11 19:21:55
/*
 * artTemplate - Template Engine
 * https://github.com/aui/artTemplate
 * Released under the MIT, BSD, and GPL Licenses
 */
!(function(){var x=function(B,A){return typeof A==="string"?c(A,{filename:B}):s(B,A)};x.version="3.0.0";x.config=function(A,B){e[A]=B};var e=x.defaults={openTag:"<%",closeTag:"%>",escape:true,cache:true,compress:false,parser:null};var b=x.cache={};x.render=function(B,A){return c(B,A)};var s=x.renderFile=function(B,A){var C=x.get(B)||t({filename:B,name:"Render Error",message:"Template not found"});return A?C(A):C};x.get=function(C){var A;if(b[C]){A=b[C]}else{if(typeof document==="object"){var B=document.getElementById(C);if(B){var D=(B.value||B.innerHTML).replace(/^\s*|\s*$/g,"");A=c(D,{filename:C})}}}return A};var y=function(B,A){if(typeof B!=="string"){A=typeof B;if(A==="number"){B+=""}else{if(A==="function"){B=y(B.call(B))}else{B=""}}}return B};var i={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"};var g=function(A){return i[A]};var h=function(A){return y(A).replace(/&(?![\w#]+;)|[<>"']/g,g)};var n=Array.isArray||function(A){return({}).toString.call(A)==="[object Array]"};var f=function(B,A){var C,D;if(n(B)){for(C=0,D=B.length;C<D;C++){A.call(B,B[C],C,B)}}else{for(C in B){A.call(B,B[C],C)}}};var z=x.utils={$helpers:{},$include:s,$string:y,$escape:h,$each:f};x.helper=function(B,A){m[B]=A};var m=x.helpers=z.$helpers;x.onerror=function(A){var B="Template Error\n\n";for(var C in A){B+="<"+C+">\n"+A[C]+"\n\n"}if(typeof console==="object"){console.error(B)}};var t=function(A){x.onerror(A);return function(){return"{Template Error}"}};var c=x.compile=function(G,D){D=D||{};for(var C in e){if(D[C]===undefined){D[C]=e[C]}}var B=D.filename;try{var F=d(G,D)}catch(A){A.filename=B||"anonymous";A.name="Syntax Error";return t(A)}function E(H){try{return new F(H,B)+""}catch(I){if(!D.debug){D.debug=true;return c(G,D)(H)}return t(I)()}}E.prototype=F.prototype;E.toString=function(){return F.toString()};if(B&&D.cache){b[B]=E}return E};var k=z.$each;var o="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined";var r=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g;var u=/[^\w$]+/g;var p=new RegExp(["\\b"+o.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g");var q=/^\d[^,]*|,\d[^,]*/g;var a=/^,+|,+$/g;var v=/^$|,+/;function l(A){return A.replace(r,"").replace(u,",").replace(p,"").replace(q,"").replace(a,"").split(v)}function w(A){return"'"+A.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function d(V,Q){var E=Q.debug;var P=Q.openTag;var A=Q.closeTag;var R=Q.parser;var C=Q.compress;var G=Q.escape;var M=1;var W={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1};var L="".trim;var U=L?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"];var D=L?"$out+=text;return $out;":"$out.push(text);";var S="function(){var text=''.concat.apply('',arguments);"+D+"}";var K="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+D+"}";var I="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(E?"$line=0,":"");var O=U[0];var H="return new String("+U[3]+");";k(V.split(P),function(Z){Z=Z.split(A);var X=Z[0];var Y=Z[1];if(Z.length===1){O+=J(X)}else{O+=N(X);if(Y){O+=J(Y)}}});var B=I+O+H;if(E){B="try{"+B+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+w(V)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}"}try{var T=new Function("$data","$filename",B);T.prototype=z;return T}catch(F){F.temp="function anonymous($data,$filename) {"+B+"}";throw F}function J(X){M+=X.split(/\n/).length-1;if(C){X=X.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")}if(X){X=U[1]+w(X)+U[2]+"\n"}return X}function N(X){var aa=M;if(R){X=R(X,Q)}else{if(E){X=X.replace(/\n/g,function(){M++;return"$line="+M+";"})}}if(X.indexOf("=")===0){var Y=G&&!/^=[=#]/.test(X);X=X.replace(/^=[=#]?|[\s;]*$/g,"");if(Y){var Z=X.replace(/\s*\([^\)]+\)/,"");if(!z[Z]&&!/^(include|print)$/.test(Z)){X="$escape("+X+")"}}else{X="$string("+X+")"}X=U[1]+X+U[2]}if(E){X="$line="+aa+";"+X}k(l(X),function(ab){if(!ab||W[ab]){return}var ac;if(ab==="print"){ac=S}else{if(ab==="include"){ac=K}else{if(z[ab]){ac="$utils."+ab}else{if(m[ab]){ac="$helpers."+ab}else{ac="$data."+ab}}}}I+=ab+"="+ac+",";W[ab]=true});return X+"\n"}}e.openTag="{{";e.closeTag="}}";var j=function(C,B){var E=B.split(":");var D=E.shift();var A=E.join(":")||"";if(A){A=", "+A}return"$helpers."+D+"("+C+A+")"};e.parser=function(D,K){D=D.replace(/^\s/,"");var M=D.split(" ");var H=M.shift();var A=M.join(" ");switch(H){case"if":D="if("+A+"){";break;case"else":if(M.shift()==="if"){M=" if("+M.join(" ")+")"}else{M=""}D="}else"+M+"{";break;case"/if":D="}";break;case"each":var J=M[0]||"$data";var C=M[1]||"as";var O=M[2]||"$value";var G=M[3]||"$index";var L=O+","+G;if(C!=="as"){J="[]"}D="$each("+J+",function("+L+"){";break;case"/each":D="});";break;case"echo":D="print("+A+");";break;case"print":case"include":D=H+"("+M.join(",")+");";break;default:if(/^\s*\|\s*[\w\$]/.test(A)){var E=true;if(D.indexOf("#")===0){D=D.substr(1);E=false}var F=0;var B=D.split("|");var I=B.length;var N=B[F++];for(;F<I;F++){N=j(N,B[F])}D=(E?"=":"=#")+N}else{if(x.helpers[H]){D="=#"+H+"("+M.join(",")+");"}else{D="="+D}}break}return D};if(typeof define==="function"){define(function(){return x})}else{if(typeof exports!=="undefined"){module.exports=x}else{this.template=x}}})();
var Mini2=Mini2||{};Mini2._startTime=new Date().getTime();Mini2.classDefine={};Mini2.singleton={};Mini2.identity=0;Mini2.onwerPage=Mini2.onwerPage||{};Mini2.onwerPage.controls=Mini2.onwerPage.controls||{};Mini2.find=function(a){return Mini2.onwerPage.controls[a]};Mini2.onwerPage.typeahead=[];enumerables=true;enumerablesTest={toString:1};Mini2.getIdentity=function(){Mini2.identity++;return Mini2.identity};Mini2.newId=Mini2.getIdentity;Mini2.ClassType=function(){};Mini2.extend=function(b,c){var a=function(){};a.prototype=c.prototype;b.prototype=new a();b.prototype.constructor=b;b.base=c.prototype;if(c.prototype.constructor==Object.prototype.constructor){c.prototype.constructor=c}return b};Mini2.overriden=function(b,c){if(c){var d=b.prototype;for(var a in c){d[a]=c[a]}}};Mini2.apply=function(f,a,b){if(b){Mini2.apply(f,b)}if(f&&a&&typeof a==="object"){var c,d,e;for(c in a){f[c]=a[c]}}return f};Mini2.applyIf=function(b,a){if(b&&a){for(var d in a){if(typeof b[d]=="undefined"){b[d]=a[d]}}}return b};Mini2.ns=function(c){var d,f=c.split("."),b=f.length,e=Mini2,a;for(a=1;a<b;a++){d=f[a];if(!e[d]){e[d]={}}e=e[d]}};Mini2.defineClass=function(c,b){if(!c){return}var h=c.split("."),e=h.length,a=h[e-1],g=Mini2,d,f;if("Mini2"!=h[0]){if(e>=2){var j=h[0];g=window[j];if(!g){g=window[j]={}}}}for(d=1;d<e-1;d++){f=h[d];if(!g[f]){g[f]={}}g=g[f]}g[a]=b;return a};Mini2.define=function(fullname,codeObj,returnFn){var F,extend,mixins,extendObj,name,funType;if(codeObj instanceof Function){Mini2.classDefine[fullname]=codeObj;return codeObj}F=function(){return((typeof this._returnFn=="function")?this._returnFn((arguments.length>0?arguments[0]:false),(arguments.length>1?arguments[1]:false)):this._returnFn)};extend=codeObj.extend;mixins=codeObj.mixins;if(undefined!=extend&&extend!=null&&extend!=""){extendObj=Mini2.classDefine[extend];if(undefined===extendObj){throw new Error(fullname+"继承对象 '"+extend+"' 不存在")}Mini2.extend(F,extendObj)}if(mixins){if(Mini2.isString(mixins)){mixins=[mixins]}var mmm=null;for(var i=0;i<mixins.length;i++){mmm=mixins[i];extendObj=Mini2.classDefine[mmm];if(undefined===extendObj){throw new Error(fullname+"继承对象 "+mmm+" 不存在")}Mini2.extend(F,extendObj)}}Mini2.overriden(F,codeObj);if(returnFn!=undefined){F.prototype._returnFn=returnFn}Mini2.classDefine[fullname]=F;name=Mini2.defineClass(fullname,F);funType=new Mini2.ClassType();funType.fullName=fullname;funType.name=name;F.prototype.getType=function(){return eval("this.classType")};F.prototype.classType=funType;if(codeObj.alternateClassName){var i,altName,altNames=codeObj.alternateClassName,len;if(Mini2.isString(altNames)){altNames=[altNames]}len=altNames.length;for(i=0;i<len;i++){altName=altNames[i];Mini2.classDefine[altName]=F;Mini2.defineClass(altName,F)}}if(codeObj.alias){Mini2.ClassManager.setAlias(fullname,codeObj.alias)}if(codeObj.singleton){return Mini2.create(fullname)}return F};Mini2.createSingleton=function(c,d,h){var g=Mini2.singleton[d];if(g!=undefined){return g}g=new c(h);g.muid="mu_"+Mini2.newId();for(var e in h){newObj[e]=h[e]}Mini2.singleton[d]=g;Mini2.defineClass(d,g);if(c.prototype.alternateClassName){var b=c.prototype.alternateClassName,a,e,f;if(Mini2.isString(b)){b=[b]}f=b.length;for(e=0;e<f;e++){a=b[e];Mini2.singleton[a]=g;Mini2.defineClass(a,g)}}return g};Mini2.create=function(b,d){var c=null,a;if(Mini2.String.startsWith(b,"widget.")){b=Mini2.ClassManager.getNameByAlias(b)}a=Mini2.classDefine[b];if(undefined===a){throw new Error("对象 "+b+" 不存在, 无法创建实例.")}d=d||{};if(a.prototype.singleton){c=Mini2.createSingleton(a,b,d)}else{d.muid="mu_"+Mini2.newId();c=new a(d);if(undefined===a.prototype._returnFn){Mini2.apply(c,d)}}return c};Mini2.createTop=function(a,c){var b=Mini2.getTopMini2();return b.create(a,c)};Mini2.createByAlias=function(a,e){var d,c,b;c=Mini2.ClassManager.getNameByAlias(a);b=Mini2.classDefine[c];e.muid="mu_"+Mini2.newId();d=new b(e);if(undefined===b.prototype._returnFn){Mini2.apply(d,e)}return d};Mini2.__isDisignMode=false;Mini2.designMode=function(a){if(arguments.length==0){return Mini2.__isDisignMode}else{Mini2.__isDisignMode=!!a}};Mini2.support={};Mini2.support.mozilla=/firefox/.test(navigator.userAgent.toLowerCase())||/mozilla/.test(navigator.userAgent.toLowerCase());Mini2.support.webkit=/webkit/.test(navigator.userAgent.toLowerCase());Mini2.support.opera=/opera/.test(navigator.userAgent.toLowerCase());Mini2.support.msie=/msie/.test(navigator.userAgent.toLowerCase());Mini2.support.ipad=/ipad/.test(navigator.userAgent.toLowerCase());Mini2.support.iphone=/iphone os/.test(navigator.userAgent.toLowerCase());Mini2.support.android=/android/.test(navigator.userAgent.toLowerCase());Mini2.apply(Mini2,{emptyFn:function(){},baseCSSPrefix:"mi-",toString:Object.prototype.toString,defaultEl:$("<div></div>"),isEmpty:function(a){if(a==undefined||a==null){return true}if(typeof a=="string"){if(a==""){return true}}return false},getBody:function(){return $(document.body)},iterableRe:/\[object\s*(?:Array|Arguments|\w*Collection|\w*List|HTML\s+document\.all\s+class)\]/,getParentWindow:function(){var b=window;var a=0;for(a=0;a<9;a++){if(b.parent==b||b.parent==undefined){break}b=b.parent}return b},getTopMini2:function(){var c=window;var f=[window];var b=0;for(b=0;b<9;b++){if(c.parent===c||c.parent===undefined){break}c=c.parent;f.push(c)}var e=f.length;var d=Mini2;while(e--){var a=f[e];if(a.Mini2){d=a.Mini2;break}}return d},$joinStr:function(a){var b=a.join("");return $(b)},$join:function(a){var b=Mini2.join(a);return $(b)},join:function(a){if(Mini2.isString(a)){return a}return a.join("")},typeOf:function(c){var a,b;if(c===null){return"null"}a=typeof c;if(a==="undefined"||a==="string"||a==="number"||a==="boolean"){return a}b=Object.prototype.toString.call(c);switch(b){case"[object Array]":return"array";case"[object Date]":return"date";case"[object Boolean]":return"boolean";case"[object Number]":return"number";case"[object RegExp]":return"regexp"}if(a==="function"){return"function"}if(a==="object"){if(c.nodeType!==undefined){if(c.nodeType===3){return(nonWhitespaceRe).test(c.nodeValue)?"textnode":"whitespace"}else{return"element"}}return"object"}},clone:function(c){var g,b,d,e,a,f;if(c===null||c===undefined){return c}if(c.nodeType&&c.cloneNode){return c.cloneNode(true)}g=Object.prototype.toString.call(c);if(g==="[object Date]"){return new Date(c.getTime())}if(g==="[object Array]"){b=c.length;a=[];while(b--){a[b]=Mini2.clone(c[b])}}else{if(g==="[object Object]"&&c.constructor===Object){a={};for(f in c){a[f]=Mini2.clone(c[f])}if(enumerables){for(d=enumerables.length;d--;){e=enumerables[d];if(c.hasOwnProperty(e)){a[e]=c[e]}}}}}return a||c},isString:function(a){if(a===false){return}return(typeof a=="string")||(a instanceof String)},isDate:function(a){if(a===false){return}return Object.prototype.toString.call(a)==="[object Date]"},isArray:function(a){return a&&(a.isArray||$.isArray(a))},isFunction:function(a){return $.isFunction(a)},isBoolean:function(a){return(typeof a==="boolean")},isNumber:function(a){return(typeof a==="number")},isDom:function(d){if(!d){return false}var c=d.toString();var a=c.length;if(a<12){return false}var b=c.substr(0,12);return(b==="[object HTML")},type:function(a){},isIterable:function(a){if(!a||typeof a.length!=="number"||typeof a==="string"){return false}if(a.muid){return true}if(!a.propertyIsEnumerable){return !!a.item}if(a.hasOwnProperty("length")&&!a.propertyIsEnumerable("length")){return true}return this.iterableRe.test(Object.prototype.toString.call(a))},functionFactory:function(){var c=this,a=Array.prototype.slice.call(arguments),b;if(Mini2.isSandboxed){b=a.length;if(b>0){b--;a[b]="var Mini=window."+Mini2.name+";"+a[b]}}return Function.prototype.constructor.apply(Function.prototype,a)},isDefined:function(a){return typeof a!=="undefined"},alertProps:function(b){var c="";for(var a in b){c+=a+" = "+b[a]+"\n"}alert(c)}});jQuery.fn.extend({cFirst:function(a){return $(this).children(a+":first")},mFind:function(a){return $(this).find(a+":first")},addCls:function(c){var b=arguments,a=$(this),d=0,e;if(Mini2.isArray(c)){b=c}e=b.length;for(d=0;d<e;d++){a.addClass(b[d])}return this},removeCls:function(b){var a=arguments,c;if(Mini2.isArray(b)){a=b}c=a.length;while(c--){$(this).removeClass(a[c])}},muBind:function(b,a,d){if(arguments.length==2){d=arguments[1];a=null}var e=this;if(typeof d!="function"){throw new Error("参数必须是 function 对象")}switch(b){case"mousedown":$(e).on(b,a,function(f){Mini2.EventManager.setMouseDown(this,a,null,f);d.call(this,f,this)});break;case"mouseup":$(e).on("mu_"+b,d);$(e).on(b,a,function(f){Mini2.EventManager.setMouseUp(this,f)});break;case"mousemove":$(e).on("mu_"+b,d);$(e).on(b,a,function(f){Mini2.EventManager.setMouseMove(this,f)});break;default:if(e.length==0){console.error('对象不存在,无法绑定事件 "'+b+'";')}if(e[0].muid&&("focusout"==b||"focusin"==b)){b="mu_focusout"}try{e.on(b,a,d)}catch(c){console.error("这个错误肯定是 JQuery 3.0 产生的错误. 事件名:"+b);throw c}break}return e},muTriggerHandler:function(a,b){var c=this;if(c[0].muid&&("focusout"==a||"focusin"==a)){a="mu_focusout"}c.triggerHandler(a,b)}});$.format=function(b,a){if(arguments.length==1){return function(){var c=$.makeArray(arguments);c.unshift(b);return $.format.apply(this,c)}}if(arguments.length>2&&a.constructor!=Array){a=$.makeArray(arguments).slice(1)}if(a.constructor!=Array){a=[a]}$.each(a,function(c,d){b=b.replace(new RegExp("\\{"+c+"\\}","g"),d)});return b};$(document).ready(function(){$(document.body).addClass("mi-webkit mi-border-box mi-body")});
Mini2.ClassManager=new function(){var a=this;Mini2.apply(a,{maps:{alternateToName:{},aliasToName:{},nameToAliases:{},nameToAlternates:{}},setAlias:function(e,b){var g=this,f=g.maps,c=f.aliasToName,h=f.nameToAliases,d;if(typeof e=="string"){d=e}else{d=this.getName(e)}if(b&&c[b]!==d){c[b]=d}if(!h[d]){h[d]=[]}if(b){Mini2.Array.include(h[d],b)}return g},getName:function(b){return b},getNameByAlias:function(b){return this.maps.aliasToName[b]||""},})};
Mini2.post=function(e,b,d,a){var c=this;if($.isFunction(b)){a=d;d=b;b=null}$.post(e,b,function(f){Mini2.Ajax.proResult(f,d,a)})};Mini2.get=function(e,b,d,a){var c=this;if($.isFunction(b)){a=d;d=b;b=null}$.get(e,b,function(f){Mini2.Ajax.proResult(f,d,a)})};Mini2.Ajax=new function(){Mini2.apply(this,{proResult:function(e,c,a){var d;try{d=JSON.parse(e)}catch(b){console.error("解析服务器反馈消息包错误,数据内容: ",e);return}if(d.success===true||d.success===false){try{this.proResutV1(d,e,c,a)}catch(b){console.error("反馈后执行错误",b);console.trace()}}else{if(d.result){try{this.proResultV2(d,e,c,a)}catch(b){console.error("反馈后执行错误",b);console.trace()}}}},proResutV1:function(d,e,c,b){if(d.success){var a=d.data;if(c){c(a,d,e)}}else{if(b){b(d,e)}else{console.error("(v1)服务器反馈消息",d.error_msg||d.msg);if(Mini2.Msg&&Mini2.Msg.alert){}}}},proResultV2:function(d,e,c,b){if("ok"==d.result){var a=d.data;if(c){c(a,d,e)}}else{if(b){b(d,e)}else{console.error("(v2)服务器反馈消息 ",d.error_msg||d.msg);if(Mini2.Msg&&Mini2.Msg.alert){}}}}})};
Mini2.define("Mini2.Timer",{owner:null,enabled:false,interval:100,count:0,limit:0,overtime:0,timeStart:null,tick:Mini2.emptyFn,timer:null,stop:function(){var a=this;a.enabled=false;if(a.timer){clearTimeout(a.timer);delete a.timer}return a},start:function(){var a=this;if(!a.enabled){a.timeStart=new Date().getTime();a.enabled=true;a.callTick()}return a},reset:function(){var a=this;a.count=0;a.timeStart=new Date().getTime();return a},resetStart:function(){var a=this;a.reset().start();return a},restart:function(){var a=this;a.reset().start();return a},callTick:function(){var b=this,e=b.owner,c,a=b.limit,d=b.overtime,f;if(!b.enabled){return}if(a>0&&b.count>=a){b.stop();return}if(d>0){c=new Date();span=c.getTime()-b.timeStart;if(span>=d){b.stop();return}}b.timer=setTimeout(function(){c=new Date();span=c.getTime()-b.timeStart;if(span>=b.interval){f=b.tick.call(e);b.count++;if(false===f){b.stop();return}}b.callTick.call(b)},b.interval)}},function(){var a=this;Mini2.apply(this,arguments[0]);this.start()});Mini2.setTimer=function(c,b){var d,a={};if(undefined==b){}else{if(Mini2.isArray(b)){a=Mini2.apply(a,{interval:b[0],limit:b[1]})}else{if(Mini2.isNumber(b)){a.interval=b}else{a=Mini2.apply(a,b)}}}a.tick=c;d=Mini2.create("Mini2.Timer",a);return d};Mini2.run1_data={};Mini2.awaitRun=function(a,c,f,g){var e=this;var b=Mini2.run1_data;var d=b[a];if(d){d.restart()}else{d=Mini2.setTimer(function(){g.call(f);delete e.run1_data[a]},[c,1]);d.owner=e;b[a]=d}};
Mini2.Guid=new function(){Mini2.apply(this,{newGuid:function(a){var b="",c,d;a=a||"D";if(a=="D"){for(c=1;c<=32;c++){d=Math.floor(Math.random()*16).toString(16);b+=d;if((c==8)||(c==12)||(c==16)||(c==20)){b+="-"}}}else{if(a=="N"){for(c=1;c<=32;c++){d=Math.floor(Math.random()*16).toString(16);b+=d}}}return b}})};
Mini2.Function={bind:function(c,e,b,a){if(arguments.length===2){return function(){return c.apply(e,arguments)}}var d=c,f=Array.prototype.slice;return function(){var g=b||arguments;if(a===true){g=f.call(arguments,0);g=g.concat(b)}else{if(typeof a=="number"){g=f.call(arguments,0);Mini2.Array.insert(g,a,b)}}return d.apply(e||Ext.global,g)}}};
Mini2.Json=new function(){Mini2.apply(this,{toJson:function(b){if(b==undefined){return'""'}var c=[];if(typeof b=="string"){return'"'+b.replace(/([\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t").replace(/\+/g,"%2B")+'"'}if(Mini2.isDate(b)){return'"'+Mini2.Date.format(b,"Y-m-d H:i:s.u")+'"'}if(typeof b=="object"){if(!b.sort){for(var a in b){c.push('"'+a+'":'+Mini2.Json.toJson(b[a]))}if(!!document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(b.toString)){c.push("toString:"+b.toString.toString())}c="{"+c.join()+"}"}else{for(var a=0;a<b.length;a++){c.push(Mini2.Json.toJson(b[a]))}c="["+c.join()+"]"}return c}return b.toString().replace(/\"\:/g,'":""')}})};
Mini2.Array=new function(){Mini2.apply(this,{clone:Mini2.clone,contains:function(f,d,c){var b=false,a=0,e=f.length;if(c){for(;a<e;a++){if(f[a]==d){b=true;break}}}else{for(;a<e;a++){if(f[a]===d){b=true;break}}}return b},lastIndexOf:function(e,b){var d=-1,c=e.length,a=c;while(a--){if(e[a]===b){d=a;break}}return d},indexOf:function(f,b){var d=-1,a=0,e=false,g,c=f.length;if(Mini2.isFunction(b)){for(;a<c;a++){g=f[a];e=b.call(g);if(e){d=a;break}}}else{for(;a<c;a++){if(f[a]===b){d=a;break}}}return d},add:function(b,a){b.push(a)},include:function(d,b){var a=[];if(this.contains(d,b)){return}d.push(b)},remove:function(e,b){var a=[],d;d=this.indexOf(e,b);if(d>-1){e.splice(d,1)}return d},move:function(d,a,e){var b=d[a],c=e;d.splice(a,1);if(a>e){c++}d.splice(c,0,b)}})};
Mini2.Date=new function(){var h=this,g=/(\\.)/g,c=/([gGhHisucUOPZ]|MS)/,b=/([djzmnYycU]|MS)/,f=/\\/gi,e=/\{(\d+)\}/g,d=new RegExp("\\/Date\\(([-+])?(\\d+)(?:[+-]\\d{4})?\\)\\/"),a=["var me = this, dt, y, m, d, h, i, s, ms, o, O, z, zz, u, v, W, year, jan4, week1monday, daysInMonth, dayMatched,","def = me.defaults,","from = Mini2.Number.from,","results = String(input).match(me.parseRegexes[{0}]);","if(results){","{1}","if(u != null){","v = new Date(u * 1000);","}else{","dt = me.clearTime(new Date);","y = from(y, from(def.y, dt.getFullYear()));","m = from(m, from(def.m - 1, dt.getMonth()));","dayMatched = d !== undefined;","d = from(d, from(def.d, dt.getDate()));","if (!dayMatched) {","dt.setDate(1);","dt.setMonth(m);","dt.setFullYear(y);","daysInMonth = me.getDaysInMonth(dt);","if (d > daysInMonth) {","d = daysInMonth;","}","}","h  = from(h, from(def.h, dt.getHours()));","i  = from(i, from(def.i, dt.getMinutes()));","s  = from(s, from(def.s, dt.getSeconds()));","ms = from(ms, from(def.ms, dt.getMilliseconds()));","if(z >= 0 && y >= 0){","v = me.add(new Date(y < 100 ? 100 : y, 0, 1, h, i, s, ms), me.YEAR, y < 100 ? y - 100 : 0);","v = !strict? v : (strict === true && (z <= 364 || (me.isLeapYear(v) && z <= 365))? me.add(v, me.DAY, z) : null);","}else if(strict === true && !me.isValid(y, m + 1, d, h, i, s, ms)){","v = null;","}else{","if (W) {","year = y || (new Date()).getFullYear(),","jan4 = new Date(year, 0, 4, 0, 0, 0),","week1monday = new Date(jan4.getTime() - ((jan4.getDay() - 1) * 86400000));","v = Mini2.Date.clearTime(new Date(week1monday.getTime() + ((W - 1) * 604800000)));","} else {","v = me.add(new Date(y < 100 ? 100 : y, m, d, h, i, s, ms), me.YEAR, y < 100 ? y - 100 : 0);","}","}","}","}","if(v){","if(zz != null){","v = me.add(v, me.SECOND, -v.getTimezoneOffset() * 60 - zz);","}else if(o){","v = me.add(v, me.MINUTE, -v.getTimezoneOffset() + (sn == '+'? -1 : 1) * (hr * 60 + mn));","}","}","return v;"].join("\n");function i(k){var j=Array.prototype.slice.call(arguments,1);return k.replace(e,function(n,l){return j[l]})}Mini2.apply(h,{now:Date.now||function(){return +new Date()},toString:function(j){var k=Mini2.String.leftPad;return j.getFullYear()+"-"+k(j.getMonth()+1,2,"0")+"-"+k(j.getDate(),2,"0")+"T"+k(j.getHours(),2,"0")+":"+k(j.getMinutes(),2,"0")+":"+k(j.getSeconds(),2,"0")},getElapsed:function(j,k){return Math.abs(j-(k||h.now()))},useStrict:false,formatCodeToRegex:function(j,k){var l=h.parseCodes[j];if(l){l=typeof l=="function"?l():l;h.parseCodes[j]=l}return l?Mini2.applyIf({c:l.c?i(l.c,k||"{0}"):l.c},l):{g:0,c:null,s:Mini2.String.escapeRegex(j)}},parseFunctions:{MS:function(j,l){var k=(j||"").match(d);return k?new Date(((k[1]||"")+k[2])*1):null},time:function(j,l){var k=parseInt(j,10);if(k||k===0){return new Date(k)}return null},timestamp:function(j,l){var k=parseInt(j,10);if(k||k===0){return new Date(k*1000)}return null}},parseRegexes:[],formatFunctions:{MS:function(){return"\\/Date("+this.getTime()+")\\/"},time:function(){return this.getTime().toString()},timestamp:function(){return h.format(this,"U")}},y2kYear:50,MILLI:"ms",SECOND:"s",MINUTE:"mi",HOUR:"h",DAY:"d",MONTH:"mo",YEAR:"y",defaults:{},dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNumbers:{January:0,Jan:0,February:1,Feb:1,March:2,Mar:2,April:3,Apr:3,May:4,June:5,Jun:5,July:6,Jul:6,August:7,Aug:7,September:8,Sep:8,October:9,Oct:9,November:10,Nov:10,December:11,Dec:11},defaultFormat:"m/d/Y",getShortMonthName:function(j){return Mini2.Date.monthNames[j].substring(0,3)},getShortDayName:function(j){return Mini2.Date.dayNames[j].substring(0,3)},getMonthNumber:function(j){return Mini2.Date.monthNumbers[j.substring(0,1).toUpperCase()+j.substring(1,3).toLowerCase()]},formatContainsHourInfo:function(j){return c.test(j.replace(g,""))},formatContainsDateInfo:function(j){return b.test(j.replace(g,""))},unescapeFormat:function(j){return j.replace(f,"")},formatCodes:{d:"Mini2.String.leftPad(this.getDate(), 2, '0')",D:"Mini2.Date.getShortDayName(this.getDay())",j:"this.getDate()",l:"Mini2.Date.dayNames[this.getDay()]",N:"(this.getDay() ? this.getDay() : 7)",S:"Mini2.Date.getSuffix(this)",w:"this.getDay()",z:"Mini2.Date.getDayOfYear(this)",W:"Mini2.String.leftPad(Mini2.Date.getWeekOfYear(this), 2, '0')",F:"Mini2.Date.monthNames[this.getMonth()]",m:"Mini2.String.leftPad(this.getMonth() + 1, 2, '0')",M:"Mini2.Date.getShortMonthName(this.getMonth())",n:"(this.getMonth() + 1)",t:"Mini2.Date.getDaysInMonth(this)",L:"(Mini2.Date.isLeapYear(this) ? 1 : 0)",o:"(this.getFullYear() + (Mini2.Date.getWeekOfYear(this) == 1 && this.getMonth() > 0 ? +1 : (Mini2.Date.getWeekOfYear(this) >= 52 && this.getMonth() < 11 ? -1 : 0)))",Y:"Mini2.String.leftPad(this.getFullYear(), 4, '0')",y:"('' + this.getFullYear()).substring(2, 4)",a:"(this.getHours() < 12 ? 'am' : 'pm')",A:"(this.getHours() < 12 ? 'AM' : 'PM')",g:"((this.getHours() % 12) ? this.getHours() % 12 : 12)",G:"this.getHours()",h:"Mini2.String.leftPad((this.getHours() % 12) ? this.getHours() % 12 : 12, 2, '0')",H:"Mini2.String.leftPad(this.getHours(), 2, '0')",i:"Mini2.String.leftPad(this.getMinutes(), 2, '0')",s:"Mini2.String.leftPad(this.getSeconds(), 2, '0')",u:"Mini2.String.leftPad(this.getMilliseconds(), 3, '0')",O:"Mini2.Date.getGMTOffset(this)",P:"Mini2.Date.getGMTOffset(this, true)",T:"Mini2.Date.getTimezone(this)",Z:"(this.getTimezoneOffset() * -60)",c:function(){var j,k,n,o,m;for(j="Y-m-dTH:i:sP",k=[],n=0,o=j.length;n<o;++n){m=j.charAt(n);k.push(m=="T"?"'T'":h.getFormatCode(m))}return k.join(" + ")},U:"Math.round(this.getTime() / 1000)"},isValid:function(r,o,j,l,n,q,p){l=l||0;n=n||0;q=q||0;p=p||0;var k=h.add(new Date(r<100?100:r,o-1,j,l,n,q,p),h.YEAR,r<100?r-100:0);return r==k.getFullYear()&&o==k.getMonth()+1&&j==k.getDate()&&l==k.getHours()&&n==k.getMinutes()&&q==k.getSeconds()&&p==k.getMilliseconds()},parse:function(k,j,m){var l=h.parseFunctions;if(l[j]==null){h.createParser(j)}return l[j].call(h,k,Mini2.isDefined(m)?m:h.useStrict)},parseDate:function(k,j,l){return h.parse(k,j,l)},getFormatCode:function(j){var k=h.formatCodes[j];if(k){k=typeof k=="function"?k():k;h.formatCodes[j]=k}return k||("'"+Mini2.String.escape(j)+"'")},createFormat:function(l){var k=[],n=false,j="",m;for(m=0;m<l.length;++m){j=l.charAt(m);if(!n&&j=="\\"){n=true}else{if(n){n=false;k.push("'"+Mini2.String.escape(j)+"'")}else{k.push(h.getFormatCode(j))}}}h.formatFunctions[l]=Mini2.functionFactory("return "+k.join("+"))},createParser:function(n){var s=h.parseRegexes.length,m=1,k=[],r=[],t=false,l="",o=0,p=n.length,j=[],q;for(;o<p;++o){l=n.charAt(o);if(!t&&l=="\\"){t=true}else{if(t){t=false;r.push(Mini2.String.escape(l))}else{q=h.formatCodeToRegex(l,m);m+=q.g;r.push(q.s);if(q.g&&q.c){if(q.calcAtEnd){j.push(q.c)}else{k.push(q.c)}}}}}k=k.concat(j);h.parseRegexes[s]=new RegExp("^"+r.join("")+"$","i");h.parseFunctions[n]=Mini2.functionFactory("input","strict",i(a,s,k.join("")))},parseCodes:{d:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(3[0-1]|[1-2][0-9]|0[1-9])"},j:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(3[0-1]|[1-2][0-9]|[1-9])"},D:function(){for(var j=[],k=0;k<7;j.push(h.getShortDayName(k)),++k){}return{g:0,c:null,s:"(?:"+j.join("|")+")"}},l:function(){return{g:0,c:null,s:"(?:"+h.dayNames.join("|")+")"}},N:{g:0,c:null,s:"[1-7]"},S:{g:0,c:null,s:"(?:st|nd|rd|th)"},w:{g:0,c:null,s:"[0-6]"},z:{g:1,c:"z = parseInt(results[{0}], 10);\n",s:"(\\d{1,3})"},W:{g:1,c:"W = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},F:function(){return{g:1,c:"m = parseInt(me.getMonthNumber(results[{0}]), 10);\n",s:"("+h.monthNames.join("|")+")"}},M:function(){for(var j=[],k=0;k<12;j.push(h.getShortMonthName(k)),++k){}return Mini2.applyIf({s:"("+j.join("|")+")"},h.formatCodeToRegex("F"))},m:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(1[0-2]|0[1-9])"},n:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(1[0-2]|[1-9])"},t:{g:0,c:null,s:"(?:\\d{2})"},L:{g:0,c:null,s:"(?:1|0)"},o:{g:1,c:"y = parseInt(results[{0}], 10);\n",s:"(\\d{4})"},Y:{g:1,c:"y = parseInt(results[{0}], 10);\n",s:"(\\d{4})"},y:{g:1,c:"var ty = parseInt(results[{0}], 10);\ny = ty > me.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"},a:{g:1,c:"if (/(am)/i.test(results[{0}])) {\nif (!h || h == 12) { h = 0; }\n} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(am|pm|AM|PM)",calcAtEnd:true},A:{g:1,c:"if (/(am)/i.test(results[{0}])) {\nif (!h || h == 12) { h = 0; }\n} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(AM|PM|am|pm)",calcAtEnd:true},g:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(1[0-2]|[0-9])"},G:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(2[0-3]|1[0-9]|[0-9])"},h:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(1[0-2]|0[1-9])"},H:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(2[0-3]|[0-1][0-9])"},i:{g:1,c:"i = parseInt(results[{0}], 10);\n",s:"([0-5][0-9])"},s:{g:1,c:"s = parseInt(results[{0}], 10);\n",s:"([0-5][0-9])"},u:{g:1,c:"ms = results[{0}]; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n",s:"(\\d+)"},O:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(3,5) / 60),","mn = o.substring(3,5) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + Mini2.String.leftPad(hr, 2, '0') + Mini2.String.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{4})"},P:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(4,6) / 60),","mn = o.substring(4,6) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + Mini2.String.leftPad(hr, 2, '0') + Mini2.String.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{2}:\\d{2})"},T:{g:0,c:null,s:"[A-Z]{1,5}"},Z:{g:1,c:"zz = results[{0}] * 1;\nzz = (-43200 <= zz && zz <= 50400)? zz : null;\n",s:"([+-]?\\d{1,5})"},c:function(){var k=[],j=[h.formatCodeToRegex("Y",1),h.formatCodeToRegex("m",2),h.formatCodeToRegex("d",3),h.formatCodeToRegex("H",4),h.formatCodeToRegex("i",5),h.formatCodeToRegex("s",6),{c:"ms = results[7] || '0'; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n"},{c:["if(results[8]) {","if(results[8] == 'Z'){","zz = 0;","}else if (results[8].indexOf(':') > -1){",h.formatCodeToRegex("P",8).c,"}else{",h.formatCodeToRegex("O",8).c,"}","}"].join("\n")}],m,n;for(m=0,n=j.length;m<n;++m){k.push(j[m].c)}return{g:1,c:k.join(""),s:[j[0].s,"(?:","-",j[1].s,"(?:","-",j[2].s,"(?:","(?:T| )?",j[3].s,":",j[4].s,"(?::",j[5].s,")?","(?:(?:\\.|,)(\\d+))?","(Z|(?:[-+]\\d{2}(?::)?\\d{2}))?",")?",")?",")?"].join("")}},U:{g:1,c:"u = parseInt(results[{0}], 10);\n",s:"(-?\\d+)"}},dateFormat:function(j,k){return h.format(j,k)},isEqual:function(j,k){if(j&&k){return(j.getTime()===k.getTime())}return !(j||k)},format:function(j,k){var l=h.formatFunctions;if(!Mini2.isDate(j)){return""}if(l[k]==null){h.createFormat(k)}return l[k].call(j)+""},getTimezone:function(j){return j.toString().replace(/^.* (?:\((.*)\)|([A-Z]{1,5})(?:[\-+][0-9]{4})?(?: -?\d+)?)$/,"$1$2").replace(/[^A-Z]/g,"")},getGMTOffset:function(k,j){var l=k.getTimezoneOffset();return(l>0?"-":"+")+Mini2.String.leftPad(Math.floor(Math.abs(l)/60),2,"0")+(j?":":"")+Mini2.String.leftPad(Math.abs(l%60),2,"0")},getDayOfYear:function(k){var o=0,j=Mini2.Date.clone(k),n=k.getMonth(),l;for(l=0,j.setDate(1),j.setMonth(0);l<n;j.setMonth(++l)){o+=h.getDaysInMonth(j)}return o+k.getDate()-1},getWeekOfYear:(function(){var j=86400000,k=7*j;return function(m){var n=Date.UTC(m.getFullYear(),m.getMonth(),m.getDate()+3)/j,l=Math.floor(n/7),o=new Date(l*k).getUTCFullYear();return l-Math.floor(Date.UTC(o,0,7)/k)+1}}()),isLeapYear:function(j){var k=j.getFullYear();return !!((k&3)==0&&(k%100||(k%400==0&&k)))},getFirstDayOfMonth:function(j){var k=(j.getDay()-(j.getDate()-1))%7;return(k<0)?(k+7):k},getLastDayOfMonth:function(j){return h.getLastDateOfMonth(j).getDay()},getFirstDateOfMonth:function(j){return new Date(j.getFullYear(),j.getMonth(),1)},getLastDateOfMonth:function(j){return new Date(j.getFullYear(),j.getMonth(),h.getDaysInMonth(j))},getDaysInMonth:(function(){var j=[31,28,31,30,31,30,31,31,30,31,30,31];return function(k){var l=k.getMonth();return l==1&&h.isLeapYear(k)?29:j[l]}}()),getSuffix:function(j){switch(j.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},clone:function(j){return new Date(j.getTime())},isDST:function(j){return new Date(j.getFullYear(),0,1).getTimezoneOffset()!=j.getTimezoneOffset()},clearTime:function(m,k){if(k){return Mini2.Date.clearTime(Mini2.Date.clone(m))}var l=m.getDate(),n,j;m.setHours(0);m.setMinutes(0);m.setSeconds(0);m.setMilliseconds(0);if(m.getDate()!=l){for(n=1,j=h.add(m,Mini2.Date.HOUR,n);j.getDate()!=l;n++,j=h.add(m,Mini2.Date.HOUR,n)){}m.setDate(l);m.setHours(j.getHours())}return m},add:function(l,p,q){var k=Mini2.Date.clone(l),m=Mini2.Date,n,o,j=0;if(!p||q===0){return k}o=q-parseInt(q,10);q=parseInt(q,10);if(q){switch(p.toLowerCase()){case Mini2.Date.MILLI:k.setTime(k.getTime()+q);break;case Mini2.Date.SECOND:k.setTime(k.getTime()+q*1000);break;case Mini2.Date.MINUTE:k.setTime(k.getTime()+q*60*1000);break;case Mini2.Date.HOUR:k.setTime(k.getTime()+q*60*60*1000);break;case Mini2.Date.DAY:k.setDate(k.getDate()+q);break;case Mini2.Date.MONTH:n=l.getDate();if(n>28){n=Math.min(n,Mini2.Date.getLastDateOfMonth(Mini2.Date.add(Mini2.Date.getFirstDateOfMonth(l),Mini2.Date.MONTH,q)).getDate())}k.setDate(n);k.setMonth(l.getMonth()+q);break;case Mini2.Date.YEAR:n=l.getDate();if(n>28){n=Math.min(n,Mini2.Date.getLastDateOfMonth(Mini2.Date.add(Mini2.Date.getFirstDateOfMonth(l),Mini2.Date.YEAR,q)).getDate())}k.setDate(n);k.setFullYear(l.getFullYear()+q);break}}if(o){switch(p.toLowerCase()){case Mini2.Date.MILLI:j=1;break;case Mini2.Date.SECOND:j=1000;break;case Mini2.Date.MINUTE:j=1000*60;break;case Mini2.Date.HOUR:j=1000*60*60;break;case Mini2.Date.DAY:j=1000*60*60*24;break;case Mini2.Date.MONTH:n=h.getDaysInMonth(k);j=1000*60*60*24*n;break;case Mini2.Date.YEAR:n=(h.isLeapYear(k)?366:365);j=1000*60*60*24*n;break}if(j){k.setTime(k.getTime()+j*o)}}return k},subtract:function(j,k,l){return h.add(j,k,-l)},between:function(j,l,k){var m=j.getTime();return l.getTime()<=m&&m<=k.getTime()},compat:function(){var j=window.Date,k,t=["useStrict","formatCodeToRegex","parseFunctions","parseRegexes","formatFunctions","y2kYear","MILLI","SECOND","MINUTE","HOUR","DAY","MONTH","YEAR","defaults","dayNames","monthNames","monthNumbers","getShortMonthName","getShortDayName","getMonthNumber","formatCodes","isValid","parseDate","getFormatCode","createFormat","createParser","parseCodes"],n=["dateFormat","format","getTimezone","getGMTOffset","getDayOfYear","getWeekOfYear","isLeapYear","getFirstDayOfMonth","getLastDayOfMonth","getDaysInMonth","getSuffix","clone","isDST","clearTime","add","between"],q=t.length,l=n.length,r,m,o;for(o=0;o<q;o++){r=t[o];j[r]=h[r]}for(k=0;k<l;k++){m=n[k];j.prototype[m]=function(){var p=Array.prototype.slice.call(arguments);p.unshift(this);return h[m].apply(h,p)}}}})};
Mini2.String=(function(){var l=/^[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u2028\u2029\u202f\u205f\u3000]+|[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u2028\u2029\u202f\u205f\u3000]+$/g,g=/('|\\)/g,i=/\{(\d+)\}/g,h=/([-.*+?\^${}()|\[\]\/\\])/g,a=/^\s+|\s+$/g,n=/\s+/,m=/(^[^a-z]*|[^\w])/gi,c,e,d,f,k=function(p,o){return c[o]},j=function(p,o){return(o in e)?e[o]:String.fromCharCode(parseInt(o.substr(2),10))},b=function(p,o){if(p===null||p===undefined||o===null||o===undefined){return false}return o.length<=p.length};return{insert:function(q,r,o){if(!q){return r}if(!r){return q}var p=q.length;if(!o&&o!==0){o=p}if(o<0){o*=-1;if(o>=p){o=0}else{o=p-o}}if(o===0){q=r+q}else{if(o>=q.length){q+=r}else{q=q.substr(0,o)+r+q.substr(o)}}return q},startsWith:function(q,r,o){var p=b(q,r);if(p){if(o){q=q.toLowerCase();r=r.toLowerCase()}p=q.lastIndexOf(r,0)===0}return p},endsWith:function(r,o,p){var q=b(r,o);if(q){if(p){r=r.toLowerCase();o=o.toLowerCase()}q=r.indexOf(o,r.length-o.length)!==-1}return q},createVarName:function(o){return o.replace(m,"")},htmlEncode:function(o){return(!o)?o:String(o).replace(d,k)},htmlDecode:function(o){return(!o)?o:String(o).replace(f,j)},addCharacterEntities:function(s){var o=[],q=[],r,p;for(r in s){p=s[r];e[r]=p;c[p]=r;o.push(p);q.push(r)}d=new RegExp("("+o.join("|")+")","g");f=new RegExp("("+q.join("|")+"|&#[0-9]{1,5};)","g")},resetCharacterEntities:function(){c={};e={};this.addCharacterEntities({"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"',"&#39;":"'"})},urlAppend:function(u,t,q){if(!Mini2.isEmpty(t)){var r=0,s="",o=t,p;if(Mini2.typeOf(t)=="object"){o=t;for(p in o){if(r++>0){s+="&"}s+=(p+"="+o[p])}}if(true===q){if(r++>0){s+="&"}s+=Mini2.Guid.newGuid()}if(r>0){t=s}return u+(u.indexOf("?")===-1?"?":"&")+t}return u},trim:function(o){return o.replace(l,"")},capitalize:function(o){return o.charAt(0).toUpperCase()+o.substr(1)},uncapitalize:function(o){return o.charAt(0).toLowerCase()+o.substr(1)},ellipsis:function(q,p,s){if(q&&q.length>p){if(s){var r=q.substr(0,p-2),o=Math.max(r.lastIndexOf(" "),r.lastIndexOf("."),r.lastIndexOf("!"),r.lastIndexOf("?"));if(o!==-1&&o>=(p-15)){return r.substr(0,o)+"..."}}return q.substr(0,p-3)+"..."}return q},escapeRegex:function(o){return o.replace(h,"\\$1")},escape:function(o){return o.replace(g,"\\$1")},toggle:function(p,q,o){return p===q?o:q},leftPad:function(r,q,o){var p=String(r);o=o||" ";while(p.length<q){p=o+p}return p},rightPad:function(r,q,o){var p=String(r);o=o||" ";while(p.length<q){p+=o}return p},format:function(p){var o=Mini2.Array.toArray(arguments,1);return p.replace(i,function(r,q){return o[q]})},repeat:function(r,p,s){if(p<1){p=0}for(var o=[],q=p;q--;){o.push(r)}return o.join(s||"")},splitWords:function(o){if(o&&typeof o=="string"){return o.replace(a,"").split(n)}return o||[]},isBlank:function(o){if(undefined===o||null===o){return true}if(typeof o=="string"){if(o.length===0){return true}var p=Mini2.String.trim(o);if(p.length===0){return true}}return false}}}());Mini2.isBlank=Mini2.String.isBlank;Mini2.String.resetCharacterEntities();Mini2.htmlEncode=Mini2.String.htmlEncode;Mini2.htmlDecode=Mini2.String.htmlDecode;Mini2.urlAppend=Mini2.String.urlAppend;
Mini2.Number=new function(){var c=this,a=(0.9).toFixed()!=="1",b=Math;Mini2.apply(this,{constrain:function(f,e,d){var g=parseFloat(f);return(g<e)?e:((g>d)?d:g)},snap:function(h,d,g,f){var e;if(h===undefined||h<g){return g||0}if(d){e=h%d;if(e!==0){h-=e;if(e*2>=d){h+=d}else{if(e*2<-d){h-=d}}}}return c.constrain(h,g,f)},snapInRange:function(h,d,f,e){var g;f=(f||0);if(h===undefined||h<f){return f}if(d&&(g=((h-f)%d))){h-=g;g*=2;if(g>=d){h+=d}}if(e!==undefined){if(h>(e=c.snapInRange(e,d,f))){h=e}}return h},toFixed:a?function(f,e){e=e||0;var d=b.pow(10,e);return(b.round(f*d)/d).toFixed(e)}:function(e,d){return e.toFixed(d)},from:function(e,d){if(isFinite(e)){e=parseFloat(e)}return !isNaN(e)?e:d},randomInt:function(d,e){return b.floor(b.random()*(e-d+1)+d)},correctFloat:function(d){return parseFloat(d.toPrecision(14))}});Mini2.num=function(){return c.from.apply(this,arguments)}};
Mini2.define("Mini2.log.MethodLogger",{owner:null,name:null,debugFormat:function(j,f){var e=this,a=window.console,c,b=new Date(),h,g="";if(arguments.length>1){j=$.format(j,f)}if(a&&a.log){a.log(e.now()+"DEBUG "+e.className+" - "+g+j)}},debug:function(j,f){var e=this,a=window.console,c,b=new Date(),h,g="";h=e.now();if(a&&a.log){a.log(h+"DEBUG "+e.className+" - "+g+j,f)}}});Mini2.define("Mini2.log.Logger",{className:"",enabled:true,now:function(){var a=new Date(),c=a.getTime()+"",b=a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"."+a.getMilliseconds();return b},getMethod:function(c){var a=this,b;b=Mini2.create("Mini2.log.MethodLogger",{owner:a,name:c});return b},debugFormat:function(k,g){var f=this,a=window.console,c,b=new Date(),j,h="";if(!f.enabled){return}if(arguments.length>1){k=$.format(k,g)}if(a&&a.debug){var e="%c"+f.now()+" %cDEBUG %c"+f.className+" - "+h+k;a.debug(e,"color:#0","color:#00A49D","color:#0")}},debug:function(k,g){var f=this,a=window.console,c,b=new Date(),j,h="";if(!f.enabled){return}if(a&&a.debug){var e="%c"+f.now()+" %cDEBUG %c"+f.className+" - "+h+k;if(arguments.length==1){a.debug(e,"color:#0","color:#00A49D","color:#0")}else{a.debug(e,"color:#0","color:#00A49D","color:#0",g)}}},error:function(k,g){var f=this,a=window.console,c,b=new Date(),j,h="";if(a&&a.error){var e="%c"+f.now()+" %ERROR %c"+f.className+" - "+h+k;if(arguments.length==1){a.error(e,"color:#0","color:red","color:#0")}else{a.error(e,"color:#0","color:red","color:#0",g)}a.trace()}},fatal:function(b,a){},info:function(b,a){},warn:function(b,a){},trace:function(b,a){}});window.log=Mini2.Logger=new function(){Mini2.apply(this,{space:-4,begin:function(g){var a=window.console;this.space+=4;if(!g){return}var e="";for(var c=0;c<this.space;c++){e+=" "}var b=new Date();var f=b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()+"  ";if(a&&a.log){a.log(f+e+"【"+g+"】")}},end:function(a){if(a){this.debug("【end】:"+a)}else{this.debug("【end】")}this.space-=4},error:function(j){var f=this,b=window.console,e,c=new Date(),h,g="";if(arguments.length>1){var a=[];for(var e=1;e<arguments.length;e++){a.push(arguments[e-1])}}for(e=0;e<this.space;e++){g+=" "}h=f.now()+"  ";if(b&&b.log){b.log(h+g+"[ERROR]"+j)}},debug:function(j,f){var e=this,a=window.console,c,b=new Date(),h,g="";for(c=0;c<this.space;c++){g+=" "}h=e.now()+"  ";if(arguments.length>1){j=$.format(j,f)}if(a&&a.log){if(arguments.length==1){a.log(h+g+j)}else{a.log(h+g+j,f)}}},now:function(){var a=new Date(),c=a.getTime()+"",b=a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"."+a.getMilliseconds();return b},d:function(h,e){var c=this,a=new Date(),g,f="";var b="%c"+c.now()+" %cDEBUG %c"+c.className+" - "+f+h;return b},getLogger:function(a,b){if(b===console){return console}if(undefined==b){b=true}var c=Mini2.create("Mini2.log.Logger",{className:a,enabled:b});return c}})};

Mini2.define("Mini2.util.Sorter",{direction:"ASC",constructor:function(a){var b=this;Mini2.apply(b,a);alert("dddddddddddddddddddddddddddd")},serialize:function(){return{root:this.root,property:this.property,direction:this.direction}}});
(function(){Mini2.ns("Mini2.util");var i=Mini2.util.Format={},h=/<\/?[^>]+>/gi,g=/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/ig,f=/\r?\n/g,a=/^#+$/,d=/[\d,\.#]+/,b=/[^\d\.#]/g,e,c={};Mini2.apply(i,{thousandSeparator:",",decimalSeparator:".",currencyPrecision:2,currencySign:"$",currencyAtEnd:false,undef:function(j){return j!==undefined?j:""},defaultValue:function(k,j){return k!==undefined&&k!==""?k:j},substr:"ab".substr(-1)!="b"?function(m,k,j){var l=String(m);return(k<0)?l.substr(Math.max(l.length+k,0),j):l.substr(k,j)}:function(l,k,j){return String(l).substr(k,j)},lowercase:function(j){return String(j).toLowerCase()},uppercase:function(j){return String(j).toUpperCase()},usMoney:function(j){return i.currency(j,"$",2)},currency:function(p,j,k,l){var o="",m=",0",n=0;p=p-0;if(p<0){p=-p;o="-"}k=Mini2.isDefined(k)?k:i.currencyPrecision;m+=(k>0?".":"");for(;n<k;n++){m+="0"}p=i.number(p,m);if((l||i.currencyAtEnd)===true){return Mini2.String.format("{0}{1}{2}",o,p,j||i.currencySign)}else{return Mini2.String.format("{0}{1}{2}",o,j||i.currencySign,p)}},date:function(k,j){if(!k){return""}if(!Mini2.isDate(k)){k=new Date(Date.parse(k))}return Mini2.Date.dateFormat(k,j||Mini2.Date.defaultFormat)},dateRenderer:function(j){return function(k){return i.date(k,j)}},stripTags:function(j){return !j?j:String(j).replace(h,"")},stripScripts:function(j){return !j?j:String(j).replace(g,"")},fileSize:(function(){var j=1024,k=1048576,l=1073741824;return function(n){var m;if(n<j){if(n===1){m="1 byte"}else{m=n+" bytes"}}else{if(n<k){m=(Math.round(((n*10)/j))/10)+" KB"}else{if(n<l){m=(Math.round(((n*10)/k))/10)+" MB"}else{m=(Math.round(((n*10)/l))/10)+" GB"}}}return m}})(),math:(function(){var j={};return function(l,k){if(!j[k]){j[k]=Mini2.functionFactory("v","return v "+k+";")}return j[k](l)}}()),round:function(l,j){var k=Number(l);if(typeof j=="number"){j=Math.pow(10,j);k=Math.round(l*j)/j}return k},number:function(w,o){if(!o){return w}if(o.substr(-1,1)=="%"){o=o.replace("%","pct")}var n=c[o];if(!n){var r=o,k=i.thousandSeparator,l=i.decimalSeparator,p,t,m,s=0,q,u,j;if(o.substr(o.length-2)=="/i"){if(!e){e=new RegExp("[^\\d\\"+i.decimalSeparator+"]","g")}o=o.substr(0,o.length-2);p=o.indexOf(k)!=-1;t=o.replace(e,"").split(l)}else{p=o.indexOf(",")!=-1;t=o.replace(b,"").split(".")}m=o.replace(d,"");if(t.length>2){Mini2.Error.raise({sourceClass:"Mini2.util.Format",sourceMethod:"number",value:w,formatString:o,msg:"Invalid number format, should have no more than 1 decimal"})}else{if(t.length===2){s=t[1].length;u=a.test(t[1])}}j=["var utilFormat=Mini2.util.Format,extNumber=Mini2.Number,neg,fnum,parts"+(p?",thousandSeparator,thousands=[],j,n,i":"")+(m?',formatString="'+o+'",formatPattern=/[\\d,\\.#]+/':"")+(u?",trailingZeroes=/\\.?0+$/;":";")+'return function(v){if(typeof v!=="number"&&isNaN(v=extNumber.from(v,NaN)))return"";neg=v<0;',"fnum=Mini2.Number.toFixed(Math.abs(v), "+s+");"];if(p){if(s){j[j.length]='parts=fnum.split(".");';j[j.length]="fnum=parts[0];"}j[j.length]="if(v>=1000) {";j[j.length]="thousandSeparator=utilFormat.thousandSeparator;thousands.length=0;j=fnum.length;n=fnum.length%3||3;for(i=0;i<j;i+=n){if(i!==0){n=3;}thousands[thousands.length]=fnum.substr(i,n);}fnum=thousands.join(thousandSeparator);}";if(s){j[j.length]="fnum += utilFormat.decimalSeparator+parts[1];"}}else{if(s){j[j.length]='if(utilFormat.decimalSeparator!=="."){parts=fnum.split(".");fnum=parts[0]+utilFormat.decimalSeparator+parts[1];}'}}if(u){j[j.length]='fnum=fnum.replace(trailingZeroes,"");'}j[j.length]='if(neg&&fnum!=="'+(s?"0."+Mini2.String.repeat("0",s):"0")+'")fnum="-"+fnum;';j[j.length]="return ";if(m){j[j.length]="formatString.replace(formatPattern, fnum);"}else{j[j.length]="fnum;"}j[j.length]="};";n=c[r]=Mini2.functionFactory("Mini2",j.join(""))(Mini2)}return n(w)},numberRenderer:function(j){return function(k){return i.number(k,j)}},attributes:function(j){if(typeof j==="object"){var l=[],k;for(k in j){l.push(k,'="',k==="style"?Mini2.DomHelper.generateStyles(j[k]):Mini2.htmlEncode(j[k]),'"')}j=l.join("")}return j||""},plural:function(l,k,j){return l+" "+(l==1?k:(j?j:k+"s"))},nl2br:function(j){return Mini2.isEmpty(j)?"":j.replace(f,"<br/>")},capitalize:Mini2.String.capitalize,ellipsis:Mini2.String.ellipsis,format:Mini2.String.format,htmlDecode:Mini2.String.htmlDecode,htmlEncode:Mini2.String.htmlEncode,leftPad:Mini2.String.leftPad,trim:Mini2.String.trim,parseBox:function(j){j=j||0;if(typeof j==="number"){return{top:j,right:j,bottom:j,left:j}}var l=j.split(" "),k=l.length;if(k==1){l[1]=l[2]=l[3]=l[0]}else{if(k==2){l[2]=l[0];l[3]=l[1]}else{if(k==3){l[3]=l[1]}}}return{top:parseInt(l[0],10)||0,right:parseInt(l[1],10)||0,bottom:parseInt(l[2],10)||0,left:parseInt(l[3],10)||0}},escapeRegex:function(j){return j.replace(/([\-.*+?\^${}()|\[\]\/\\])/g,"\\$1")}});c["0pct"]=function(k){var j=parseInt(k*100);if(isNaN(j)){return""}return j+"%"};c["0.0pct"]=function(k){var j=Mini2.util.Format.number(k*100,"0.0");if(isNaN(j)){return""}return j+"%"};c["0.00pct"]=function(k){var j=Mini2.util.Format.number(k*100,"0.00");if(isNaN(j)){return""}return j+"%"};c["0.#pct"]=function(k){var j=Mini2.util.Format.number(k*100,"0.#");if(isNaN(j)){return""}return j+"%"};c["0.##pct"]=function(k){var j=Mini2.util.Format.number(k*100,"0.##");if(isNaN(j)){return""}return j+"%"}}());
Mini2.define("Mini2.collection.ArrayList",{isArray:true,log:Mini2.Logger,constructor:function(b,c){var d=this,a=arguments;d.length=0;d.items=[];if(Mini2.isArray(a[0])){d.items=a[0];d.length=d.items.length}if(Mini2.isFunction(c)){d.getFun=c}},getCount:function(){return this.items.length},add:function(a){var b=this,c=b.items;if(a&&a.length){b.items=c=c.concat(a)}else{c.push(a)}b.length=c.length},erase:function(a,b){},insert:function(b,c){var f=this,h=0,e,d=f.items,a,g;if(b>d.length){b=d.length}e=f.getRange(b,null);if(typeof c=="array"){for(a=0;a<c.length;a++){g=a+b;d[g]=c[a]}h=b+c.length}else{d[b]=c;h=b+1}for(a=0;a<e.length;a++){g=h+a;d[g]=e[a]}f.length=d.length},remoteAt:function(a){var d=this,c=d.items,b;if(a<d.length&&a>=0){b=c[a];c.splice(a,1);d.length=c.length;return b}return false},removeAll:function(){var a=this;while(a.length){a.removeAt(0)}a.length=a.items.length},remove:function(c){var f=this,a,b=0,g=-1,d=f.items,e=d.length;for(;b<e;b++){a=d[b];if(a===c){g=b;break}}f.remoteAt(g);f.length=d.length;return g},removeRange:function(g,a){var d=this,b=d.items,e=[],c=b.length,h,f;if(c<1){return e}if(g>a){f=true;h=g;g=a;a=h}if(g<0){g=0}if(a==null||a>=c){a=c-1}e=b.splice(g,a+1);d.length=b.length;return e},getByProp:function(h,j){var g=this,e=null,f=g.items,b,a,d=0;for(;d<f.length;d++){b=f[d];a=b[h];if(a==j){e=b;break}}return e},get:function(a){var c=this,b=null;b=c.items[a];return b},set:function(a,b){this.items[a]=b},first:function(){return this.items[0]},last:function(){return this.items[this.length-1]},getRange:function(g,a){var d=this,b=d.items,e=[],c=b.length,h,f;if(c<1){return e}if(a!=undefined&&a!=null&&g>a){f=true;h=g;g=a;a=h}if(g<0){g=0}if(a==null||a>=c){a=c-1}e=b.slice(g,a+1);if(f&&e.length){e.reverse()}return e},filterFirstBy:function(a,g){var e=this,f=null,c=e.items,d=c.length,b=0;for(;b<d;b++){if(a.call(g||e,c[b])){f=c[b];break}}return f},filterBy:function(a,g){var e=this,f=new Mini2.collection.ArrayList(),c=e.items,d=c.length,b=0;for(;b<d;b++){if(a.call(g||e,c[b])){f.add(c[b])}}return f},findIndexBy:function(a,h,j){var g=this,d,e=g.items,f=e.length,b=j,c=-1;if(j==undefined){b=0}for(;b<f;b++){if(a.call(h||g,e[b])){c=b;break}}return c},toArray:function(){return this.items}},function(a){var c=this,d=[],e=arguments,b=0;for(;b<e.length;b++){d[b]=e[b]}c.muid=Mini2.getIdentity();c.constructor(d[0],d[1])});
Mini2.define("Mini2.SystemInfo",{singleton:true,mode:"default",form:{tabKeyCode:13,itemMarginBottom:8,itemMarginRight:8},formTrigger:{width:22},toolbar:{height:36,item_span:4,uiType_buttonGroup:{height:36,item_span:0},uiType_largeFlat:{height:36,item_span:0}},table:{headerWidthRaed:1,headerHeight:31,rowHeight:31,footerHeight:36,headerAlign:"center",columnLines:true,focusBorders:true,cols:{rowNumberer:{width:40},}},window:{headerHeight:24,footerHeight:36,contentHeight:70,msgHeight:180},list:{itemHeight:24},font:{size:12,chatWidth:6},tabPanel:{tabHeight:32},pagination:{height:24},menu:{paddingTop:3,paddingBottom:3},modeList:false,defaultMode:false,setMode:function(b){var a=this,c;if(!a.modeList){a.defaultMode=a.computeMode;a.modeList={"default":a.computeMode,compute:a.computeMode,touch:a.touchMode,mobile:a.mobileMode,compact:a.compact,bootstrap:a.bootstrap,triton2:a.triton2,}}c=a.modeList[b];if(c){c.call(a)}else{a.defaultMode.call(a)}},compactMode:function(){var a=this;a.toolbar.height=24;Mini2.apply(a.table,{headerHeight:24,rowHeight:24,headerWidthRaed:0.8,footerHeight:24})},bootstrap:function(){var a=this;a.mode="bootstrap";console.debug("切换 SystemInfo.mode 为 ",Mini2.SystemInfo.mode);a.toolbar.height=44},triton2:function(){var a=this;a.mode="triton2";Mini2.apply(a.table,{columnLines:false,focusBorders:false,headerWidthRaed:1.1,headerHeight:52,rowHeight:52});Mini2.apply(a.toolbar,{height:44,item_span:0,});Mini2.apply(a.toolbar.uiType_buttonGroup,{height:34,item_span:0});Mini2.apply(a.toolbar.uiType_largeFlat,{height:44,item_span:0});Mini2.apply(a.pagination,{height:45})},computeMode:function(){var a=this},touchMode:function(){var a=this;a.mode="touch";console.debug("切换 SystemInfo.mode 为 ",Mini2.SystemInfo.mode);Mini2.apply(a.toolbar,{height:60});Mini2.apply(a.table,{headerWidthRaed:1,footerHeight:37,headerHeight:37,rowHeight:37});Mini2.apply(a.table.cols.rowNumberer,{width:60});Mini2.apply(a.window,{footerHeight:52,contentHeight:70,msgHeight:180,itemHeight:46});Mini2.apply(a.list,{itemHeight:46});Mini2.apply(a.tabPanel,{tabHeight:42});Mini2.apply(a.pagination,{height:50});Mini2.apply(a.form,{itemMarginBottom:15,itemMarginRight:15});Mini2.apply(a.formTrigger,{width:38})},mobileMode:function(){}},function(){var a=this});
Mini2.define("Mini2.LoaderManager",{singleton:true,log:Mini2.Logger.getLogger("Mini2.LoaderManager"),afterRenderItems:[],resizeItems:[],resize:function(a){var b=this;b.resizeItems.push(a)},ready:function(a){var b=this;if(!Mini2.isFunction(a)){throw new Error("必须是指定 fun 函数对象.")}b.afterRenderItems.push(a)},afterRender:function(a){var b=this;if(!Mini2.isFunction(a.afterRender)){throw new Error("这个对象不存在 afterRender 函数.")}b.afterRenderItems.push(a)},callItemResize:function(){var e=Mini2.LoaderManager,b,f,a=0,c=e.resizeItems,d=c.length;for(;a<d;a++){b=c[a];f=b.resize;if(f){f.call(b)}}},preResizeFirst:function(){var a=Mini2.LoaderManager;a.callItemResize();setTimeout(a.callItemResize,50)},resizeTimer:null,preResize:function(){var a=Mini2.LoaderManager;Mini2.awaitRun(a.muid,100,a,function(){a.callItemResize();setTimeout(a.callItemResize,50)})},preRenderComplete:function(){var f=this,e=f.log,b,a=0,c=f.afterRenderItems,d=c.length;for(;a<d;a++){b=c[a];if(Mini2.isFunction(b)){b()}else{if(b.afterRender){b.afterRender.call(b)}}}delete f.afterRenderItems;if(Mini2.data&&Mini2.data.StoreManager){Mini2.data.StoreManager.loader()}f.preResizeFirst();$(window).bind("resize",f.preResize)}});Mini2.ready=function(a){Mini2.LoaderManager.ready(a)};
Mini2.TweenManager=new function(){var a=this;Mini2.apply(a,{log:Mini2.Logger.getLogger("Mini2.TweenManager"),items:{},len:0,isRunning:false,add:function(e){var d=this,c=d.items,b=e.muid;c[b]=e;d.len++;if(!d.isRunning){d.isRunning=true;requestAnimationFrame(function(f){d.animate(f)})}return d},remove:function(e){var d=this,c=d.items,b=e.muid;if(c[b]){delete c[b];d.len--}return d},animate:function(c){var b=this;if(b.len<=0){b.isRunning=false;return}requestAnimationFrame(function(d){b.animate(d)});TWEEN.update(c)}})};
Mini2.define("Mini2.EventBuilder",{trigger:function(d,b){var h=this,j,g,c="_EVENT_"+d,f,e,a;f=h[c];if(f){for(g=0;g<f.length;g++){e=f[g];if(e.sender){j=e.sender;e=e.fun}else{j=h}a=e.call(j,b);if(true===a){break}}}return a},on:function(b,f,c){var e=this,a="_EVENT_"+b,d=e[a];if(typeof f==="function"){c=f;f=null}if(!Mini2.isFunction(c)){throw new Error("必须指定一个函数类型.")}if(!d){e[a]=d=[]}if(f){c={sender:f,fun:c}}d.push(c);return e}});
Mini2.define("Mini2.ui.EventHandler",{listenerList:null,owner:null,eventName:"",isEmpty:false,addListener:function(a){var b=this;b.listenerList.push(a)},removeListener:function(a){var b=this},getCount:function(){var a=this;return a.listenerList.length},trigger:function(a){var g=this,d,b,c=g.listenerList,f=c.length;a=a||{};a.sender=g.owner;for(d=0;d<f;d++){b=c[d];b(a)}},on:function(a){var b=this;b.listenerList.push(a)},un:Mini2.emptyFn},function(){var a=this;a.listenerList=[]});Mini2.employEventHandler=Mini2.create("Mini2.ui.EventHandler",{isEmpty:true});
Mini2.EventManager=new function(){var b=this,a=document,c=window;Mini2.apply(b,{log:Mini2.Logger.getLogger("Mini2.EventManager"),con:null,scope:null,data:null,drag:false,lastTimeMouseAction:0,lastTimeKeyAction:0,lastTimeAction:0,setMouseAction:function(){var d=this;d.lastTimeMouseAction=d.lastTimeAction=Mini2.Date.now()},setKeyAction:function(){var d=this;d.lastTimeKeyAction=d.lastTimeAction=Mini2.Date.now()},setAction:function(){var d=this;d.lastTimeAction=Mini2.Date.now()},isAction:function(h){var f=this,d=Mini2.ui.FocusMgr.isInputting(),e=f.lastTimeAction,g;if(d){return true}h=h||0;g=Mini2.Date.now()-e-h;return(g<=0)},stopEvent:function(d){d=d||window.event;if(d){this.stopPropagation(d);this.preventDefault(d)}},stopPropagation:function(d){d=d||window.event;if(d.stopPropagation){d.stopPropagation()}else{d.cancelBubble=false}},preventDefault:function(d){d=d||window.event;if(d.preventDefault){d.preventDefault()}else{d.returnValue=false}},withinOne:function(e,h,d){var f=this,g;if(d&&d.el&&typeof d=="object"){d=d.el}if(d){if(e==d||e===d){return true}g=$(d).find(e);return(g.length>0)}},within:function(f,k,d){var j=this;if(f&&f.el&&typeof f=="object"){f=f.el}if(f){if(d instanceof Array){var e=d,g=0,l,h;for(;g<e.length;g++){l=e[g];h=j.withinOne(f,k,l);if(h){return true}}}else{return j.withinOne(f,k,d)}}return false},offsetParent:function(f){var e=$(f),d="mi-border-box",g=0;if(e.hasClass(d)){return f}for(;g<99;g++){e=e.parent();if(e.hasClass(d)){break}}return e},getBorderBox:function(e){var h=this,g=h.log;if(e==undefined||e==null){return h}if(e.toString()=="[object Window]"){e=window.document.body}if(e&&e.el){if(e.el.jquery){e=e.el.get(0)}else{if(Mini2.isDom(e.el)){e=e.el}}}if(!Mini2.isDom(e)){return h}var d;if($(e).hasClass("mi-border-box")){d=$(e)}else{d=h.offsetParent(e)}var f=null;if(d.length){f=d.data("EVENT_MANAGER");if(!f){f={control:null,data:null,scope:null,el:d.get(0),typeString:d.get(0).toString(),muid:"F_"+Mini2.getIdentity()};d.data("EVENT_MANAGER",f)}return f}return h},curControl:function(){var d=this,e=d.getBorderBox(con);return e.con},clear:function(d){var e=this,f=e.getBorderBox(d);f.con=null;f.scope=null},setScope:function(d,g){var e=this,f=e.getBorderBox(d);f.con=d;f.scope=g},setKeyDown:function(d,f,i){var g=this,h=this.getBorderBox(d);g.setKeyAction();if(h.con!=null){return}h.con=d;h.scope=i;$(d).trigger("keydown",f);g.stopEvent(f)},setKeyUp:function(f,g){var h=this,d,i=this.getBorderBox(f);h.setKeyAction();d=h.within(f,null,h.scope);if(d){$(f).trigger("keyup",g)}else{Mini2.ui.FocusMgr.setControl(f)}i.con=null;h.stopEvent(g)},setMouseDown:function(d,f,k,g,e){var i=this,h=i.log,j=this.getBorderBox(k||d);i.mousedownControl=d;i.setMouseAction();i.borderBox=j;j.mouseUp_repetition="no";if(j.con!=null){return}if(k==undefined){k=d}j.con=d;j.scope=k;j.data=f;if(d&&!e){i.stopEvent(g)}},borderBox:null,setMouseMove:function(d,e){var i=this,h=i.log,j=i.borderBox||this.getBorderBox(d),f=j.con,g=j.scope;i.setMouseAction();f=f||d;$(f).triggerHandler("mu_mousemove",[e,d])},setMouseUp:function(d,e){var i=this,h=i.log,d=d||i.mousedownControl,j=i.borderBox||this.getBorderBox(d),f=j.con,g=j.scope;i.mousedownControl=null;i.setMouseAction();if(j.con&&j.mouseUp_repetition=="no"){j.mouseUp_repetition="yes";$(j.con).triggerHandler("mu_mouseup",[e,d]);j.con=null;j.data=null;if(e==null){h.error("没有事件啊",e)}i.stopPropagation(e);i.borderBox=null}},addListener:function(d,e,f,h,g){},removeListener:function(d,e,f,g){},tab:function(d){var l=d.ownerParent,j=null;if(!l){return j}var m=l.getTabItems();var n=m.length;var e=-1;for(var g=0;g<n;g++){var h=m[g];if(h===d){e=g;break}}if(e>=0){var k=e+1;if(k>=n){l.focus();return}j=m[k];try{j.focus();if(j.select){j.select()}}catch(f){console.error("焦点属性赋值错误.",h);console.log("pLen",n)}}return j}})};$(document).on("keydown",function(a){var d=a.keyCode,f=Mini2.Logger,c=Mini2.ui.FocusMgr.lastActionControl,h=a.target.tagName,b=Mini2.EventManager,g=Mini2.SystemInfo.form.tabKeyCode||9;b.setKeyAction();if(h=="TEXTAREA"){return}if(d==g||d===9){return false}});$(document).bind("keyup",function(d){var k=d.keyCode,l=Mini2.Logger,h=Mini2.ui.FocusMgr.lastActionControl,o=d.target.tagName,g=Mini2.EventManager,n=Mini2.SystemInfo.form.tabKeyCode||9;g.setKeyAction();if(o=="TEXTAREA"){return}if(k==n||k===9){var c=Mini2.ui.FocusMgr.data;if(h!=null){var f={data:c,cancel:false};$(h).triggerHandler("keyup",f);if(f.cancel){g.stopEvent(d);return}}g.stopEvent(d);var m=g.tab(h);if(m){return}}var b=h;var a=a;if(b&&b.muid){}else{var a=h;for(var j=0;j<99;j++){b=$(a).data("me");if(b&&b.muid){break}a=$(a).parent()}}if(b&&b.proKeyEvent){b.proKeyEvent.call(b,d)}});$(window).mousedown(function(a){var b=Mini2.EventManager;b.setMouseAction()}).mouseup(function(a){var d=a.keyCode,c=Mini2.ui.FocusMgr.control,g=a.target,f=g.tagName,b=Mini2.EventManager;if(g&&$(g).hasClass("mi-mask")){b.stopEvent(a);return}if(b.mousedownControl){Mini2.ui.FocusMgr.setControl(b.mousedownControl)}else{Mini2.ui.FocusMgr.setControl(this)}b.setMouseUp(null,a);if(Mini2.ui&&Mini2.ui.menu&&Mini2.ui.menu.Manager){Mini2.ui.menu.Manager.hideAll()}}).mousemove(function(a){var c=this,b=Mini2.EventManager;b.setMouseMove(this,a)});
Mini2.define("Mini2.ModelManager",{log:Mini2.Logger,alternateClassName:"Mini2.ModelMgr",typeName:"mtype",singleton:true,types:{},create:function(b,e,d){var c,a=(typeof e=="function")?e:this.types[e||b.name];c=new a(b,d);return c},registerType:function(c,a){var d=a.prototype,b;if(d&&d.isModel){b=a}else{if(Mini2.String.isBlank(a.extend)){a.extend="Mini2.data.Model"}b=Mini2.define(c,a)}this.types[c]=b;return b},getModel:function(a){var b=a;if(typeof b=="string"){b=this.types[b]}return b}});
Mini2.define("Mini2.data.Store",{log:Mini2.Logger,getNewRecords:function(){return[]},getUpdatedRecords:function(){return[]},getModifiedRecords:function(){},getRemovedRecords:function(){return this.removed},filter:function(a,b){},getCount:Mini2.emptyFn,removeAll:Mini2.emptyFn});
Mini2.define("Mini2.data.Errors",{extend:"Mini2.collection.ArrayList",isValid:function(){return this.length===0},getByField:function(c){var b=[],a,d;for(d=0;d<this.length;d++){a=this.items[d];if(a.field==c){b.push(a)}}return b}});Mini2.define("Mini2.data.Invalids",{length:0,items:[]});
Mini2.define("Mini2.data.Field",{isField:true,constructor:function(a){var b=this;if(Mini2.isString(a)){a={name:a}}Mini2.apply(b,a)},dateFormat:null,dateReadFormat:null,dateWriteFormat:null,useNull:false,defaultValue:"",mapping:null,sortType:null,sortDir:"ASC",allowBlank:true,persist:true},function(){this.constructor(arguments[0])});
Mini2.define("Mini2.data.Model",{alternateClassName:["Mini2.data.Record"],persistenceProperty:"data",log:Mini2.Logger.getLogger("Mini2.data.Model",false),emptyData:[],idField:[],idProperty:"id",dataSave:false,evented:false,isModel:true,editing:false,fields:false,fieldModeId:"fixed",modified:false,statics:{PREFIX:"Mini-record",AUTO_ID:1,EDIT:"edit",REJECT:"reject",COMMIT:"commit",id:function(a){}},onInit:function(b,g,s,a){var n=this,m=n.log,q=(g||g===0),e,d,k,c,o,t,p,r,j=n.idProperty,h=n.constructor.idField,l=n.constructor.lockedField,f;n.id=n.muid;n.raw=s||b;n.modified={};n.data=b;n.dataSave={};n.stores=[];d=n.fields;for(f=0,k=d.length;f<k;f++){c=new Mini2.data.Field(d[f]);d[f]=c}n.fields=new Mini2.collection.ArrayList(d);n.idField=h;n.lockedField=l;n.initProperty()},initProperty:function(){var g=this,f=g.log,b,c=g.fields,d,e=c.length;if(Object.defineProperty){for(d=0;d<e;d++){b=c.get(d);if(!Mini2.isString(b.name)){f.debug("无法自定义属性的字段: ",b);continue}if(Mini2.String.isBlank(b.name)){f.debug("无法自定义空字段的属性: ",b);continue}if(g[b.name]){continue}try{(function(){var h=b.name;Object.defineProperty(g,h,{get:function(){return g.get(h)},set:function(i){g.set(h,i)}})})()}catch(a){}}}else{console.error("浏览器不支持 Object.defineProperty 函数.")}},inheritableStatics:{setFields:function(b,c,a){},getFields:function(){return this.prototype.fields.items}},_singleProp:{},isEqual:function(c,d){if(c instanceof Date&&d instanceof Date){return c.getTime()===d.getTime()}return c===d},setFields:function(b,f,a){var j=this,h=j.log,k,d,e=false,l=j.prototype,m=l.fields,n=l.superClass.fields,g,c;if(f){l.idProperty=f;d=f.isField?f:new Mini2.data.Field(f)}if(a){l.clientIdProperty=a}if(m){m.clear()}else{m=j.prototype.fields=new Mini2.collection.ArrayList()}if(n){b=n.items.concat(b)}for(c=0,g=b.length;c<g;c++){k=new Mini2.data.Field(b[c]);if(d&&((k.mapping&&(k.mapping===d.mapping))||(k.name===d.name))){e=true;k.defaultValue=undefined}m.add(k)}if(d&&!e){d.defaultValue=undefined;m.add(d)}j.fields=m;return m},getId:function(){var c=this,b=c.idField,a;if(!b){return null}a=c.get(b.name);if(a==undefined){a=null}return a},get:function(a){return this[this.persistenceProperty][a]},baseSet:function(e,o){var j=this,i=j.log,b=j[j.persistenceProperty],d=j.fieldModeId,f=j.fields,k=j.modified,q=Mini2.isString(e),a,c,g,h,l,m,p,n,r,s;if(undefined==e){throw new Error("没有指定字段名，无法对实体进行赋值")}if(q){s=j._singleProp;s[e]=o}else{s=e}for(m in s){if(!s.hasOwnProperty(m)){if("fixed"==d){continue}}r=s[m];c=(f?f.getByProp("name",m):null);if(f&&c&&c.convert){r=c.convert(r,j)}a=b[m];if((a==""&&r==null)||(a==null&&r=="")){continue}if(j.isEqual(a,r)){continue}b[m]=r;(l||(l=[])).push(m);if(c&&c.persist){if(k.hasOwnProperty(m)){if(j.isEqual(k[m],r)){delete k[m];j.dirty=false;for(h in k){if(k.hasOwnProperty(h)){j.dirty=true;break}}}}else{j.dirty=true;k[m]=a}}}if(q){delete s[e]}if(!j.editing&&l){j.afterEdit(l)}if(j.editing&&l){j.afterCommit(l)}return l||null},set:function(a,c){var b=this;return b.baseSet(a,c)},callStore:function(c){var b=[],h=this.stores,d,e,f=h.length,a=arguments.length,g;for(e=0;e<a;e++){b[e]=arguments[e]}b[0]=this;for(d=0;d<f;++d){g=h[d];if(g&&Mini2.isFunction(g[c])){g[c].apply(g,b)}}},afterInvalid:function(a){this.callStore("afterInvalid",a)},afterEdit:function(a){this.callStore("afterEdit",a)},afterReject:function(){this.callStore("afterReject")},afterCommit:function(a){this.callStore("afterCommit",a)},execLockedRule:function(){var me=this,lockedRule=me.lockedRule,result=false;if(lockedRule&&lockedRule!=""){if(Mini2.isString(lockedRule)){try{result=eval(lockedRule)}catch(ex){log.debug("执行锁行规则错误:"+lockedRule);throw new Error("执行锁行规则错误:"+lockedRule)}}else{if(Mini2.isFunction(lockedRule)){try{result=lockedRule.call(me)}catch(ex){log.debug("执行锁行规则错误:"+lockedRule);throw new Error("执行锁行规则错误:"+lockedRule)}}}}return result},isLocked:function(){var d=this,c=d.log,f,b=d.lockedField,e=d.store;if(e&&e.readOnly){return true}try{if(d.execLockedRule()){return true}}catch(a){console.error("执行锁行代码错误."+a.Message,a)}if(b){f=d.get(b);return !!f}return false},isLockedExclusionField:function(b){var d=this,e=d.store,c=e.lockedExclusionFields;if(c){var a=Mini2.Array.contains(c,b);if(a){return true}}return false},isLockedForField:function(a){var b=this;return false},isDisabledForField:function(a){return false},beginEdit:function(){var c=this,b,a,d;if(!c.editing){c.editing=true;c.dirtySave=c.dirty;d=c[c.persistenceProperty];a=c.dataSave={};for(b in d){if(d.hasOwnProperty(b)){a[b]=d[b]}}d=c.modified;a=c.modifiedSave={};for(b in d){if(d.hasOwnProperty(b)){a[b]=d[b]}}}},cancelEdit:function(){var b=this,a=b.log;if(b.editing){b.editing=false;b.modified=b.modifiedSave;b[b.persistenceProperty]=b.dataSave;b.dirty=b.dirtySave;b.modifiedSave=b.dataSave=b.dirtySave=null}},endEdit:function(e,d){var c=this,b,a;e=e===true;if(c.editing){c.editing=false;b=c.dataSave;c.modifiedSave=c.dataSave=c.dirtySave=null;if(!e){if(!d){d=c.getModifiedFieldNames(b)}a=c.dirty||d.length>0;if(a){c.afterEdit(d)}}}},getModifiedFieldNames:function(e){var c=this,a=c[c.persistenceProperty],d=[],b;e=e||c.dataSave;for(b in a){if(a.hasOwnProperty(b)){if(!c.isEqual(a[b],e[b])){d.push(b)}}}return d},getChanges:function(){var c=this.modified,a={},b;for(b in c){if(c.hasOwnProperty(b)){a[b]=this.get(b)}}return a},reject:function(d){var b=this,c=b.modified,a;for(a in c){if(c.hasOwnProperty(a)){if(typeof c[a]!="function"){b[b.persistenceProperty][a]=c[a]}}}b.dirty=false;b.editing=false;b.modified={};if(d!==true){b.afterReject()}},commit:function(f,e){var c=this,d=c.modified;c.phantom=c.dirty=c.editing=false;if(d&&e){for(var b=0;b<e.length;b++){var a=e[b];if(d.hasOwnProperty(a)){delete d[a]}}}if(true!==f){c.afterCommit(e)}},isModified:function(a){return this.modified.hasOwnProperty(a)},joinStore:function(b){var a=this;if(!a.stores.length){a.stores[0]=b}else{Mini2.Array.include(this.stores,b)}this.store=this.stores[0]},unjoinStore:function(a){Mini2.Array.remove(this.stores,a);this.store=this.stores[0]||null},errors:false,markInvalid:function(a){var h=this,b=h.errors,g,f,d=a.field,e=[d];if(!b){h.errors=b={length:0,items:{}}}g=b.items;f=g[d];if(!f){g[d]=f=[]}f.push(a);b.length++;try{h.afterInvalid(e)}catch(c){console.error("调用错误: Model.afterInvalid(error)\n"+c.Message,c)}},clearInvalidAll:function(){var c=this;if(c.errors){var b=[];for(var a in c.errors){b.push(a)}delete c.errors;c.afterInvalid(b)}},clearInvalid:function(b){var c=this,a=c.errors;if(a){if(b){delete a.items[b];c.afterInvalid(fields)}else{delete c.errors;c.errors=false;c.afterInvalid(fields)}}},getErrors:function(d){var f=this,b=f.errors,e,a;try{if(b){e=b.items;a=e[d]}}catch(c){alert(c.Message)}return a},isValid:function(){return this.validate().isValid()},validate:function(){var e=this,a=new Mini2.data.Errors(),j=e.validations,k=Mini2.data.validations,d,h,b,g,f,c;if(j){d=j.length;for(c=0;c<d;c++){h=j[c];b=h.field||h.name;f=h.type;g=k[f](h,e.get(b));if(!g){a.add({field:b,message:h.message||k[f+"Message"]})}}}return a},dispose:function(){var a=this;if(!a.isDisposed){a.isDisposed=true}}},function(){var a=this;a.muid=Mini2.newId();a.onInit(arguments[0])});Mini2.define("Mini2.data.FreeModel",{extend:"Mini2.data.Model",fieldModeId:"free"});Mini2.ModelManager.registerType("Mini2.data.FreeModel",Mini2.create("Mini2.data.FreeModel"));Mini2.define("Mini2.data.ModelX",{extend:"Mini2.data.Model",isLockedForField:function(a){var b=this;return false},isDisabledForField:function(a){var b=this;if("COL_4"==a){if(b.get("COL_2")=="123"){return true}}return false},set:function(a,c){var b=this,d;d=b.baseSet(a,c);return d}});
Mini2.define("Mini2.data.Validations",{singleton:true,presenceMessage:"must be present",lengthMessage:"is the wrong length",formatMessage:"is the wrong format",inclusionMessage:"is not included in the list of acceptable values",exclusionMessage:"is not an acceptable value",emailMessage:"is not a valid email address",emailRe:/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,presence:function(a,b){if(arguments.length===1){b=a}return !!b||b===0||b===false},length:function(a,e){if(e===undefined||e===null){return false}var b=e.length,d=a.min,c=a.max;if((d&&b<d)||(c&&b>c)){return false}else{return true}},email:function(a,b){return Mini2.data.Validations.emailRe.test(b)},format:function(a,b){return !!(a.matcher&&a.matcher.test(b))},inclusion:function(a,b){return a.list&&Mini2.Array.indexOf(a.list,b)!=-1},exclusion:function(a,b){return a.list&&Mini2.Array.indexOf(a.list,b)==-1}});
Mini2.define("Mini2.data.ResultSet",{loaded:true,count:0,total:0,success:false,constructor:function(a){Mini2.apply(this,a);this.totalRecords=this.total;if(a.count===undefined){this.count=this.records.length}}});
Mini2.define("Mini2.data.Field",{isField:true,constructor:function(a){var b=this;if(Mini2.isString(a)){a={name:a}}Mini2.apply(b,a)},dateFormat:null,dateReadFormat:null,dateWriteFormat:null,useNull:false,defaultValue:"",mapping:null,sortType:null,sortDir:"ASC",allowBlank:true,persist:true},function(){this.constructor(arguments[0])});
Mini2.define("Mini2.data.StoreManager",{singleton:true,log:Mini2.Logger.getLogger("Mini2.data.StoreManager"),data:[],lookup:function(b){var a=this,c=b;if(typeof b=="string"){c=a.lookup_ForId(b)}return c},lookup_ForId:function(f){var d=this,b,a=d.data,c=a.length,e;for(b=0;b<c;b++){e=a[b];if(f==e.storeId){return e}}return null},loader:function(){var d=this,b,a=d.data,c=a.length,e;for(b=0;b<c;b++){e=d.data[b];e.onLoader()}},regStore:function(c){var b=this,a=b.data;a.push(c)}});
Mini2.define("Mini2.data.Store",{log:Mini2.Logger.getLogger("Mini2.data.Store",false),storeId:false,jsonMode:"sample",isStore:true,isIncr:false,autoLoad:true,autoCallback:true,autoSync:true,autoSyncSuspended:false,remoteSort:false,remoteFilter:false,remoteGroup:false,groupField:undefined,groupDir:"ASC",sorters:false,pageSize:65535,currentPage:0,buffered:false,data:false,proxy:{},modelDefaults:null,model:null,implicitModel:false,isLoadData:false,totalCount:0,autoSave:true,vTotalCount:-1,summary:false,autoFocus:true,on:function(b,a,d){var c=this;if(c.isLoadData){return c}$(c).triggerHandler(b,a);return c},intiSorters:function(){var a=this,b=a.sorters;a.sorters=new Mini2.collection.ArrayList(false,function(c){return c.id||c.property});if(b){a.sorters.addAll(a.decodeSorters(b))}},createImplicitModel:function(){var b=this,c=b.modelName,a=b.fields,d;if(!b.model&&a){d="Mini2.data.Store.ImplicitModel_"+(b.storeId||Mini2.newId());b.model=Mini2.define(d,{name:c,extend:"Mini2.data.ModelX",fields:a});delete b.fields;b.implicitModel=true}},createInlineData:function(){var f=this,e=f.log,g=f.model,c,a,h,b=f.data,d;if(b){d=b.length;for(c=0;c<d;c++){a=b[c];h=Mini2.ModelManager.create(a,g);h.joinStore(f);b[c]=h}}f.inlineData=b;delete f.data;f.data=new Mini2.collection.ArrayList(f.inlineData);f.updateRecordsIndex()},preInit:function(a){var g=this,j,h=g.model,f=g.log;if(g.storeId){Mini2.data.StoreManager.regStore(g)}g.removed=[];if(Mini2.isBlank(h)){h=Mini2.ModelManager.getModel("Mini2.data.FreeModel")}else{if(Mini2.isString(h)){j=h;g.modelName=j}h=Mini2.ModelManager.getModel(h);if(h){h.prototype.name=j}}g.model=h;g.intiSorters();g.createImplicitModel();if(!g.disableMetaChangeEvent){var c,e,b,d,k,l=new Mini2.collection.ArrayList(false,function(i){return i.name});b=g.model.prototype.fields;for(c=0,e=b.length;c<e;c++){k=new Mini2.data.Field(b[c]);if(d&&((k.mapping&&(k.mapping===d.mapping))||(k.name===d.name))){idFieldDefined=true;k.defaultValue=undefined}l.add(k)}g.model.prototype.constructor.fields=l;if(g.idField){var d=new Mini2.data.Field(g.idField);g.model.prototype.constructor.idField=d;delete g.idField}if(g.lockedField){g.model.prototype.constructor.lockedField=g.lockedField;delete g.lockedField}if(g.lockedRule){g.model.prototype.lockedRule=g.lockedRule;delete g.lockedRule}}g.createInlineData();g.createBindEvent();if(g.totalCount<=0){g.totalCount=g.data.getCount()}},setSummary:function(a,e){var c=this,b,d=c.summary||{};if(!c.summary){c.summary=d}if(Mini2.isString(a)){d[a]=e;b={};b[a]=e;c.on("summarychnaged",[b])}else{for(b in a){d[b]=a[b]}c.on("summarychnaged",[a])}return c},getSummary:function(a){var b=this,c=b.summary||{};if(arguments.length){return c[a]}return c},setCurrentPage:function(a){this.currentPage=a},getCurrentPage:function(){return this.currentPage},loopSaveAll:function(){var b=this,a=b.log;if(!b.autoCallback){return}Mini2.awaitRun(b.muid,500,b,function(){var d=b.getUpdatedRecords();if(0==d.length){return}try{var e=window.widget1;if(e&&e.subMethod){try{e.subMethod($("form:first"),{subName:b.id,subMethod:"SaveAll"})}catch(c){console.error("提交失败",c);alert("提交失败:"+c.message)}}}catch(c){a.debug("error:"+c.message)}})},createBindEvent:function(){var a=this;if(a.autoSave){$(a).muBind("update",a,function(){a.loopSaveAll()})}},updateRecordsIndex:function(){var d=this,c=0,e,b=d.data,a=b.getCount();for(;c<a;c++){e=b.get(c);e.index=c}},afterCommit:function(c,b){var a=this;if(!b){b=null}a.on("update",[c,"COMMIT",b])},setCurrntForId:function(a){var b=this,c;c=b.getById(a);b.setCurrent(c);return !!c},onCurrentChanged:function(){var d=this,c=d.log,a=d.current,b=d.currentIndex;d.on("currentchanged",[b,a])},__lastCurIndex:-1,setCurrent:function(d,e){var h=this,g=h.log,a,b,f,c=h.data;g.debug("设置当前焦点行 setCurrent({0})",d);g.debug("记录数量",c.length);if(undefined==c||c.length==0){h.current=null;h.currentIndex=-1;g.debug("setCurrent(...) 触发 currentchange 事件");h.on("currentchanged",[h.currentIndex,h.current]);g.debug("isTriggerSer = ",e);if(h.currentChanged){h.currentChanged.call(h)}return}if(Mini2.isNumber(d)){a=c.get(d);b=d}else{f=c.filterBy(function(i){if(i==d){return true}return false});if(f.length>0){a=f.get(0);b=a.index}else{a=null;b=-1}}h.current=a;h.currentIndex=b;h.on("currentchanged",[b,a]);if(h.__lastCurIndex!==b){h.__lastCurIndex=b;if(h.currentChanged){h.currentChanged.call(h)}}},getCurrent:function(){var a=this;return a.current},getCurrentIndex:function(){var a=this;return a.currentIndex},commitChanges:function(){var c=this,d=c.getModifiedRecords(),b=d.length,a=0;for(;a<b;a++){d[a].commit()}c.removed.length=0},commitChangesForMuid:function(e,d){var c=this,a=c.data,f,b;b=a.findIndexBy(function(g){if(g.muid==e){return true}});if(b==-1){console.debug("没有找打需要修改的记录, muid=",e);return}f=a.get(b);f.commit(null,d)},add:function(a){var d=this,e,c,b;if(Mini2.isArray(a)){e=a}else{e=arguments[0]}c=e.length;e=d.insert(1000000,e);return e},load:function(b){var a=this;a.lastOptions=Mini2.apply({action:"read",sorters:a.getSorters()},b);a.on("load",[a])},filterNewOnly:function(a){return a.phantom===true},filterNew:function(a){return a.phantom===true&&a.isValid()},filterUpdated:function(a){return a.dirty===true&&a.phantom!==true},getNewRecords:function(){return this.data.filterBy(this.filterNew)},getUpdatedRecords:function(){return this.data.filterBy(this.filterUpdated)},getRemovedRecords:function(){return this.removed},sync:function(d){var a=this,c={},e=a.getNewRecords(),g=a.getUpdatedRecords(),f=a.getRemovedRecords(),b=false;if(e.length>0){c.create=e;b=true}if(g.length>0){c.update=g;b=true}if(f.length>0){c.destroy=f;b=true}if(b&&a.on("beforesync",c)!==false){d=d||{}}return a},removeById:function(b,f){var e=this,d=e.log,c,a=e.data;if(!Mini2.isArray(b)){b=[b]}c=a.filterBy(function(g){return Mini2.Array.contains(b,g.getId(),true)});e.remove(c,false,f);e.disposeModels(c);return c},removeByMuid:function(d,e){var c=this,b,a=c.data;if(!Mini2.isArray(d)){d=[d]}b=a.filterBy(function(f){return Mini2.Array.contains(d,f.muid)});c.remove(b,false,e);c.disposeModels(b);return b},disposeModels:function(e){var c=this,d,b,a=0;if(e&&Mini2.isArray(e)){b=e.length;for(a;a<b;a++){d=e[a];if(d&&d.isModel){d.dispose()}}}},removeAll:function(d){var c=this,e=c.snapshot,a=c.data,b;c.__lastCurIndex=-1;if(e){e.removeAll(a.getRange())}b=c.remove({start:0,end:c.getCount()-1},false,d);if(d!==true){c.on("clear",c);c.onDataChanged()}c.disposeModels(b);return c},curLoadData:null,beginLoadData:function(){var a=this;a.isLoadData=true;a.curLoadData=[];a.onBeginLoaded();return a},endLoadData:function(){var c=this,b=c.log;if(c.isLoadData){c.isLoadData=false;c.onLoad();c.onDataChanged();try{if(c.autoFocus){c.setCurrent(c.currentIndex||0)}}catch(a){console.error("自动设置焦点行错误",a)}c.onEndLoaded()}return c},onBeginLoaded:function(){var b=this;try{b.on("beginloaded",b)}catch(a){console.error("触发 onBeginLoaded 错误",a)}},onEndLoaded:function(){var b=this;try{b.on("endloaded",b)}catch(a){console.error("触发 onEndLoaded 错误",a)}},onDataChanged:function(){var c=this,b=c.log;if(c.getCount()>c.totalCount){c.totalCount=c.getCount()}b.debug("触发 onDataChanged 事件。");try{c.on("datachanged",c)}catch(a){console.error("触发 onDataChanged 错误",a)}},onLoad:function(){var b=this;try{b.on("load",b)}catch(a){console.error("触发 onLoad 错误",a)}},remove:function(p,h,t){h=h===true;var m=this,v=false,u=m.snapshot,b=m.data,d=0,l,g=[],a=[],f=[],k,j,e,o,r,q,s=[];if(p.isModel){p=[p];l=1}if(p.isModel){p=[p];l=1}else{if(Mini2.isIterable(p)){if(p.toArray){p=p.toArray()}l=p.length}else{if(typeof p==="object"){r=true;d=p.start;l=p.end+1;q=l-d}}}if(!r){for(d=0;d<l;d++){o=p[d];e=b.remove(o);o.unjoinStore(m);f.push(e);a.push(o);m.removed.push(o);m.on("remove",o,e,!!h)}s=p}if(r){s=b.removeRange(p.start,q)}m.updateRecordsIndex();if(!t){m.on("bulkremove",[a,f,!!h]);m.onDataChanged()}var c=Mini2.Array.contains(f,m.currentIndex);if(c){var n=-1;if(m.currentIndex>=m.data.length){n=m.data.length-1}else{n=m.currentIndex}m.setCurrent(n)}return s},afterEdit:function(d,c){var b=this,a,e;b.on("update",[d,"EDIT",c])},clearInvalidAll_ByRecordId:function(d,a){var b=this,c=b.getById(d);if(c){c.clearInvalid(a)}},clearInvalid_ByRecordId:function(d,a){var b=this,c=b.getById(d);if(c){c.clearInvalid(a)}},markInvalid_ByRecordId:function(e,a){var c=this,d=c.getById(e);if(d){try{d.clearInvalidAll();d.markInvalid(a)}catch(b){console.error("执行函数错误: markInvalid_ByRecordId(...,..)."+b.Message)}}},afterInvalid:function(c,a){var b=this;b.on("invalid",[c,a])},filterFirstBy:function(b,e){var d=this,c,a=d.data;c=a.filterFirstBy(function(f){return e==f.get(b)});return c},getById:function(b){var d=this,c,a=d.data;c=a.filterFirstBy(function(e){return b==e.getId()});return c},setRecordValue:function(f,b,g,a){var d=this,c=d.log,e;e=d.getById(f);if(e){e.set(b,g);if(a!==true){e.commit(null,[b])}}else{}},getModifiedRecords:function(){return[].concat(this.getNewRecords().toArray(),this.getUpdatedRecords().toArray())},sort:function(h){var d=this;d.sortText=h;if(!d.requestOptions){var f=d.currentPage,g=d.pageSize,e;e=Mini2.apply({action:"read",sorters:d.getSorters()},{});e.page=f;e.start=f*g;e.limit=g;e.end=e.start+e.limit;d.requestOptions=e}d.requestOptions.sorters=d.getSorters();var b=d.clientId+"_Action";var a=$("#"+b);var c=d.getRequestJson();a.val(c);d.loadPage(0)},doSort:function(b){var a=this;if(a.remoteSort){a.load()}else{a.data.sortBy(b);a.onDataChanged();a.on("refresh",a)}a.on("sort",a,a.sorters.getRange())},setReadOnly:function(b){var a=this;a.readOnly=b;return a},getReadOnly:function(){var a=this;return !!a.readOnly},refresh:function(){var a=this;a.on("refresh",a);return a},getTotalCount:function(){return this.totalCount},setTotalCount:function(a){this.totalCount=a},getCount:function(){var a=this;return a.data.getCount()},each:function(b,f){var a=this.data.items,d=a.length,e,c;for(c=0;c<d;c++){e=a[c];if(b.call(f||e,e,c,d)===false){break}}},createModel:function(b){var a=this;if(!b.isModel){if(!a.model){throw new Error("Store.Model 不能等于 null")}b=Mini2.ModelManager.create(b,a.model)}return b},insert:function(d,j,l){var f=this,k=false,c,e,h,a=f.modelDefaults,g;if(Mini2.isArray(j)){g=j}else{g=[j]}j=g;e=j.length;for(c=0;c<e;c++){h=j[c];if(!h.isModel){try{h=f.createModel(h)}catch(b){throw new Error("创建 record 实体错误."+b.message)}}h.joinStore(f);g[c]=h;if(a){h.set(a)}k=k||h.phantom===true;f.data.insert(d+c,h);if(f.curLoadData){f.curLoadData.push(h)}}if(undefined===l||true===l){f.updateRecordsIndex();f.on("add",[d,g]);f.onDataChanged()}return f},isIncr:false,incrPage:0,isLastPage:function(){var b=this,a=b.data,c=b.totalCount;if(a.length>=c){return true}return false},nextPage:function(d){var b=this,a=b.log,c;b.incrPage++;b.loadPage(b.incrPage);return b},loadPage:function(d){var b=this,a=b.log,c;if(undefined==d){d=b.currentPage}c=Mini2.apply({action:"read",sorters:b.getSorters()},{});c.page=d;c.start=d*b.pageSize;c.limit=b.pageSize;c.end=c.start+c.limit;b.requestOptions=c;console.debug("---------- op ",c);var e=window.widget1;if(e&&e.subMethod){e.subMethod("form:first",{subName:b.id,subMethod:"LoadPage",actionPs:d})}return b},getSorters:function(){var a=this;return a.sortText},getJsonForRecord:function(d){var b=this,e,a;var c={action:"none",id:d.getId(),clientId:d.muid,index:b.currentIndex,values:{}};if(d.dirty){c.action="modified"}e=d.data;for(a in e){if("_ownerTreeNode"==a){continue}c.values[a]=e[a]}return c},getJsonForRecordModified:function(e,a){var c=this,b,d;d={action:"none",id:e.getId(),clientId:e.muid,index:a,values:{}};if(e.dirty){d.action="modified"}for(b in e.modified){d.values[b]=e.get(b)}return d},getRequestJson:function(){var b=this;var a=Mini2.Json.toJson(b.requestOptions);return a},getUploadJson:function(){var g=this,f=g.log,j,b,h,d,c,k=g.data,e=k.getCount();c={cur_index:g.currentIndex,current:null,records:[]};try{if(g.current&&g.currentIndex>-1){j=g.current;c.current=g.getJsonForRecord(j)}for(b=0;b<e;b++){j=k.get(b);if("full"==g.jsonMode){h=g.getJsonForRecord(j)}else{if(!j.dirty){continue}h=g.getJsonForRecordModified(j,b)}c.records.push(h)}}catch(a){f.error("Store.getUploadJson(...) 执行错误。"+a.message);throw new Error("Store.getUploadJson(...) 执行错误。"+a.message)}try{d=Mini2.Json.toJson(c)}catch(a){console.error("getUpladJson ",c);f.error("执行 Mini2.Json.toJson(...) 错误",a.message);throw new Error("执行 Mini2.Json.toJson(...) 错误",a.message)}return d},onLoader:function(){var b=this,a=b.log;a.debug(b.id+"  onLoader()");if(b.autoFocus){a.debug("自动设置焦点记录。");b.setCurrent(0)}}},function(){var c=this,b=c.log,a=arguments;if(a&&a[0]){Mini2.apply(this,a[0])}c.preInit()});
Mini2.define("Mini2.data.TreeModel",{data:null,isNode:true,childs:null,parentNode:null,parentId:null,index:0,depth:0,expanded:false,leaf:false,isLast:false,isFirst:false,loaded:false,loading:false,hasChild:false,checked:false,cls:"",icon:"",iconCls:"",model:false,onInit:function(){var b=this,a=b.data,d,c;b.attrs={};b.childs=[];if(a.isNode){d=a.data;delete a.data;c=a}else{d=a;c=a}if(!d.isModel){d=Mini2.ModelManager.create(d,this.model)}b.data=d;Mini2.apply(b.attrs,c)},addNode:function(c,b){var a=this},getAttr:function(a){var c=this,b=c.attrs;return b[a]},setArrt:function(a,d){var c=this,b=c.attrs;b[a]=d;return c}},function(){var a=this;a.muid=Mini2.newId();Mini2.apply(a,arguments[0]);a.onInit(arguments[0])});
Mini2.define("Mini2.data.Tree",{root:null,groupBuffer:false,PID_EX:"PID_",constructor:function(c){var b=this,a=b.data;if(c){b.root=c}b.groupBuffer={};if(a){b.initGroupBuffer(a);delete b.data}},initGroupBuffer:function(a){var d=this,b,e,c=a.length;for(b=0;b<c;b++){e=a.get(b);d.insertNode(e)}},removeNode:function(g){var d=this,f,e=d.parentField,a=d.groupBuffer,h,j,b,c;f="PID_"+g.get(e);h=a[f];if(h){c=g.getId();for(b=0;b<h.length;b++){j=h[b];if(j.isNode){j=j.data}if(j.getId()==c){h.splice(b,1);break}}}},insertNode:function(e){var b=this,d,c=b.parentField,f,a=b.groupBuffer;d="PID_"+e.get(c);f=a[d];if(!f){f=[];a[d]=f}if(!e.isNode){e=Mini2.create("Mini2.data.TreeModel",{model:b.model,data:e})}f.push(e)},getChilds:function(c){var b=this,d="PID_"+c,a=b.groupBuffer,e;e=a[d];return e},getRootNode:function(){return this.root},},function(){var a=this;a.muid=Mini2.getIdentity();Mini2.apply(a,arguments[0]);a.constructor(arguments[0])});
Mini2.define("Mini2.data.TreeStore",{extend:"Mini2.data.Store",isTreeStore:true,parentField:null,textField:null,tree:false,rootValue:"0",dymHasChild:true,hasChilds:function(b){var a=this,c=a.tree||a.createTree();return !!c.getChilds(b)},getByGroup:function(b){var a=this,c=a.tree||a.createTree();return c.getChilds(b)},createTree:function(){var a=this,b=a.parentField,d=a.tree,c=a.data;if(!d){a.tree=d=Mini2.create("Mini2.data.Tree",{model:a.model,parentField:b,data:c})}return d},createInlineData:function(){var g=this,f=g.log,h=g.model,d,a,j,b=g.data,e;if(b){e=b.length;for(d=0;d<e;d++){a=b[d];if("tree-model"==a.role){var c=a.has_child;var k=a.role;j=Mini2.ModelManager.create(a.data,h);j.has_child=c;j.role=k}else{j=Mini2.ModelManager.create(a,h)}j.joinStore(g);b[d]=j}}g.inlineData=b;delete g.data;g.data=new Mini2.collection.ArrayList(g.inlineData);g.updateRecordsIndex()},removeById:function(c,h){var f=this,e=f.log,b,d,a=f.data;if(!Mini2.isArray(c)){c=[c]}var g=c;if(!h){f.on("remove",[g,false]);f.onDataChanged()}f.disposeModels(d);return d},remove:function(e,c,g){var d=this,a=d.constructor.base,f,b,h=d.tree||d.createTree();f=a.remove.call(d,e,c,g);for(b=0;b<f.length;b++){h.removeNode(f[b])}},createModel:function(c){var b=this;if("tree-model"==c.role){if(!b.model){throw new Error("Store.Model 不能等于 null")}var a=c.has_child;c=Mini2.ModelManager.create(c,b.model);c.role="tree-model";c.has_child=a}else{if(!c.isModel){if(!b.model){throw new Error("Store.Model 不能等于 null")}c=Mini2.ModelManager.create(c,b.model)}}return c},insert:function(c,h){var e=this,d=e.log,a=e.constructor.base,l,g,f,j=[],m=[],b,k=e.tree||e.createTree();if(!Mini2.isArray(h)){f=[h]}else{f=h}h=f;for(b=0;b<h.length;b++){g=h[b];if("tree-model"==g.role){l=g;g=g.data;g._ownerTreeNode=l;g.role="tree-model";g.has_child=l.has_child}else{if(g.isNode){l=g;g=l.data;g._ownerTreeNode=l}else{}}j.push(g)}a.insert.call(e,c,j,false);for(b=0;b<j.length;b++){k.insertNode(j[b])}e.updateRecordsIndex();e.on("add",[c,j]);e.onDataChanged()},setCurrent:function(d,e){var h=this,g=h.log,a,b=0,f,c=h.data;console.debug("数据仓库 setCurrent ",d);if(undefined===c){h.current=null;h.currentIndex=-1;h.focusNode=null;h.on("currentchanged",[h.currentIndex,h.current]);if(h.currentChanged){h.currentChanged.call(h)}return}if(Mini2.isNumber(d)){}else{a=d;h.focusNode=a;h.current=a;h.currentIndex=b}h.on("currentchanged",[b,a]);if(h.currentChanged){h.currentChanged.call(h)}}});
Mini2.ns("Mini2.ui");Mini2.ui.SecManager=new function(){Mini2.apply(this,{defaultProp:"visible",propDict:{visible:{},readonly:{}},reg:function(f,a,e){if(Mini2.isBlank(f)){return this}e=e||this.defaultProp;var d=this,b=d.propDict[e],c=b[f];if(!c){b[f]=c=[]}c.push(a);return d},unreg:function(f,a,e){if(Mini2.isBlank(f)){return this}e=e||this.defaultProp;var d=this,b=d.propDict[e],c=b[f];if(!c){b[f]=c=[]}Mini2.Array.remove(c,a);return d},getItems:function(d){var c=this,a=c.secControls,b=a[d];return b||null},setFun:function(a,c){var b=this;b.setFun_ForVisible(a,c);b.setFun_FroReadonly(a,c);Mini2.LoaderManager.preResize();return b},getEnableGroup:function(a,f){var e=this,g=[],b=[],d={T:g,F:b};for(var c in a){if(Mini2.Array.contains(f,c,true)){g[c]=a[c]}else{b[c]=a[c]}}return d},setFun_ForVisible:function(b,f){var e=this,c="setVisible",a=e.propDict.visible,d;d=e.getEnableGroup(a,f);e.callFun(d.T,c,true);e.callFun(d.F,c,false);return e},setFun_FroReadonly:function(b,f){var e=this,c="setReadOnly",a=e.propDict.readonly,d;d=e.getEnableGroup(a,f);e.callFun(d.T,c,true);e.callFun(d.F,c,false);return e},callFun:function(a,d,j){var h=this,b,g,f;for(var c in a){g=a[c]||[];for(var e=0;e<g.length;e++){f=g[e];b=f[d];if(b){b.call(f,j)}else{console.warn("没有找到这个控件对应的函数名: "+d)}}}return h}})};
Mini2.define("Mini2.ui.FocusManager",{singleton:true,log:Mini2.Logger.getLogger("Mini2.ui.FocusManager",false),alternateClassName:["Mini2.ui.FocusMgr"],control:null,data:null,scope:null,el:null,lastActionControl:null,lastActionTime:Mini2.Date.now(),setActionControl:function(a){var b=this;b.lastActionControl=a;b.lastActionTime=Mini2.Date.now()},isInputting:function(){var c=this,b,d,a=c.lastActionControl;b=(a&&a.isInput)||false;if(b){d=Mini2.Date.now()-c.lastActionTime;if(d>20000){b=false}}return b},offsetParent:function(c){var b=$(c),a="mi-border-box",d=0;if(b.hasClass(a)){return c}for(d;d<999;d++){b=b.parent();if(b.hasClass(a)){break}}return b},getBorderBox:function(b){var d=this;if(b==undefined){return d}if(b.toString()=="[object Window]"){b=window.document.body}if(b.el){if(b.el.jquery){b=b.el.get(0)}else{if(Mini2.isDom(b.el)){b=b.el}}}if(!Mini2.isDom(b)){return d}var a;if($(b).hasClass("mi-border-box")){a=$(b)}else{a=d.offsetParent(b)}var c=null;if(a.length){c=a.data("FOCUS_MANAGER");if(!c){c={control:null,data:null,scope:null,el:a.get(0),typeString:a.get(0).toString(),muid:"F_"+Mini2.getIdentity()};a.data("FOCUS_MANAGER",c)}return c}return d},clear:function(a){var b=this,c=b.getBorderBox(a);c.data=null;c.scope=null;c.control=null},setControl:function(a,b,i,c){var g=this,f=g.log,h=g.getBorderBox(a),d=h.control,e=h.data;if(a){if(a.getType){f.debug(a.getType().fullName)}}a=i||a;b=b||null;if(c!=true){if(d==a&&e==b){f.debug("对比控件相同, 退出");return}}f.debug("lastCon",d);f.debug("cur con : ",a);if(d){f.debug("触发控件移出的事件");$(d).muTriggerHandler("focusout",[{sender:d,target:a,data:e}])}h.control=a;h.data=b;g.setActionControl(a);if(a){$(a).triggerHandler("focusin")}}});
Mini2.define("Mini2.ui.Component",{el:null,log:Mini2.Logger.getLogger("Mini2.ui.Component"),deviceType:"auto",ui:"default",scope:null,isComponent:true,renderTo:null,visible:true,disabled:false,eventNames:[],ownerParent:null,callParent:function(){var a=this,b=a.ownerParent;if(b&&b.updateLayout){b.updateLayout()}return a},initComponent:Mini2.emptyFn,defaultRenderer:Mini2.emptyFn,trigger:function(c,d){var h=this,j,g,b="_EVENT_"+c,f,e,a;f=h[b];if(f){for(g=0;g<f.length;g++){e=f[g];if(e.owner){j=e.owner;e=e.fun}else{j=h}a=e.call(j,d);if(true===a){break}}}return a},bind:function(b,f,c){var e=this,a="_EVENT_"+b,d;d=e[a]||[];if(undefined===c){c=f}else{c={owner:f,fun:c}}d.push(c);if(!e[a]){e[a]=d}return e},on:function(b,a,d){var c=this;switch(b){case"mouseup":Mini2.EventManager.setMouseUp(c,a);break;case"mousemove":Mini2.EventManager.setMouseMove(c,a);break;default:$(c).muTriggerHandler(b,a);break}return c},addCls:function(a){var c=this,b=c.rendered?c.el:c.protoEl;$(c.el).addClass(a);return c},onResize:function(d,a,c,b){},setLocation:function(a,b){return this.setLeft(a).setTop(b)},setLocal:function(b,c){var a=this;return a.setLocation(b,c)},setTop:function(b){var a=this;a.top=b;a.el.css("top",b);return this},getTop:function(){var b=this,a=b.el;return a.css("top")},setLeft:function(c){var b=this,a=b.el;b.left=c;a.css("left",c);return b},getLeft:function(){var b=this,a=b.el;return a.css("left")},setHeight:function(a){this.setSize(undefined,a)},setWidth:function(a){this.setSize(a)},getWidth:function(b){var c=this,a=c.el;if(true===b){return a.outerWidth(b)}else{return a.outerWidth()}},getHeight:function(b){var c=this,a=c.el;if(true===b){return a.outerHeight(b)}else{return a.outerHeight()}},setSize:function(b,a){},getSize:function(a){var b=this;if(true===a){return{width:b.getWidth(a),height:b.getHeight(a)}}else{return{width:b.getWidth(),height:b.getHeight()}}},hide:function(){var b=this,a=b.el;b.visible=false;if(a){a.hide()}b.callParent();return b},show:function(){var b=this,a=b.el;b.visible=true;if(a){a.show()}b.callParent();return b},setVisible:function(b){var a=this;b=!!b;a.visible=b;if(b){a.show()}else{a.hide()}return a},getVisible:function(){var a=this;return a.visible},setDisabled:function(b){var a=this;a.disabled=!!b},getDisabled:function(){var a=this;return a.disabled},onLostFocus:function(){},resetPaint:Mini2.emptyFn,onFocus:Mini2.emptyFn,focus:Mini2.emptyFn,dispose:Mini2.emptyFn},function(){var a=this;a.renderTo=Mini2.getBody();Mini2.apply(a,arguments[0]);a.initComponent()});
Mini2.define("Mini2.ui.Editor",{extend:"Mini2.ui.Component",value:"",offsets:[0,0],cancelOnEsc:true,focusOnToFront:false,hidden:true,field:null,initComponent:function(){},afterRender:function(a,b){},startEdit:function(a,b){},onShow:function(){},cancelEdit:function(a){},hideEdit:function(a){},onHide:function(){},setValue:function(a){this.field.setValue(a)},getValue:function(){return this.field.getValue()}});
Mini2.define("Mini2.ui.EcView",{parentPage:null,getParentWin:function(){var b=window;var a=0;for(a=0;a<9;a++){if(b.parent==b||b.parent==undefined){break}b=b.parent}return b},changeAppUri:function(g){var b=this;if(undefined==g){throw new Error("srcUrl 不能为空.")}if(g.length&&g.substr(0,1)=="/"){return g}if(g.indexOf("http:")==0||g.indexOf("https:")){return g}var e=window.location.pathname;var f=window.location.search;var c=e.lastIndexOf("/");var a=e.substr(0,c+1);while((g.length>3&&g.substr(0,3)=="../")){c=a.lastIndexOf("/",a.length-2);a=a.substr(0,c+1);g=g.substr(3)}var d=a+g;return d},show:function(e,d,b,f,a){var c=this,g;e=c.changeAppUri(e);g=c.getParentWin();if(g.AddTab){if(b){g.AddTab(e,{label:d,iconCls:b,parentPage:window})}else{g.AddTab(e,d,true,true,window)}return}if(f==undefined){f=800}if(a==undefined){a=600}window.open(e,d,"height="+f+",width="+a+",toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")}});Mini2.EcView={show:function(e,d,b,c){var a=Mini2.create("Mini2.ui.EcView",{});a.show(e,d,b);return a}};
Mini2.define("Mini2.ui.Page",{singleton:true,margin:{top:40},curMax:{con:null,srcWidth:0,srcHeight:0,srcTop:0,srcLeft:0},initComponent:function(){var a=this},hasMaxControl:function(){return !!this.curMax.con},resize:function(){var c=this,b=c.curMax,a=b.con;if(a){var d=$(window);a.setSize(undefined,d.height()-c.margin.top)}},maxControl:function(a){var e=this,b=e.curMax,c=$;if(a.el){c=$(a.el)}if(c.hasClass("mi-state-max")){return}c=a.el;try{b.con=a;b.srcHeight=a.getHeight();b.srcWidth=a.getWidth();b.srcTop=a.getTop();b.srcLeft=a.getLeft();c.addClass("mi-state-max");var g=$(window);a.setSize(undefined,g.height()-e.margin.top)}catch(d){var f=a.getType();console.log("最大化错误. con.fullName="+f.fullName);console.log(d)}},resetMaxControl:function(a){var d=this,b=d.curMax,c=$;if(!b.con){return}if(a.el){c=$(a.el)}c.removeClass("mi-state-max");a.setLeft(b.srcLeft).setTop(b.srcTop).setSize(b.srcWidth,b.srcHeight);b.con=null}});Mini2.define("Mini2.ui.WindowManager",{singleton:true,items:[],defaultZIndex:19000,zIndex:19000,isUpdateLayout:false,regWin:function(d){var c=this,a=c.items,b=a.length;Mini2.Array.add(a,d);d.setZIndex(c.zIndex+b*20)},moveFirst:function(g){var f=this,c,a,e,b,d=f.items;b=Mini2.Array.lastIndexOf(d,g);e=d.length;if(b==e-1){return}for(a=b;a<e-1;a++){d[a]=d[a+1]}d[e-1]=g;for(a=b;a<e;a++){c=d[a];c.setZIndex(f.zIndex+a*20)}},removeWin:function(c){var b=this,a=b.items;Mini2.Array.remove(a,c);if(!a.length){b.zIndex=b.defaultZIndex}}});
Mini2.define("Mini2.ui.WindowHeader",{renderTo:Mini2.getBody(),text:"Window",headerTpl:['<div class="mi-window-header ',"mi-header ","mi-header-horizontal ","mi-header-draggable ","mi-docked ","mi-unselectable ","mi-window-header-default ","mi-horizontal ","mi-window-header-horizontal ","mi-window-header-default-horizontal ","mi-top ","mi-window-header-top ","mi-window-header-default-top ","mi-docked-top ","mi-window-header-docked-top ",'mi-window-header-default-docked-top" ','style="right: auto; left: -5px; top: -5px; width: 400px; ">','<div class="mi-header-body ',"mi-window-header-body ","mi-window-header-body-default ","mi-window-header-body-horizontal ","mi-window-header-body-default-horizontal ","mi-window-header-body-top ","mi-window-header-body-default-top ","mi-window-header-body-default-docked-top ","mi-box-layout-ct ","mi-window-header-body-default-horizontal ",'mi-window-header-body-default-top " ','style="width: 380px; ">','<div class="mi-box-inner " role="presentation" style="width: 380px;  ">','<div class="mi-box-target" style="width: 380px; ">','<div class="mi-component ',"mi-header-text-container ","mi-window-header-text-container ","mi-window-header-text-container-default ",'mi-box-item mi-component-default" ','unselectable="on" ','style="right: auto; left: 0px; top: 0px; margin: 0px; width: 358px; ">','<span class="mi-header-text ',"mi-window-header-text ",'mi-window-header-text-default" ','unselectable="on">',"Window","</span>","</div>",'<div class="mi-tool ',"mi-box-item ","mi-tool-default ",'mi-tool-after-title" ','title="关闭"','style="width: 16px; height: 16px;  left: 364px; top: 0px; right: auto;margin: 0px; " >','<img role="presentation" ','src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" ','class="mi-tool-img mi-tool-close">',"</div>","</div>","</div>","</div>","</div>"],closeEnabled:true,setText:function(a){this.headerTextEl.html(a)},getText:function(){return this.headerTextEl.html()},setWidth:function(c){var a=this,b=Mini2.SystemInfo;a.el.css("width",c);a.boxInnerEl.css("width",c-20);a.boxTargetEl.css("width",c-20);a.textContainerEl.css("width",c-32);if("touch"==b.mode){a.toolEl.css({left:c-46})}else{a.toolEl.css({left:c-36})}},srcLocation:{},srcX:0,srcY:0,button1:false,isDrag:false,mouseBind:function(a){var b=this;a.muBind("mousedown",b,function(c){b.button1=true;b.srcLocation=b.owner.getOffset();b.srcX=event.pageX;b.srcY=event.pageY;b.owner.focus()}).muBind("mouseup",b,function(c){b.button1=false;if(b.isDrag){b.isDrag=false;b.owner.endDrag();Mini2.EventManager.stopEvent(c)}}).muBind("mousemove",b,function(c){if(b.button1){var d=event.pageX-b.srcX;var f=event.pageY-b.srcY;var g=d+b.srcLocation.left;var h=f+b.srcLocation.top;if(!b.isDrag){if(Math.abs(d)>=4||Math.abs(f)>=4){b.isDrag=true;b.owner.beginDrag()}}else{if(b.isDrag){b.owner.setGhostLocation(g,h)}}}})},render:function(){var g=this,h=Mini2.SystemInfo,c=h.window;var d=Mini2.$joinStr(g.headerTpl);var e=d.cFirst(".mi-header-body");var a=e.cFirst(".mi-box-inner");var b=a.cFirst(".mi-box-target");var i=b.cFirst(".mi-header-text-container");var f=i.cFirst(".mi-header-text");var j=b.cFirst(".mi-tool");console.debug("me.closeEnabled = ",g.closeEnabled);if(!g.closeEnabled){j.hide()}f.html(g.text);g.el=d;g.headerBodyEl=e;g.boxInnerEl=a;g.boxTargetEl=b;g.textContainerEl=i;g.headerTextEl=f;g.toolEl=j;if("touch"==h.mode){j.css({width:32,height:32,top:-10,})}$(j).mouseenter(function(){$(this).addClass("mi-tool-over")}).mouseout(function(){$(this).removeClass("mi-tool-over")}).muBind("mousedown",Mini2.emptyFn).muBind("mouseup",function(k){g.onAction("close",k)});$(g.renderTo).append(d);a.css("height",c.headerHeight||16);g.mouseBind(d)},onAction:function(a){$(this).triggerHandler("action",[a]);Mini2.EventManager.stopEvent()}});
Mini2.define("Mini2.ui.Window",{extend:"Mini2.ui.Component",alias:"widget.window",text:"Window",bite:true,isTween:true,formClosed:function(a){this.bind("formClosed",a)},formClosing:function(a){this.bind("formClosing",a)},closeEnabled:true,windwoBoxTpl:['<div class="mi-window ',"mi-layer ","mi-window-default ","mi-closable ","mi-window-closable ","mi-window-default-closable ","mi-border-box ","mi-resizable ","mi-window-resizable ",'mi-window-default-resizable" ','style="right: auto; position: fixed !important;">',"</div>"],ghostTpl:['<div class="mi-window-proxy" style="right: auto;display:none;"></div>'],bodyTpl:['<div class="mi-window-body mi-window-body-default mi-closable mi-window-body-closable mi-window-body-default-closable ','mi-window-body-default mi-window-body-default-closable mi-noborder-trbl " ','style="padding: 0px; overflow: hide; left: 0px;">',"</div>"],shadowTpl:['<div class="mi-css-shadow mi-css-shadow-default" role="presentation" style="right: auto;position: fixed ; ',"left: 572px; top: 186px; width: 400px; height: 261px; ",'display: block;">',"</div>"],maskTpl:['<div class="mi-mask" style="right: auto; left: 0px; top: 0px; position: fixed;"></div>'],contentTpl:['<iframe src="" frameborder="0" dock="full">框架窗体</iframe>'],url:null,iframe:true,iframeContent:null,startPosition:"default",autoScroll:false,width:600,height:400,left:100,top:20,headerVisible:true,shadowVisible:true,header:null,onInit:Mini2.emptyFn,onLoad:Mini2.emptyFn,zIndex:19000,mode:false,buttons:false,buttonPanel:false,buttonAlign:"right",initComponent:function(){var a=this;Mini2.ui.WindowManager.regWin(this);a.onInit();a.onLoad()},render_ButtonPanel:function(f){var d=this,e,a=d.buttons,g=Mini2.SystemInfo,b=g.window;if(a){var c=(b.footerHeight+12)||24;e=Mini2.create("Mini2.ui.panel.Panel",{baseCls:Mini2.baseCSSPrefix+"toolbar",dock:"bottom",ui:"footer",height:c,scroll:"none",padding:{left:8,top:8,right:8,bottom:4},renderTo:f});e.render();d.render_Button(e.boxTarget);d.buttonPanel=e}},render_Button:function(g){var e=this,c,a,d,b=e.buttons,f=[];if(b){for(d=0;d<b.length;d++){c=Mini2.applyIf(Mini2.clone(b[d]),{renderTo:g,ownerWindow:e});f[d]=a=Mini2.create("Mini2.ui.button.Button",c);a.render();a.el.addClass("mi-box-item")}delete e.buttons;e.buttons=f}},focusBase:function(){var a=this;Mini2.ui.WindowManager.moveFirst(a);Mini2.ui.FocusMgr.setControl(a);return a},focus:function(){return this.focusBase()},setZIndex:function(c){var b=this,a=b.el;b.zIndex=c;if(!b.el){return}a.css("z-index",c);if(b.shadowVisible){b.shadowEl.css({"z-index":c-1})}},header_Action:function(a,c){var b=a.data;switch(c){case"close":b.close();break;default:}},getOffset:function(){return $(this.el).offset()},getBtnWidth:function(a){var c=0,b=a.length;while(b--){c+=a[b].getWidth()}return c},setButtonLayout:function(f,b){var e=this,c,a,d=b.length;for(c=0;c<d;c++){a=b[c];a.setLeft(f);f+=a.getWidth()+6}},updateLayout:function(){var e=this,a,f,c,d,b=e.buttons;if(b){c=b.length;f=e.getBtnWidth(b);d=e.width-f-c*6-20;switch(e.buttonAlign){case"left":e.setButtonLayout(0,b);break;case"center":e.setButtonLayout(d/2,b);break;case"right":e.setButtonLayout(d,b);break}}},setSizeBase:function(o,k){var l=this,i=l.el,a=k-10,b=0,d,e=l.buttons,c=o-10,g=l.contentEl,m,n=Mini2.SystemInfo,f=n.window;l.width=o||l.width;l.height=k||l.height;i.css({width:o,height:k});if(l.buttonPanel){var j=(f.footerHeight+8)||36;l.buttonPanel.setSize(o-10,j);a-=j;l.updateLayout()}if(l.headerVisible){l.header.setWidth(o);a-=f.headerHeight+12||31;b+=f.headerHeight+12||31}if(l.buttonPanel){l.buttonPanel.setTop(b+a)}m={width:c,height:a};l.bodyEl.css(m).css({top:b});if(g&&("full"==g.attr("dock")||"full"==g.attr("data-dock"))){if(g.get(0).tagName=="IFRAME"){g.attr(m)}else{g.css(m);if(l.bite){g.bind("mousedown",function(h){Mini2.ui.FocusMgr.setControl(this)});g.muBind("mouseup",Mini2.emptyFn)}}}if(l.shadowVisible){l.shadowEl.css({width:o,height:k-8})}return l},setSize:function(c,a){var b=this;b.setSizeBase(c,a);return b},setSizeTween:function(k,b){var c=this,g=c.left,i=c.top,f=c.width,e=c.height;if(!TWEEN){c.setSize(k,b);return}var d=300;if(!c.isTween){d=100}var a={x:g,y:i,w:f,h:e};var j=new TWEEN.Tween(a).to({x:g-(k-f)/2,y:i-(b-e)/2,w:k,h:b},d).onUpdate(function(){c.setLocation(this.x,this.y);c.setSize(this.w,this.h)}).onComplete(function(){Mini2.TweenManager.remove(j)}).easing(TWEEN.Easing.Quadratic.In);j.muid=Mini2.newId();Mini2.TweenManager.add(j);j.start();return c},setLocationTween:function(f,g){var b=this,c=b.left,d=b.top;var a={x:c,y:d,opacity:0};var e=new TWEEN.Tween(a).to({x:f,y:g,opacity:1},500).onUpdate(function(){b.setLocation(this.x,this.y);b.el.css("opacity",this.opacity)}).onComplete(function(){Mini2.TweenManager.remove(e)}).easing(TWEEN.Easing.Quadratic.In);e.muid=Mini2.newId();Mini2.TweenManager.add(e);e.start();return b},setLocation:function(c,d,a){var b=this;if(!Mini2.isNumber(c)){c=parseInt(c)}if(!Mini2.isNumber(d)){d=parseInt(d)}if(a&&("center_screen"==b.startPosition||"default"==b.startPosition)){c=($(window).width()-b.width)/2;d=($(window).height()-b.height)/2}if(d<0){d=0}b.left=c;b.top=d;b.el.css({left:c,top:d});if(b.shadowVisible){b.shadowEl.css({left:c,top:d+8})}return b},initGhost:function(){var a=this;if(!a.ghostEl){a.ghostEl=Mini2.$joinStr(a.ghostTpl);$(a.renderTo).append(a.ghostEl)}},setGhostLocation:function(c,d){var b=this,a=b.ghostEl;a.css({left:c,top:d});return b},beginDrag:function(){var c=this,b,a=c.el,d=a.css("z-index");d=parseInt(d);c.initGhost();b=c.ghostEl;b.css({left:a.css("left"),top:a.css("top"),width:a.css("width"),height:a.css("height"),"z-index":d+100});b.muBind("mouseup",Mini2.emptyFn);b.show();if(c.shadowVisible){c.shadowEl.hide()}a.hide();return c},endDrag:function(){var c=this,b=c.ghostEl,a=c.el,d,e;b.hide();d=b.css("left");e=b.css("top");c.setLocation(d,e);if(c.shadowVisible){c.shadowEl.show()}a.show();return c},renderMask:function(){var c=this,a,b,d=$(window);if(c.mode){c.maskEl=b=Mini2.$join(c.maskTpl);b.css({width:d.width(),height:d.height(),"z-index":c.zIndex-2});if(c.maskOpacity){b.css("opacity",c.maskOpacity);b.css("filter","alpha(opacity="+c.maskOpacity*100+")")}c.renderTo.append(b);b.muBind("mousedown",Mini2.emptyFn);b.muBind("mouseup",Mini2.emptyFn)}return c},getText:function(){return this.text},setText:function(b){var a=this;a.text=b;a.header.setText(b);return a},renderHeader:function(a){var c=this;if(c.headerVisible){var b=c.header=Mini2.create("Mini2.ui.WindowHeader",{width:c.width,owner:c,renderTo:a,text:c.text,closeEnabled:c.closeEnabled});b.render();$(b).bind("action",c,c.header_Action)}return c},renderShadow:function(){var a=this;if(a.shadowVisible){a.shadowEl=Mini2.$joinStr(a.shadowTpl);a.shadowEl.css("z-index",a.zIndex-1);a.renderTo.append(a.shadowEl)}return a},renderEl:function(){var d=this,b,a,c;d.el=b=Mini2.$join(d.windwoBoxTpl);d.renderTo.append(b);b.mouseup(function(f){Mini2.EventManager.stopEvent(f)});b.data("me",d);b.css("z-index",d.zIndex);d.bodyEl=a=Mini2.$join(d.bodyTpl);b.append(a);if(d.autoScroll&&!d.iframe){a.css("overflow","auto")}a.css("border-style","none");d.renderHeader(b);d.renderShadow();d.render_ButtonPanel(b);return d.el},setUrl:function(c){var b=this,a=b.contentEl;if(b.iframe){a.attr("src",b.url)}},getContentEl:function(){var b=this,a;a=Mini2.$joinStr(b.contentTpl);return a},renderContent:function(){var e=this,a,b;e.contentEl=a=e.getContentEl();e.bodyEl.append(a);if(e.iframe){a.attr("muid",e.muid);if(!e.autoScroll){a.attr("scrolling","no")}a.bind("load",{owner:e},e.iframe_load);e.iFrameReady.call(e,a[0],function(){var f=a[0].contentWindow;f.ownerWindow=e;b=f.Mini2;if(b&&b.onwerPage){b.onwerPage.ownerWindow=e}});if(e.url){a.attr("src",e.url)}else{if(e.iframeContent){var c=a[0].contentWindow;var d=c.document;d.open();d.write(e.iframeContent);d.close()}}}return a},iframe_load:function(d){var g=this,f=$(g).attr("muid"),h=g.contentWindow,b,c=h.document,a=c.body;if(!h.ownerWindow){h.ownerWindow=d.data.owner;b=h.Mini2;if(b&&b.onwerPage){b.onwerPage.ownerWindow=d.data.owner}}},renderBase:function(){var b=this,a,c=$(window);b.renderMask();a=b.renderEl();b.renderContent();if("max"==b.state){b.win_resize.call(b);c.resize(function(){b.win_resize.call(b)})}else{b.setSize(b.width,b.height);b.setLocation(b.left,b.top,true)}return a},render:function(){var b=this,a;a=b.renderBase();return a},win_resize:function(){var b=this,d=$(window),c=d.width()-20,a=d.height()-20;b.setSize(c,a);b.setLocation(10,10,true)},setOpacity:function(c){var b=this,a=b.el;a.css({opacity:c});if(b.shadowVisible){b.shadowEl.css({opacity:c})}return b},setOpacityTween:function(e){var c=this,b=c.el;if(!window.TWEEN){b.css({opacity:e});if(c.shadowVisible){c.shadowEl.css({opacity:e})}return}var a={opacity:b.css("opacity")};var d=new TWEEN.Tween(a).to({opacity:1},300).onUpdate(function(){b.css("opacity",this.opacity);if(c.shadowVisible){c.shadowEl.css({opacity:this.opacity})}}).onComplete(function(){Mini2.TweenManager.remove(d)}).easing(TWEEN.Easing.Quadratic.In);d.muid=Mini2.newId();Mini2.TweenManager.add(d);d.start();return c},firstShow:0,showBefore:Mini2.emptyFn,showAfter:Mini2.emptyFn,show:function(){var c=this,b=c.isTween,a=c.el,d;if(!this.el){c.firstShow=0;c.render()}else{c.firstShow++}a=c.el;if(b){c.setOpacity(0)}d=c.shadowEl;if(c.shadowVisible){d.show()}c.showBefore();a.show();c.showAfter();if(b){c.setOpacityTween(1)}c.focus();return c},hide:function(){var c=this,a=c.el,d=c.shadowEl,b=c.maskEl;if(a){a.hide()}if(c.shadowVisible){d.hide()}if(c.mode){if(b[0].addEventListener){b[0].addEventListener("webkitAnimationStart",function(){c.isCartoonEnd=true});b[0].addEventListener("webkitAnimationEnd",function(){if(c.isDispose){b.remove()}});Mini2.setTimer(function(){if(c.isCartoonEnd){return false}if(c.isDispose){b.remove();return false}},{limit:1,overtime:1000,interval:100,})}else{Mini2.setTimer(function(){if(c.isDispose){b.remove();return false}},{limit:1,interval:300})}b.addClass("mi-mask-hide")}return c},iFrameReady:function(e,d){var h;var c=false;function f(){if(!c){c=true;clearTimeout(h);d.call(this)}}function g(){if(this.readyState==="complete"){f.call(this)}}function a(i,j,k){if(i.addEventListener){return i.addEventListener(j,k)}else{return i.attachEvent("on"+j,function(){return k.call(i,window.event)})}}a(e,"load",function(){f.call(e.contentDocument||e.contentWindow.document)});function b(){var i;if(e.contentDocument){i=e.contentDocument}if(!i&&e.contentWindow){i=e.contentWindow.document}if(i&&i.URL.indexOf("about:")!==0){if(i.readyState==="complete"){f.call(i)}else{a(i,"DOMContentLoaded",f);a(i,"readystatechange",g)}}else{h=setTimeout(b,1)}}b()},close:function(b){var c=this,a;b=b||{};a=c.trigger("formClosing",b);if(!a){c.trigger("formClosed",b);c.hide();c.dispose()}return c},isDispose:false,dispose:function(){var c=this,a=c.el,d=c.shadowEl,b=c.maskEl;c.isDispose=true;if(a){a.remove()}if(d){d.remove()}if(c.ghostEl){c.ghostEl.remove()}Mini2.ui.WindowManager.removeWin(c)}});Mini2.define("Mini2.ui.Draggable",{el:null,srcX:0,srcY:0,srcLocation:null,bind:function(){var b=this,a=b.el;a.muBind("mousedown",b,function(c){b.srcLocation=$(a).offset();b.srcX=event.pageX;b.srcY=event.pageY;a.focus();console.log("ddddddddddd")}).muBind("mouseup",b,function(c){}).muBind("mousemove",b,function(c){var d=event.pageX-b.srcX;var f=event.pageY-b.srcY;var g=d+b.srcLocation.left;var h=f+b.srcLocation.top;if(!b.isDrag){if(Math.abs(d)>=4||Math.abs(f)>=4){b.isDrag=true}}else{if(b.isDrag){a.css({left:g,top:h})}}})}});
Mini2.define("Mini2.ui.MessageBox",{extend:"Mini2.ui.Window",mode:true,buttonAlign:"center",startPosition:"center_screen",width:350,height:130,icon:"info",buttons:[{text:"确定",width:80,click:function(a){this.ownerWindow.close()}}],INFO:Mini2.baseCSSPrefix+"message-box-info",WARNING:Mini2.baseCSSPrefix+"message-box-warning",QUESTION:Mini2.baseCSSPrefix+"message-box-question",ERROR:Mini2.baseCSSPrefix+"message-box-error",contentTpl:['<div class="mi-box-inner " role="presentation" style="height: 55px; width: 339px;" dock="full">','<div class="mi-box-target" style="width: 339px;">','<div class="mi-container mi-box-item mi-window-item mi-container-default mi-box-layout-ct" ','style="overflow: hidden; padding: 10px; margin: 0px; right: auto; left: 0px; top: 0px;">',"</div>","</div>","</div>"],contentTpl2:['<div class="mi-box-inner " role="presentation" style="width: 319px; height: 35px;">','<div class="mi-box-target" style="width: 319px;">','<div class="mi-component mi-box-item mi-component-default mi-dlg-icon " ','style="width: 50px; height: 35px; margin: 0px; right: auto; left: 0px; top: 0px;">',"</div>",'<div class="mi-container mi-box-item mi-container-default" style="margin: 0px;right: auto; left: 50px; top: 0px;">','<span style="display: table;">','<div class="mi-message-box-textbox" style="height: 100%; vertical-align: top;  white-space:nowrap;">',"</div>","</span>","</div>","</div>","</div>"],title:"标题",msg:"提示信息",renderHeader:function(a){var c=this,b;if(c.headerVisible){b=c.header=Mini2.create("Mini2.ui.WindowHeader",{width:c.width,owner:c,renderTo:a,text:c.title});b.render();$(b).bind("action",c,c.header_Action)}},renderContent:function(){var h=this,i=Mini2.SystemInfo,b=i.window,c,d,e,g,f,a=h.bodyEl;h.contentEl=d=Mini2.$join(h.contentTpl);a.append(d);h.content2El=c=Mini2.$join(h.contentTpl2);$(d).find(".mi-container").append(c);h.iconEl=e=c.find(".mi-dlg-icon");h.inputBodyEl=f=c.find(".mi-message-box-textbox");switch(h.icon){case"error":e.addClass(h.ERROR);break;case"question":e.addClass(h.QUESTION);break;case"warning":e.addClass(h.WARNING);break;default:e.addClass(h.INFO);break}f.html(h.msg)},render:function(){var d=this,g=Mini2.SystemInfo,a=g.window;d.renderMask();d.renderEl();d.renderContent();var e=d.inputBodyEl.height();var f=d.inputBodyEl.width();if(f<200){f=200}if(e<40){e=40}var b=d.buttonPanel.getHeight();d.content2El.height(e);d.content2El.width(f+50);var c=d.content2El.children(".mi-box-inner");d.height=e+(a.headerHeight+16)+b;d.height+=30;d.width=f+40+50;d.setSize(d.width,d.height);d.setLocation(d.left,d.top,true);setTimeout(function(){d.buttons[0].focus()},200)}});Mini2.define("Mini2.ui.PromptWinddow",{extend:"Mini2.ui.Window",width:500,height:180,mode:true,text:"文本框",iframe:false,startPosition:"center_screen",contentTpl:['<div style="padding:10px;" class="mi-form-item-body">','<div class="input-message" style="height:40px;">请输入:</div>','<input type="text" style="width:100%;resize: none;" class="input-box mi-form-field mi-form-text">',"","</input>","</div>"],buttons:[{text:"确定",width:80,click:function(){var b=this,d=b.ownerWindow,c=d.okClick,a;if(c){a=c.call(d);if(true===a){return}}d.close({result:"ok"})}},{text:"取消",width:80,click:function(){var a=this,b=a.ownerWindow;if(b.cancelClick){b.cancelClick.call(b)}b.close({result:"cancel"})}}],okClick:false,cancelClick:false,setValue:function(b){var a=this;$(a.contentEl).children(".input-box").val(b);return a},getValue:function(){var a=this;return $(a.contentEl).children(".input-box").val()},render:function(){var b=this,a;b.renderBase();a=$(b.contentEl);a.children(".input-message").html(b.message);setTimeout(function(){a.children(".input-box").focus()},100)}});Mini2.Msg={alert:function(e,c,b){var d,a;if(typeof c==="function"){b=c;c=e;e=""}else{if(1==arguments.length){c=e;e="提示"}}a={title:e,msg:c,icon:"info",buttons:[{text:"确定",width:80,click:b?b:function(f){this.ownerWindow.close()}}]};d=Mini2.createTop("Mini2.ui.MessageBox",a);d.show();return d},confirm:function(f,d,c,a){var e,b;console.debug("title",f);console.debug("msg",d);if(typeof d==="function"){a=c;c=d;d=f;f="询问"}b={title:f,msg:d,icon:"question",buttons:[{text:"确定",width:80,click:function(g){var h;if(c){h=c.call(this)}if(false!==h){this.ownerWindow.close()}}},{text:"取消",width:80,click:function(g){var h;if(a){h=a.call(this)}if(false!==h){this.ownerWindow.close()}}}]};e=Mini2.createTop("Mini2.ui.MessageBox",b);e.show();return e},prompt:function(e,c,b,a){var d;if(typeof c==="function"){a=b;b=c;c=e;e=""}d=Mini2.createTop("Mini2.ui.PromptWinddow",{text:e,message:c,okClick:b,cancelClick:a});d.show();return d}};
Mini2.define("Mini2.ui.Toast",{basePanelTpl:['<div class="mi-toast-panel" >','<div class="mi-toast-panel-innser" >','<div class="mi-toast-target mi-toast-left-notify" style="width:25%; pointer-events:none;" ></div>','<div class="mi-toast-target mi-toast-right-notify" style="left:75%; width:25%; pointer-events:none;" ></div>','<div class="mi-toast-target mi-toast-center-notify" style="left:33.33%; width:33.33%; pointer-events:none;" ></div>',"</div>","</div>"],supportedStyles:["basic","warning","success"],basicDuration:3000,style:"basic",validate:function(){var a=this,b=a.supportedStyles;if(Mini2.Array.indexOf(b,a.style)===-1){a.style=b[0]}},setStyle:function(b){var a=this;a.style=b;a.validate();return a},setText:function(b){var a=this;a.text=b||"";return a},setDuration:function(a){var b=this;b.duration=a>0?a:b.basicDuration;return this},show:function(d){var b=this,a,c;if($(".mi-toast-panel").length==0){a=Mini2.$join(b.basePanelTpl);$("body").append(a)}c=$(document.createElement("div")).addClass("mi-toast-notiser "+b.style).append(b.text);c.prependTo($(d)).hide().slideDown();c.one("click",function(){b.fadeOutAndRemoveElement(b.el)});b.clear(c);return b},clear:function(a){var b=this;setTimeout(b.fadeOutAndRemoveElement,b.duration,a)},fadeOutAndRemoveElement:function(a){a.fadeOut(function(){this.remove()})}});Mini2.toast=function(d,a,c){var b=Mini2.createTop("Mini2.ui.Toast",{text:d,duration:a||3000,style:c||"basic"});b.show(".mi-toast-center-notify");return b};
Mini2.define("Mini2.ui.Pagination",{renderTo:Mini2.getBody(),urlFormat:"?page={0}",prevText:"上一页",nextText:"下一页",firstText:"首页",lastText:"尾页",curPage:0,itemTotal:0,rowCount:20,pageCount:0,startPage:0,endPage:0,uiType:"default",hideRowCountSelect:false,visible:true,constructor:function(b){var a=this;if(Mini2.isString(a.store)){var c=Mini2.data.StoreManager.lookup(a.store);a.store=c}a.bindStore(a.store)},bindStore:function(b){var a=this;if(!b){return}a.itemTotal=b.getTotalCount();a.renderButton();$(b).muBind("datachanged",a,a.store_dataChanged);$(b).muBind("load",a,a.store_load)},store_load:function(a,c){var b=a.data;b.itemTotal=c.getTotalCount();b.rowCount=c.pageSize;b.curPage=c.currentPage;b.renderButton()},store_dataChanged:function(a,c){var b=a.data;b.itemTotal=c.getTotalCount();b.rowCount=c.pageSize;b.curPage=c.currentPage;b.renderButton()},click:function(b,c){var a=this;if(c){c.loadPage(b)}},getFirstUrl:function(){var a=this;return $.format(a.urlFormat,0)},getPrevUrl:function(){var a=this,b=a.curPage-1;if(b<0){b=0}return $.format(a.urlFormat,b)},getNextUrl:function(){var a=this,b=a.curPage+1;if(b>=a.pageCount){b=a.pageCount-1}return $.format(a.urlFormat,b)},getLastUrl:function(){var a=this;return $.format(a.urlFormat,a.pageCount-1)},resetParam:function(){var f=this,a=f.curPage,d=f.itemTotal||0,h=f.rowCount,g,i,b,j,c;var e=d%h;g=(d-e)/h;if(e>0){g++}i=a-4;b=a+5;if(i<0){i=0}if(b>=g){b=g-1}j=a*h;c=j+h;if(c>d){c=d}f.pageCount=g;f.startPage=i;f.endPage=b;f.startRow=j;f.endRow=c},render:function(){var b=this,a,c=b.uiType;b.visible=!!b.visible;if("default"==c){b.el=a=$('<div class="flickr" style="border-color: silver;border-width: 1px;"></div>');if(b.applyTo){$(b.applyTo).append(a)}else{$(b.renderTo).append(a)}if(!b.visible){a.hide()}b.renderButton()}else{if("more"==c){b.el=a=Mini2.$join(["<nav>",'<ul class="pager" style="margin:4px;">','<li><a href="#">加载更多</a></li>',"</ul>","</nav>"]);if(b.applyTo){$(b.applyTo).append(a)}else{$(b.renderTo).append(a)}if(!b.visible){a.hide()}}else{if("backAndNext"==c){}}}},renderRowCountSelectBox:function(){var b=this,a=$(b.el),d=b.rowCount;var c=Mini2.$joinStr(['<span style="float:left;position: relative;top: -6px;">',"<span>每页显示 </span>",'<select style="padding: 0px 2px 0px 2px;  border-bottom-style: none;" class="mi-form-field mi-form-text">',"<option>20</option>","<option>50</option>","<option>100</option>","</select>","<span> 行</span>","</span>"]);var e=c.children(".mi-form-field");e.val(b.rowCount);e.change(function(){b.rowCount=parseInt($(this).val());b.store.pageSize=b.rowCount;b.click.call(this,0,b.store);return false});a.append(c)},renderButton:function(){var j=this,f;j.resetParam();var c=j.curPage,h=j.itemTotal||0,l=j.rowCount,k=j.pageCount,m=j.startPage,e=j.endPage,d=$(j.el),b="loadPage";d.html("");var a="<a href='{0}' command='{3}' commandParam='{2}' page='{2}' class='button' valid='false'>{1}</a>";if(!j.hideRowCountSelect){j.renderRowCountSelectBox()}if(c>0){d.append($.format(a,j.getFirstUrl(),j.firstText,0,b))}else{d.append($.format("<span class='disabled'>{0}</span>",j.firstText))}if(c>0){d.append($.format(a,j.getPrevUrl(),j.prevText,c-1,b))}else{d.append($.format("<span class='disabled'>{0}</span>",j.prevText))}for(f=m;f<=e;f++){var n=$.format(j.urlFormat,f);if(f==c){d.append($.format("<span class='current'>{0}</span>",f+1))}else{d.append($.format(a,n,f+1,f,b))}}if(c<k-1){d.append($.format(a,j.getNextUrl(),j.nextText,c+1,b));d.append($.format(a,j.getLastUrl(),j.lastText,k-1,b))}else{d.append($.format("<span class='disabled'>{0}</span>",j.nextText));d.append($.format("<span class='disabled'>{0}</span>",j.lastText))}if(j.click){var g=d.children("a.button");$(g).click(function(){var i=parseInt($(this).attr("page"));j.click.call(this,i,j.store);return false})}d.append($.format("当前记录 {0}--{1} 条,共 {2} 条记录",j.startRow+1,j.endRow,h))},show:function(){var b=this,a=b.el;a.show()},hide:function(){var b=this,a=b.el;a.hide()}},function(){var a=this;Mini2.apply(this,arguments[0]);a.constructor()});
Mini2.define("Mini2.ui.Offline",{tpl:['<div class="mi-offline" >','<div class="mi-offline-content" >','<div class="mi-offline-icon"></div>','<div class="mi-offline-text">(尝试重新连接...)</div>',"</div>",'<a class="mi-offline-retry" >重新连接</a>',"</div>"],info:{recont:"尝试重新连接...",lost:"你与服务器发生断网.",success:"你已重新连接服务器"},visible:false,initComponent:function(){var a=this},baseRender:function(){var b=this,a;b.el=a=Mini2.$join(b.tpl);b.textEl=a.find(".mi-offline-text");if(b.visible){a.show()}else{a.hide()}$("body").append(a);return b},render:function(){var a=this;a.baseRender();return a},hide:function(){var b=this,c,a=b.el;if(!b.visible){return}b.visible=false;c=b.info.success;b.textEl.html(c);a.removeClass("mi-offline-down").removeClass("mi-offline-connecing");a.addClass("mi-offline-online");setTimeout(function(){a.animate({top:-100},function(){a.hide()})},2000);return b},show:function(b){var c=this,d,a=c.el;if(c.visible){return}c.visible=true;b=b||"lost";if(!a){c.render();a=c.el}d=c.info[b];c.textEl.html(d);a.removeClass("mi-offline-connecing").removeClass("mi-offline-online");a.addClass("mi-offline-down");if(a.is(":visible")){}else{a.css({top:-100});a.show().animate({top:"0px"})}setTimeout(function(){d=c.info.recont;c.textEl.html(d);a.removeClass("mi-offline-down").removeClass("mi-offline-online");a.addClass("mi-offline-connecing")},3000)}},function(){var a=this;a.renderTo=Mini2.getBody();Mini2.apply(a,arguments[0]);a.initComponent()});
Mini2.define("Mini2.ui.icon.Manager",{singleton:true,btnConfig:[{keys:["添加","新建","新增","new","create"],iconCls:"fa-plus"},{keys:["保存","save"],iconCls:"fa-save"},{keys:["删除","delete","remote"],icon:null,iconCls:"fa-remove",cls:"mi-btn-remove",hoverCls:null},{keys:["编辑","修改","edit","update"],iconCls:"fa-pencil"},{keys:["打印","print"],iconCls:"fa-print"},{keys:["查找","查询","搜索","search"],iconCls:"fa-search"},{keys:["刷新","refresh"],iconCls:"fa-refresh  ",},{keys:["导出 Excel","导出Excel"],icon:"/res/file_ico/excel.png",iconCls:null},{keys:["导入"],icon:"/res/icon/leading_in.png"},{keys:["导出","export"],icon:"/res/icon/Export.png"},{keys:["下载","download"],iconCls:"fa-download"},{keys:["查看","view"],iconCls:"fa-search"},{keys:["选择"],iconCls:"fa-list-alt"},{keys:["提交"],iconCls:"fa-upload"},{keys:["撤销","撤销提交"],iconCls:"fa-reply"},{keys:["审核","结案","归档"],iconCls:"fa-lock"}],buffer:{},getPlugin:function(c){var a=this,b=a.buffer[c];if(!b){if(a[c]){b=Mini2.create("Mini2.ui.icon.Plugin",{cfg:a[c]});a.buffer[c]=b}}return b}});
Mini2.define("Mini2.ui.icon.Plugin",{cfg:null,buffer:null,initComponent:function(){var a=this;a.buffer={};if(a.cfg){a.setConfig(a.cfg);delete a.cfg}},getItem:function(a){var d=this,b=d.buffer,c=b[a];return c},getItemForLink:function(a){var e=this,b=e.buffer,d=null;if(Mini2.isBlank(a)){return d}for(var c in b){if(a.indexOf(c)>=0){d=b[c];break}}return d},getIcon:function(a){var c=this,b=c.getItem(a);if(!b){b=c.getItemForLink(a)}if(b&&!Mini2.isBlank(b.icon)){return b.icon}return null},getIconCls:function(a){var c=this,b=c.getItem(a);if(!b){b=c.getItemForLink(a)}if(b&&!Mini2.isBlank(b.iconCls)){return b.iconCls}return null},getCls:function(a){var c=this,b=c.getItem(a);if(!b){b=c.getItemForLink(a)}if(b&&!Mini2.isBlank(b.cls)){return b.cls}return null},getItemConfig:function(a){var c=this,b=c.getItem(a);if(!b){b=c.getItemForLink(a)}return b},setConfig:function(b){var c=this,a=c.buffer;$(b).each(function(){var e=this;var h=e.keys;var f={};Mini2.apply(f,e);if(Mini2.isString(h)){h=[h]}for(var d=0;d<h.length;d++){var g=h[d];a[g]=f}})}},function(){var a=this;Mini2.apply(a,arguments[0]);a.initComponent()});
Mini2.define("Mini2.ui.button.Button",{extend:"Mini2.ui.Component",alias:"widget.button",btnInner:null,baseCls:Mini2.baseCSSPrefix+"btn",scale:"small",allowedScales:["small","medium","large"],dock:"none",text:"按钮",icon:false,el:null,userCls:false,checkedCls:false,radioCls:false,isButton:true,hrefTarget:"_blank",group:false,buttonType:"button",checked:false,renderTpl:['<a class="mi-btn ',"mi-unselectable ",'" ','role="button" hidefocus="on" unselectable="on" tabindex="0" >','<span class="mi-btn-wrap" unselectable="on">','<span class="mi-btn-button">','<span class="mi-btn-inner mi-btn-inner-center" unselectable="on">',"</span>","</span>","</span>","</a>"],initComponent:function(){var a=this},setChekced:function(k,j){var h=this,c=h.el,f,d=h.group,a=h.buttonType,b=h.checkCls;h.checked=k;if(b){c.toggleClass(b,k)}if(false!==j&&"radio"==a){var g=Mini2.GroupManager.get(d);for(var e=0;e<g.length;e++){if(g[e]===h){continue}f=g[e];f.setChekced(false,false)}}return h},setTop:function(c){var b=this,a=b.el;a.css("top",c);return b},setLeft:function(c){var b=this,a=b.el;a.css("left",c);return b},focus:function(){var a=this;Mini2.ui.FocusMgr.setControl(a)},getInputEl:function(){var h=this,m=Mini2.support,l=h.scale,g=h.margin,d=h.href,e=h.hrefTarget,a=h.baseCls,b=h.command,k="-pressed",j="-over",c=Mini2.$join(h.renderTpl);if(m.ipad||m.iphone){c.attr("readonly",true)}h.overCls=["mi"+j,a+j,a+"-default-"+l+j];h.pressedCls=["mi"+k,a+k,a+"-default-"+l+k];if(!Mini2.isBlank(b)){c.attr("command",b)}c.css({width:h.width,height:h.height,left:h.left});if(h.minWidth){c.css("min-width",h.minWidth)}if(h.minHeight){c.css("min-height",h.minHeight)}if(h.maxWidth){c.css("max-width",h.maxWidth)}if(h.maxHeight){c.css("max-height",h.maxHeight)}c.addCls(a+"-default-"+l);if(g){if(Mini2.isString(g)){c.css("margin",g)}else{for(var f in g){c.css("margin-"+f,g[f])}}}h.btnInner=c.find(".mi-btn-inner:first");h.btnInner.html(h.text);if(h.icon&&""!=h.icon){c.addCls("mi-icon-text-left",a+"-icon-text-left",a+"-default-"+l+"-icon-text-left");h.imgEl=$('<img src="" class="mi-btn-icon-el mi-btn-glyph"  />');h.imgEl.attr("src",h.icon);c.mFind("."+a+"-button").append(h.imgEl)}c.on("mouseenter",function(){$(this).addCls(h.overCls)}).on("mouseleave",function(){$(this).removeCls(h.overCls)});if(d){c.attr("href",d);if(d){c.attr("target",e)}}else{c.muBind("mousedown",function(i){$(this).addCls(h.pressedCls);Mini2.ui.FocusMgr.setControl(h)}).muBind("mouseup",function(n,p){$(this).removeCls(h.overCls);$(this).removeCls(h.pressedCls);if(0==p.button){if(h.beforeClick){var o=h.beforeClick.call(h,n);if(false===o){return}}else{if(!Mini2.isBlank(h.beforeAskText)){return h.showAskMsg.call(h)}}var i=h.buttonType;if("radio"==i){h.setChekced(true)}else{if("check"==i){h.setChekced(!h.checked)}}h.callback_click.call(h)}})}return c},showAskMsg:function(){var a=this;Mini2.Msg.confirm("询问",a.beforeAskText,function(){a.click()});return false},expandCls:function(a){var d=this,b=d.el,c,e;if(a){e=a.split(" ");for(c=0;c<e.length;c++){b.addClass(e[c])}}},serverForSubmit:function(){var a=this,b=a.widget||window.widget1;if(b){b.submit(a.el,{command:a.command,commandParam:a.commandParams})}},setHref:function(b){var c=this,a=c.el;c.href=b;a.attr("href",b)},getHref:function(){var b=this,a=b.el;return b.href},render:function(){var d=this,b,a=d.clientId;d.el=b=d.getInputEl();b.attr("id",a).data("me",d);d.expandCls(d.userCls);if(d.applyTo){$(d.applyTo).replaceWith(b)}else{$(d.renderTo).append(b)}if(d.click){d.userClick=d.click;delete d.click}d.click=d.callback_click;if(d.group){b.attr("data-group",d.group);Mini2.GroupManager.add(d.group,d)}try{Mini2.ui.SecManager.reg(d.secFunCode,d)}catch(c){console.error("注册权限错误",c)}return d},callback_click:function(){var a=this;if(a.userClick){a.userClick.call(a)}else{if(a.command){a.serverForSubmit.call(a)}}}});
Mini2.define("Mini2.ui.container.DockingContainer",{isDockingContainer:true,owner:window,initComponent:function(){var a=this;a.clearItems()},configureItem:function(a){},clearItems:function(){var a=this;a.length=0;a.items={top:[],left:[],right:[],bottom:[],center:[],full:[]}},addDocked:function(c,g){var e=this,a=0,f=e.items,b,d=c.length;for(;a<d;a++){b=c[a];if(Mini2.isDom(b)){b.dock=$(b).attr("data-dock")||$(b).attr("dock")}else{b.dock=b.dock||"top"}switch(b.dock){case"none":break;case"top":f.top.push(b);break;case"bottom":f.bottom.push(b);break;case"left":f.left.push(b);break;case"right":f.right.push(b);break;case"full":f.full.push(b);break;case"center":f.center.push(b);break}}e.length=d},updateLayout:function(j){var g=this,i=g.items,a=g.el,k=g.padding,f=g.itemMargin,l=false,b,m,c=0,d=0,e=0,n=0,o=0,p=0,q=0;if(!g.length){return}j=j||g.owner;f=Mini2.clone(f);if("auto"==f.left){f.left=0}else{if(Mini2.isString(f.left)){f.left=parseInt(f.left)}}if("auto"==f.right){f.right=0}else{if(Mini2.isString(f.right)){f.right=parseInt(f.right)}}if("auto"==f.top){f.top=0}else{if(Mini2.isString(f.top)){f.top=parseInt(f.top)}}if("auto"==f.buttom){f.buttom=0}else{if(Mini2.isString(f.buttom)){f.buttom=parseInt(f.buttom)}}g.itemMargin=f;c=g.getItemsHeight(i.top);hC=g.getItemsHeight(i.full);e=g.getItemsHeight(i.bottom);n=g.getItemsWidth(i.left);p=g.getItemsWidth(i.right);if(j&&j.muid){m=j.getWidth();b=j.getHeight()}else{m=$(j).width();b=$(j).height()}b-=(k.top+k.bottom);m-=(k.left+k.right);d=b-c-e;o=m-n-p;if("none"!=j.scroll&&c+hC+e>b){o-=20}if(i.top.length||i.bottom.length){g.setItemsTop2(k.top,i.top);g.setItemsTop2(k.top+c+d,i.bottom);g.setItemsWidth(o,i.top);g.setItemsWidth(o,i.bottom)}if(i.left.length||i.right.length){g.setItemsTop(c,i.left);g.setItemsTop(c,i.right);g.setItemsLeft2(0,i.left);g.setItemsLeft2(n+o+f.right,i.right);g.setItemsHeight(d,i.left);g.setItemsHeight(d,i.right)}if(i.center.length){q=g.getItemsWidth(i.center);g.setItemsLeft2(k.left+(m-q)/2,i.center)}if(i.full.length){g.setItemsLeft(n,i.full);g.setItemsTop(c,i.full);g.setItemsWidth(o,i.full);g.setItemsHeight(d,i.full)}},setItemCss:function(b,e,d,a){var c=this;if(b){if(b[d]){b[d](e)}else{$(b).css(a,e)}}},setItemsWidth:function(f,c){var e=this,a,b,d=c.length;if(d){for(a=0;a<d;a++){b=c[a];e.setItemCss(b,f,"setWidth","width")}}},setItemsHeight:function(a,c){var e=this,b,d=c.length;if(d){$(c).each(function(){e.setItemCss(this,a,"setHeight","height")})}},setItemsTop:function(f,b){var d=this,a,e=f,c=b.length;if(c){$(b).each(function(){d.setItemCss(this,e,"setTop","top")})}},setItemsTop2:function(g,c){var e=this,a,b=e.itemMargin,f=g,d=c.length;if(d){$(c).each(function(){a=this;f+=b.top;if(a.marginTop){try{var i=parseInt(a.marginTop);f+=i}catch(h){}}e.setItemCss(a,f,"setTop","top");f+=b.bottom;if(a.getHeight){f+=a.getHeight()}else{f+=$(a).outerHeight()}})}},setItemsLeft:function(g,c){var e=this,a,b=e.itemMargin,f=g,d=c.length;if(d){$(c).each(function(){e.setItemCss(this,f,"setLeft","left")})}},setItemsLeft2:function(h,c){var f=this,a,b=f.itemMargin,g=h,d,e=c.length;if(e){$(c).each(function(){a=this;if("auto"!=b.left){g+=b.left}if(a.setLeft){a.setLeft(g);d=a.getWidth()}else{$(a).css("left",g);d=$(a).outerWidth()}if(!Mini2.isNumber(d)){d=parseInt(d)}g+=d;if("auto"!=b.right){g+=b.right}})}},getItemsWidth:function(c){var e=this,a,b=e.itemMargin,f=0,d;if(c.length){$(c).each(function(){a=this;if(a.getWidth){d=a.getWidth()}else{d=$(a).outerWidth()}if(!Mini2.isNumber(d)){d=parseInt(d)}f+=(d+b.left+b.right)})}return f},getItemsHeight:function(c){var e=this,a,b=e.itemMargin,f=0,d=c.length;if(d){$(c).each(function(){a=this;if(a.getHeight){f+=a.getHeight()}else{f+=$(a).outerHeight()}f+=b.top+b.bottom})}return f}},function(){var a=this;Mini2.apply(this,arguments[0]);a.initComponent()});
Mini2.define("Mini2.ui.container.Viewport",{log:Mini2.Logger.getLogger("Mini2.ui.container.Viewport",false),alias:"Mini2.ui.Viewport",layout:"border",owner:window,isContainer:false,space:0,el:null,widthOffset:0,heightOffset:0,anchorfixedItems:null,margin:{top:0},initComponent:function(){var a=this;a.length=0;a.region={north:[],south:[],west:[],east:[],center:[]};a.isHide_north=false;a.isHide_south=false;a.isHide_west=false;a.isHide_east=false},enable:function(){this.disabled=false},disable:function(){this.disabled=true},toggleRegion:function(c){var b=this,a=b.isVisibled(c);if(a){b.hideRegion(c)}else{b.showRegion(c)}return b},isVisibled:function(c){var b=this,d,a=false;d="isHide_"+c;a=b[d];return !a},showRegion:function(h){var c=this,a=c.el,d=c.region,e,b=d[h];if(b&&b.length){if("west"==h){if(!c.isHide_west){return}c.isHide_west=false;e=b[0];var g=e.getWidth();var k=0;var l=-g;e.show().animate({left:0},"fast","swing")}else{if("east"==h){if(!c.isHide_east){return}c.isHide_east=false;e=b[0];var j=a.width();var g=e.getWidth();var k=j-g;var l=j;e.setLeft(l).show().animate({left:k},"fast","swing")}else{if("north"==h){if(!c.isHide_north){return}c.isHide_north=false;e=b[0];var f=e.getHeight();var m=0;var n=-f;e.setTop(n).show().animate({top:m},"fast","swing")}else{if("south"==h){if(!c.isHide_south){return}c.isHide_south=false;e=b[0];var i=a.height();var f=e.getHeight();var m=i-f;var l=i;e.setTop(l).show().animate({top:k},"fast","swing")}}}}c.resize(c.owner)}},hideRegion:function(i){var d=this,a=d.el,e=d.region,c=d.margin,f,b=e[i];if(b&&b.length){if("west"==i){if(d.isHide_west){return}d.isHide_west=true;f=b[0];var h=f.getWidth();var k=0;var l=-h;f.animate({left:l},"fast","swing",function(){f.hide()})}else{if("east"==i){if(d.isHide_east){return}d.isHide_east=true;f=b[0];var j=a.width();var h=f.getWidth();var k=j-h;var l=j;f.animate({left:l},"fast","swing",function(){f.hide()})}else{if("north"==i){if(d.isHide_north){return}d.isHide_north=true;f=b[0];var g=f.getHeight();var m=c.top;var n=-g+c.top;f.animate({top:n,"z-index":800},"fast","swing",function(){f.hide()})}else{if("south"==i){}}}}d.resize(d.owner)}},winResize:function(a){var c=a.data.owner,b=c.log;c.resize(c.owner)},resize:function(v){var r=this,o=r.log,c=r.el,t=r.region,d,k,z,y=r.space,p=r.margin,u=p.top||0,q=p.buttom||0,e=0,f=0,g=0,A=0,B=0,C=0;v=v||r.owner;e=r.isHide_north?0:r.getItemsHeight(t.north);g=r.isHide_south?0:r.getItemsHeight(t.south);A=r.isHide_west?0:r.getItemsWidth(t.west);C=r.isHide_east?0:r.getItemsWidth(t.east);if(v&&v.muid){z=v.getWidth();d=v.getHeight()}else{var x=$(v).width();if(r.isContainer){if(x>=1200){z=1170}else{if(x>=992){z=970}else{if(x>=768){z=750}else{z=x}}}}else{z=x}d=$(v).height()}d-=(u+q);d+=r.heightOffset;z+=r.widthOffset;c.css({width:z,height:$(window).height()-(u+q)});f=d-e-g;var s=r.getItemsHeight(t.center,f);if(f<s){k=e+f+g;if("none"!=r.scroll){}z-=18;c.css({"overflow-y":"scroll"})}else{k=d;c.css({"overflow-y":"hidden"})}B=z-A-C;if(t.north.length||t.south.length){r.setItemsTop(0,t.north);if(f<s){r.setItemsTop(e+s,t.south)}else{r.setItemsTop(e+f,t.south)}r.setItemsWidth(z,t.north);r.setItemsWidth(z,t.south)}if(t.west.length||t.east.length){var i=e+(t.north.length?y:0);r.setItemsTop(i,t.west);r.setItemsTop(i,t.east);r.setItemsLeft(0,t.west);r.setItemsLeft(A+B,t.east);var j=f-(t.north.length?y-1:0)-(t.south.length?y-1:0);r.setItemsHeight(j,t.west);r.setItemsHeight(j,t.east)}var l=0;var m=0;if(t.center.length){l=(t.north.length?y:0);m=(t.south.length?y:0);var D=A+(t.west.length?y:0);var E=B-(t.west.length?y:0)-(t.east.length?y:0);var i=e+l;var j=f-(l>0?l-1:0)-(m>0?m-1:0);r.setItemsLeft(D,t.center);r.setItemsTop(i,t.center);r.setItemsWidth(E,t.center);r.setItemsHeight(j,t.center)}var a=k-(l>0?l-1:0)-(m>0?m-1:0);var b=z;if(k>d){b-=20}if("none"==r.scroll){r.innerEl.css({width:b,height:d})}else{r.innerEl.css({width:b,height:a})}var n=r.anchorfixedItems;if(n){$(n).each(function(){var h=this;h._tmpAnchor=null});r.preAnchorFixedItem()}return r},setItemsWidth:function(d,b){var c=this,a;$(b).each(function(){a=this;if("relative"==a.position){return}if(a.isVisible&&a.isVisible()){a.setWidth(d)}})},setItemsHeight:function(a,c){var d=this,b;$(c).each(function(){b=this;if("relative"==b.position){return}if(b.isVisible&&b.isVisible()){b.setHeight(a)}})},setItemsTop:function(e,b){var c=this,a,d=e;$(b).each(function(){a=this;if("relative"==a.position){return}if(a.isVisible&&a.isVisible()){a.setTop(d);var g=a.minHeight||0;var f=a.getHeight();if(f<g){d+=g}else{d+=f}}});return c},setItemsLeft:function(e,b){var c=this,a,d=e;$(b).each(function(){a=this;if("relative"==a.position){return}if(a.isVisible&&a.isVisible()){a.setLeft(d);d+=a.getWidth()}});return c},getItemsWidth:function(b){var c=this,a,d=0;$(b).each(function(){a=this;if("relative"==a.position){return}if(a.isVisible&&a.isVisible()){d+=a.getWidth()}});return d},getItemsHeight:function(c,a){var d=this,b,e=0;$(c).each(function(){b=this;if("relative"==b.position){return}if(b.isVisible&&b.isVisible()){var g=b.minHeight||0;var f=b.getHeight();if(f<g){e+=g}else{e+=f}}});return e},getItem:function(c){var a=this,b;if(c.muid){return c}b=Mini2.create("Mini2.ui.panel.Panel",c);b.render();return b},initAnchorFixedItems:function(){var d=this,b=d.el,c=[],e=d.region.west,a=d.region.east;$(e,a).each(function(){if("topbottom"==this.anchorFixedType){c.push(this)}});if(c.length){d.anchorfixedItems=c;$(b).scroll(function(){d.preAnchorFixedItem()})}},scrollTop:function(c){var b=this,a=b.el;a.scrollTop(c);return b},preAnchorFixedItem:function(){var c=this,a=c.el,b=c.anchorfixedItems,d=$(a).scrollTop(),e=$(a).height();$(b).each(function(){var f=this,g,h=-1,i=f._tmpAnchor;if(!i){i={top:parseInt(f.getTop()),height:parseInt(f.getHeight()),tmpTop:0,tmpHeight:0};f._tmpAnchor=i}if(d>i.top){h=d-1}else{h=i.top}if(h!=i.tmpTop){i.tmpTop=h;f.setTop(h)}if(d>0){g=d+i.height;if(g>e){g=e}if(i.tmpHeight!=g){i.tmpHeight=g;f.setHeight(g)}}})},baseRender:function(){var k=this,b,e,d=0,j=k.margin,f,h,g=k.items;k.el=b=$(k.contentEl);b.addClass("mi-viewport");k.innerEl=e=$(b).children(".mi-viewport-inner");if(k.isContainer){b.addClass("mi-viewport-container");b.css({"margin-left":"auto","margin-right":"auto"})}else{if(j){b.css({position:"absolute",top:j.top})}}if("none"==k.scroll){b.css("overflow","hidden");e.css("overflow","hidden")}else{b.css("overflow-x","hidden");e.css("overflow-x","hidden");setTimeout(function(){k.initAnchorFixedItems()},500)}if(g){h=g.length;for(d;d<h;d++){f=g[d];if(!f||!f.contentEl){continue}if(!Mini2.isString(f.contentEl)){continue}var a=f.contentEl.substr(0,1);if(a=="#"){var l=Mini2.create("Mini2.ui.panel.Panel",f);l.render();g[d]=l}}}},afterRender:function(){var d=this,a=0,b,g,f,e=d.region,c=d.items,h;if(c){for(a;a<c.length;a++){b=c[a];if(b.isAfterRender){b=window[b.id]}g=b.region||"north";f=d.getItem(b);f.el.addClass("mi-box-item");h=e[g];if(h){h.push(f)}else{e.center.push(f)}}delete d.items}return d},setZIndex:function(b,e){var c=this,a,d;if(b){d=b.length;while(d--){b[d].css("z-index",e)}}return c},resetZIndex:function(){var b=this,c=b.region,a,d=b.setZIndex;d(c.center,50);d(c.north,40);d(c.south,30);d(c.west,20);d(c.east,10)},render:function(){var a=this;a.baseRender();a.resetZIndex();Mini2.LoaderManager.afterRender(a);Mini2.LoaderManager.resize(a)}},function(){var a=this;Mini2.apply(this,arguments[0]);a.initComponent()});
Mini2.define("Mini2.ui.form.Base",{});
Mini2.define("Mini2.ui.form.field.Base",{extend:"Mini2.ui.Component",log:Mini2.Logger.getLogger("Mini2.ui.form.field.Base"),mixins:{labelable:"Mini2.ui.form.Labelable"},secFunCode:null,secReadonly:null,clearText:false,style:null,isInput:true,invalidCls:"mi-form-invalid",extraFieldBodyCls:false,tabStop:true,labelable:null,preventMark:false,disabled:false,renderTo:Mini2.getBody(),el:null,name:"",oldValue:"",newValue:"",autoTrim:true,autoComplete:"off",allowBlank:true,readOnly:false,align:"left",width:"100%",height:"",inputDom:null,autoWidth:true,dirty:false,initComponent:function(){var a=this;$(a).muBind("focusout",function(){if(a._focusTimeout){clearTimeout(a._focusTimeout);delete a._focusTimeout}if(a.fieldEl){a.fieldEl.removeClass("mi-form-focus").trigger("blur")}a.el.removeClass("mi-form-trigger-wrap-focus");a.on("hided");a.clearInvalid();if(a.clearBtnEl){a.clearBtnEl.hide()}if(a.autoTrim){var c=a.getValue();if(c){var b=Mini2.String.trim(c);if(b!=c){a.setValue(b)}}}});a.initLabelable()},setDirty:function(d){var c=this,a=c.el,b=c.fieldEl;d=!!d;c.dirty=d;a.toggleClass("mi-form-dirty-item",d);return c},getDirty:function(){var a=this;return a.dirty},getRawValue:function(){var a=this,b;if(a.readOnly&&a.hideEl){b=a.hideEl.val()}else{b=a.inputEl.val()}return b},processRawValue:function(a){return a},isValid:function(){var b=this,a=b.disabled,c=b.forceValidation||!a;return c?b.validateValue(b.processRawValue(b.getRawValue())):a},getErrors:function(b){var a=this;if(b==""||b==null){return"必填"}return""},validateValue:function(e){var d=this,c=d.log,a=d.getErrors(e),b=Mini2.isEmpty(a);if(!d.preventMark){if(b){d.clearInvalid()}else{d.markInvalid(a)}}return b},getActiveError:function(){var b=this,a=b.labelable;return a.getActiveError()},hasActiveError:function(){var b=this,a=b.labelable;return a.hasActiveError()},unsetActiveError:function(){var b=this,a=b.labelable;a.unsetActiveError()},clearInvalid:function(){var f=this,a=f.el,c=f.hasActiveError(),d=f.inputEl,b=f.fieldEl,e=f.invalidCls;a.removeClass(e);if(b){b.removeClass(e+"-field")}else{if(d&&d.removeClass){d.removeClass(e+"-field")}}f.unsetActiveError();if(c){f.setError("")}},markInvalid:function(b){var f=this,a=f.el,g=f.getActiveError(),d=f.inputEl,c=f.fieldEl,e=f.invalidCls;a.addClass(e);if(c){c.addClass(e+"-field")}else{d.addClass(e+"-field")}if(g!==b){f.setError(b)}return f},setError:function(a){var c=this,d=c.msgTarget,e,b=c.labelable;if(a==undefined||a==""||a==null){c.unsetActiveError()}else{if(b){b.setActiveError(a)}}},insertText:function(c,f){if(document.selection){var d=document.selection.createRange();d.text=f}else{if(typeof c.selectionStart==="number"&&typeof c.selectionEnd==="number"){var e=c.selectionStart,b=c.selectionEnd,a=e,g=c.value;c.value=g.substring(0,e)+f+g.substring(b,g.length);a+=f.length;c.selectionStart=c.selectionEnd=a}else{c.value+=f}}},moveEnd:function(b){b.focus();var a=b.value.length;if(document.selection){var c=b.createTextRange();c.moveStart("character",a);c.collapse();c.select()}else{if(typeof b.selectionStart=="number"&&typeof b.selectionEnd=="number"){b.selectionStart=b.selectionEnd=a}}},layoutReset:function(){},onPositionChanged:Mini2.emptyFn,isValueChanged:function(){var b=this,a=b.log;a.debug("---- oldValue = "+b.oldValue);a.debug("---- me.getValue = "+b.getValue());return b.oldValue!=b.getValue()},getLeft:function(){var a=this;return a.el.css("left")},setLeft:function(c){var b=this,a=b.el;a.css("left",c);return b},getTop:function(){var b=this,a=b.el;return a.css("top")},setTop:function(c){var b=this,a=b.el;a.css("top",c);return b},setWidth:function(c){var b=this,a=b.el;b.width=c;a.css("width",c);return b},getWidth:function(){return this.width},setHeight:function(b){var a=this;a.height=b;a.el.css("height",b);return a},getHeight:function(){return this.height},setValue:function(d){var c=this,b=c.log,a=c.hideEl;c.inputEl.val(d);if(a){a.val(d)}return c},getValue:function(){var b=this,a=b.hideEl,c;if(b.readOnly||"none"==b.mode){c=a.val()}else{c=b.inputEl.val()}return c},hide:function(){var a=this;a.visible=false;a.el.hide();a.callParent();return a},focus:function(){var e=this,d=e.log,a=e.el,b=e.fieldEl,c=e.inputEl;Mini2.ui.FocusMgr.setControl(e,null,e.scope);if(!a.hasClass("mi-form-trigger-wrap-focus")){if(b){b.addCls("mi-form-focus",e.focusCls)}a.addClass("mi-form-trigger-wrap-focus")}if(!e.readOnly&&c&&c.focus&&!e._focusTimeout){e._focusTimeout=setTimeout(function(){if(a.hasClass("mi-form-trigger-wrap-focus")){c.focus()}e._focusTimeout=null},200)}if(e.clearBtnEl){e.clearBtnEl.css("display","inline")}return e},select:function(){var a=this;a.inputEl.select();return a},onLostFocus:function(a){var b=this;b.inputEl.removeClass("mi-form-focus");b.on("hided")},show:function(){var a=this;a.visible=true;a.el.show();a.callParent();return a},fieldCls:"mi-form-type-text",getTableContainer:function(){var b=this,c=b.mixins,a=c.labelable,d;if(b.labelable){d=b.labelable.labelableRenderTpl}else{d=Mini2.$join(['<table class="mi-field mi-table-plain mi-form-item  mi-field-default " ','cellpadding="0" cellspacing="0" style="table-layout: fixed; width: 100%; ">',"<tbody>",'<tr role="presentation" class="mi-form-item-input-row">','<td class="mi-form-item-body"></td>',"</tr>","</tbody>","</table>"])}d.addClass(b.fieldCls);d.css("width",b.width);if(b.left){d.css("left",b.left)}if(b.top){d.css("top",b.top)}if("static"!=b.position){d.css("position",b.position)}return d},bindInputEl_Key:function(a){var b=this;$(a).on("keydown",function(c){b.on("keydown",c)}).on("keyup",function(c){b.on("keyup",c)}).on("keypress",function(c){b.on("keypress",c)})},bindInputEl_Mouse:function(a){var b=this;$(a).muBind("mousedown",function(c){b.focus();b.on("mousedown",c)}).muBind("mouseup",function(c){b.on("mouseup",c);Mini2.EventManager.stopEvent(c)})},getCell:function(d,c,a){var e,b,f;e=$(d).children("tbody:first");if(e.length==0){e=d}b=$(e).children("tr:eq("+c+")");f=$(b).children(":eq("+a+")");return f},appendCell:function(f,g,e,c){var d=this,b,a=arguments;if(g){if(a.length==4){b=d.getCell(f,e,c)}else{if(Mini2.isString(a[2])){b=f.find(a[2]);if(b.length==0){console.error("没有找到对应的节点, 无法附加元素")}}else{console.error("错误....")}}$(b).append(g)}else{console.error("targetEl 不能为空, 无法附加到框架上.",g)}return d},initLabelable:function(){var e=this,f=e.mixins,d=f.labelable,c=e.labelable||{},b;if(c&&c.hideLable){return}c=Mini2.apply(c,{owner:e,required:e.required});b=Mini2.create(d,c);delete e.labelable;e.labelable=b;try{var g=Mini2.ui.SecManager;g.reg(e.secFunCode,e,"visible");g.reg(e.secReadonly,e,"readonly")}catch(a){console.error("注册权限错误",a)}},hideEl:null,createHideEl:function(){var b=this,c=b.name,a=$('<input type="hidden" value="" />');if(c){a.attr("name",c)}a.val(b.value||b.srcValue);return a},setReadOnly:function(i){var e=this,b=e.el,d=e.inputEl,c=e.hideEl,f="readonly",g="mi-form-item-readonly";i=!!i;e.readOnly=i;b&&b.toggleClass(g,i);if(!d){return}if(i){d.attr(f,f)}else{d.removeAttr(f)}if(i){if(!c){d.attr("name","");e.hideEl=c=e.createHideEl();var a="td.mi-form-item-body:first";var h=e.getTableContainer();e.appendCell(h,c,a)}}else{if(c){d.attr("name",e.name);$(c).remove();delete e.hideEl}}$(d).change(function(){e.clearInvalid()});$(d).keydown(function(){e.clearInvalid()});return e},getReadOnly:function(){var a=this;return a.readOnly},setMap:function(g,j){var e=this,d=j||e.mapItems,f=e.ownerParent,h,a;if(!d){return}if(e.record){a=e.record}else{if(!f){return}h=f.store;if(!h){return}a=h.getCurrent()}for(var b=0;b<d.length;b++){var c=d[b];if(c&&c.srcField&&c.targetField){var k;if(g.get){k=g.get(c.srcField)}else{k=g[c.srcField]}a.set(c.targetField,k)}else{console.warn("映射规则定义错误:",c)}}},getSentDataForTypeahead:function(){var a=this,c={},b=a.typeaheadParams;$(b).each(function(){var f=this;if("query_string"==f.role){var h=$.query.get(f.queryStringField);c[f.name]=h}else{if("control"==f.role){var e=Mini2.find(f.control);var i=e.getValue();c[f.name]=i}else{var g=f["default"];if(g.indexOf("{{")>=0&&g.indexOf("}}")){var d=template.compile(g);var j=d({T:{"未定义":""}});c[f.name]=j}else{c[f.name]=g}}}});return c},initTypeahead:function(a){var b=this,d=b.type||"text",c=b.typeahead;if(c&&"text"==d){$(a).addClass("mi-typeahead");$(a).typeahead({autoSelect:c.autoSelect||false,appendTo:Mini2.getBody(),delay:200,items:c.items,source:function(g,e){var f=b.getSentDataForTypeahead();f[c.searchKey||"name"]=g;return Mini2.post(c.remoteUrl,f,function(h){return e(h)})},displayText:function(e){return e[c.field]||"未指定字段"},afterSelect:function(f){b.curRecord=f;try{b.setMap(f,b.typeaheadMapItems)}catch(e){console.error("设置映射值错误",e)}},highlighter:function(g,f){if(c.displayFormat){var e=b.artTemplate;if(!e){b.artTemplate=e=template.compile(c.displayFormat)}var h=e({T:f});return h}else{return g}}})}},getFieldEl:function(){var b=this,c=b.type||"text",a=Mini2.$joinStr(['<input type="',c,'" class="mi-form-field mi-form-text" ','aria-invalid="false"  style="width: 100%; " autocomplete="off" spellcheck="false"  >']);if(b.name){a.attr("name",b.name)}a.attr("id",b.clientId).attr("placeholder",b.placeholder).css("text-align",b.align);b.initTypeahead(a);b.bindInputEl_Mouse(a);b.bindInputEl_Key(a);b.inputEl=a;return a},renderForLableable:function(d){var c=this,b,a=c.labelable;if(a){if(!a.hideLabel){b=a.getEl();if(c.clientId){b.attr("for",c.clientId)}c.appendCell(d,b,"td.mi-field-label-cell:first");if(!Mini2.designMode()){b.muBind("mousedown",function(f){c.focus()});b.muBind("mouseup",function(f){Mini2.EventManager.stopEvent(f)})}}if(!a.hideHelper){}}return c},renderForBoxLabel:function(c){var b=this,a;if(b.boxLabel){a=Mini2.$joinStr(['<label class="mi-form-cb-label mi-form-cb-label-after" for="',b.clientId,'">',b.boxLabel,"</label>"]);a.muBind("mousedown",function(d){b.focus()});a.muBind("mouseup",function(d){Mini2.EventManager.stopEvent(d)});b.boxLableEl=a;b.appendCell(c,a,"td.mi-form-item-body:first")}return b},baseRenderSize:function(f){var e=this,d,c,b=null,a={width:"width",height:"height",minHeight:"min-height",minWidth:"min-width",maxHeight:"max-height",maxWidth:"max-width"};for(d in a){if(e[d]){c=a[d];b=b||{};b[c]=e[d]}}if(b){f.css(b)}},baseRender:function(){var g=this,f=g.log,j,e,b,a="td.mi-form-item-body:first";j=g.getTableContainer();e=g.getFieldEl();g.baseRenderSize(j);if(g.applyTo){if(g.parentEl&&Mini2.isString(g.applyTo)){var h=$(g.parentEl).find(g.applyTo);h.replaceWith(j)}else{$(g.applyTo).replaceWith(j)}}else{$(g.renderTo).append(j)}g.fieldBodyEl=j.find(a);g.renderForLableable(j);if(g.srcInputEl){g.appendCell(j,g.srcInputEl,a)}g.appendCell(j,e,a);if(g.getBodyExpand){b=g.getBodyExpand();if(b){g.appendCell(j,b,a)}}g.renderForBoxLabel(j);g.fieldEl=e;if(g.clearText){var c;g.clearBtnEl=c=$('<a class="mi-form-text-clear" style="display:none;"></a>');$(e).after(c);$(c).click(function(){e.val("")})}g.el=j;if(g.readOnly){g.setReadOnly(g.readOnly)}g.fieldBodyEl.addClass(g.extraFieldBodyCls);if(g.dirty){g.setDirty(g.dirty)}if(g.dataSource){var d=Mini2.data.StoreManager.lookup(g.dataSource);g.dataSource=d;g.bindDataSource(d)}g.initValue();if(undefined!=g.value){g.oldValue=g.value;g.setValue(g.value);delete g.value}if(g.style){var i=j.attr("style");i+=g.style;j.attr("style",i)}return g},setRecord:function(c){var b=this,d,a=b.dataField;if(!Mini2.isBlank(a)){if(c.isModel){d=c.get(a)}else{d=c[a]}b.oldValue=d;b.setValue(d)}b.record=c;return b},bindDataSource:function(a){var c=this,b=c.log;b.debug("bindDataSource 绑定数据源");$(a).muBind("update",c,c.dataSource_update).muBind("load",c,c.dataSource_load).muBind("currentchanged",c,c.dataSource_currentChanged)},dataSource_update:function(a,m,l,k){var g=a.data,b,e,h,d,f,c=false;if("COMMIT"==l){var n=m.get(g.dataField);g.setValue(n)}else{if("EDIT"==l){var n=m.get(g.dataField);g.setValue(n)}else{console.error("operation=",l)}}return c},dataSource_load:function(a,h){var e=a.data,d=e.log,b,f,g=h.data,c;d.debug("store_load(...)")},dataSource_currentChanged:function(a,b,e){var d=a.data,c=d.log;c.debug("数据仓库数据发生变化 store_currentChanged(...)");if(b>-1){if(!e){return}var f=e.get(d.dataField);if(d.setOldValue){d.setOldValue(f)}else{d.oldValue=f}d.setValue(f)}},initValue:Mini2.emptyFn,delayRender:function(){var b=this,a=$(b.applyTo);b.isDelayRender=true;Mini2.delayRS=Mini2.delayRS||{};Mini2.delayRS[b.clientId]=b;a.attr("mi-delay-render","true");a.data("me",b);return b},render:function(){var b=this,a;b.baseRender();a=b.el;a.attr("data-muid",b.muid);a.data("me",b);if(!b.visible){a.hide()}return b}});
Mini2.define("Mini2.ui.form.Labelable",{childEls:["labelCell","labelEl","bodyEl","sideErrorCell","errorEl","inputRow","helperEl",],activeErrorsTpl:['<td role="presentation" sid="sideErrorCell" valign="middle" style="" width="21">','<div role="presentation" sid="textfield-XXX-errorEl" class="mi-form-error-msg mi-form-invalid-icon" title="" ','style="" data-errorqtip="&lt;ul class=&quot;mi-list-plain&quot;&gt;&lt;li role=&quot;alert&quot;&gt;Name is required&lt;/li&gt;&lt;/ul&gt;">','<ul class="mi-list-plain"><li role="alert"></li></ul>',"</div>","</td>"],helperTpl:['<td role="helper" >','<div role="helper-inner" style="mi-form-helper-msg mi-form-helper-icon" >','<ul class="mi-list-plain"><li role="alert"></li></ul>',"</div>","</td>"],labelableRenderTpl:['<table role="Labelable" class="mi-field mi-table-plain mi-form-item mi-field-default " ','cellpadding="0" cellspacing="0" style="table-layout: fixed; width: 100%; ">',"<tbody>",'<tr role="presentation" class="mi-form-item-input-row">','<td role="presentation" class="mi-form-item-body"></td>',"</tr>","</tbody>","</table>"],requiredTpl:['<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'],formItemCls:Mini2.baseCSSPrefix+"form-item",labelCls:Mini2.baseCSSPrefix+"form-item-label",helerCls:Mini2.baseCSSPrefix+"form-helper-msg",errorMsgCls:Mini2.baseCSSPrefix+"form-error-msg",baseBodyCls:Mini2.baseCSSPrefix+"form-item-body",inputRowCls:Mini2.baseCSSPrefix+"form-item-input-row",fieldBodyCls:"",mixinsPropertys:["fieldLabel","labelAlign","labelWidth","labelPad","labelSeparator","hideLabel","hideHelper","helperText","helperLayout","helperStyle"],clearCls:Mini2.baseCSSPrefix+"clear",invalidCls:Mini2.baseCSSPrefix+"form-invalid",fieldLabel:undefined,labelAlign:"left",labelWidth:100,labelPad:5,labelSeparator:":",hideLabel:false,labelCell:undefined,getEl:function(){var c=this,b,a=c.fieldLabel;b=$('<label class="mi-form-item-label mi-unselectable" unselectable="on"></label>');b.html((a?a:"标签")+c.labelSeparator);b.addClass("mi-form-item-label-"+c.labelAlign);b.css({width:c.labelWidth+"px","margin-right":c.labelPad+"px"});if(c.required){b.append(Mini2.$join(c.requiredTpl))}return b},setHideLabel:function(c){var b=this,a=b.labelCell;b.hideLabel=c;if(c){if(!a){b.renderLabelCell()}}else{if(a){a.hide()}}},setLabelPad:function(g){var e=this,b,f=e.owner,a,c,d=e.labelCls;e.labelPad=g;if(f&&f.el){b=f.el;a=b.find("td.mi-field-label-cell:first");c=a.find("label:first")}c.css({"margin-right":e.labelPad+"px"})},getLabelPad:function(){return this.labelPad},setLabelAlign:function(g){var e=this,f=e.owner,b,a,c,d=e.labelCls;e.labelAlign=g;if(f&&f.el){b=f.el;a=b.find("td.mi-field-label-cell:first");c=a.find("label:first");c.removeClass(d+"-left");c.removeClass(d+"-right")}c.addClass("mi-form-item-label-"+e.labelAlign)},getLabelAlign:function(){var a=this;return a.labelAlign},setWidth:function(g){var e=this,f=e.owner,b,c,a,d;e.labelWidth=g;if(f&&f.el){b=f.el;a=b.find("td.mi-field-label-cell:first");c=a.find("label:first");d=g+e.labelPad;$(a).css("width",d);$(c).css("width",g)}},getWidth:function(){var a=this;return a.labelWidth},renderLabelCell:function(){var c=this,b,a;a=c.labelableRenderTpl.find("td.mi-form-item-body:first");c.labelCell=b=Mini2.$join(['<td role="presentation" valign="top" halign="left" class="mi-field-label-cell"></td>']);b.css("width",c.labelWidth+c.labelPad);$(a).before(b)},initLabelable:function(){var c=this,b=c.labelableRenderTpl;b=Mini2.$join(b);c.labelableRenderTpl=b;if(Mini2.designMode()){var a=$('<div class="mi-form-item"></div>');b.appendTo(a);c.labelableRenderTpl=a}c.lastActiveError="";if(!c.hideLabel){c.renderLabelCell()}if(!c.hideHelper){c.renderHelperCell()}},renderHelperCell:function(){var e=this,b,c,d,a;if(!e.hideHelper&&!Mini2.isBlank(e.helperText)){c=e.helperStyle;a=e.labelableRenderTpl.find("td.mi-form-item-body:first");e.helperCell=b=Mini2.$join(['<td role="presentation" valign="top" halign="left" class="mi-field-helper-cell">',"<ul>","<li>",'<div class="mi-helper-icon"></div>',"</li>","</ul>","</td>"]);d=b.find(".mi-helper-icon");if("icontext"==c){var f=Mini2.$join('<div class="mi-helper-text">',e.helperText,"</div>");d.after(f)}else{if("icon"==c){d.attr("data-original-title",e.helperText);if(d.tooltip){d.tooltip({placement:"right",delay:200,container:Mini2.getBody()})}}}b.css("width",0);$(a).parent().append(b)}},setHelper:function(a,c,b){},getActiveError:function(){return this.activeError||""},hasActiveError:function(){return !!this.getActiveError()},setActiveError:function(a){this.setActiveErrors(a)},getActiveErrors:function(){return this.activeErrors||[]},setActiveErrors:function(a){var b=this;if(!Mini2.isArray(a)){a=[a]}b.activeError=a[0];b.activeErrors=a;b.renderActiveError()},unsetActiveError:function(){var a=this;delete a.activeError;delete a.activeErrors;a.renderActiveError()},renderActiveError:function(){var f=this,a=f.getActiveError(),e=!!a,d=f.errorEl;if(a!==f.lastActiveError){f.lastActiveError=a}if(e){if(!d){f.errorEl=d=Mini2.$joinStr(f.activeErrorsTpl);var b=f.labelableRenderTpl.find("td.mi-form-item-body:first");$(b).after(d)}d.show();var c=d.children(".mi-form-error-msg");$(c).attr("title",a)}else{if(d){d.hide()}}}},function(a){var d=this;Mini2.apply(d,a);if(d.owner){var f=d.owner,b,e=d.mixinsPropertys,c=e.length,g;for(b=0;b<c;b++){g=e[b];d[g]=f[g]||d[g]}}d.initLabelable()});
Mini2.define("Mini2.ui.form.CheckboxGroup",{extend:"Mini2.ui.form.field.Base",alias:"widget.checkboxgroup",log:Mini2.Logger.getLogger("Mini2.ui.form.CheckboxGroup"),mixins:{labelable:"Mini2.ui.form.Labelable"},isCheckGroup:true,labeldable:null,columns:"auto",repeatColumns:0,repeatDirection:"vertical",repeatLayout:"table",vertical:false,blankText:"You must select at least one item in this group",defaultType:"checkboxfield",defaultItemType:"Mini2.ui.form.field.CheckBox",groupCls:Mini2.baseCSSPrefix+"form-check-group",extraFieldBodyCls:Mini2.baseCSSPrefix+"form-checkboxgroup-body",layout:"checkboxgroup",componentCls:Mini2.baseCSSPrefix+"form-checkboxgroup",items:null,initComponent:function(){var f=this,b,d=f.items,e=d.length,c,a;$(f).muBind("focusout",function(){f.fieldEl.removeClass("mi-form-focus");f.el.removeClass("mi-form-trigger-wrap-focus");f.on("hided")});f.initLabelable();for(b=0;b<e;b++){c=Mini2.apply({hideLabel:true,name:f.name,width:""},d[b]);a=Mini2.create(f.defaultItemType,c);d[b]=a}},clearItems:function(){var e=this,d=e.repeatLayout,c=e.items;for(var a=0;a<c.length;a++){var b=c[a].el;$(b).remove()}e.items=[];return e},insert:function(e){throw new Error("未完成此函数...");var f=this;if(!Mini2.isArray(e)){e=[e]}for(var b=0;b<e.length;b++){var c=e[b];var d=Mini2.apply({hideLabel:true,name:f.name,width:""},c);var a=Mini2.create(f.defaultItemType,d);f.items.push(a)}},resetItems:function(p){var t=this,d=t.el,h,r,f=t.fieldEl,k,n,a,c=t.columns,s=t.repeatLayout;t.clearItems();for(h=0;h<p.length;h++){var m=Mini2.apply({hideLabel:true,name:t.name,width:""},p[h]);var e=Mini2.create(t.defaultItemType,m);p[h]=e}t.items=p;console.debug("layout = ",t.repeatLayout);if("table"==t.repeatLayout){f.find("tbody:first").children().remove();var v=f.children("table");var g=t.getGroup_TableCell(v,c,p);var u=g.row;var b=g.col;var v=g.el;var o=0;for(h=0;h<u;h++){for(r=0;r<b;r++){a=t.getCell(v,h,r);k=p[o++];k.renderTo=a;k.render();k.el.css("margin","0px 15px 0px 0px");if(o>=p.length){break}}}}else{if("flow"==t.repeatLayout){var g=t.getGroup_Flow();g=g.el;var q=0;if(t.repeatColumns>0){q=parseInt(100/t.repeatColumns)}for(h=0;h<p.length;h++){k=p[h];k.renderTo=g;k.render();n=k.el;var l=$(n).find("td.mi-form-item-body:first");l.css("padding-right","15px");if("vertical"==t.repeatDirection){n.css("float","left")}if(q>0){n.css("width",q+"%")}}}}console.debug("----------------------");t.bindItemAll(p)},initValue:function(){var a=this,b=a.value;a.originalValue=a.lastValue=b||a.getValue();a.setValue(b,false)},getValue:function(){var g=this,f=g.log,c,d=g.items,e=d.length,a,j="",h=0,b;for(b=0;b<e;b++){c=d[b];a=c.checked;if(a){if(h++>0){j+=", "}j+=c.inputValue}}return j},setValue:function(m,k){var h=this,g=h.log,c,d=h.items,f=d.length,b,a,e,o,n;if(h.locked){console.debug("上锁..");return h}if(Mini2.isBlank(m)){m=""}if(Mini2.isArray(m)){o=m}else{if(Mini2.isString(m)){o=m.split(",")}}n={};for(e=0;e<o.length;e++){var l=o[e];if(Mini2.isString(l)){l=Mini2.String.trim(l)}else{l=l+""}o[e]=l;n[l]=true}for(a=0;a<f;a++){c=d[a];b=!!n[c.inputValue];c.setValue(b,k)}return h},setHeight:function(a){},createGroupCell:function(e,d,a){var b,c,f,g;f=e.find("tbody:first");for(b=0;b<d;b++){g=$("<tr></tr>");f.append(g);for(c=0;c<a;c++){g.append('<td class="mi-form-radio-group" valign="top"></td>')}}},getGroup_TableCell:function(h,b,c){var e=this,f,a,i,g,d=c.length;if("auto"==b){e.createGroupCell(h,1,d);f={el:h,row:1,col:d}}else{if(b<=1){e.createGroupCell(h,d,1);f={el:h,row:d,col:1}}else{a=parseInt(b);i=d%a;g=(d-i)/a;if(i>0){g++}e.createGroupCell(h,g,a);f={el:h,row:g,col:a}}}return f},getGroup_Table:function(){var c=this,b=c.items,a=c.repeatColumns,e,d;e=Mini2.$join(['<div class="mi-checkbox-group-inner" >','<table id="radiogroup-',c.muid,'-innerCt" class="mi-table-plain" cellpadding="0" role="presentation" style="table-layout: auto;">',"<tbody>","</tbody>","</table>","</div>"]);d=c.getGroup_TableCell(e,a,b);return d},getGroup_Flow:function(){var b=this,c,a=b.repeatColumns,d;d=Mini2.$join(["<div>","</div>"]);c={el:d};return c},getFieldEl:function(){var n=this,d,m,e,g,a,k=n.items;if("table"==n.repeatLayout){var c=n.getGroup_Table();var o=c.row;var b=c.col;c=c.el;var p=c.children("table");var h=0;for(d=0;d<o;d++){for(m=0;m<b;m++){a=n.getCell(p,d,m);e=k[h++];e.renderTo=a;e.render();e.el.css("margin","0px 15px 0px 0px");if(h>=k.length){break}}}return c}else{if("flow"==n.repeatLayout){var c=n.getGroup_Flow();c=c.el;var l=0;if(n.repeatColumns>0){l=parseInt(100/n.repeatColumns)}for(d=0;d<k.length;d++){e=k[d];e.renderTo=c;e.render();g=e.el;var f=$(g).find("td.mi-form-item-body:first");f.css("padding-right","15px");if("vertical"==n.repeatDirection){g.css("float","left")}if(l>0){g.css("width",l+"%")}}return c}}},bindItemAll:function(a){var b=this;a=a||b.items;$(a).each(function(){b.bindItem(this)});return b},bindItem:function(a){var b=this;$(a).muBind("change",function(c){console.debug("触发事件了.......");console.debug("item2 === ",a.muid);var f=a.getValue();b.locked=true;try{$(b).muTriggerHandler("changed",[{sender:this,target:null,data:f}])}catch(d){console.error("执行 changed 事件错误.",d)}b.locked=false})},baseRender:function(){var d=this,c=d.log,a="td.mi-form-item-body:first",e,b;e=d.getTableContainer();if(d.minWidth){e.css({"min-width":d.minWidth})}if(d.maxWidth){e.css({"max-width":d.maxWidth})}if(d.applyTo){$(d.applyTo).replaceWith(e)}else{$(d.renderTo).append(e)}d.fieldBodyEl=e.find(a);b=d.getFieldEl();d.renderForLableable(e);d.appendCell(e,b,a);d.renderForBoxLabel(e);d.fieldEl=b;d.el=e;d.el.addClass(d.componentCls);d.fieldBodyEl.addClass(d.extraFieldBodyCls);d.initValue();d.bindItemAll();if(d.dirty){d.setDirty(d.dirty)}},render:function(){var a=this;a.baseRender();a.el.data("me",a)}});
Mini2.define("Mini2.ui.form.RadioGroup",{extend:"Mini2.ui.form.CheckboxGroup",alias:"widget.radiogroup",log:Mini2.Logger.getLogger("Mini2.ui.form.RadioGroup",false),defaultType:"radiofield",defaultItemType:"Mini2.ui.form.field.Radio",groupCls:Mini2.baseCSSPrefix+"form-radio-group",extraFieldBodyCls:Mini2.baseCSSPrefix+"form-radiogroup-body",layout:"radiogroup",componentCls:Mini2.baseCSSPrefix+"form-radiogroup",bindItem:function(a){var c=this,b=c.log;$(a).on("change",this,function(d,h,i){if(h){c.setCheck(this)}var g=a.getValue();c.locked=true;try{$(c).muTriggerHandler("changed",[{sender:this,target:null,data:g}])}catch(f){console.error("触发 changed 事件错误",f)}c.locked=false})},setCheck:function(a){var f=this,c,d=f.items,e=d.length,b=e;while(b--){c=d[b];if(c!==a){c.setValue(false)}}return f},setValue:function(h){var g=this,f=g.log,c,d=g.items,e=d.length,b,a;console.trace();console.group("setValue="+h);for(a=0;a<e;a++){c=d[a];b=(c.inputValue==h);console.debug(this.id+"初始化......."+c.inputValue+"....",b);if(b){console.debug("item = ",c);c.setValue(b);break}}console.groupEnd();g.trigger("changed",{value:h});return g}});
Mini2.define("Mini2.ui.form.Label",{extend:"Mini2.ui.form.field.Base",alias:"widget.label",mode:"ENCODE",getFieldEl:function(){var b=this,a;if("ENCODE"==b.mode){b.inputEl=a=Mini2.$joinStr(['<label role="Label" class="mi-form-field mi-form-label" ','aria-invalid="false" style="width: 100%; "></label>']);if(b.name){a.attr("name",b.name)}a.text(b.value).attr("id",b.clientId).css("text-align",b.align).attr("autocomplete",b.autoComplete)}else{b.inputEl=a=Mini2.$joinStr(['<div role="Label" class="mi-form-field mi-form-label" ','aria-invalid="false" style="width: 100%; "></div>'])}return a},setValue:function(d){var c=this,a=c.hideEl,b=c.inputEl;b.val(d);b.html(d);if(a){a.val(d)}return c},getValue:function(){var c=this,a=c.hideEl,b=c.inputEl,d;if(c.readOnly&&a){d=a.val()}else{if("ENCODE"==c.mode){d=b.val()}else{d=b.html()}}return d},render:function(){var d=this,c,f=d.value;d.baseRender();d.inputEl.removeAttr("name");d.hideEl=c=d.createHideEl();c.val(f);var a="td.mi-form-item-body:first";var e=d.getTableContainer();var b=e.find(a);if(d.bodyAlign){b.css("text-align",d.bodyAlign)}d.appendCell(e,c,a);d.el.data("me",d)}});
Mini2.define("Mini2.ui.form.field.Text",{extend:"Mini2.ui.form.field.Base",alias:"widget.text",size:20,minLength:0,maxLength:Number.MAX_VALUE,minLengthText:"The minimum length for this field is {0}",maxLengthText:"The maximum length for this field is {0}",initEvents:function(){},bindInputEl_Mouse:function(a){var b=this;$(a).on("mousedown",function(c){b.focus();Mini2.EventManager.setMouseDown(b,null,b.scope||b,c,true)}).on("mouseup",function(c){b.on("mouseup",c);Mini2.EventManager.setMouseUp(b,c)})},bindInputEl_Key:function(a){var b=this;$(a).on("keydown",function(c){b.on("keydown",c)}).on("keyup",function(c){b.on("keyup",c)})},getCursorPosition:function(){var c=this,b=c.inputEl[0],a=0,e,d;if(b){if(b.selectionStart){a=b.selectionStart}else{var e=document.selection;if(e){d=e.createRange();d.moveStart("character",-b.value.length);a=d.text.length}}}return a},isFirstCursorPos:function(){var b=this,a=b.getCursorPosition();return a==0},isLastCursorPos:function(){var d=this,b=d.inputEl,c=$(b).val().length,a=d.getCursorPosition();return a==c},onChange:function(a,b){this.autoSize()},autoSize:function(){}});
Mini2.define("Mini2.ui.form.field.Password",{extend:"Mini2.ui.form.field.Text",alias:"widget.password",type:"password"});
Mini2.define("Mini2.ui.form.field.Trigger",{extend:"Mini2.ui.form.field.Text",alias:"widget.trigger",log:Mini2.Logger.getLogger("Mini2.ui.form.field.Trigger",false),buttonEl:null,dropDownPanel:null,emptyText:"",focusCls:"mi-form-focus",store:false,itemBody:null,content:null,changed:Mini2.emptyFn,mode:"user_input",initComponent:function(){var a=this;a.fieldCls="mi-form-type-text";$(a).muBind("focusout",function(){a.fieldEl.removeClass("mi-form-focus");a.el.removeClass("mi-form-trigger-wrap-focus");a.hideDropDownPanel();a.clearInvalid()});a.initStore();a.initLabelable()},initStore:function(){var a=this,b=a.store,c;if(Mini2.isString(b)){c=Mini2.data.StoreManager.lookup(a.store);delete a.store}else{if(Mini2.isArray(b)){c=Mini2.create("Mini2.data.Store",{storeId:"MiniStore_"+Mini2.newId(),fields:a.fields||[],data:b,autoSave:false});delete a.store}else{c=a.store}}a.store=c;a.bindStore(c)},getStore:function(){var a=this;return a.store},bindStore:function(a){},getTriggerMarkup:function(){var a=this,b=Mini2.$join(['<div class="mi-boundlist ',"mi-layer ",'mi-border-box" ','style="border-width: 1px; right: auto; z-index: 39001; display:none; ">',"","</div>"]);return b},hide:function(){var a=this;a.visible=false;a.el.hide();a.hideDropDownPanel();a.callParent();return a},layoutReset:function(){var a=this;a.hideDropDownPanel()},init_DropDwonPanel:function(){var a=this;if(a.dropDownPanel!=null){return}var b=a.getTriggerMarkup();a.dropDownPanel=$(b);$(document.body).append(a.dropDownPanel);$(a.dropDownPanel).mousedown(function(c){}).mousemove(function(c){}).mouseup(function(c){Mini2.EventManager.stopEvent(c);Mini2.EventManager.clear(a.scope||a.el)})},getBoundPanel:Mini2.emptyFn,initContentPanel:function(){var b=this;if(!b.isCustom){var a=null;if(Mini2.isString(b.content)){if(window[b.content]){a=window[b.content]}else{a=$(b.content)}delete b.content}else{a=b.content}b.isCustom=true;$(a).addCls("mi-boundlist","mi-layer","mi-border-box").css({right:"auto","z-index":39001}).show();b.dropDownPanel=a}},beforeShowDropDownPanel:function(){var b=this;if(b.content){b.initContentPanel()}if(!b.isCustom){b.init_DropDwonPanel();var c=b.dropDownPanel;var a=b.getBoundPanel();$(c).children().remove();$(c).append(a)}},showDropDownPanel:function(){var e=this;e.init_DropDwonPanel();if(e.dropDown){try{e.dropDown.call(e,e)}catch(c){throw new Error("执行 Trigger.dropDown(...) 事件发生错误")}}e.trigger("dropDown");var b=e.el,g=e.dropDownPanel,i=e.dropDownWidth||(e.dropDownWidth>0)||b.width(),d=e.dropDownHeight,f=e.fieldEl.offset();if(!e.isCustom){g.css({width:i-4,height:d})}var a=f.top+b.height()-2+d;g.css({left:f.left,top:f.top+b.height()-2}).show()},hideDropDownPanel:function(){var b=this,a=b.dropDownPanel;if(a==null){return}a.hide();b.trigger("dropDownClosed")},triggerDropDownPanel:function(){var b=this,a=b.dropDownPanel;if(a&&a.css("display")!="none"){b.hideDropDownPanel()}else{b.beforeShowDropDownPanel();b.showDropDownPanel()}},onPositionChanged:function(){var b=this,a=b.el,c,d=b.dropDownPanel;if(d){c=a.offset();d.css({left:c.left,top:c.top+a.height()-2})}},onButtonClick:function(){var c=this,a=c.buttonClick,b=c.buttonClick_Callback;if(a||b){if(a&&Mini2.isFunction(a)){a.call(c,c)}if(b&&Mini2.isFunction(b)){b.call(c,c)}}else{c.triggerDropDownPanel()}},bindEvent_Button:function(b){var d=this,a="mi-form",e=a+"-trigger-over",c=a+"-trigger-click";$(b).mouseenter(function(){if(!d.readOnly){$(this).addClass(e)}}).mouseleave(function(){if(!d.readOnly){$(this).removeClass(e)}});$(b).muBind("mousedown",function(f){if(!d.readOnly){d.focus()}Mini2.EventManager.stopEvent(f)}).muBind("mouseup",function(f){if(!d.readOnly){$(this).removeClass(c);d.onButtonClick()}Mini2.EventManager.stopEvent(f)})},focus:function(){var c=this,a=c.el,b=c.fieldEl;if(!a.hasClass("mi-form-trigger-wrap-focus")){b.addClass("mi-form-focus");a.addClass("mi-form-trigger-wrap-focus");if(!c._focusTimeout){if(c.inputEl){c._focusTimeout=setTimeout(function(){var d=c.inputEl;if(b.hasClass("mi-form-focus")){d.focus()}c._focusTimeout=null},200)}}Mini2.ui.FocusManager.setControl(c.scope||c,null,null,true)}},bindInputEl_Mouse2:function(a){var b=this;if("none"==b.mode){a.css("current","pointer");$(a).mousedown(function(c){if(!b.readOnly){b.focus()}Mini2.EventManager.stopEvent(c)}).mouseup(function(c){if(!b.readOnly){b.onButtonClick()}Mini2.EventManager.stopPropagation(c)})}},getFieldEl:function(){var d=this,c=d.log,f,b,a,e=Mini2.SystemInfo.formTrigger;f=Mini2.$join(['<table class="mi-form-trigger-wrap" cellpadding="0" cellspacing="0" style="table-layout: fixed; width: 100%; ">',"<tbody>","<tr>",'<td class="mi-form-trigger-input-cell" style="width: 100%; "></td>','<td valign="top" class="mi-trigger-cell mi-unselectable" style="width:22px;" role="button" ></td>',"</tr>","</tbody>","</table>"]);d.inputEl=b=Mini2.$join(['<input type="text" class="mi-form-field mi-form-text" ','autocomplete="off" aria-invalid="false" spellcheck="false" style="width: 100%; ">']);if(!Mini2.isBlank(d.placeholder)){b.attr("placeholder",d.placeholder)}if(d.required){b.addClass("mi-form-required-field")}a=Mini2.$join(['<div class="mi-form-trigger mi-form-arrow-trigger " role="button"></div>']);d.buttonEl=a;if(d.buttonCls){a.addCls(d.buttonCls)}b.attr("id",d.clientId);if(d.name){b.attr("name",d.name)}d.appendCell(f,b,"td.mi-form-trigger-input-cell");d.appendCell(f,a,"td.mi-trigger-cell");f.find("td.mi-trigger-cell").width(e.width);if(undefined!=d.value){d.setValue(d.value);d.srcValue=d.value;delete d.value}d.bindEvent_Button(a);d.bindInputEl_Mouse(b);d.bindInputEl_Key(b);d.bindInputEl_Mouse2(b);d.initTypeahead(b);$(d).on("keyup",function(g,h){if(13==h.keyCode&&d.mapping){d.onMaping();h.cancel=true}});if("none"==d.mode){d.setMode(true)}return f},onMaping:function(){var b=this,a=b.mapTimer;if(a){a.resetStart()}else{b.mapTimer=Mini2.setTimer(function(){b.mapping.call(b,b)},[500,1])}},setMode:function(g){var e=this,d=e.log,a=e.el,c=e.inputEl,b=e.hideEl,f="readonly";if(g){c.attr(f,f)}else{c.removeAttr(f)}if(g){if(!b){c.attr("name","");e.hideEl=b=e.createHideEl();b.attr("name",e.name);c.after(b)}}else{if(b){c.attr("name",e.name);$(b).remove();delete e.hideEl}}return e},setReadOnly:function(h){var e=this,d=e.log,a=e.el,c=e.inputEl,b=e.hideEl,f="readonly",g="mi-form-item-readonly";h=!!h;e.readOnly=h;a&&a.toggleClass(g,h);if(!c){return}if(h||e.mode=="none"){d.debug("设置只读属性");c.attr(f,f)}else{d.debug("删除只读属性");c.removeAttr(f)}if(h||e.mode=="none"){if(!b){d.debug("创建隐藏标签");c.attr("name","");e.hideEl=b=e.createHideEl();b.attr("name",e.name);c.after(b)}}else{if(b){d.debug("删除隐藏标签");c.attr("name",e.name);$(b).remove();delete e.hideEl}}$(c).change(function(){e.clearInvalid()});$(c).keyup(function(){e.clearInvalid()});return e}});
Mini2.define("Mini2.ui.form.field.Field",{value:"",disabled:false,submitValue:true,validateOnChange:true,initField:function(){},initValue:function(){},getName:function(){return this.name},getValue:function(){return this.value},setValue:function(b){var a=this;a.value=b;a.checkChange();return a},isEqual:function(a,b){return String(a)===String(b)},isEqualAsString:function(a,b){return String(Mini2.value(a,""))===String(Mini2.value(b,""))},getSubmitData:function(){var b=this,a=null;if(!b.disabled&&b.submitValue&&!b.isFileUpload()){a={};a[b.getName()]=""+b.getValue()}return a},getModelData:function(){var b=this,a=null;if(!b.disabled&&!b.isFileUpload()){a={};a[b.getName()]=b.getValue()}return a},reset:function(){var a=this;a.beforeReset();a.setValue(a.originalValue);a.clearInvalid();delete a.wasValid},beforeReset:Mini2.emptyFn,resetOriginalValue:function(){this.originalValue=this.getValue();this.checkDirty()},checkChange:function(){if(!this.suspendCheckChange){var a=this,b=a.getValue(),c=a.lastValue;if(!a.isEqual(b,c)&&!a.isDestroyed){a.lastValue=b;a.fireEvent("change",a,b,c);a.onChange(b,c)}}},onChange:function(a,b){if(this.validateOnChange){this.validate()}this.checkDirty()},getErrors:function(a){return[]},isValid:function(){var a=this;return a.disabled||Mini2.isEmpty(a.getErrors())},isFileUpload:function(){return false},markInvalid:Mini2.emptyFn,clearInvalid:Mini2.emptyFn});
Mini2.define("Mini2.ui.form.field.Hidden",{extend:"Mini2.ui.Component",alias:"widget.hidden",initComponent:function(){var a=this},setValue:function(c){var b=this,a=b.el;a.val(c);log.debug("赋值 hidden.value = "+b.el.val());return b},getValue:function(){var b=this,a=b.el,c;c=a.val();return c},baseRender:function(){var b=this,a;if(b.applyTo){var c=$(b.applyTo);if(c.length){b.el=a=c}else{b.el=a=$('<input type="hidden" />');$(b.applyTo).replaceWith(a)}}else{b.el=a=$('<input type="hidden" />');$(b.renderTo).append(a)}a.attr("name",b.name);if(b.value!=undefined){b.setValue(b.value);delete b.value}return b},initValue:Mini2.emptyFn,render:function(){var a=this;a.baseRender();a.el.data("me",a)}});
Mini2.define("Mini2.ui.form.field.CheckBox",{extend:"Mini2.ui.form.field.Base",alias:"widget.checkbox",log:Mini2.Logger.getLogger("Mini2.ui.form.field.CheckBox",false),alternateClassName:"Mini2.ui.form.Checkbox",fieldCls:Mini2.baseCSSPrefix+"-form-type-checkbox",focusCls:Mini2.baseCSSPrefix+"form-checkbox-focus",checkedCls:Mini2.baseCSSPrefix+"form-cb-checked",extraFieldBodyCls:Mini2.baseCSSPrefix+"form-checked-body",componentLayout:"field",isCheckbox:true,checked:null,textEl:null,trueText:null,falseText:null,inputValue:"on",inputType:"checkbox",inputTypeAttr:"button",originalValue:false,lastValue:false,initComponent:function(){var a=this;$(a).muBind("focusout",function(){a.fieldEl.removeClass("mi-form-focus").removeClass(a.focusCls);a.el.removeClass("mi-form-trigger-wrap-focus")});a.initLabelable()},initValue:function(){var b=this,a=!!b.checked;b.originalValue=b.lastValue=a;b.setValue(a,false);if(b.textEl){var c=a?b.trueText:b.falseText;b.textEl.html(c)}},baseSetValue:function(h,g){var d=this,c=d.el,f=d.srcInputEl,b=d.checkedCls,a,e=d.originalValue;d.lastValue=d.checked;d.checked=a=!!h;$(c).toggleClass(b,a);if(f){f.prop("checked",a)}if(false!==g){d.trigger("changed",{value:a})}},setValue:function(j,h){var e=this,d=e.log,c=e.el,g=e.srcInputEl,b=e.checkedCls,a,f=e.originalValue;j=!!j;if(e.checked===j&&$(c).hasClass(b)){return}e.lastValue=e.checked;e.checked=a=j;$(c).toggleClass(b,a);if(g){g.prop("checked",a)}if(e.textEl){var i=j?e.trueText:e.falseText;e.textEl.html(i)}if(a!=f){if(false!==h){e.onChange(a,f)}e.originalValue=a}if(false!==h){e.trigger("changed",{value:a})}return e},getValue:function(){return this.checked},onChange:function(b,c){var a=this;if(Mini2.isFunction(a.change)){a.change.call(a,b,c)}$(a).triggerHandler("change",[b,c])},renderForLableable:function(d){var c=this,a=c.labelable,b;if(a&&!a.hideLabel){b=a.getEl();if(c.clientId){b.attr("for",c.clientId)}b.muBind("mousedown",function(f){c.focus()});c.appendCell(d,b,"td.mi-field-label-cell:first");if(c.checked){d.addClass("mi-form-cb-checked")}}},renderForBoxLabel:function(d){var c=this,a=c.boxLabel;if(a){var b=Mini2.$joinStr(['<label class="mi-form-cb-label mi-form-cb-label-after" " >',a,"</label>"]);b.attr("for",c.clientId);b.muBind("mousedown",function(f){c.focus()});b.muBind("mouseup",function(f){c.setValue(!c.checked);Mini2.EventManager.stopEvent(f)});c.boxLableEl=b;c.appendCell(d,b,"td.mi-form-item-body:first")}},initSrcInput:function(){var a=this,b;a.srcInputEl=b=Mini2.$join(['<input type="checkbox" style="display:none;" />']);b.attr("name",a.name).attr("value",a.inputValue);if(a.checked){b.prop("checked",true)}},getBodyExpand:function(){var b=this,c,d=b.trueText,a=b.falseText;if(d||a){c=$('<label style="white-space: nowrap;margin-top: 4px;margin-left: 4px;position: absolute; "></label>');c.attr("for",b.clientId);c.muBind("mousedown",function(f){b.focus()});c.muBind("mouseup",function(f){b.setValue(!b.checked);Mini2.EventManager.stopEvent(f)});b.textEl=c;return c}},getFieldEl:function(){var c=this,b,d,a=c.checkedCls;c.initSrcInput();c.inputEl=b=Mini2.$joinStr(['<input type="button" class="mi-form-field mi-form-checkbox mi-form-cb " ','autocomplete="off" ','hidefocus="true" ','aria-invalid="false" ','data-errorqtip="" style="" >']);b.attr("id",c.clientId);$(b).muBind("mousedown",function(f){c.focus();Mini2.EventManager.stopEvent(f)}).muBind("mouseup",function(f){var g=c.checked;c.setValue(!g);Mini2.EventManager.stopEvent(f)});return b}});
Mini2.define("Mini2.ui.form.field.TextButton",{extend:"Mini2.ui.form.field.Trigger",alias:"widget.textbutton",onButtonClick:function(){var a=this;var b=Mini2.createTop("Mini2.ui.Window",{mode:true,text:"文本框",buttons:[{text:"确定",width:100},{text:"取消",width:100,click:Mini2.emptyFn}]});b.show()}});
Mini2.define("Mini2.ui.form.field.TextArea",{extend:"Mini2.ui.form.field.Text",alias:"widget.textarea",cols:20,rows:4,tabStop:false,bindInputEl_Key:function(a){var b=this;$(a).on("keydown",function(c){if(13==c.keyCode){b.insertText(this,"\n");Mini2.EventManager.stopEvent(c);return}b.on("keydown",c)}).on("keyup",function(c){b.on("keyup",c)}).on("keypress",function(c){b.on("keypress",c)})},setValue:function(d){var c=this,a=c.hideEl,b=c.inputEl;b.val(d);if(a){a.val(d)}return c},getValue:function(){var c=this,a=c.hideEl,b=c.inputEl,d;if(c.readOnly&&a){d=a.val()}else{d=b.val()}return d},getFieldEl:function(){var b=this,a;b.inputEl=a=Mini2.$joinStr(['<textarea class="mi-form-field mi-form-text mi-form-textarea" ','aria-invalid="false" style="width: 100%;resize: none; " ','spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off">',"</textarea>"]);if(b.name){a.attr("name",b.name)}a.attr("id",b.clientId).attr("placeholder",b.placeholder).attr("autocomplete",b.autoComplete).attr("cols",b.cols).attr("rows",b.rows);a.css({"text-align":b.align,height:b.height});if(b.readOnly){a.attr("readonly","readonly")}b.bindInputEl_Mouse(a);b.bindInputEl_Key(a);return a}});
Mini2.define("Mini2.ui.form.field.ComboBox",{extend:"Mini2.ui.form.field.Trigger",alias:"widget.combobox",log:Mini2.Logger.getLogger("Mini2.ui.form.field.ComboBox",console),displayField:"text",itemDisplayField:"textEx",valueField:"value",checkedMode:"single",emptyEnabled:true,emptyValue:"",emptyText:"",createCloseItemEl:function(e){var c=this,d={},a=c.emptyValue,b=Mini2.$join(c.itemTpl);d[c.valueField]=c.emptyValue;d[c.displayField]="";d[c.itemDisplayField]="[ X ]";d=e.createModel(d);b.addClass("mi-boundlist-empty").html("[ X ]").data("record",d);return b},initComponent:function(){var b=this,a=b.log;$(b).muBind("focusout",function(){if(b._focusTimeout){clearTimeout(b._focusTimeout);delete b._focusTimeout}b.fieldEl.removeClass("mi-form-focus");b.el.removeClass("mi-form-trigger-wrap-focus");b.hideDropDownPanel()});b.initStore();b.initLabelable()},getItemDisplayText:function(b){var a=this,c;c=b.get(a.itemDisplayField);if(Mini2.isBlank(c)){c=b.get(a.displayField)}return c},add:function(a){},getBoundPanel:function(){var h=this,c,b,j,f,o,n=h.store,m=n.data,l,d=n.getCount(),a=Mini2.SystemInfo.list,g=a.itemHeight||24;b=Mini2.$join(['<div class="mi-boundlist-list-ct mi-unselectable" style="overflow: auto; height: 100px; font-size:12px; ">','<ul class="mi-list-plain"></ul>',"</div>"]);var k=b.children(".mi-list-plain");h.boundListEl=b;h.listPlainEl=k;if(h.checkedMode=="multi"){var e=Mini2.$joinStr(['<li role="option" unselectable="on" class="mi-boundlist-item">','<img class="mi-form-checkbox" src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style="">',"</li>"]);m=n.data;var q=h.value||"";var p=q.split(",");for(var c=0;c<p.length;c++){p[c]=Mini2.String.trim(p[c])}for(c=0;c<m.getCount();c++){l=m.get(c);j=e.clone();o=h.getItemDisplayText(l);j.append(o);j.data("record",l);if(Mini2.Array.contains(p,o,true)){j.addClass("mi-boundlist-item-selected")}$(k).append(j)}f=k.children();h.bindItems_ForMulti(f)}else{var e=$('<li role="option" unselectable="on" class="mi-boundlist-item"></li>');m=n.data;for(c=0;c<m.getCount();c++){l=m.get(c);j=e.clone();o=h.getItemDisplayText(l);j.html(o);j.data("record",l);$(k).append(j)}f=k.children();h.bindItems(f)}d=(d>8?8:d);b.css("height",g*d);return b},getMultiValues:function(c){var d=this;var a=$(c).children(".mi-boundlist-item-selected");var e="";var b=0;$(a).each(function(){var f=$(this).data("record");var h=f.get(d.valueField);var g=f.get(d.displayField);if(b++>0){e+=","}e+=h});return e},bindItems_ForMulti:function(a){var b=this;$(a).on("mouseenter",function(){$(this).addClass("mi-boundlist-item-over")}).on("mouseleave",function(){$(this).removeClass("mi-boundlist-item-over")}).on("mouseup",function(c){$(this).toggleClass("mi-boundlist-item-selected");var d=b.getMultiValues($(this).parent());if("none"==b.mode){b.hideEl.val(d);b.inputEl.val(d)}else{b.inputEl.val(d)}b.value=d;b.text=d;b.clearInvalid();b.focus();if(b.changed){b.changed.call(b)}b.trigger("changed",{value:value,text:text});b.trigger("changed_callback",{values:d})})},bindItems:function(a){var b=this;$(a).on("mouseenter",function(){$(this).addClass("mi-boundlist-item-over")}).on("mouseleave",function(){$(this).removeClass("mi-boundlist-item-over")}).on("mouseup",function(c){var d=$(this).data("record");var g=d.get(b.valueField);var f=d.get(b.displayField);if("none"==b.mode){b.hideEl.val(g);b.inputEl.val(f)}else{b.inputEl.val(g)}b.curRecord=d;b.value=g;b.text=f;b.hideDropDownPanel();b.clearInvalid();b.focus();if(b.changed){b.changed.call(b)}b.trigger("changed",{value:g,text:f});b.trigger("changed_callback",{value:g,text:f});Mini2.EventManager.stopPropagation(c)})},setValue:function(k){var f=this,e=f.log,g,c=f.hideEl,h=f.store,i,d=f.inputEl,l=f.valueField,a=f.displayField;f.value=k;if("none"==f.mode&&h){try{var j;if(true===k){j="true"}else{if(false===k){j="false"}else{j=k}}g=h.filterFirstBy(l,j);if(g){f.curRecord=g;i=g.get(a);f.text=i;d.val(i)}else{f.text="";d.val("")}}catch(b){e.error("ComboBox.setValue(...) 赋值错误啦。",b)}}else{g=h.filterFirstBy(l,k);f.curRecord=g;if(g){f.text=g.get(f.displayField)}else{f.text=""}d.val(k)}if(c){c.val(k)}},getValue:function(){var c=this,b=c.log,d,f=c.valueField,a=c.hideEl,e;if(c.readOnly||"none"==c.mode){e=a.val()}else{e=c.inputEl.val()}d=c.store.filterFirstBy(f,e);c.curRecord=d;if(d){c.text=d.get(c.displayField)}else{c.text=""}c.value=e;return e},getSentData:function(){var a=this,c={},b=a.remoteParams;if(b&&b.length){$(b).each(function(){var f=this;if("query_string"==f.role){var h=$.query.get(f.queryStringField);c[f.name]=h}else{if("control"==f.role){var e=Mini2.find(f.control);var i=e.getValue();c[f.name]=i}else{var g=f["default"];if(g.indexOf("{{")>=0&&g.indexOf("}}")){var d=template.compile(g);var j=d({T:{"未定义":""}});c[f.name]=j}else{c[f.name]=g}}}})}return c},showDropDownPanel:function(){var c=this,a=c.el;c.init_DropDwonPanel();if(c.remoteEnabled){var d=c.getSentData();Mini2.post(c.remoteUrl,d,function(e){var f=c.store;f.removeAll();f.add(e);c.refresh()})}if(c.dropDown){try{c.dropDown.call(c,c)}catch(b){throw new Error("执行 Trigger.dropDown(...) 事件发生错误."+b.Message)}}c.proDropDownPanel_SizeALocal();return c},itemTpl:['<li role="option" unselectable="on" class="mi-boundlist-item"></li>'],createCloseItemEl:function(e){var c=this,d={},a=c.emptyValue,b=Mini2.$join(c.itemTpl);d[c.valueField]=c.emptyValue;d[c.displayField]="";d[c.itemDisplayField]="[ X ]";d=e.createModel(d);b.addClass("mi-boundlist-empty").html("[ X ]").data("record",d);return b},refresh:function(){var k=this,d,b,h=k.itemTpl,l,f,p,o=k.store,n=o.data,m,e=o.getCount(),a=Mini2.SystemInfo.list,g=a.itemHeight||24;var j=k.listPlainEl;j.html("");if(k.emptyEnabled){var c=k.createCloseItemEl(o);$(j).append(c)}n=o.data;for(d=0;d<n.getCount();d++){m=n.get(d);p=k.getItemDisplayText(m);if(Mini2.isBlank(p)){p="&nbsp;"}l=Mini2.$join(h);l.html(p);l.data("record",m);$(j).append(l)}f=j.children();k.bindItems(f);e=(e>8?8:e);k.boundListEl.css("height",g*e);k.proDropDownPanel_SizeALocal()},getStrLength:function(b){var a=b.match(/[^\x00-\xff]/ig);return b.length+(a==null?0:a.length)},proDropDownPanel_SizeALocal:function(){var h=this,c=h.el,d=h.fieldEl,j=h.dropDownPanel,i,m,f,n=$(window).height(),a,k,e,l,b=Mini2.SystemInfo.list,g=b.itemHeight||24;i=d.offset();e=d.outerWidth();m=h.dropDownWidth||e;if(m<e){m=e}f=h.store.getCount();if(f>8){f=8}l=g*f;a=(i.top+d.height()+2)+l;if(a>n){k=i.top-l}else{k=i.top+d.height()+1}j.css({"border-width":1,width:m,height:l,left:i.left,top:k}).show();return h}});
Mini2.define("Mini2.ui.form.field.ComboBoxBase",{extend:"Mini2.ui.form.field.Trigger",alias:"widget.comboboxbase",log:Mini2.Logger.getLogger("Mini2.ui.form.field.ComboBoxBase",true),displayField:"text",itemDisplayField:"textEx",valueField:"value",curRecord:null,checkedMode:"single",itemHeight:24,remoteEnabled:false,remoteUrl:null,remoteParams:null,emptyEnabled:true,emptyValue:"",emptyText:"",emptyItemEl:null,emptyItemHeight:0,initComponent:function(){var a=this;$(a).muBind("focusout",function(){if(a._focusTimeout){clearTimeout(a._focusTimeout);delete a._focusTimeout}a.fieldEl.removeClass("mi-form-focus");a.el.removeClass("mi-form-trigger-wrap-focus");a.hideDropDownPanel()});a.initStore();a.initLabelable();a.curRecordEl=Mini2.$join(['<input type="hidden" name="',a.clientId,'_curRecord" />'])},getItemDisplayText:function(b){var a=this,c;c=b.get(a.itemDisplayField);if(undefined==c||""==c){c=b.get(a.displayField)}return c},getBoundPanel:function(){var l=this,r=Mini2.SystemInfo,c,b,m,f,s,q=l.store,p=q.data,h,o,d=q.getCount(),a=Mini2.SystemInfo.list,g=a.itemHeight||l.itemHeight;b=Mini2.$joinStr(['<div class="mi-boundlist-list-ct mi-unselectable" style="overflow: auto; height: 100px; font-size:12px; ">','<ul class="mi-list-plain"></ul>',"</div>"]);var n=b.children(".mi-list-plain");l.boundListEl=b;l.listPlainEl=n;p=q.data;if("multi"==l.checkedMode){var e=Mini2.$joinStr(['<li role="option" unselectable="on" class="mi-boundlist-item">','<img class="mi-form-checkbox" src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style="">',"</li>"]);p=q.data;var v=l.value||"";var u=v.split(",");for(c=0,h=u.length;c<h;c++){u[c]=Mini2.String.trim(u[c])}for(c=0,h=p.getCount();c<h;c++){o=p.get(c);m=e.clone();s=l.getItemDisplayText(o);m.append(s+"&nbsp;");m.data("record",o);if(Mini2.Array.contains(u,s,true)){m.addClass("mi-boundlist-item-selected")}$(n).append(m)}f=n.children();l.bindItems_ForMulti(f)}else{var e=$('<li role="option" unselectable="on" class="mi-boundlist-item"></li>');var t,j,k=0;for(c=0,h=p.getCount();c<h;c++){o=p.get(c);m=e.clone();s=l.getItemDisplayText(o);m.html(s+"&nbsp;");t=m.text();j=l.getStrLength(t);k=Math.max(k,j);m.data("record",o);$(n).append(m)}l.maxItemTextLen=k*r.font.chatWidth+16;f=n.children();l.bindItems(f)}d=(d>8?8:d);b.css({height:g*d});return b},itemTpl:['<li role="option" unselectable="on" class="mi-boundlist-item"></li>'],createCloseItemEl:function(e){var c=this,d={},a=c.emptyValue,b=Mini2.$join(c.itemTpl);d[c.valueField]=c.emptyValue;d[c.displayField]="";d[c.itemDisplayField]="[ X ]";d=e.createModel(d);b.addClass("mi-boundlist-empty").html("[ X ]").data("record",d);return b},refresh:function(){var o=this,t=Mini2.SystemInfo,e,b,j=o.itemTpl,c,d=0,p,g,u,s=o.store,r=s.data,q,f=s.getCount(),m=o.listPlainEl,k,v,l,n=0,a=Mini2.SystemInfo.list,h=a.itemHeight||o.itemHeight;m.html("");if(o.emptyEnabled){o.emptyItemEl=c=o.createCloseItemEl(s);$(m).append(c);o.emptyItemHeight=d=$(c).outerHeight()+2}r=s.data;for(e=0,k=r.getCount();e<k;e++){q=r.get(e);p=Mini2.$join(j);u=o.getItemDisplayText(q);if(Mini2.isBlank(u)){u="&nbsp;"}p.html(u);v=p.text();l=o.getStrLength(v);n=Math.max(n,l);p.data("record",q);$(m).append(p)}o.maxItemTextLen=n*t.font.chatWidth+16;g=m.children();o.bindItems(g);f=(f>8?8:f);o.boundListEl.css({height:h*f+d});o.proDropDownPanel_SizeALocal()},getStrLength:function(b){var a=b.match(/[^\x00-\xff]/ig);return b.length+(a==null?0:a.length)},getMultiValues:function(c){var d=this;var a=$(c).children(".mi-boundlist-item-selected");var e="";var b=0;$(a).each(function(){var f=$(this).data("record");var h=f.get(d.valueField);var g=f.get(d.displayField);if(b++>0){e+=","}e+=h});return e},bindItems_ForMulti:function(a){var b=this;$(a).mouseenter(function(){$(this).addClass("mi-boundlist-item-over")}).mouseleave(function(){$(this).removeClass("mi-boundlist-item-over")}).mouseup(function(c){$(this).toggleClass("mi-boundlist-item-selected");var d=b.getMultiValues($(this).parent());if("none"==b.mode){b.hideEl.val(d);b.inputEl.val(d)}else{b.inputEl.val(d)}b.value=d;b.text=d;b.clearInvalid();b.focus();if(b.changed){b.changed.call(b)}b.trigger("changed_callback",{value:value,text:text})})},selectItemToValue:function(b){var e=this,h,g,f=$(b).data("record");if(f.isModel){h=f.get(e.valueField);g=f.get(e.displayField)}else{h=f[e.valueField];g=f[e.displayField]}if("none"==e.mode){e.hideEl.val(h);e.inputEl.val(g)}else{e.inputEl.val(h)}e.curRecord=f;var c=e.store.getJsonForRecord(f);var d=Mini2.Json.toJson(c);e.curRecordEl.val(d);e.value=h;e.text=g;try{e.setMap(f)}catch(a){console.error("设置映射值错误",a)}e.hideDropDownPanel();e.clearInvalid();e.focus();if(e.changed){e.changed.call(e)}e.trigger("changed_callback",{value:h,text:g})},setMap:function(g){var e=this,d=e.mapItems,f=e.ownerParent,h;if(!d){return}if(!f){return}h=f.store;if(!h){return}var a=h.getCurrent();for(var b=0;b<d.length;b++){var c=d[b];if(c&&c.srcField&&c.targetField){var j=g.get(c.srcField);a.set(c.targetField,j)}}},bindItems:function(a){var b=this;$(a).mouseenter(function(){$(this).addClass("mi-boundlist-item-over")}).mouseleave(function(){$(this).removeClass("mi-boundlist-item-over")});$(a).muBind("mousedown",function(c){}).muBind("mouseup",function(c){b.selectItemToValue.call(b,this)})},setValue:function(k){var g=this,h,l=g.valueField,a=g.displayField,c=g.hideEl,i=g.store,j,d=g.inputEl;g.value=k;if("none"==g.mode&&i){try{h=i.filterFirstBy(l,k);if(h){g.curRecord=h;var e=i.getJsonForRecord(h);var f=Mini2.Json.toJson(e);g.curRecordEl.val(f);j=h.get(a);d.val(j)}else{d.val(k)}}catch(b){alert("错误啦。"+b.Message)}}else{d.val(k)}if(c){c.val(k)}},getValue:function(){var c=this,b=c.log,a=c.hideEl,d;if(c.readOnly||"none"==c.mode){d=a.val()}else{d=c.inputEl.val()}b.debug("getValue() return "+d);c.value=d;return d},proDropDownPanel_SizeALocal:function(){var h=this,c=h.el,d=h.fieldEl,j,i,m,f,n=$(window).height(),a,k,e,l,b=Mini2.SystemInfo.list,g=b.itemHeight||h.itemHeight;j=h.dropDownPanel;i=d.offset();e=d.outerWidth()+2;m=h.dropDownWidth||h.maxItemTextLen||e;m=Math.max(m,e);f=h.store.getCount();if(f>8){f=8;m+=20}l=g*f+h.emptyItemHeight;a=(i.top+d.height()-2)+l;if(a>n){k=i.top-l}else{k=i.top+d.height()+1}j.css({"border-width":1,width:m,height:l,left:i.left,top:k}).show();return h},isFirstCursorPos:function(){return true},isLastCursorPos:function(){return true},proKeyEvent:function(c){var g=this,b=g.dropDownPanel,f=$(g.listPlainEl),d=c.keyCode,a="mi-boundlist";if(Mini2.onwerPage.typeahead.length){return}if(40==d){if(!b||b.is(":hidden")){g.beforeShowDropDownPanel();g.showDropDownPanel()}var h=$(f).children(".mi-boundlist-selected");h.removeClass("mi-boundlist-selected");if(h.length==0){h=f.children(".mi-boundlist-item:first")}else{h=h.next(".mi-boundlist-item")}h.addClass("mi-boundlist-selected");Mini2.EventManager.stopEvent(c);c.stoped=true}else{if(38==d){if(!b||b.is(":hidden")){g.beforeShowDropDownPanel();g.showDropDownPanel()}var h=$(f).children(".mi-boundlist-selected");h.removeClass("mi-boundlist-selected");if(h.length==0){h=f.children(".mi-boundlist-item:last")}else{h=h.prev(".mi-boundlist-item")}h.addClass("mi-boundlist-selected");Mini2.EventManager.stopEvent(c);c.stoped=true}else{if(13==d){if(!b||b.is(":hidden")){return}var h=$(f).children(".mi-boundlist-selected");g.selectItemToValue.call(g,h);Mini2.EventManager.stopEvent(c);c.stoped=true}}}},getSentData:function(){var a=this,c={},b=a.remoteParams;if(b&&b.length){$(b).each(function(){var f=this;if("query_string"==f.role){var h=$.query.get(f.queryStringField);c[f.name]=h}else{if("control"==f.role){var e=Mini2.find(f.control);var i=e.getValue();c[f.name]=i}else{var g=f["default"];if(g.indexOf("{{")>=0&&g.indexOf("}}")){var d=template.compile(g);var j=d({T:{"未定义":""}});c[f.name]=j}else{c[f.name]=g}}}})}return c},showDropDownPanel:function(){var g=this,b=g.el,d=g.fieldEl,i,h,m,f,n=$(window).height(),a,j,e,l;g.init_DropDwonPanel();i=g.dropDownPanel;if(g.remoteEnabled){var k=g.getSentData();Mini2.post(g.remoteUrl,k,function(o){var p=g.store;p.removeAll();p.add(o);g.refresh()})}if(g.dropDown){try{g.dropDown.call(g,g)}catch(c){throw new Error("执行 Trigger.dropDown(...) 事件发生错误")}}g.proDropDownPanel_SizeALocal();return g},render:function(){var b=this,a="td.mi-form-item-body:first";b.baseRender();b.appendCell(b.el,b.curRecordEl,a);b.el.data("me",b)}});
Mini2.define("Mini2.ui.form.field.ComboGrid",{extend:"Mini2.ui.form.field.Trigger",alias:"widget.combogrid",log:Mini2.Logger.getLogger("Mini2.ui.form.field.ComboGrid",true),dropDownPanel:null,grid:null,store:null,dropDownWidth:500,dropDownHeight:400,valueField:"value",delayLoad:true,initComponent:function(){var a=this;a.fieldCls="mi-form-type-text";$(a).muBind("focusout",function(){a.fieldEl.removeClass("mi-form-focus");a.el.removeClass("mi-form-trigger-wrap-focus");a.hideDropDownPanel();a.clearInvalid()});a.initStore();a.initLabelable()},beforeShowDropDownPanel:function(){var b=this;if(!b.isCustom&&!b.content){b.content=b.initGrid()}if(b.content){b.initContentPanel()}if(!b.isCustom){b.init_DropDwonPanel();var c=b.dropDownPanel;var a=b.getBoundPanel();$(c).children().remove();$(c).append(a)}},store_currentChanged:function(b,d,i){var f=b.data,c="mi-grid-row-focused",j,k,l=$(f.tbodyEl).children(),e=f.lastRowFocused,a=null;if(d>-1){var m=i.get(f.valueField);f.setValue(m);if(f.ownerParent&&f.ownerParent.store){var h=f.ownerParent.store;var g=h.current;$(f.mapItems).each(function(){var n=this.srcField;var p=this.targetField;var o=i.get(n);g.set(p,o)})}}},initGrid:function(){var d=this,a=Mini2.getBody(),e,b=d.delayLoad;e=$('<div class="mi-boundlist mi-box-target" style="display:none;"></div>');e.css({width:d.dropDownWidth,height:d.dropDownHeight});$(a).append(e);if(!d.store){var f=Mini2.create("Mini2.data.Store",{pageSize:0,totalCount:0,jsonMode:"sample",model:"Mini2.data.FreeModel",fields:d.fields,data:d.data});d.store=f}$(d.store).muBind("currentchanged",d,d.store_currentChanged);if(undefined==b||null==b){b=true}var c=Mini2.create("Mini2.ui.panel.Table",{scope:d,delayLoad:b,renderTo:e,store:d.store,checkedMode:"SINGLE",focusBorders:false,scroll:"auto",columnLines:false,dock:"full",selType:"checkBoxModel",readOnly:true,autoRowCheck:true,columns:d.columns});c.render();c.setSize(e.width(),e.height());e.muBind("mousedown",function(g){Mini2.EventManager.stopEvent(g)});return e}});
Mini2.define("Mini2.ui.form.field.ComboTree",{extend:"Mini2.ui.form.field.Trigger",alias:"widget.combotree",log:Mini2.Logger.getLogger("Mini2.ui.form.field.ComboTree",true),dropDownPanel:null,grid:null,store:null,dropDownWidth:200,dropDownHeight:300,valueField:"value",initComponent:function(){var a=this;a.fieldCls="mi-form-type-text";$(a).muBind("focusout",function(){a.fieldEl.removeClass("mi-form-focus");a.el.removeClass("mi-form-trigger-wrap-focus");a.hideDropDownPanel();a.clearInvalid()});a.initStore();a.initLabelable()},callRemoteData:function(){var a=this,c=a.store;console.debug("开始加载远程数据...",a.remoteUrl);var b={parent_id:a.rootValue};Mini2.post(a.remoteUrl,b,function(d){console.debug("数据回来了...",d);c.add(d)})},beforeShowDropDownPanel:function(){var b=this;if(!b.isCustom&&!b.content){b.content=b.initTree();if(b.remoteEnabled){b.callRemoteData()}}if(b.content){b.initContentPanel()}if(!b.isCustom){b.init_DropDwonPanel();var c=b.dropDownPanel;var a=b.getBoundPanel();$(c).children().remove();$(c).append(a)}},store_currentChanged:function(b,e,h){var g=b.data,d="mi-grid-row-focused",i,j,k=$(g.tbodyEl).children(),f=g.lastRowFocused,a=null;if(e>-1){var c=g.valueField,l;if(h.get){l=h.get(c)}else{l=h[c]}g.setValue(l)}},initTree:function(){var b=this,a=Mini2.getBody(),d=b.store,c;c=$('<div class="mi-boundlist mi-box-target" style="display:none;"></div>');c.css({width:b.dropDownWidth,height:b.dropDownHeight});$(a).append(c);if(!d){d=Mini2.create("Mini2.data.TreeStore",{id:"store"+Mini2.newId(),remoteEnabled:b.remoteEnabled,remoteUrl:b.remoteUrl,pageSize:0,totalCount:0,jsonMode:"sample",model:"Mini2.data.FreeModel",idField:b.idField,parentField:b.parField,textField:b.displayField,rootValue:b.rootValue,rootText:b.rootText,sortText:b.sortText,fields:b.fields,data:b.data});b.store=d}$(d).muBind("currentchanged",b,b.store_currentChanged);var e=Mini2.create("Mini2.ui.tree.Panel",{id:"tree"+Mini2.newId(),renderTo:c,store:d,remoteEnabled:b.remoteEnabled,remoteUrl:b.remoteUrl,scroll:"auto",dock:"full",region:"north",rootId:b.rootValue,idField:b.idField,parField:b.parField,valueField:b.valueField,textField:b.displayField,triggerEvent_selected:false,triggerEvent_create:false,triggerEvent_remove:false,triggerEvent_rename:false,types:{"default":{icon:"/res/icon/application_view_columns.png"},table:{icon:"/res/icon/table.png"},view:{icon:"/res/icon/view.png"}},contextMenu:[],event_selected:false,event_move:false,isTree:true});e.render();e.setSize(c.width(),c.height());c.muBind("mousedown",function(f){Mini2.EventManager.stopEvent(f)});return c},});
Mini2.define("Mini2.ui.form.field.Date",{extend:"Mini2.ui.form.field.Trigger",alias:"widget.date",log:Mini2.Logger.getLogger("Mini2.ui.form.field.Date",false),displayField:"text",valueField:"value",isLoaded:false,dateEl:null,defaultValue:null,useStrict:undefined,format:"Y-m-d",initTimeFormat:"H",initTime:"24",showTime:false,timeEl:null,buttonCls:"mi-icon-date-trigger",setWidth:function(c){var b=this,a=b.el;b.width=c,a.css("width",c)},getWidth:function(){return this.width},getTriggerMarkup:function(){var a=this,b=Mini2.$join(['<div class="mi-layer mi-border-box" style="z-index:39001;" >',"</div>"]);return b},focus:function(){var c=this,a=c.el,b=c.fieldEl;if(!a.hasClass("mi-form-trigger-wrap-focus")){b.addClass("mi-form-focus");a.addClass("mi-form-trigger-wrap-focus");if(!c._focusTimeout){if(c.inputEl){c._focusTimeout=setTimeout(function(){var d=c.inputEl;if(b.hasClass("mi-form-focus")){d.focus()}c._focusTimeout=null},200)}}Mini2.ui.FocusManager.setControl(c.scope||c,null,null,true)}},getFieldEl_Native:function(){var e=this,a=Mini2.$join,d=e.log,g,c,b,f=Mini2.SystemInfo.formTrigger;if(e.showTime){e.inputEl=c=a(['<input type="datetime-local" class="mi-form-field mi-form-text" ','autocomplete="off" aria-invalid="false" style="width: 100%; ">'])}else{e.inputEl=c=a(['<input type="date" class="mi-form-field mi-form-text" ','autocomplete="off" aria-invalid="false" style="width: 100%; ">'])}g=e.inputEl;c.attr("id",e.clientId);if(e.name){c.attr("name",e.name)}$(c).change(function(){});$(c).muBind("focus",function(){e.focus()});$(c).muBind("click",function(){e.focus()});return g},getFieldEl_M2:function(){var e=this,a=Mini2.$join,d=e.log,g,c,b,f=Mini2.SystemInfo.formTrigger;g=a(['<table class="mi-form-trigger-wrap" cellpadding="0" cellspacing="0" style="table-layout: fixed; width: 100%; ">',"<tbody>","<tr>",'<td class="mi-form-trigger-input-cell" style="width: 100%; "></td>','<td valign="top" class="mi-trigger-cell mi-unselectable" style="width:22px;" role="button" ></td>',"</tr>","</tbody>","</table>"]);e.inputEl=c=a(['<input type="text" class="mi-form-field mi-form-text" ','autocomplete="off" aria-invalid="false" style="width: 100%; ">']);if(!Mini2.isBlank(e.placeholder)){c.attr("placeholder",e.placeholder)}if(e.required){c.addClass("mi-form-required-field")}b=a(['<div class="mi-form-trigger mi-form-arrow-trigger " role="button"></div>']);e.buttonEl=b;if(e.buttonCls){b.addCls(e.buttonCls)}c.attr("id",e.clientId);if(e.name){c.attr("name",e.name)}e.appendCell(g,c,"td.mi-form-trigger-input-cell");e.appendCell(g,b,"td.mi-trigger-cell");g.find("td.mi-trigger-cell").width(f.width);if(undefined!=e.value){e.setValue(e.value);e.srcValue=e.value;delete e.value}e.bindEvent_Button(b);e.bindInputEl_Mouse(c);e.bindInputEl_Key(c);e.bindInputEl_Mouse2(c);$(e).on("keydown",function(h,i){if(13==i.keyCode&&e.mapping){e.onMaping();i.cancel=true}});return g},getFieldEl:function(){var e=this,a=Mini2.$join,d=e.log,g,c,b,f=Mini2.SystemInfo.formTrigger;if("touch"==Mini2.SystemInfo.mode||Mini2.support.ipad||Mini2.support.iphone){g=e.getFieldEl_Native()}else{g=e.getFieldEl_M2()}if("none"==e.mode){e.setMode(true)}return g},callDatepickerShow:function(a){var b=this;b.initLocalMessage();$.datepicker.formatDate("yy-mm-dd",new Date());$(a).datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,showOn:"",buttonImageOnly:false,showOptions:{direction:""},showButtonPanel:true,inline:false,onSelect:function(c,d){if(b.showTime){var e=c+" "+b.timeEl.val();b.inputEl.val(e)}else{b.inputEl.val(c)}b.hideDropDownPanel();b.focus();b.clearInvalid()}})},initTimeBox:function(){var a=this,b=a.dropDownPanel;if(a.showTime&&!a.timeEl){var c=Mini2.$joinStr(['<div class="ui-datepicker-time" style="padding: 3px 0px 0px 6px; background-color: #FFF;">',"<span>时间：</span>",'<input type="text" class="ui-time" style="width:80px;" value="12:59:59" />',"</div>"]);$(b).append(c);a.timeEl=c.find(".ui-time:first")}},initCloseBtn:function(){var c=this;var a=$(c.dateEl).find(".ui-datepicker-buttonpane:first");if(a.children(".ui-datepicker-close").length>0){return}var b=Mini2.$joinStr(["<button type='button' ","class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' ","data-handler='hide' data-event='click'>关闭</button>"]);$(a).append(b);$(b).click(function(){c.hideDropDownPanel()})},getBoundPanel:function(){var a=this;a.dateEl=Mini2.$joinStr(['<div style="font-size:12px; "></div>']);if($.fn.datepicker){a.callDatepickerShow(a.dateEl)}else{In("jq.ui.datepicker",function(){a.callDatepickerShow.call(a,a.dateEl)})}return a.dateEl},beforeShowDropDownPanel:function(){var b=this;b.init_DropDwonPanel();if(b.isLoaded){b.initCloseBtn();b.initTimeBox();console.debug("me.dateEl",b.dateEl);return}var c=b.dropDownPanel;var a=b.getBoundPanel();$(c).children().remove();$(c).append(a);b.initCloseBtn();b.initTimeBox();b.isLoaded=true},loadDataPicker:function(){var h=this,g=h.log,d=h.el,f=h.fieldEl,k,b=h.dateEl,i=h.dropDownPanel,r=$(window).height(),j,a,n,o=h.timeEl;k=f.offset();var c=h.inputEl.val();if(h.pw==undefined||h.ph==undefined){h.pw=b.width();h.ph=b.height()}$(b).datepicker("setDate",c);if(o){if(c==""){o.val("00:00:00")}else{if(Mini2.support.msie||Mini2.support.mozilla){c=c.replace(/-/g,"/")}var q=new Date(c);var p=Mini2.Date.format(q,"H:i:s");o.val(p)}}n=h.ph;if(h.showTime){n+=30}a=(k.top+d.height()-2)+n;if(a>r){j=k.top-n}else{j=k.top+d.height()-1}var e=d.width();var m=k.left+f.width()-$(i).width()+2;var l=h.ph;if(h.showTime){l+=30}g.debug("posX",m);i.css({width:h.pw,height:l,left:m,top:j});i.show()},initLocalMessage:function(){if($.datepicker.regional["zh-CN"]){return}$.datepicker.regional["zh-CN"]={closeText:"关闭",prevText:"&#x3C;上月",nextText:"下月&#x3E;",currentText:"今天",monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],weekHeader:"周",dateFormat:"yy-mm-dd",firstDay:1,isRTL:false,showMonthAfterYear:true,yearSuffix:"年"};$.datepicker.setDefaults($.datepicker.regional["zh-CN"])},showDropDownPanel:function(){var a=this;a.init_DropDwonPanel();if($.fn.datepicker){a.loadDataPicker()}else{In("jq.ui.datepicker",function(){a.loadDataPicker.call(a)})}},parseDate:function(g){if(!g||Mini2.isDate(g)){return g}var e=this,f=e.safeParse(g,e.format),a=e.altFormats,b=e.altFormatsArray,c=0,d;if(!f&&a){b=b||a.split("|");d=b.length;for(;c<d&&!f;++c){f=e.safeParse(g,b[c])}}return f},safeParse:function(h,a){var c=this,b=c.log,g=Mini2.Date,e=null,f=c.useStrict,d;if(g.formatContainsHourInfo(a)){e=g.parse(h,a,f)}else{d=g.parse(h+" "+c.initTime,a+" "+c.initTimeFormat,f);b.debug(a+" "+c.initTimeFormat);if(d){e=g.clearTime(d)}}return e},setOldValue:function(j){var d=this,k=j,g=Mini2.support,h="";if(!j){d.oldValue="";return}if(Mini2.isDate(k)){if(d.showTime){k=Mini2.Date.format(j,"Y-m-d\\TH:i:s")}else{k=Mini2.Date.format(i,"Y-m-d")}h=Mini2.Date.format(j,"H:i:s")}else{if(Mini2.isString(k)){if(k!=""){if("touch"==Mini2.SystemInfo.mode||g.ipad||g.iphone){var i=new Date(k);if(d.showTime){k=Mini2.Date.format(i,"Y-m-d\\TH:i:s")}else{k=Mini2.Date.format(i,"Y-m-d")}}else{if(g.mozilla){var e=j.lastIndexOf("."),b,f,a;if(e>0){b=j.substring(0,e);f=j.substr(e+1);b=b.replace(/-/g,"/");a=new Date(b);try{a.setMilliseconds(f)}catch(c){console.log("错误啦...."+c.message)}j=a}k=Mini2.Date.format(j,d.format)}else{var i=new Date(k);k=Mini2.Date.format(i,d.format)}}}}}d.oldValue=k},getValue:function(){var b=this,c=Mini2.support,a=b.defaultValue,e,d=b.constructor.base.getValue.call(b);if(d==""){return b.defaultValue}if("touch"==Mini2.SystemInfo.mode||c.ipad||c.iphone){d=b.inputEl.val();return d}else{d=b.constructor.base.getValue.call(b);if(d==""){return b.defaultValue}d=new Date(d);d=Mini2.Date.format(d,b.format)}return d},setValue:function(j){var d=this,g=Mini2.support,k=j,h="";if(!j){d.constructor.base.setValue.call(d,"");return}if(Mini2.isDate(k)){if(d.showTime){k=Mini2.Date.format(j,"Y-m-d\\TH:i:s")}else{k=Mini2.Date.format(i,"Y-m-d")}h=Mini2.Date.format(j,"H:i:s")}else{if(Mini2.isString(k)){if(k!=""){if("touch"==Mini2.SystemInfo.mode||g.ipad||g.iphone){if(k.indexOf("T")>0){d.inputEl.val(k)}else{console.debug("转化类型前1, ",k);var i=new Date(k);console.debug("转化类型后2, ",i);if(d.showTime){k=Mini2.Date.format(i,"Y-m-d\\TH:i:s")}else{k=Mini2.Date.format(i,"Y-m-d")}console.debug("转化类型后, ",k);d.inputEl.val(k)}return}else{if(g.mozilla){var e=j.lastIndexOf("."),b,f,a;if(e>0){b=j.substring(0,e);f=j.substr(e+1);b=b.replace(/-/g,"/");a=new Date(b);try{a.setMilliseconds(f)}catch(c){console.log("错误啦...."+c.message)}j=a}else{j=new Date(j)}k=Mini2.Date.format(j,d.format)}else{var i=new Date(k);k=Mini2.Date.format(i,d.format)}}}}}d.constructor.base.setValue.call(d,k)},isValueChanged:function(){var c=this,b=c.log,d=c.oldValue,a=c.getValue();if(undefined===d||""==d){d=null}if(undefined===a||""==a){a=null}return d!=a},proDropDownPanel_SizeALocal:function(){var f=this,b=f.el,c=f.fieldEl,h,g,k,e,l=$(window).height(),a,i,d,j;h=f.dropDownPanel;g=c.offset();d=c.width();k=f.dropDownWidth||d;if(k<d){k=d}e=f.store.getCount();if(e>8){e=8}j=24*e;a=(g.top+b.height()-2)+j;if(a>l){i=g.top-j}else{i=g.top+b.height()-2}h.css({"border-width":1,width:k,height:j,left:g.left,top:i}).show();return f}});
Mini2.define("Mini2.ui.form.field.DateRange",{extend:"Mini2.ui.form.field.Base",alias:"widget.daterange",isRangeControl:true,startItem:null,endItem:null,startCellEl:null,endCellEl:null,initComponent:function(){var a=this;a.initLabelable()},getFieldEl:function(){var b=this,e,c,d,a;e=Mini2.$joinStr(['<table class="mi-table-plain"  cellpadding="0" cellspacing="0" border="0" role="presentation" style="table-layout: auto;">',"<tbody>","<tr>",'<td class="mi-item-cell-start"></td>',"<td>&nbsp;-&nbsp;</td>",'<td class="mi-item-cell-end"></td>',"</tr>","</tbody>","</table>"]);c=e.find("tr:first");b.startCellEl=d=c.children(".mi-item-cell-start");b.endCellEl=a=c.children(".mi-item-cell-end");b.startItem=Mini2.create("Mini2.ui.form.field.Date",{renderTo:d,hideLabel:true,value:b.startValue,clientId:b.clientId+"_Start",name:b.name+"_Start"});b.endItem=Mini2.create("Mini2.ui.form.field.Date",{renderTo:a,hideLabel:true,value:b.endValue,clientId:b.clientId+"_End",name:b.name+"_End"});return e},setStartValue:function(c){var a=this,b=a.startItem;b.setValue(c);return a},getStartValue:function(){var a=this,b=a.startItem;return b.getValue()},setEndValue:function(c){var b=this,a=b.endItem;a.setValue(c);return b},getEndValue:function(){var b=this,a=b.endItem;return a.getValue()},setOldValue:function(b,c){var a=this;if("start"==b){a.startItem.setOldValue(c)}else{if("end"==b){a.endItem.setOldValue(c)}else{throw new Error('无效类型, 参数只有 ["start" | "end"] 两个选择. 用户输入: '+b)}}return a},setValue:function(b,c){var a=this;if("start"==b){a.startItem.setValue(c)}else{if("end"==b){a.endItem.setValue(c)}else{throw new Error('无效类型, 参数只有 ["start" | "end"] 两个选择. 用户输入: '+b)}}return a},getValue:function(b){var a=this;if("start"==b){return a.startItem.getValue()}else{if("end"==b){return a.endItem.getValue()}else{}}},setDirty:function(d,a){var c=this,e=c.startItem,b=c.endItem;if("start"==d){e.setDirty(a)}else{if("end"==d){b.setDirty(a)}else{throw new Error('无效类型, 参数只有 ["start" | "end"] 两个选择. 用户输入: '+d)}}return c},isValueChanged:function(c){var b=this,d=b.startItem,a=b.endItem;if(c){if("start"==c){return d.isValueChanged()}else{if("end"==c){return a.isValueChanged()}else{throw new Error('无效类型, 参数只有 ["start" | "end"] 两个选择. 用户输入: '+c)}}}else{return(d.isValueChanged()||a.isValueChanged())}},render:function(){var c=this,a="td.mi-form-item-body:first",d,b;d=c.getTableContainer();b=c.getFieldEl();if(c.applyTo){$(c.applyTo).replaceWith(d)}else{$(c.renderTo).append(d)}c.appendCell(d,b,a);c.renderForLableable(d);c.startItem.render();c.endItem.render();$(c.startItem).muBind("focusout",function(f){var g=c.startItem.getValue();$(c).muTriggerHandler("focusout",[{sender:this,target:null,data:g}])});$(c.endItem).muBind("focusout",function(f){var g=c.endItem.getValue();$(c).muTriggerHandler("focusout",[{sender:this,target:null,data:g}])});c.el=d;d.data("me",c)}});
Mini2.define("Mini2.ui.form.field.Time",{extend:"Mini2.ui.form.field.Text",inputTpl:['<table class="mi-form-trigger-wrap" cellpadding="0" cellspacing="0" style="table-layout: fixed;">',"<tr>",'<td style="">','<input type="text" class="mi-form-time-hour" style="width:100%; font-size:15px; border:none; " value="0:0" maxLength="5" />',"</td>",'<td style="display:none;">','<input type="hidden" class="mi-form-timepicker-input" />',"</td>","</tr>","</table>"],initComponent:function(){var b=this,a=b.log;$(b).muBind("focusout",function(){if(b._focusTimeout){clearTimeout(b._focusTimeout);delete b._focusTimeout}if(b.fieldEl){b.fieldEl.removeClass("mi-form-focus").trigger("blur")}b.el.removeClass("mi-form-trigger-wrap-focus");b.on("hided");b.clearInvalid();if(b.clearBtnEl){b.clearBtnEl.hide()}});b.initLabelable()},numVaue:0,getTimeObj:function(f){var c=this;if(Mini2.isNumber(f)){var b=f%3600;var e=b%60;var a=(f-b)/3600;var d=(b-e)/60;return{hour:a,minute:d,sec:e}}else{}},setValue:function(d){var b=this,a=b.hideEl;if(Mini2.isBlank(d)){b.numVaue=null;b.hideValueEl.val("");b.hourEl.val("");return b}if(Mini2.isNumber(d)){var c=b.getTimeObj(d);b.numVaue=d;b.hideValueEl.val(d);b.hourEl.val(c.hour+":"+c.minute);if(a){a.val(d)}}else{}return b},textToNum:function(c){var b=c.split(":");var a=0;a+=parseInt(b[0])*3600;a+=parseInt(b[1])*60;if(b[2]){a+=parseInt(b[2])}return a},getValue:function(c){var a=this;var b=a.hourEl.val();if(Mini2.isBlank(b)){return null}a.numVaue=a.textToNum(b);return a.numVaue},getFieldEl:function(){var e=this,b,d,f,a=e.checkedCls;e.inputEl=d=Mini2.$join(e.inputTpl);e.hideValueEl=b=d.find(".mi-form-timepicker-input");b.attr("id",e.clientId);b.attr("name",e.name);b.attr("value",e.value);var c=d.find(".mi-form-time-hour");e.hourEl=c;e.bindInputEl_Mouse(c);return d}});
Mini2.define("Mini2.ui.form.field.Number",{extend:"Mini2.ui.form.field.Text",alias:"widget.number",log:Mini2.Logger.getLogger("Mini2.ui.form.field.Number"),allowDecimals:true,decimalSeparator:".",submitLocaleSeparator:true,decimalPrecision:2,minValue:-1000000000,maxValue:1000000000,step:1,direction:"h",value:0,defaultValue:0,align:"right",initComponent:function(){var b=this,a=b.log;$(b).muBind("focusout",function(){var c=b.getValue();var d=Mini2.Number.from(c,b.defaultValue);if(d<b.minValue){b.setValue(b.minValue)}else{if(d>b.maxValue){b.setValue(b.maxValue)}else{b.setValue(d)}}if(b._focusTimeout){clearTimeout(b._focusTimeout);delete b._focusTimeout}b.fieldEl.removeClass("mi-form-focus");b.el.removeClass("mi-form-trigger-wrap-focus");b.clearInvalid()});b.initLabelable()},getValue:function(){var b=this,a=b.defaultValue;var c=this.constructor.base.getValue.call(this);if(c==""){return 0}c=Mini2.Number.from(c,a);return c},setMinValue:function(c){var b=this,a;b.minValue=Mini2.Number.from(c,Number.NEGATIVE_INFINITY);b.toggleSpinners();if(b.disableKeyFilter!==true){a=b.baseChars+"";if(b.allowExponential){a+=b.decimalSeparator+"e+-"}else{if(b.allowDecimals){a+=b.decimalSeparator}if(b.minValue<0){a+="-"}}a=Mini2.String.escapeRegex(a);b.maskRe=new RegExp("["+a+"]");if(b.autoStripChars){b.stripCharsRe=new RegExp("[^"+a+"]","gi")}}},setMaxValue:function(a){this.maxValue=Mini2.Number.from(a,Number.MAX_VALUE);this.toggleSpinners()},toggleSpinners:function(){var b=this,c=b.getValue(),d=c===null,a;if(b.spinUpEnabled||b.spinUpDisabledByToggle){a=d||c<b.maxValue;b.setSpinUpEnabled(a,true)}if(b.spinDownEnabled||b.spinDownDisabledByToggle){a=d||c>b.minValue;b.setSpinDownEnabled(a,true)}},rawToValue:function(a){var b=this.fixPrecision(this.parseValue(a));if(b===null){b=a||null}return b},valueToRaw:function(c){var b=this,a=b.decimalSeparator;c=b.parseValue(c);c=b.fixPrecision(c);c=Mini2.isNumber(c)?c:parseFloat(String(c).replace(a,"."));c=isNaN(c)?"":String(c).replace(".",a);return c},parseValue:function(a){a=parseFloat(String(a).replace(this.decimalSeparator,"."));return isNaN(a)?null:a},fixPrecision:function(d){var a=this,b=isNaN(d),c=a.decimalPrecision;if(b||!d){return b?"":d}else{if(!a.allowDecimals||c<=0){c=0}}return parseFloat(Mini2.Number.toFixed(parseFloat(d),c))},setSpinValue:function(c){var b=this,a;b.setValue(c)},onSpinUp:function(){var a=this;if(!a.readOnly){a.setSpinValue(Mini2.Number.constrain(a.getValue()+a.step,a.minValue,a.maxValue))}},onSpinDown:function(){var a=this;if(!a.readOnly){a.setSpinValue(Mini2.Number.constrain(a.getValue()-a.step,a.minValue,a.maxValue))}},spinUpEnabled:function(a){var b=this;if(a){b.onSpinUp();if(!b.spinUpDisabledByToggle){b.spinUpDisabledByToggle=setInterval(function(){b.onSpinUp()},200)}}else{if(b.spinUpDisabledByToggle){clearInterval(b.spinUpDisabledByToggle);delete b.spinUpDisabledByToggle}}},spinDownEnabled:function(a){var b=this;if(a){b.onSpinDown();if(!b.spinDownDisabledByToggle){b.spinDownDisabledByToggle=setInterval(function(){b.onSpinDown()},200)}}else{if(b.spinDownDisabledByToggle){clearInterval(b.spinDownDisabledByToggle);delete b.spinDownDisabledByToggle}}},btnUp_Click:function(a){var b=a.data;b.onSpinUp();b.focus();Mini2.EventManager.stopEvent(a)},btnDown_Click:function(a){var b=a.data;b.onSpinDown();b.focus();Mini2.EventManager.stopEvent(a)},bindInputEl_Key:function(a){var b=this;$(a).on("keydown",function(c){var d=c.keyCode;if(107==d){b.onSpinUp();Mini2.EventManager.stopEvent(c)}else{if(109==d){b.onSpinDown();Mini2.EventManager.stopEvent(c)}else{b.on("keydown",c)}}}).on("keyup",function(c){b.on("keyup",c)}).on("keypress",function(c){b.on("keypress",c)})},getFieldEl_ForComputer:function(){var d=this,c;var e=Mini2.$join(['<table class="mi-form-trigger-wrap" cellpadding="0" cellspacing="0" style="table-layout: fixed; width: 100%; ">',"<tbody>","<tr>",'<td class="mi-form-trigger-input-cell" style="width: 100%; "></td>','<td valign="top" class="mi-trigger-cell"></td>',"</tr>","</tbody>","</table>"]);c=Mini2.$join(['<input type="text" class="mi-form-field mi-form-text" ','autocomplete="off" aria-invalid="false"  style="width: 100%; ">']);var b=Mini2.$join(['<div class="mi-trigger-index-0 mi-form-trigger mi-form-spinner-up" role="button"></div>']);var a=Mini2.$join(['<div class="mi-trigger-index-1 mi-form-trigger mi-form-spinner-down" role="button"></div>']);c.attr("id",d.clientId);c.val(d.value);if(d.name){c.attr("name",d.name)}d.appendCell(e,c,"td.mi-form-trigger-input-cell");d.appendCell(e,b,"td.mi-trigger-cell");d.appendCell(e,a,"td.mi-trigger-cell");b.muBind("mousedown",d,function(f){d.focus();d.spinUpEnabled(true)});b.muBind("mouseup",d,function(f){d.spinUpEnabled(false);Mini2.EventManager.stopEvent(f)});a.muBind("mousedown",d,function(){d.focus();d.spinDownEnabled(true)});a.muBind("mouseup",d,function(f){d.spinDownEnabled(false);Mini2.EventManager.stopEvent(f)});d.bindInputEl_Mouse(c);d.bindInputEl_Key(c);d.inputEl=c;return e},getFieldEl_ForTouch:function(){var d=this,c;var e=Mini2.$join(['<table class="mi-form-trigger-wrap mi-form-trigger-wrap-touch" cellpadding="0" cellspacing="0" style="table-layout: fixed; width: 100%;padding:0px; ">',"<tbody>","<tr>",'<td valign="" class="mi-trigger-cell mi-trigger-cell-left mi-trigger-down" ></td>','<td class="mi-form-trigger-input-cell" style="width: 100%; "></td>','<td valign="" class="mi-trigger-cell mi-trigger-cell-right mi-trigger-up" ></td>',"</tr>","</tbody>","</table>"]);c=Mini2.$join(['<input type="text" class="mi-form-field mi-form-text" ','autocomplete="off" aria-invalid="false"  style="width: 100%; ">']);var b=Mini2.$join(['<div class="mi-trigger-index-0 mi-form-trigger fa fa-plus" role="button"></div>']);var a=Mini2.$join(['<div class="mi-trigger-index-1 mi-form-trigger  fa fa-minus"  role="button"></div>']);c.attr("id",d.clientId);c.val(d.value);if(d.name){c.attr("name",d.name)}d.appendCell(e,c,"td.mi-form-trigger-input-cell");d.appendCell(e,b,"td.mi-trigger-up");d.appendCell(e,a,"td.mi-trigger-down");b.muBind("mousedown",d,function(f){d.focus();d.spinUpEnabled(true)});b.muBind("mouseup",d,function(f){d.spinUpEnabled(false);Mini2.EventManager.stopEvent(f)});a.muBind("mousedown",d,function(){d.focus();d.spinDownEnabled(true)});a.muBind("mouseup",d,function(f){d.spinDownEnabled(false);Mini2.EventManager.stopEvent(f)});d.bindInputEl_Mouse(c);d.bindInputEl_Key(c);d.inputEl=c;return e},getFieldEl_ForTouch_V:function(){var d=this,c;var e=Mini2.$join(['<table class="mi-form-trigger-wrap mi-form-trigger-wrap-vertical" cellpadding="0" cellspacing="0" style="table-layout: fixed;padding:0px; ">',"<tbody>","<tr>",'<td valign="" class="mi-trigger-cell mi-trigger-cell-top mi-trigger-up" style="background-color:#EEE;" ></td>',"</tr>","<tr>",'<td class="mi-form-trigger-input-cell" style="width: 100%; "></td>',"</tr>","<tr>",'<td valign="" class="mi-trigger-cell mi-trigger-cell-bottom mi-trigger-down" style="background-color:#EEE;" ></td>',"</tr>","</tbody>","</table>"]);c=Mini2.$join(['<input type="text" class="mi-form-field mi-form-text" ','autocomplete="off" aria-invalid="false"  style="width: 100%; ">']);var b=Mini2.$join(['<div class="mi-trigger-index-0 mi-form-trigger mi-form-spinner-up" role="button" style="margin: auto;background-color:#EEE;"></div>']);var a=Mini2.$join(['<div class="mi-trigger-index-1 mi-form-trigger  mi-form-spinner-down"  role="button" style="margin: auto;background-color:#EEE;"></div>']);c.attr("id",d.clientId);c.val(d.value);if(d.name){c.attr("name",d.name)}d.appendCell(e,c,"td.mi-form-trigger-input-cell");d.appendCell(e,b,"td.mi-trigger-up");d.appendCell(e,a,"td.mi-trigger-down");b.muBind("mousedown",d,function(f){d.focus();d.spinUpEnabled(true)});b.muBind("mouseup",d,function(f){d.spinUpEnabled(false);Mini2.EventManager.stopEvent(f)});a.muBind("mousedown",d,function(){d.focus();d.spinDownEnabled(true)});a.muBind("mouseup",d,function(f){d.spinDownEnabled(false);Mini2.EventManager.stopEvent(f)});d.bindInputEl_Mouse(c);d.bindInputEl_Key(c);d.inputEl=c;return e},getFieldEl:function(){var b=this,c,a=b.deviceType;if("auto"===a){if("touch"==Mini2.SystemInfo.mode){a="touch"}}if("v"===b.direction||"vertical"===b.direction){c=b.getFieldEl_ForTouch_V()}else{if("auto"===a||"computer"===a){c=b.getFieldEl_ForComputer()}else{if("touch"===a){c=b.getFieldEl_ForTouch()}}}return c},render:function(){var a=this;a.baseRender();a.el.attr("data-muid",a.muid);a.el.data("me",a)}});
Mini2.define("Mini2.ui.form.field.NumRange",{extend:"Mini2.ui.form.field.Base",alias:"widget.numrange",isRangeControl:true,startItem:null,endItem:null,startCellEl:null,endCellEl:null,startValue:"",endValue:"",allowBlank:true,getFieldEl:function(){var b=this,e,c,d,a;e=Mini2.$joinStr(['<table class="mi-table-plain"  cellpadding="0" cellspacing="0" border="0" role="presentation" style="table-layout: auto;">',"<tbody>","<tr>",'<td class="mi-item-cell-start"></td>',"<td>&nbsp;-&nbsp;</td>",'<td class="mi-item-cell-end"></td>',"</tr>","</tbody>","</table>"]);c=e.find("tr:first");b.startCellEl=d=c.children(".mi-item-cell-start");b.endCellEl=a=c.children(".mi-item-cell-end");b.startItem=Mini2.create("Mini2.ui.form.field.Number",{renderTo:d,hideLabel:true,clientId:b.clientId+"_Start",name:b.name+"_Start",allowBlank:b.allowBlank,value:b.startValue});b.endItem=Mini2.create("Mini2.ui.form.field.Number",{renderTo:a,hideLabel:true,clientId:b.clientId+"_End",name:b.name+"_End",allowBlank:b.allowBlank,value:b.endValue});return e},setStartValue:function(c){var a=this,b=a.startItem;b.setValue(c);return a},getStartValue:function(){var a=this,b=a.startItem;return b.getValue()},setEndValue:function(c){var b=this,a=b.endItem;a.setValue(c);return b},getEndValue:function(){var b=this,a=b.endItem;return a.getValue()},setValue:function(b){var a=this;return a},getValue:function(){},focus:function(){var c=this,a=c.fieldEl,b=c.startItem;Mini2.ui.FocusMgr.setControl(c.scope||c);if(!c.readOnly&&b&&b.focus){setTimeout(function(){b.focus()},200)}return c},render:function(){var c=this,a="td.mi-form-item-body:first",d,b;d=c.getTableContainer();b=c.getFieldEl();if(c.applyTo){$(c.applyTo).replaceWith(d)}else{$(c.renderTo).append(d)}c.appendCell(d,b,a);c.renderForLableable(d);c.startItem.render();c.endItem.render();c.el=d;d.data("me",c)}});
Mini2.define("Mini2.ui.form.field.Radio",{extend:"Mini2.ui.form.field.CheckBox",alias:"widget.radio",log:Mini2.Logger.getLogger("Mini2.ui.form.field.Radio"),alternateClassName:"Mini2.ui.form.Radio",fieldCls:Mini2.baseCSSPrefix+"-form-type-radio",focusCls:Mini2.baseCSSPrefix+"form-radio-focus",checkedCls:Mini2.baseCSSPrefix+"form-cb-checked",inputType:"radio",initSrcInput:function(){var a=this;var b=Mini2.$joinStr(['<input type="radio" style="display:none;" />']);b.attr("name",a.name).attr("value",a.inputValue);a.srcInputEl=b},getFieldEl:function(){var b=this,a;b.initSrcInput();b.inputEl=a=Mini2.$joinStr(['<input type="button" class="mi-form-field mi-form-radio mi-form-cb " ','autocomplete="off" ','hidefocus="true" ','aria-invalid="false" ','data-errorqtip="" style="" >']);a.attr("id",b.clientId);$(a).muBind("mousedown",function(c){b.focus();Mini2.EventManager.stopEvent(c)}).muBind("mouseup",function(c){var d=b.el.hasClass(b.checkedCls);if(!d){b.setValue(true)}Mini2.EventManager.stopEvent(c)});return a},renderForBoxLabel:function(d){var c=this,a=c.boxLabel;if(a){var b=Mini2.$joinStr(['<label class="mi-form-cb-label mi-form-cb-label-after" for="',c.clientId,'" >',a,"</label>"]);b.muBind("mousedown",function(f){c.focus()});b.muBind("mouseup",function(f){if(!c.checked){c.setValue(!c.checked)}Mini2.EventManager.stopEvent(f)});c.boxLableEl=b;c.appendCell(d,b,"td.mi-form-item-body:first")}}});
Mini2.define("Mini2.ui.form.field.Image",{extend:"Mini2.ui.form.field.Base",alias:"widget.image",sizeMode:"normal",initEvents:function(){},value:null,getFieldEl:function(){var c=this,d=c.sizeMode,b;c.inputEl=b=Mini2.$joinStr(['<div class="mi-form-field mi-form-image" style="width:100%;height:auto; " >','<img class="mi-form-image-item" src="" />',"</div>"]);b.attr("id",c.clientId);var a=$(b).children(".mi-form-image-item");a.attr("src",c.value);console.log("sizeMode = ",d);if("normal"==d){b.css("overflow","hidden")}else{if("zoom"==d){b.css("width","100%");a.css({width:"100%"})}}if(c.maxHeight){b.css("max-height",c.maxHeight)}if(c.height){b.css("height",c.height)}$(b).muBind("mousedown",function(f){c.focus();Mini2.EventManager.stopEvent(f)}).muBind("mouseup",function(f){Mini2.EventManager.stopEvent(f)});return b},setValue:function(d){var c=this,b=c.inputEl,a=$(b).children(".mi-form-image-item");c.value=d;a.attr("src",d);return d}});
Mini2.define("Mini2.ui.form.field.ClipImage",{extend:"Mini2.ui.form.field.Trigger",alias:"widget.clipimage",log:Mini2.Logger.getLogger("Mini2.ui.form.field.ClipImage",false),sizeMode:"normal",initEvents:function(){},displayField:"text",valueField:"value",value:null,initComponent:function(){var b=this,a=b.log;b.initStore();b.initLabelable()},getFieldEl:function(){var c=this,d=c.sizeMode,b;c.inputEl=b=Mini2.$joinStr(['<div class="mi-form-field mi-form-image" style="width:100%;height:auto; " >','<img class="mi-form-image-item" src="" />',"</div>"]);b.attr("id",c.clientId);var a=$(b).children(".mi-form-image-item");a.attr("src",c.value);if("normal"==d){b.css("overflow","hidden")}else{if("zoom"==d){b.css("width","100%");a.css({width:"100%"})}}if(c.maxHeight){b.css("max-height",c.maxHeight)}if(c.height){b.css("height",c.height)}$(b).muBind("mousedown",function(f){c.focus();Mini2.EventManager.stopEvent(f)}).muBind("mouseup",function(f){Mini2.EventManager.stopEvent(f)});return b},setValue:function(i){var f=this,e=f.log,d=f.inputEl,b=$(d).children(".mi-form-image-item"),g,h=f.store,c,a=f.displayField,j=f.valueField;f.value=i;g=h.filterFirstBy(j,i);if(g){f.curRecord=g;c=g.get(a)}else{c=null}b.attr("src",c);return f}});
Mini2.define("Mini2.ui.form.field.ProgressBar",{extend:"Mini2.ui.form.field.Text",alias:"widget.progressbar",log:Mini2.Logger.getLogger("Mini2.ui.form.field.ProgressBar"),allowDecimals:true,decimalSeparator:".",submitLocaleSeparator:true,decimalPrecision:2,minValue:Number.NEGATIVE_INFINITY,maxValue:Number.MAX_VALUE,step:1,value:0,defaultValue:0,align:"right",initComponent:function(){var b=this,a=b.log;$(b).muBind("focusout",function(){if(b._focusTimeout){clearTimeout(b._focusTimeout);delete b._focusTimeout}b.fieldEl.removeClass("mi-form-focus");b.el.removeClass("mi-form-trigger-wrap-focus");b.clearInvalid()});b.initLabelable()},getValue:function(){var b=this,a=b.defaultValue;var c=this.constructor.base.getValue.call(this);if(c==""){return null}c=Mini2.Number.from(c,a);return c},setMinValue:function(c){var b=this,a;b.minValue=Mini2.Number.from(c,Number.NEGATIVE_INFINITY);b.toggleSpinners();if(b.disableKeyFilter!==true){a=b.baseChars+"";if(b.allowExponential){a+=b.decimalSeparator+"e+-"}else{if(b.allowDecimals){a+=b.decimalSeparator}if(b.minValue<0){a+="-"}}a=Mini2.String.escapeRegex(a);b.maskRe=new RegExp("["+a+"]");if(b.autoStripChars){b.stripCharsRe=new RegExp("[^"+a+"]","gi")}}},setMaxValue:function(a){this.maxValue=Mini2.Number.from(a,Number.MAX_VALUE);this.toggleSpinners()},toggleSpinners:function(){var b=this,c=b.getValue(),d=c===null,a;if(b.spinUpEnabled||b.spinUpDisabledByToggle){a=d||c<b.maxValue;b.setSpinUpEnabled(a,true)}if(b.spinDownEnabled||b.spinDownDisabledByToggle){a=d||c>b.minValue;b.setSpinDownEnabled(a,true)}},rawToValue:function(a){var b=this.fixPrecision(this.parseValue(a));if(b===null){b=a||null}return b},valueToRaw:function(c){var b=this,a=b.decimalSeparator;c=b.parseValue(c);c=b.fixPrecision(c);c=Mini2.isNumber(c)?c:parseFloat(String(c).replace(a,"."));c=isNaN(c)?"":String(c).replace(".",a);return c},parseValue:function(a){a=parseFloat(String(a).replace(this.decimalSeparator,"."));return isNaN(a)?null:a},fixPrecision:function(d){var a=this,b=isNaN(d),c=a.decimalPrecision;if(b||!d){return b?"":d}else{if(!a.allowDecimals||c<=0){c=0}}return parseFloat(Mini2.Number.toFixed(parseFloat(d),c))},setSpinValue:function(c){var b=this,a;b.setValue(c)},onSpinUp:function(){var a=this;if(!a.readOnly){a.setSpinValue(Mini2.Number.constrain(a.getValue()+a.step,a.minValue,a.maxValue))}},onSpinDown:function(){var a=this;if(!a.readOnly){a.setSpinValue(Mini2.Number.constrain(a.getValue()-a.step,a.minValue,a.maxValue))}},spinUpEnabled:function(a){var b=this;if(a){b.onSpinUp();if(!b.spinUpDisabledByToggle){b.spinUpDisabledByToggle=setInterval(function(){b.onSpinUp()},200)}}else{if(b.spinUpDisabledByToggle){clearInterval(b.spinUpDisabledByToggle);delete b.spinUpDisabledByToggle}}},spinDownEnabled:function(a){var b=this;if(a){b.onSpinDown();if(!b.spinDownDisabledByToggle){b.spinDownDisabledByToggle=setInterval(function(){b.onSpinDown()},200)}}else{if(b.spinDownDisabledByToggle){clearInterval(b.spinDownDisabledByToggle);delete b.spinDownDisabledByToggle}}},btnUp_Click:function(a){var b=a.data;b.onSpinUp();b.focus();Mini2.EventManager.stopEvent(a)},btnDown_Click:function(a){var b=a.data;b.onSpinDown();b.focus();Mini2.EventManager.stopEvent(a)},getFieldEl:function(){var b=this;var a='<mi-progressbar :ex_cls="ex_cls"  :value="value"></mi-progressbar>';if(b.name){}b.inputEl=a;return a},setValueCartoon:function(d){var a=this,e=a.vue,c=a.value||0,b=d;new TWEEN.Tween({num:c}).easing(TWEEN.Easing.Quadratic.Out).to({num:b},500).onUpdate(function(){e.value=this.num.toFixed(0)}).start()},setValue:function(b){var a=this,c=a.vue;if(c&&TWEEN){a.setValueCartoon(b)}a.value=b;return a},getValue:function(){var a=this;return a.value},elemTpl:['<div class="mi-progress">','<span :class="[ex_cls]" style="min-width:0px;" :style="{width: value + \'%\'}">',"<span>{{value}}%</span>","</span>","</div>"],regVue:function(d){var b=this,a="mi-progressbar";Mini2.vue=Mini2.vue||{};Mini2.vue.component=Mini2.vue.component||{};if(!Mini2.vue.component[a]){var c=Vue.extend({template:Mini2.join(b.elemTpl),props:["ex_cls","value"],methods:{}});Vue.component(a,c);Mini2.vue.component[a]=true}b.vue=new Vue({el:"#"+b.id,data:d})},render:function(){var a=this;var b=a.value;a.baseRender();a.el.attr("id",a.id);a.regVue({ex_cls:"blue",value:0});a.setValue(b);a.el.data("me",a)}});
Mini2.define("Mini2.ui.form.field.ListBox",{extend:"Mini2.ui.form.CheckboxGroup",alias:"widget.listbox",height:150,extraFieldBodyCls:false,getGroup_Table:function(){var f=this,d=f.items,e=d.length,b=f.repeatColumns,a,j,h,i,g,c=f.height;i=Mini2.$join(['<div class="mi-checkbox-group-inner mi-form-trigger-wrap" style="overflow: auto; padding: 4px; border: 1px solid #CCCCCC;" >','<table id="radiogroup-',f.muid,'-innerCt" class="mi-table-plain" cellpadding="0" role="presentation" style="table-layout: auto; width:100%;">',"<tbody>","</tbody>","</table>","</div>"]);if(c&&c!="auto"){i.css("height",c)}if(b=="auto"){f.createGroupCell(i,1,e);g={el:i,row:1,col:e}}else{if(b<=1){f.createGroupCell(i,e,1);g={el:i,row:e,col:1}}else{a=parseInt(b);j=e%a;h=e/(e-j);if(j>0){h++}f.createGroupCell(i,h,a);g={el:i,row:h,col:a}}}$(i).on("click",function(){f.focus()});return g}});
Mini2.define("Mini2.ui.form.field.HtmlEditor",{extend:"Mini2.ui.form.field.Text",alias:"widget.htmleditor",imageUrl:"",fileUrl:"",hasFocus:false,getFieldEl:function(){var b=this,a;b.inputEl=a=Mini2.$join(["<textarea >","</textarea>"]);if(b.name){a.attr("name",b.name)}a.attr("id",b.clientId);a.css({width:b.width,height:b.height});if(b.readOnly){a.attr("readonly","readonly")}b.bindInputEl_Mouse(a);b.bindInputEl_Key(a);return a},_isValueChanged:false,isUEditReady:false,isValueChanged:function(){var a=this;return a._isValueChanged},getValue:function(){var b=this,c=b.uedit,a=b.inputEl;return a.val()},setValue:function(d){var b=this,c=b.uedit,a=b.inputEl;if(!b.hasFocus){a.val(d);if(b.isUEditReady){c.setContent(d,false)}}},autoSave:function(){var a=this,b=a.uedit;if(a.saveTimer){a.saveTimer.resetStart()}else{a.saveTimer=Mini2.setTimer(function(){var c=b.getContent();a.inputEl.val(c);a._isValueChanged=true;var d=a.ownerParent;if(d&&d.setStoreRecrod){d.setStoreRecrod.call(d,a)}},{interval:1000,limit:1})}},render:function(){var c=this,d,b,a=".mi-form-item-body:first";c.baseRender();c.el.data("me",c);c.uedit=d=UE.getEditor(c.clientId,{autoHeightEnabled:false,initialFrameHeight:400,scaleEnabled:false,imageUrl:c.imageUrl,imagePath:"",maxImageSideLength:9000});d.addListener("ready",function(){c.isUEditReady=true});d.addListener("focus",function(e){c.hasFocus=true;c.focus()});d.addListener("blur",function(e){c.hasFocus=false;c.autoSave()});d.addListener("selectionchange",function(e){c.autoSave()})}});
Mini2.define("Mini2.ui.form.field.FileUpload",{extend:"Mini2.ui.form.field.Base",alias:"widget.fileupload",chunked:false,buttonTpl:['<a class="mi-btn ',"mi-unselectable ","mi-btn-default-small ",'" ','style="margin-left: 6px;" ','role="button" hidefocus="on" unselectable="on" tabindex="0" >','<input type="hidden" class="temp_value" value="" />','<input type="hidden" class="value" />','<div class="progress" style="display:none; height:100%;width:20%; background-color:#ffffff;opacity:0.50; position:absolute;overflow:hidden; top:0px;left:0px;">',"</div>",'<span class="mi-btn-wrap" unselectable="on">',"</span>","</a>"],innerHtmlTpl:['<span class="mi-btn-button">','<span class="mi-btn-inner mi-btn-inner-center" unselectable="on">选择文件</span>',"</span>"],imageThumbPlugin:{htmlTpl:['<div class="thumb" style="border: 1px solid #ddd; height:110px; width:110px; background-color: #FFFFFF; margin-bottom:4px; padding:4px; ',"border-radius: 4px;","-webkit-box-shadow: 0 1px 2px rgba(0,0,0,0.075);box-shadow: 0 1px 2px rgba(0,0,0,0.075);",'display: block;">','<div class="thumb-inner" style=" overflow:hidden;width:100px;height:100px;">','<img class="thumb-img" src="" style="height:100%;" />',"</div>","</div>"]},formType:"full",isUserUrl:false,pluginType:"image",thumbWidth:100,thumbHeight:100,thumbEl:null,valueEl:null,tempValueEl:null,widgetActionUrl:"/Core/Mini/EcWidgetAction.aspx",text:"选择文件",isPreviewed:false,setValue:function(f){var c=this,d=c.pluginType,g=c.valueEl,e=c.thumbEl;g.val(f);if(d=="image"){f=f||"";var a=e.find(".thumb-img");var b=f.split("||");a.attr("data-original",b[0]);if(a&&$.fn.viewer){if(!c.isPreviewed){c.isPreviewed=true;a.viewer({url:"data-original"})}else{a.viewer("update")}}}return c},getValue:function(){var a=this,c=a.valueEl,b;b=c.val();return b},setTempValue:function(d){var a=this,b=a.pluginType,c=a.tempValueEl;c.val(d);if(b=="image"){a.thumbEl.find(".thumb-img").attr("src",d)}return a},request:function(){var d=location.href,a,b,c;c=d.substring(d.indexOf("?")+1,d.length).split("&");b="";for(a=0;j=c[a];a++){if(a>0){b+="$$$"}b+=j}if(this.tag){b+="$$$tag="+encodeURIComponent(this.tag)}return b},DefaultParams:{__Path:"",__CID:"",__PID:"",__IsUser:1,__Lang:"",__WidgetPs:"",__Action:"",__ActionPs:"",__ReturnFormat:"",__IsPost:"1",__SubName:"",__SubEvent:""},getFieldEl:function(){var me=this,el,uploader,tempValueEl,valueEl,pluginType=me.pluginType,thumb=me.imageThumbPlugin;var widgetUriObj={__Path:encodeURI(me.appRelativeVirtualPath),__Action:"",__ActionPs:"",__CID:"widget1_I",__ReturnFormat:"script",__SubName:me.id,__SubMethod:"OnUploader",__Query:me.request()};el=Mini2.$join(me.buttonTpl);if("image"==pluginType){var thumbEl=Mini2.$join(thumb.htmlTpl);thumbEl.css({width:(me.thumbWidth+10)+"px",height:(me.thumbHeight+10)+"px"});$(thumbEl).children(".thumb-inner").css({width:me.thumbWidth+"px",height:me.thumbHeight+"px"});thumbEl.find(".thumb-img").attr("src",me.value).attr("data-original",me.value);var boxEl=$("<div></div>");boxEl.append(thumbEl);boxEl.append(el);el=boxEl;me.thumbEl=thumbEl}el.attr("id",me.clientId);me.tempValueEl=tempValueEl=el.find(".temp_value:first");me.valueEl=valueEl=el.find(".value:first");tempValueEl.attr("name",me.clientId+"_temp_value");valueEl.attr("name",me.clientId+"_value");if(me.temp_value){tempValueEl.val(me.temp_value)}if(me.value){valueEl.val(me.value)}var url;if(!Mini2.String.isBlank(me.fileUrl)){url=me.fileUrl;me.isUserUrl=true}else{url=me.widgetActionUrl+"?"+$.param(widgetUriObj)}var innerHtmlTpl=['<span class="mi-btn-button">','<span class="mi-btn-inner mi-btn-inner-center" unselectable="on">',me.text,"</span>","</span>"];me.uploader=uploader=new WebUploader.Uploader({swf:"CoreScriptswebuploader-0.1.5Uploader.swf",pick:{id:el.find(".mi-btn-wrap:first"),multiple:true,innerHTML:Mini2.$join(innerHtmlTpl)},fileVal:me.clientId,server:url,auto:true,chunked:me.chunked,resize:false});if("image"==pluginType){uploader.on("fileQueued",function(file){uploader.makeThumb(file,function(error,ret){if(error){console.error("预览错误")}else{me.thumbEl.find(".thumb-img").attr("src",ret)}},me.thumbWidth,me.thumbHeight)})}uploader.on("startUpload",function(){var data={};if("full"==me.formType){var formData=$("form:first").formToArray();for(var i=0;i<formData.length;i++){var fd=formData[i];data[fd.name]=fd.value}}else{if("sample"==me.formType){data[me.clientId+"_temp_value"]=me.tempValueEl.val();data[me.clientId+"_value"]=me.valueEl.val()}}uploader.options.formData=data;$(el).find(".progress").show()});uploader.on("uploadProgress",function(file,percentage){var perText=percentage*100+"%";$(el).find(".progress").css("width",perText);$(el).find(".mi-btn-inner-center").text("已上传 "+perText)});uploader.on("uploadSuccess",function(file,response){console.log("上传完成",file);if(me.isUserUrl){var url=response.url;console.debug("反馈回的路径: "+url);var valueEl=me.valueEl;valueEl.val(url);if(me.thumbEl&&$.fn.viewer){me.thumbEl.find(".thumb-img").attr("data-original",url);if(!me.isPreviewed){me.isPreviewed=true;me.thumbEl.viewer({url:"data-original"})}else{me.thumbEl.viewer("update")}}me.trigger("focusout");var owner=me.ownerParent;if(owner&&owner.setStoreRecrod){owner.setStoreRecrod.call(owner,me)}me.trigger("uploadSuccess",response)}else{try{var raw=response._raw+"";eval(raw)}catch(ex){console.error("解析对象出错。"+ex.message+"\r\n"+response._raw)}}});uploader.on("uploadError",function(file,reason){console.error("上传出错")});uploader.on("uploadComplete",function(file){$(el).find(".mi-btn-inner-center").text(me.text);$(el).find(".progress").hide()});return el},setTag:function(c){var b=this,d=b.uploader;b.tag=c;var f={__Path:encodeURI(b.appRelativeVirtualPath),__Action:"",__ActionPs:"",__CID:"widget1_I",__ReturnFormat:"script",__SubName:b.id,__SubMethod:"OnUploader",__Query:b.request()};var e;if(!Mini2.String.isBlank(b.fileUrl)){e=b.fileUrl;b.isUserUrl=true}else{e=b.widgetActionUrl+"?"+$.param(f)}try{console.debug(d);d.options.server=e}catch(a){console.error("设置 tag 属性错误",a)}}});
Mini2.define("Mini2.ui.form.field.MoreFileUpload",{extend:"Mini2.ui.form.field.Text",alias:"widget.morefileupload",dataType:"text",imageUrl:"",fileUrl:"",thumbWidth:100,thumbHeight:100,hideThumbTitle:false,height:270,displayMode:"editor",slicer:true,imagePanelEl:null,otherPanelEl:null,getFieldEl:function(){var e=this,h=e.slicer,c,d;var a=parseInt(e.height);if("editor"==e.displayMode){e.inputEl=d=Mini2.$join(['<div class="mi-file-panel" >','<div class="file-inner"  style="border: 1px solid #ddd; padding:10px; height:',a-60,'px; overflow: auto;">',"</div>",'<div class="mi-file-toobar"  style="border: 1px solid #ddd; padding:6px;height:50px;" >','<div class="upload-button" style="flow:left;"></div>','<button type="button" class="remove-btn" style="float:left;">删除</button>',"</div>","</div>"])}else{if("preview"==e.displayMode){e.inputEl=d=Mini2.$join(['<div class="mi-file-panel" >','<div class="file-inner"  style="border: 1px solid #ddd; padding:10px; height:',a-60,'px; overflow: auto;">',"</div>",'<div class="mi-file-toobar"  style="border: 1px solid #ddd; padding:6px;height:40px;" >','<button type="button" class="editor-btn" style="float:left; width:80px;">编辑</button>',"</div>","</div>"]);$(d).find(".editor-btn").click(function(){e.onButtonClick()})}}e.fileInnerEl=c=$(d).children(".file-inner");if(e.maxHeight){var f=parseInt(e.maxHeight)-50;c.css("max-height",f+"px")}if(e.minHeight){var f=parseInt(e.minHeight)-50;c.css("min-height",f+"px")}if(h&&"preview"==e.displayMode){var g=Mini2.$join(['<div role="other-file-panel" style="height:auto; margin-bottom:10px; padding-bottom:10px; border-bottom: 1px solid #dddddd;">',"</div>"]);var b=Mini2.$join(['<div role="image-file-panel" style="height:auto;">',"</div>"]);c.append(g);c.append(b);e.imagePanelEl=b;e.otherPanelEl=g}else{e.imagePanelEl=c;e.otherPanelEl=null}d.attr("id",e.clientId);$(d).find(".upload-button").attr("id",e.clientId+"_UploadBtn");d.css({width:e.width,height:e.height});if(e.readOnly){d.attr("readonly","readonly")}return d},_isValueChanged:false,isValueChanged:function(){var a=this;return a._isValueChanged},items:false,clear:function(){var c=this,b=c.imagePanelEl,d=c.otherPanelEl,a=c.hideEl2;c.items=[];b.children().remove();if(d){d.children().remove()}if(a){a.val("")}return c},removeSeleted:function(){var j=this,f=j.imagePanelEl,m=j.otherPanelEl,g=j.inputEl,h=j.items,d=j.hideEl2;console.debug("imagePanelEl = ",f);var b=f.children(".mi-file-check");console.log("选中的图片数量: ",b.length);for(var e=0;e<b.length;e++){var a=b[e];var c=$(a).attr("data-file-id");var k=Mini2.Array.indexOf(h,function(){return(this.file_id==c)});if(k>=0){h.splice(k,1)}}b.remove();j.autoSave();if(d){var l=j.getValue();d.val(l)}},getValue:function(){var e=this,d=e.items||[],f,b,c,a=e.hideEl2;if("text"==e.dataType){f="";for(b=0;b<d.length;b++){if(b>0){f+="\n"}c=d[b];f+=Mini2.join([c.url,"||",c.thumb_url,"||",c.title,"||",c.code])}return f}},setValue:function(j){var g=this,e=g.inputEl,c=g.hideEl2;g.clear();if(Mini2.isBlank(j)){return}if("text"==g.dataType){var f=j.split("\n");for(var d=0;d<f.length;d++){var h=f[d];if(Mini2.String.isBlank(h)){continue}try{g.addForText(h)}catch(b){console.error("text",h);console.error("添加对象失败",b)}}}else{if("josn"==g.dataType){if(Mini2.isString(j)){try{j=JSON.parse(j)}catch(b){console.error("json 转化为 对象失败. ",j)}}for(var d=0;d<j.length;d++){var a=j[d];try{g.add(a)}catch(b){console.error("cfg",a);console.error("添加对象失败",b)}}}}},isPreviewed:false,previewEl:null,add:function(a){var i=this,f=i.fileInnerEl,h=i.items,g=i.inputEl,e=i.hideEl2;if(!h){i.items=h=[]}var c="file"+Mini2.newId();a.file_id=c;var b=i.createFileEl(a);h.push(a);if(b.hasClass("image")){i.imagePanelEl.append(b)}else{if(i.otherPanelEl){i.otherPanelEl.append(b)}else{i.imagePanelEl.append(b)}}var j=i.imagePanelEl.html();if(window.Viewer){i.initPreviewEl()}else{b.attr("rel","boxer"+i.muid);b.boxer({})}if(e){var d=e.val();d+="\n"+(a.url+"||"+a.thumb_url+"||"+a.title+"||"+(a.code||""));e.val(d)}return i},initPreviewTime:null,initPreviewEl:function(){var a=this,b=a.initPreviewTime;if(b){b.resetStart();return}a.initPreviewTime=Mini2.setTimer(function(){if(a.previewEl){a.previewEl.update()}else{a.previewEl=new Viewer(a.imagePanelEl[0],{url:"data-original"})}},[1000,1])},addForText:function(a){var f=this,e=f.items,c=f.fileInnerEl,d=f.inputEl,b=f.hideEl2;if(Mini2.isString(a)){var g=a.split("||");a={thumb_url:g[1]||g[0],url:g[0],title:g[2],code:g[3]}}f.add(a);return f},getUrlFilename:function(d){var b=d.indexOf("?");if(b>0){d=d.substring(0,b)}var a=d.split("/");var c=a[a.length-1];return c},createFileEl:function(a){var e=this,f=e.slicer,h,b;h=e.getUrlFilename(a.url);var d=h.lastIndexOf(".");var j=h.substring(d).toLowerCase();var c=false;if(j==".jpg"||j==".jpeg"||j==".gif"||j==".png"||j==".bmp"){c=true}if("editor"==e.displayMode){b=Mini2.$join(['<div class="mi-file thumb " style="" title="',a.title,'">','<div class="mi-file-inner thumb-inner" style="width:',e.thumbWidth,"px;height:",e.thumbHeight,'px;">','<img class="mi-file-image thumb-img" src="',a.thumb_url||a.url,'" data-original="',a.url||a.thumb_url,'" style="height:100%;">',"</div>",'<div class="mi-file-mask"></div>','<div class="mi-checkbox"></div>',"</div>",]);if(!e.hideThumbTitle){b.append(Mini2.$join(['<div class="mi-file-text" title="',h,'">',h,"</div>"]))}$(b).children(".mi-checkbox").muBind("click",function(){if($(b).hasClass("mi-file-check")){$(b).removeClass("mi-file-check")}else{$(b).addClass("mi-file-check")}})}else{if("preview"==e.displayMode){var i=a.thumb_url||a.url;var g=a.url||a.thumb_url;if(f&&!c){b=Mini2.$join(['<a class="" style="display:block;margin-bottom:6px;" target="_blank" href="',a.url,'" title="',a.title,'">','<img class="mi-file-image" src="',i,'" style="height:16px;height:16px; margin-right:4px;">',"<span>",a.title,"</span>","</a>"])}else{b=Mini2.$join(['<div class="mi-file thumb " style=""  title="',a.title,'">','<div class="mi-file-inner thumb-inner" style="width:',e.thumbWidth,"px;height:",e.thumbHeight,'px;">','<img class="mi-file-image thumb-img" src="',i,'" data-original="',g,'" style="height:100%;">',"</div>","</div>",]);if(!e.hideThumbTitle){b.append(Mini2.$join(['<div class="mi-file-text" title="',h,'">',h,"</div>"]))}}}}if(c){b.addClass("image")}else{var k=j.substring(1);$(b).find(".mi-file-image").attr("src","/res/file_icon_256/"+k+".png")}b.attr("data-file-id",a.file_id);return b},autoSave:function(){var a=this;a._isValueChanged=true;var b=a.ownerParent;if(b&&b.setStoreRecrod){b.setStoreRecrod.call(b,a)}},appendHideEl:function(){var c=this,b=c.hideEl2,a=".mi-form-item-body:first";console.debug("隐藏项目....+++++++++++++++++++++++++");c.hideEl2=b=Mini2.$join(['<input type="hidden"  />']);if(c.name){b.attr("name",c.name)}console.debug("附加的值 :",c.oldValue);b.val(c.oldValue);c.appendCell(c.el,b,a)},appendUploadBtn:function(){var a=this;var b=Mini2.create("Mini2.ui.form.field.FileUpload",{id:a.id+"_UploadBtn",clientId:a.clientId+"_UploadBtn",hideLabel:true,pluginType:"other",fileUrl:a.fileUrl,dock:"left",applyTo:"#"+a.clientId+"_UploadBtn"});b.render();b.bind("uploadSuccess",function(e){var d=e;var c={url:d.url,thumb_url:d.thumb_url||d.url,title:d.original,code:d.code||""};a.add(c);a.autoSave();a.callParent()});if(b.el){b.el.css({"float":"left",width:0,marginRight:"6px"})}},onButtonClick:function(){var a=this,b=a.ownerParent,d=b.store,c=d.getCurrent();var e=Mini2.urlAppend("/App/InfoGrid2/View/OneForm/Dialogs/MoreFileDialog.aspx",{table:d.modelName,field:a.dataField,row_pk:c.getId(),tag_code:a.tagCode||"sub_file"},true);var f=Mini2.createTop("Mini2.ui.Window",{width:800,height:600,url:e,mode:true,text:"文件管理"});f.formClosed(function(g){if(g.success){try{console.debug("界面关闭: ",g);c.set(a.dataField,g.data)}catch(h){console.error("刷新数据仓库错误.",h)}}});f.show()},render:function(){var d=this,b,c;d.baseRender();b=d.el;if("editor"==d.displayMode){d.appendHideEl();var a=Mini2.create("Mini2.ui.button.Button",{text:"删除",width:80,height:28,applyTo:b.find(".remove-btn"),click:function(){d.removeSeleted()}});a.render();a.el.css({"float":"right"});d.appendUploadBtn()}d.el.data("me",d)}});Mini2.define("Mini2.ui.form.field.MoreFileEditor",{extend:"Mini2.ui.Component",buttonCls:"mi-icon-more",initComponent:function(){var a=this;a.fieldCls="mi-form-type-text";$(a).muBind("focusout",function(){console.debug("失去焦点..");a.el.removeClass("mi-form-trigger-wrap-focus")})},focus:function(){var a=this;console.debug("获取焦点..");a.el.addClass("mi-form-trigger-wrap-focus");Mini2.ui.FocusMgr.setControl(a,null,a.scope);return a},getFieldEl:function(){var c=this,b=c.log,d,a;d=Mini2.$join(['<div class="" style="width: 120px;  position: relative; ">',"</div>"]);a=Mini2.$join(['<div role="button" class="mi-form-trigger mi-form-arrow-trigger " style="position: absolute;right:0px;background-color:#fff;border-color: #157fcc;    border-width: 1px; border-style: solid;" ></div>']);d.append(a);c.buttonEl=a;if(c.buttonCls){a.addCls(c.buttonCls)}a.click(function(){c.onButtonClick()});return d},setWidth:function(b){var a=this;a.el.css("width",b)},onButtonClick:function(){var a=this,b=a.record,c=b.store;console.debug("文件编辑",a);var d=Mini2.urlAppend("/App/InfoGrid2/View/OneForm/Dialogs/MoreFileDialog.aspx",{table:c.modelName,field:a.dataIndex,row_pk:b.getId(),tag_code:a.tagCode||"sub_file"},true);var e=Mini2.createTop("Mini2.ui.Window",{width:800,height:600,url:d,mode:true,text:"文件管理"});e.formClosed(function(f){if(f.success){try{console.debug("界面关闭: ",f);b.set(a.dataIndex,f.data)}catch(g){console.error("刷新数据仓库错误.",g)}}});e.show()},value:null,setValue:function(b){var a=this;console.debug("设置值...",b);a.value=b;return a},getValue:function(){var a=this;return a.value},render:function(){var b=this;var a=b.getFieldEl();if(b.applyTo){$(b.applyTo).replaceWith(a)}else{$(b.renderTo).append(a)}a.data("me",b);b.el=a;return b}});
Mini2.define("Mini2.ui.form.field.CodeEditor",{extend:"Mini2.ui.form.field.Text",alias:"widget.codeeditor",cols:20,rows:4,extraFieldBodyCls:"mi-code-editor-panel",mode:"text/x-csharp",setValue:function(f){var e=this,d=e.hideEl,a=e.codeEl,b=e.editor;e.value=f;a.val(f);if(b&&f){try{b.setValue(f)}catch(c){console.debug("editor.setValue(...) = ",f);console.error("代码编辑框赋值错误. ",c)}}if(d){d.val(f)}return e},getValue:function(){var c=this,a=c.hideEl,b=c.inputEl,d;return c.value;return d},setSize:function(c,a){var b=this;console.debug("dddddddddddddd",a)},setHeight:function(c){var b=this,a=b.editor;b.height=c;b.el.css("height",c);if(a){a.setSize("100%",b.height+"px")}return b},getFieldEl:function(){var c=this,b,a;c.inputEl=b=Mini2.$joinStr(["<div>",'<div role="toolbar"></div>','<textarea class="code-box" style="display:none;">',"</textarea>","</div>"]);c.codeEl=a=$(b).children(".code-box");if(c.name){a.attr("name",c.name)}b.attr("id",c.clientId);return b},render:function(){var e=this,c,d,b,a=".mi-form-item-body:first";e.baseRender();e.el.data("me",e);d=e.inputEl;b=e.codeEl;var c=CodeMirror.fromTextArea(b[0],{lineNumbers:true,mode:e.mode,autofocus:false});c.setSize("100%",e.height+"px");e.editor=c;setTimeout(function(){c.on("blur",function(g,f){e.value=g.getValue();d.val(e.value);e.autoSave()})},1000)},resetPaint:function(){var b=this,a=b.editor;a.refresh();return b},autoSave:function(){var a=this,b=a.saveTimer;if(b){b.resetStart()}else{a.saveTimer=b=Mini2.setTimer(function(){a._isValueChanged=true;var d=a.ownerParent;if(d&&d.setStoreRecrod){d.setStoreRecrod.call(d,a)}var c=a.editor;if(c){c.setSize("100%",a.height+"px")}},{interval:500,limit:1})}}});
Mini2.define("Mini2.ui.grid.CellFocusRegion",{});
Mini2.define("Mini2.ui.grid.header.Container",{renderTo:Mini2.getBody(),log:Mini2.Logger.getLogger("Mini2.ui.grid.header.Container"),height:31,rowHeight:31,width:600,m_divMarker1:null,m_divMarker2:null,m_CurMoveHead:null,m_IsLineMove:false,headerElMoveWidth:0,headerEl:null,innerEl:null,targetEl:null,columns:[],curIndex:-1,baseCls:"mi-column-header",m_ColumnWidthResize:Mini2.emptyFn,detailCols:false,allCols:false,columnMoved:Mini2.emptyFn,columnWidthResize:function(a){this.m_ColumnWidthResize=a},strJoin:function(a){var b,d="",c=a.length;for(b=0;b<c;b++){d+=a[b]}return d},headTpl:['<div class="mi-column-header mi-box-item mi-column-header-default mi-unselectable " ','style="right: auto; left: 0px; top: 0px; margin: 0px; ">','<div class="mi-column-header-inner ">','<span class="mi-column-header-text">',"</span>","</div>","</div>"],checkColumns:[],lastSortColumn:null,createMenu:function(b,c){var f=this,a=f.baseCls,d;d=c.children(".mi-column-header-inner."+a+"-inner");if(!b.menuDisabled&&b.menu){console.debug("headerInnerEl.len = ",d.length);var e=$('<div class="'+a+'-trigger" ></div>');d.append(e);return;d.on("mousedown",function(h){var k,j,i,g=$(this).data("me");if(g&&g.resizable){i=$(this).offset().left;k=event.clientX-i;j=$(this).width();if(k<j-4){console.log("拖住...");Mini2.EventManager.setMouseDown(this,h)}else{console.log("点击...")}}}).on("mouseup",function(h,g){})}},createColumn:function(b){var g=this,c=g.grid,a=g.baseCls,d,f,e;d=$(g.headTpl).addClass(a+"-align-"+b.headerAlign).data("me",b);g.renderHeaderText(b,c,d);g.createMenu(b,d);g.head_bindEvent(d);if(b.required){d.find(".mi-column-header-text").after('<span style="color:red;font-weight:bold" data-qtip="Required">*</span>')}return d},createGroupColumn:function(c,e,n){var o=this,m=Mini2.Logger,f=o.grid,a=o.baseCls,g,h,d,b;g=$(o.headTpl).addClass(a+"-align-"+c.headerAlign).addClass("mi-group-header").data("me",c);o.renderHeaderText(c,f,g);if(c.required){g.find(".mi-column-header-text").after('<span style="color:red;font-weight:bold" data-qtip="Required">*</span>')}h=g.children(".mi-column-header-inner");b=$('<div class="mi-box-inner" role="presentation" ></div>');g.append(b);var k,l=0,r=0,j=0,q=c.columns,p;for(k=0;k<q.length;k++){p=q[k];o.allCols.push(p);p.deptPath=c.deptPath+"."+k;if(p.columns){d=o.createGroupColumn(p,e+1,n)}else{d=o.createColumn(p);if(n-e>1){$(d).css({"padding-top":(o.rowHeight*(n-e)-o.rowHeight)/2})}}p.el=d;d.css({left:l+"px",width:(p.width)+"px",height:o.rowHeight*(n-e)}).addClass("mi-group-sub-header").appendTo(b);r+=p.width;l+=p.width}c.width=r;c.height=o.rowHeight*(n-e);b.css({height:c.height});o.createMenu(c,g);o.head_bindEvent(g);return g},renderHeaderText:function(b,c,d){var h=this,a=h.baseCls;var f=d.children(".mi-column-header-inner").children("."+a+"-text:first");if(b.getHeaderConfig){var e=b.getHeaderConfig();b=Mini2.apply(b,e);h.checkColumns.push(b);if(c&&"SINGLE"==c.checkedMode){var i=b.headerText;f.html(i)}else{var g=b.renderer.call(b,false,c);f.append(g)}}else{f.html(b.headerText)}},mouse_button:null,isDragCol:false,dragHoverEl:null,dragColEl:null,mouseDownLocal:null,startColDrag:function(g,l){var j=this;var h=l.target;if(!$(h).hasClass("mi-column-header")){var d=$(h).parents(".mi-column-header");h=d[0]}if(!h){return}j.isDragCol=true;j.dragHoverEl=h;var k=j.innerEl.offset();var b=$(h).offset();var c=$(h).width();var a=$(h).height();var f=j.colMoveTopEl;var e=j.colMoveBottomEl;if(!f){f=Mini2.$joinStr(['<div class="mi-col-move mi-col-move-top" style="display:none;"></div>']);$(document.body).append(f);j.colMoveTopEl=f}if(!e){e=Mini2.$joinStr(['<div class="mi-col-move mi-col-move-bottom" style="display:none;"></div>']);$(document.body).append(e);j.colMoveBottomEl=e}j.colMoveTopEl.show();j.colMoveBottomEl.show();var i=b.left+c-5;f.css({top:b.top-11,left:i});e.css({top:b.top+j.headerEl.height(),left:i})},endColDrag:function(f){var e=this;var c=f;var d=e.dragHoverEl;var a=$(c).index();var b=$(d).index();if(a===b||a-1===b){return}e.columnMoved.call(e,{fromIndex:a,toIndex:b,})},head_bindEvent:function(a){var b=this;a.muBind("mousedown",function(d,i){b.mouse_button=d.button;if(0===b.mouse_button){var c=$(this).data("me");if(c.isCheckerHd){b.dragColEl=null;return}var h=0;if(!$(d.target).hasClass("mi-column-header")){var f=$(d.target).parentsUntil(".mi-column-header");var g=$(d.target).position();h+=g.left;$(f).each(function(){g=$(this).position();h+=g.left})}var j=$(this).width();var e=d.offsetX+h;if(e>4&&e<j-4){b.mouseDownLocal={x:d.offsetX,y:d.offsetY};b.dragColEl=this}else{b.dragColEl=null}Mini2.ui.FocusMgr.setControl(c,null,this,true)}}).muBind("mousemove",function(e,g){if(0===b.mouse_button){if(b.dragColEl){var f;var c=Math.abs(b.mouseDownLocal.x-g.offsetX);var d=Math.abs(b.mouseDownLocal.y-g.offsetY);f=(c>8)||(d>8);if(f){b.startColDrag(e,g)}}}}).muBind("mouseup",function(e,d){if(0===b.mouse_button){if(b.colMoveTopEl){b.colMoveTopEl.hide()}if(b.colMoveBottomEl){b.colMoveBottomEl.hide()}var f;if(b.isDragCol){b.endColDrag(this)}else{if(b.dragColEl&&$(d.target).hasClass("mi-column-header-trigger")){f=d.target;var c=$(this).data("me");c.triggerClick.call(c)}else{b.head_click.call(this,this,d,b)}}}b.isDragCol=false;b.dragHoverEl=null;b.mouse_button=null}).muBind("dblclick",function(d,c){b.head_dblclick.call(this,d,c,b)})},head_click:function(i,d,h){var g=h,b="mi-grid-checkcolumn-checked",f,a,c=$(this).data("me");if(!g.m_IsLineMove){Mini2.ui.FocusMgr.setControl(this);if(c&&c.isCheckerHd){f=$(this).find("img:first");f.toggleClass(b);a=$(f).hasClass(b);c.onHeaderClick(this,c,a);Mini2.EventManager.stopEvent(d)}}},head_dblclick:function(l,g,k){var j=k,h=j.grid,b=j.baseCls,i=b+"-sort",c="mi-grid-checkcolumn-checked",f=i+"-DESC",a=i+"-ASC",d=$(this).data("me");if(!j.m_IsLineMove){Mini2.ui.FocusMgr.setControl(this);if(!d.isCheckerHd){if(!h.sortable||!d.sortable){return}if(d.columns&&d.columns.length){return}if(j.lastSortColumn===this){d.doSort()}else{d.doSort("ASC")}$(j.lastSortColumn).removeCls(f,a);if("ASC"==d.direction){$(this).addClass(f)}else{if("DESC"==d.direction){$(this).addClass(a)}}j.lastSortColumn=this;Mini2.EventManager.stopEvent(g)}}},setHeaderCheck:function(h){var j=this,c,e=j.checkColumns,f,g,d,k=j.targetEl,a="mi-grid-checkcolumn-checked",b="mi-grid-checkcolumn-undefined";for(f=0;f<e.length;f++){c=e[f];d=$(k).children(":eq("+c.index+")");g=$(d).find("img:first");if(undefined===h){$(g).removeClass(a);$(g).addClass(b)}else{$(g).removeClass(b);$(g).toggleClass(a,h)}}},getRowCount:function(c,h){var g=this,b=c,f,e,a;h=h||1;if(b&&b.length){var d=0;for(f=0;f<b.length;f++){a=b[f];if(a.columns){e=g.getRowCount(a.columns,h+1);d=Math.max(d,e)}}h=Math.max(h,d)}return h},fullDetailCols:function(d,b,c){var f=this,e,a,g;if(b&&b.length){for(e=0;e<b.length;e++){a=b[e];g=a.columns;if(g&&g.length){f.fullDetailCols(d,g,c+1)}else{d.push(a)}}}return d.length},createColumns:function(g){var l=this,j,f,d,a=l.baseCls,e=l.columns,h,k=0,n=0;var b=g.cFirst(".mi-box-inner");var c=$(b).cFirst(".mi-box-target");var m=l.getRowCount(l.columns);l.fullDetailCols(l.detailCols,l.columns,1);l.height=l.rowHeight*m-m-1;g.height(l.height);b.height(l.height);for(j=0;j<e.length;j++){d=e[j];d.ownerParent=l.grid;l.allCols.push(d);if(d.isCheckerHd){l.checkColumns.push(d)}d.deptPath=j+"";if(d.columns){f=l.createGroupColumn(d,1,m)}else{f=l.createColumn(d);$(f).css({"padding-top":parseInt((l.height-l.rowHeight)/2)})}d.el=f;c.append(f);$(f).css({left:k+"px",height:l.height+"px",width:(d.width-1)+"px"});if(d.visible){k+=d.width;n+=d.width}}l.width=n;return g},createMarker:function(){var d=this,a,b=d.m_divMarker1,c=d.m_divMarker2;if(b!=null&&c!=null){return}a='<div class="mi-grid-resize-marker" style="top:0;right: auto; left: -9999px; pointer-events: none;" ></div>';d.m_divMarker1=b=$(a);d.m_divMarker2=c=$(a);$(d.renderTo).append([b,c])},onInit:function(){var a=this;a.detailCols=a.detailCols||[];a.allCols=a.allCols||[];a.headTpl=a.strJoin(a.headTpl)},render:function(){var f=this,a=f.baseCls,e,b,c;f.onInit();var d=Mini2.$join(['<div unselectable="on" >','<div class="mi-box-inner" role="presentation" style="width: 644px; height: 29px;  overflow: visible;">','<div class="mi-box-target" style="width: 644px; "></div>',"</div>","</div>"]);d.addCls(a+"-ct",a+"-ct-docked-top",a+"-ct-default-docked-top",a+"-ct-default","mi-box-layout-ct","mi-noborder-rl");$(f.renderTo).append(d);f.createColumns(d);b=$(d).cFirst(".mi-box-inner");c=$(b).cFirst(".mi-box-target");f.headerEl=d;f.innerEl=b;f.targetEl=c;f.IntiHeaderInner();f.InitHeadGroups();f.resetWidth()},setWidth:function(b){var a=this;a.width=b;a.innerEl.css("width",b-1-16);a.targetEl.css("width",b);return a},scrollLeft:function(b){var a=this;a.innerEl.css("left",-b);return a},preventDefault:function(a){a=a||window.event;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}},StartHeadDrog:function(d){var i=this,c=$(i.m_CurMoveHead),j=i.renderTo,g=i.headerEl,b,a,k,f;i.createMarker();i.m_IsLineMove=true;i.curIndex=c.index();b=c.width();a=c.offset().left-j.offset().left;k=d.clientX-a;f=j.height()+g.height();i.m_divMarker1.css({left:a,top:0,height:f});i.m_divMarker2.css({left:a+b,top:0,height:f});i.headerElMoveWidth=b;Mini2.ui.FocusMgr.setControl(g)},HeadDroging:function(d,g){var f=this,h=$(g),b=h.width(),a=h.offset().left,j,k,l,i,c;j=d.clientX+a;k=f.m_divMarker1.offset().left;l=d.clientX;i=l-k;if(i>4){c=l-$(f.renderTo).offset().left;f.m_divMarker2.css({left:c});f.headerElMoveWidth=l-k}},EndHeadDrog:function(f,i){var g=this,a,c=g.m_divMarker1,d=g.m_divMarker2,b=g.m_CurMoveHead,h=g.headerElMoveWidth;if(c&&d){c.css({left:-9999});d.css({left:-9999});$(b).css({width:h});g.m_IsLineMove=false;g.m_CurMoveHead=null;a=$(b).data("me");if(a){a.width=h;g.resetSubColumnWidth(a);if(a.parent){g.resetSubColumnWidth(a.parent)}}g.resetWidth(a);g.setWidth(g.grid.width)}},resetSubColumnWidth:function(a){var g=this,b=a.columns,h,f,k=a.width,c,e=0,j=k,d;if(b&&b.length){f=b.length;for(d=0;d<f-1;d++){h=b[d];h.el.css({left:e});if(h.visible){j-=h.width;e+=h.width}}h=b[f-1];h.width=j;c=h.el;c.css({left:e,width:j});g.resetSubColumnWidth(h)}},InitHeadGroups:function(){var b=this;var a=$(b.headerEl).find(".mi-box-inner:first");a.mousemove(function(c){if(b.m_IsLineMove){b.HeadDroging(c,this);b.preventDefault(c)}}).mouseup(function(c){if(b.m_IsLineMove){b.EndHeadDrog(c,this)}b.preventDefault(c)})},IntiHeaderInner:function(){var f=this,e=f.log,b=$(f.headerEl),a=f.baseCls,c=b.find("."+a+"-inner"),d=b.find("."+a);$(c).muBind("mouseenter",function(){$(this).addClass("mi-column-header-over")}).muBind("mouseleave",function(){$(this).removeClass("mi-column-header-over")});$(d).muBind("mousedown",function(g){if(f.m_CurMoveHead!=null){Mini2.EventManager.drag=true;f.StartHeadDrog(g)}Mini2.EventManager.stopEvent(g)}).muBind("mouseup",function(h,g){f.m_IsLineMove=false;Mini2.EventManager.drag=false;f.EndHeadDrog(g,this)}).muBind("mousemove",function(q,m){var o=$(this);if(f.m_IsLineMove){f.HeadDroging(m,this);Mini2.EventManager.stopEvent(m);return}var l=o;var i=o.width()+20;var h=o.offset().left;var r=m.clientX-h;var j=false,k=false,g=o.data("me");var p=o.index();if(r<=4){if(p>0){p=o.prev().index();if(g&&g.resizable&&o.prev().index()>0){o.css("cursor","col-resize");f.m_CurMoveHead=o.prev();j=true}}}else{if(r>=20){}else{o.css("cursor","")}}if(g.resizable&&r>i-24){o.find("."+a+"-trigger:first").css("cursor","col-resize");f.m_CurMoveHead=o;k=true}else{o.find("."+a+"-trigger:first").css("cursor","")}if(j==false&&k==false){f.m_CurMoveHead=null}Mini2.EventManager.stopEvent(m)})},clear:function(){var a=this,b=a.targetEl;$(b).children().remove()},add:function(b){var h=this,g=h.log,d,f=0,k=0,a=b,c=h.headerEl,e=h.innerEl,j=h.targetEl;h.columns=[];h.checkColumns=[];h.detailCols=[];h.columns=b;h.createColumns(c);h.IntiHeaderInner();h.InitHeadGroups();h.resetWidth();return h},resetWidth:function(d){var h=this,k=0,j=0,f,a,e,b,c=h.columns,g=c.length;for(f=0;f<g;f++){a=c[f];if(a.visible){b=a.el;b.css("left",k);k+=a.width}}if(d){h.m_ColumnWidthResize(d)}}});
Mini2.define("Mini2.ui.grid.column.StyleAction",{srcValue:null,value:null,style:null,opClassList:null,onInit:function(){},addClass:function(a){var b=this;var c={action:"add",className:a};if(b.opClassList){b.me.opClassList=[]}b.opClassList.push(c)},removeClass:function(a){var b=this;var c={action:"remove",className:a};if(b.opClassList){b.me.opClassList=[]}b.opClassList.push(c)},reset:function(b){var a=this;a.srcValue=b;a.value=b;a.style={};if(a.opClassList){a.opClassList=[]}},getHtml:function(a){var f=this,j=f.value;if(j!=f.srcValue){a.isAct=true;return(a.text||j)}if(a.formatFun){try{j=a.formatFun(j,a.formatStr)}catch(b){console.error("格式化错误:Mini2.util.Format.number = "+j+", format="+a.formatStr)}a.isAct=true}var c=false;for(var e in f.style){c=true;break}if(c&&j!=null){a.isAct=true;var g=$("<span>"+(a.text||j)+"</span>");if(c){g.css(f.style)}var h=$("<div></div>");h.append(g);var d=h.html();return d}else{return(a.text||j)}}},function(){var a=this;a.style={}});Mini2.define("Mini2.ui.grid.column.Colunm",{extend:"Mini2.ui.Component",width:120,autoTrim:true,headerWidth:120,handleWidth:4,headerAlign:"left",noWrap:true,emptyCellText:"&#160;",miType:"col",dataIndex:"",headerText:"&#160",renderer:false,editor:false,autoLock:false,resizable:true,hasCustomRenderer:false,lockedHeader:false,rowspan:undefined,menuDisabled:false,align:"left",isHeader:true,sortAsc:false,sortDesc:false,sortable:true,styleRules:null,tdCls:"",innerCls:"",setReadOnly:function(b){var a=this;a.readOnly=!!b;console.debug("设置只读: ",a);console.debug("设置只读    : ",a.readOnly);return a},renderTpl:['<td role="gridcell" class="mi-grid-cell mi-grid-td ">','<div class="mi-grid-cell-inner">',"</div>","</td>"],initComponent:function(){var c=this,d,b;d=c.renderer;if(d){if(typeof d=="string"){}c.hasCustomRenderer=true}else{if(c.defaultRenderer){c.scope=c;c.renderer=c.defaultRenderer}}if(c.clientId){window[c.clientId]=c}c.initStyleRule();try{var e=Mini2.ui.SecManager;e.reg(c.secFunCode,c,"visible");e.reg(c.secReadonly,c,"readonly")}catch(a){console.error("注册权限错误",a)}},setVisible:function(b){var a=this;b=!!b;if(b!==a.visible){a.visible=b;if(b){a.show()}else{a.hide()}}return a},bufferStyleAction:null,initStyleRule:function(){var me=this,i,rule,rules=me.styleRules;if(!rules||rules.length==0){return}console.debug("动态编译样式规则...");for(i=0;i<rules.length;i++){rule=rules[i];if(rule.exec){continue}if("script"==rule.role){rule.exec=eval("(function(T){ "+rule.script+"})");console.debug("动态编译为脚本函数: ",rule.exec)}}},execStyleRule:function(a){var d=this,c,e,f=d.styleRules;if(!f||f.length==0){return a.text||a.value}var g=d.bufferStyleAction;if(!g){d.bufferStyleAction=g=Mini2.create("Mini2.ui.grid.column.StyleAction")}g.reset(a.value);for(c=0;c<f.length;c++){e=f[c];if("script"==e.role){e.exec(g)}}var b=g.getHtml(a);return b},hasLockedHeader:function(){return this.lockedHeader},defaultRenderer:function(a){return a},getBufferCellEl:function(){var c=this,b,a=c.buffer;if(!a){c.buffer=a={}}b=a.cellEl;return b},setBufferCellEl:function(b){var c=this,b,a=c.buffer;if(!a){c.buffer=a={}}a.cellEl=b;return c},triggerClick:function(){var c=this,a=c.el,b=a.children(".mi-column-header-inner"),g=b.children(".mi-column-header-trigger"),d=c.menu,e=c.menuInst;var f=$(g).offset();var h=f.left;var i=f.top+g.height();if(!d){}if(d){if(!e){c.menuInst=e=Mini2.create("Mini2.ui.menu.Menu",{left:h,top:i,owner:c,items:d});e.bind("showed",function(){b.addClass("mi-column-header-open")});e.bind("hidded",function(){b.removeClass("mi-column-header-open")});e.render()}else{e.setLocal(h,i).show()}}},renderCell:function(){var b=this,a;a=b.getBufferCellEl();if(!a){a=Mini2.$joinStr(b.renderTpl);a.children(".mi-grid-cell-inner").css("text-align",b.align);b.setBufferCellEl(a)}a=a.clone();return a},getStore:function(){var b=this,a=b.displayStore;return a},renderer:function(s,j,b,n,o,e,p,q){var m=this,c,r,g=m.editor,h=m.editorMode,d=m.displayStore,f=m.displayField,l=m.itemValueField||"value",k=m.itemDisplayField||"text";if(f){try{r=n.get(f)}catch(i){throw new Error("获取字段“"+f+"”的值错误。")}var a={value:s,text:r,record:n,dataIndex:m.dataIndex,formatFun:null,format:null,isAct:false};r=m.execStyleRule(a);if(!Mini2.isBlank(r)){return r}}if(d&&("none"==h||(g&&"none"==g.mode))){c=d.filterFirstBy(l,s);if(c){r=c.get(f||k);var a={value:s,text:r,record:n,dataIndex:m.dataIndex,formatFun:null,format:null,isAct:false};r=m.execStyleRule(a);return r}}var a={value:s,record:n,dataIndex:m.dataIndex,formatFun:null,format:null,isAct:false};s=m.execStyleRule(a);if(m.placeholder&&Mini2.isBlank(s)){s='<span style="color:#c0c0c0;">'+m.placeholder+"</span>"}return s},clearInvalid:function(e,a,b){var d=this;if($(a).hasClass("mi-grid-cell-invalid")){var c=$(a).children(".mi-grid-cell-invalid-icon");if(c.length){$(c).remove()}$(a).removeClass("mi-grid-cell-invalid")}},markInvalid:function(i,a,b,g){var h=this,e=i.errors;if(g){e=g;if(e){c=e[0]}var d=$(a).children(".mi-grid-cell-invalid-icon");if(d.length){$(d).remove()}var f=c.type.toLowerCase();d=Mini2.$join(['<div role="presentation" class="mi-form-',f,'-msg mi-form-invalid-icon mi-grid-cell-invalid-icon" >',"</div>"]);d.attr("title",c.message);d.attr("data-errorqtip","");$(a).addClass("mi-grid-cell-invalid");$(a).append(d)}else{if(e&&e.length){var c=i.getErrors(b);if(c){c=c[0]}if(c){var d=$(a).children(".mi-grid-cell-invalid-icon");if(d.length){$(d).remove()}var f=c.type.toLowerCase();d=Mini2.$join(['<div role="presentation" class="mi-form-',f,'-msg mi-form-invalid-icon mi-grid-cell-invalid-icon" >',"</div>"]);d.attr("title",c.message);d.attr("data-errorqtip","");$(a).addClass("mi-grid-cell-invalid");$(a).append(d)}}}},getSortParam:function(){return this.dataIndex},doSort:function(i){var b=this,c="ASC",d="DESC",h="",a=b.direction,e=b.sortAsc,f=b.sortDesc,g=b.sortExpression,j=b.grid.getStore();if(!i){i=b.direction=(c==a?d:c)}else{i=b.direction=i.toUpperCase()}if(c==i&&e){h=e}else{if(d==i&&f){h=f}else{if(g){h=g+" "+i}else{h=b.dataIndex+" "+i}}}j.sort(h)}});
Mini2.define("Mini2.ui.grid.column.Action",{extend:"Mini2.ui.grid.column.Colunm",sortable:false,menuDisabled:true,innerCls:function(){var b=this,a="mi-grid-cell-inner-action-col";if(b.autoHide){a+=" mi-grid-cell-autohide"}return a},tdCls:"mi-action-col-cell",renderItem_ForIcon:function(a,b){var c=$('<img role="button" alt="" src="" class="mi-action-col-icon" data-qtip="" style="margin-left:3px;margin-right:3px; " click="alert(\'dddddddddd\')" />');c.addClass("mi-action-col-"+a).attr("src",b.icon).attr("data-qtip",b.tooltip).attr("itemId",a).attr("title",b.text);return c},renderItem_ForText:function(a,b){var c=$('<a role="button" alt="" href="#" class="mi-action-col-icon" data-qtip="" style="margin-left:3px;margin-right:3px;"></a>');c.attr("itemId",a).html(b.text);return c},renderItem_ForIconText:function(a,b){var c=Mini2.$joinStr(['<a role="button" alt="" href="#" class="mi-action-col" data-qtip="" ','style="margin-left:3px;margin-right:3px; ">','<img src="" class="mi-action-col-icon" data-qtip="" />','<span class="mi-action-col-text" style="margin-left: 4px;">',b.text,"</span>","</a>"]);c.cFirst(".mi-action-col-icon").attr("src",b.icon);c.attr("itemId",a);return c},renderer:function(s,m,a,n,p,b,q){var l=this,f,c,g,h,j=l.items,k=j.length,o;o='<table border="0" cellpadding="0" cellspacing="0" align="center" style="height:16px;"><tr>';for(f=0;f<k;f++){g=j[f];c=g.displayMode=(g.displayMode||"auto");if("auto"==c){var d=!Mini2.isBlank(g.icon);var e=!Mini2.isBlank(g.text);if(d&&e){c="icontext"}else{if(d&&!e){c="icon"}else{if(!d&&e){c="text"}}}}switch(c){case"icontext":h=l.renderItem_ForIconText(f,g);break;case"icon":h=l.renderItem_ForIcon(f,g);break;case"text":h=l.renderItem_ForText(f,g);break}var r=$("<div></div>").append(h);o+="<td>"+r.html()+"</td>"}o+="</tr></table>";return o},bindEvent:function(j,b,h,c,d,g,i){var f=this,a=b.find("[role='button']");$(a).muBind("mousedown",Mini2.emptyFn).muBind("mouseup",function(e){f.processEvent("mouseup",j,b,h,c,e,g,i);Mini2.EventManager.stopEvent(e)}).on("click",function(e){return false})},processEvent:function(t,u,a,o,b,d,n,r){var m=d.currentTarget,j,h,c,q=null,l=this.items,k=parseInt($(m).attr("itemId"));j=l[k];c=j.clickHandler;h=j.handler;if(c&&Mini2.isFunction(c)){q=c.call(m,{record:n,view:u,cell:a,recordIndex:o,cellIndex:b,event:d,row:r});if(q===false){return}}else{if(h&&Mini2.isFunction(h)){q=h.call(m,u,a,o,b,d,n,r);if(q===false){return}}}if(!Mini2.isBlank(j.href)){console.debug("item ---- ",j);var p=this.rendererHref_art;var i;try{i=p.call(this,j,n)}catch(f){console.error("地址模板解析处理失败,",j);return}var s=j.target.toLowerCase();if(Mini2.isBlank(s)){window.location.href=i}else{if("ecview"==s){EcView.show(i,j.targetText)}else{if("dialog"==s){var g=Mini2.createTop("widget.window",{url:i,text:j.targetText,width:400,height:300,state:"max",mode:true});g.show()}else{console.debug("未知标识",s)}}}return}},rendererHref_j:function(a,b){},rendererHref_art:function(b,d){var c=this,e,a=b.artTemplate;if(!a){b.artTemplate=a=template.compile(b.href)}e=a({T:d});return e}});
Mini2.define("Mini2.ui.grid.column.Boolean",{extend:"Mini2.ui.grid.column.Colunm",trueText:"true",falseText:"false",undefinedText:"&#160;",renderer:function(h,d,a,e,f,b,g){var c=this;if(h===undefined){return c.undefinedText}if(!h||h==="false"){return c.falseText}return c.trueText}});
Mini2.define("Mini2.ui.grid.column.Password",{extend:"Mini2.ui.grid.column.Colunm",passwordChar:false,defaultRenderer:function(f){var b=this,d=b.passwordChar,e=f,c=b.notDisplayValue;if(Mini2.isBlank(f)||(c&&f==c)){return""}try{e=Mini2.String.rightPad("",f.length,d||"*")}catch(a){console.error("格式化错误:  "+f,a)}return e},renderer:function(g,c,a,d,e,b,f){return this.defaultRenderer(g)}});
Mini2.define("Mini2.ui.grid.column.Date",{extend:"Mini2.ui.grid.column.Colunm",format:"Y-m-d",defaultRenderer:function(b){var a=this,c;if(b&&!Mini2.isDate(b)){b=Mini2.Date.parse(b,a.format)}c=Mini2.Date.format(b,a.format);return c},renderer:function(o,h,a,i,j,b,n){var g=this,p,k=o;if(o==null){return o}var f=Mini2.isDate(o);if(o&&!f){if(o.length<=10){o+=" 0:0:0"}if(($.support&&$.support.mozilla)||Mini2.support.msie||Mini2.support.mozilla){var l=o.lastIndexOf("."),d,m,c;if(l>0){d=o.substring(0,l);m=o.substr(l+1);d=d.replace(/-/g,"/");c=new Date(d);try{c.setMilliseconds(m)}catch(e){console.log("错误啦...."+e.message)}o=c}else{o=new Date(o)}}else{o=new Date(o)}}p=Mini2.Date.format(o,g.format);return p}});
Mini2.define("Mini2.ui.grid.column.Time",{extend:"Mini2.ui.grid.column.Colunm",format:"H:m",defaultRenderer:function(b){var a=this,c;if(b&&!Mini2.isDate(b)){b=Mini2.Date.parse(b,a.format)}c=Mini2.Date.format(b,a.format);return c},getTimeObj:function(f){var c=this;if(Mini2.isNumber(f)){var b=f%3600;var e=b%60;var a=(f-b)/3600;var d=(b-e)/60;return{hour:a,minute:d,sec:e}}else{}},renderer:function(j,d,a,e,f,b,h){var c=this,k,g=j;var i=c.getTimeObj(j);var k=i.hour+":"+i.minute;return k}});
Mini2.define("Mini2.ui.grid.column.CheckColumn",{extend:"Mini2.ui.grid.column.Colunm",trueText:null,falseText:null,setCheckCell:function(b,a){var d=this,e=b.store,c=b.dataIndex;e.each(function(h,f,g){if("reverse"==a){var j=!!h.get(c);h.set(c,!j)}else{h.set(c,a)}});return d},menu:[{text:"全选",click:function(){var b=this,a=b.owner;a.setCheckCell(a,true)}},{text:"反选",click:function(){var b=this,a=b.owner;a.setCheckCell(a,"reverse")}},{text:"全不选",click:function(){var b=this,a=b.owner;a.setCheckCell(a,false)}}],align:"center",renderTpl:['<td role="gridcell" class="mi-grid-cell mi-grid-td mi-grid-cell-checkcolumn">','<div class="mi-grid-cell-inner mi-grid-cell-inner-checkcolumn">',"</div>","</td>"],falseIconTpl:'<img class="mi-grid-checkcolumn" src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style=" vertical-align:middle;">',trueIconTpl:'<img class="mi-grid-checkcolumn mi-grid-checkcolumn-checked" src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" style=" vertical-align:middle;" >',defaultRenderer:function(a){return a},renderer:function(d,b){var a=this,c;if(!d||d==="false"||(typeof d=="string"&&d.toLowerCase()=="false")){c=a.falseIconTpl;if(a.falseText){c+='<span style="vertical-align:middle;margin-left: 4px;">'+a.falseText+"</span>"}}else{c=a.trueIconTpl;if(a.trueText){c+='<span style="vertical-align:middle;margin-left: 4px;">'+a.trueText+"</span>"}}return c}});
Mini2.define("Mini2.ui.grid.column.RowNumberer",{extend:"Mini2.ui.grid.column.Colunm",headerText:"&#160",sortable:false,align:"center",width:23,dataIndex:"",rowspan:undefined,menuDisabled:true,autoLock:true,resizable:false,renderTpl:['<td role="gridcell" class="mi-grid-cell mi-grid-td mi-grid-cell-row-numberer ">','<div class="mi-grid-cell-inner mi-unselectable mi-grid-cell-inner-row-numberer">',"</div>","</td>"],initComponent:function(){this.constructor.base.initComponent();var b=this,c=Mini2.SystemInfo,a=c.table.cols.rowNumberer;b.width=a.width||23},defaultRenderer:function(a){return a},renderCell:function(){var b=this,a;a=b.getBufferCellEl();if(!a){a=Mini2.$join(b.renderTpl);if("left"!=b.align){a.css("text-align",b.align)}b.setBufferCellEl(a)}a=a.clone();return a},renderer:function(j,c,a,e,g,b,i){var h=this.rowspan,d=i.currentPage,f=e.index;return(d*i.pageSize+g+1)}});
Mini2.define("Mini2.ui.grid.column.RowCheckColumn",{extend:"Mini2.ui.grid.column.Colunm",align:"center",width:40,renderTpl:['<td role="gridcell" class="mi-grid-cell mi-grid-td mi-grid-cell-checkcolumn">','<div class="mi-grid-cell-inner mi-unselectable mi-grid-cell-inner-checkcolumn">',"</div>","</td>"],initComponent:function(){var b=this,c,a;c=b.renderer;if(c){if(typeof c=="string"){}b.hasCustomRenderer=true}else{if(b.defaultRenderer){b.scope=b;b.renderer=b.defaultRenderer}}b.lockedHeader=true;b.headerWidth=40},getHeaderConfig:function(){var a=this,b=a.showHeaderCheckbox!==false;return{isCheckerHd:b,text:"&#160;",clickTargetName:"el",width:a.headerWidth,sortable:false,draggable:false,resizable:false,hideable:false,menuDisabled:true,dataIndex:"",cls:b?"mi-column-header-checkbox ":"",renderer:Mini2.Function.bind(a.renderer,a),editRenderer:a.editRenderer||a.renderEmpty,locked:a.hasLockedHeader()}},checkerOnCls:"mi-grid-checkcolumn-checked",toggleUiHeader:function(a){this.grid.setHeaderCheck(a)},defaultRenderer:function(a){return a},onHeaderClick:function(b,a,c){var d=this;if(a.isCheckerHd){d.grid.setRowCheckAll(c)}},renderEmpty:function(){return"&#160;"},renderer:function(b,a){if(!b||b===false||b==="false"){return'<img class="mi-grid-checkcolumn" src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" >'}return'<img class="mi-grid-checkcolumn mi-grid-checkcolumn-checked" src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="  >'},onSelectChange:function(){if(!this.suspendChange){this.updateHeaderState()}},updateHeaderState:function(){var h=this,g=undefined,a,e,f,d=h.grid,c=d.rowCheckColumn,i,b=0;i=$(d.tbodyEl).children();if(i.length){$(i).each(function(){a=$(this).children("td:eq("+c.index+")");e=a.find("img.mi-grid-checkcolumn");if(e.length){f=$(e).hasClass("mi-grid-checkcolumn-checked");if(f){b++}}});if(b===i.length){g=true}else{if(0===b){g=false}}}else{g=false}h.toggleUiHeader(g);return h}});
Mini2.define("Mini2.ui.grid.column.Number",{extend:"Mini2.ui.grid.column.Colunm",format:"0",align:"right",defaultValue:0,defaultRenderer:function(a){return Mini2.util.Format.number(a,this.format)},renderer:function(n,g,b,j,l,c,m){var f=this,k=n,e=f.format,h=f.notDisplayValue,i=Mini2.util.Format.number;if(h&&n==h){return""}var a={value:n,record:j,dataIndex:f.dataIndex,formatFun:i,format:e,isAct:false};try{k=f.execStyleRule(a)}catch(d){console.error('渲染"样式规则"错误',d)}if(!a.isAct){try{k=i(n,e)}catch(d){alert("格式化错误:Mini2.util.Format.number = "+n+", format="+e)}}return k}});
Mini2.define("Mini2.ui.grid.column.Template",{extend:"Mini2.ui.grid.column.Colunm",content:"",artTemplate:null,vurTemplate:null,engineName:"j",renderer:function(o,f,b,g,j,c,l,m,i,a){var e=this,n=e.engineName,h,p,k=o;if("j"==n){h=e.renderer_j}else{if("vue"==n){h=e.renderer_vue}else{if("art"==n){h=e.renderer_art}}}try{p=h.call(e,o,f,b,g,j,c,l,m,i,a)}catch(d){console.error("输出错误 ",d)}return p},renderer_j:function(m,f,b,g,i,c,k,l,h,a){var e=this,n,d=e.jTemplate,j=m;if(!d){d=$.createTemplate(e.content);e.jTemplate=d}return d.get(g,{value:m,row_index:i,col_index:c})},curVueTemlateId:null,regVue:function(a,e){var d=this,f=d.vueTemplate,b="coltemplate";if(!f){var c="templatecolumn";f=Vue.extend({template:d.content,props:["t"]});d.vueTemplate=f;Vue.component(c,f);Mini2.vue=Mini2.vue||{};Mini2.vue.component=Mini2.vue.component||{};Mini2.vue.component[c]=true;d.curVueTemlateId=c}setTimeout(function(){d.vue=new Vue({el:a[0],data:{t:e}})},1000)},renderer_vue:function(l,e,b,f,h,c,j,k,g,a){var d=this,m,i=l;d.regVue(a,f);return'<templatecolumn :t="t" ></templatecolumn>'},renderer_art:function(m,f,c,g,i,d,k,l,h,b){var e=this,n,a=e.artTemplate,j=m;if(!a){e.artTemplate=a=template.compile(e.content)}n=a({data:g});return n}});
Mini2.define("Mini2.ui.grid.column.TextArea",{extend:"Mini2.ui.grid.column.Colunm",renderTpl:['<td role="gridcell" class="mi-grid-cell mi-grid-td ">','<div class="mi-grid-cell-inner" style="white-space:pre-line;">',"</div>","</td>"],renderer:function(i,c,a,e,f,b,g,h){var d=this;if(!Mini2.isBlank(i)){i=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />")}else{i="&nbsp;"}return i}});
Mini2.define("Mini2.ui.grid.column.MoreFileColumn",{extend:"Mini2.ui.grid.column.Colunm",thumbWidth:72,thumbHeight:72,innerCls:"mi-file-panel",innerAutoHide:false,dataType:"text",view:"large",IMAGE_TYPES:[".jpg",".jpeg",".gif",".png",".bmp"],isImgType:function(a){var b=this;return Mini2.Array.contains(b.IMAGE_TYPES,a,true)},createFileEl:function(b){var e=this,h=e.thumbWidth||16,g=e.thumbHeight||16;var a=b.url.split("/");var f=a[a.length-1];var d=b.url.lastIndexOf(".");var i=b.url.substring(d).toLowerCase();var c;console.debug("cfg ==== ",b);console.debug("type ==== ",i);if("list"==e.view){c=Mini2.$join(['<a class="" style="display:block;margin-bottom:6px;" target="_blank" href="',b.url,'" title="',b.title,'">','<img class="mi-file-image" src="',b.thumb_url||b.url,'" data-original=',b.url,' style="height:16px;height:16px; margin-right:4px;">',"<span>",b.title,"</span>","</a>"])}else{if("large"==e.view){if(!e.isImgType(i)){c=Mini2.$join(['<a class="mi-file thumb " style="width:',e.thumbWidth+10,"px;height:",e.thumbHeight+10,'px;" target="_blank"  href="',b.url,'">','<div class="mi-file-inner thumb-inner" style="width:',e.thumbWidth,"px;height:",e.thumbHeight,'px;">','<img class="mi-file-image thumb-img" src="',b.thumb_url||b.url,'"  style="height:100%;">',"</div>","</a>"])}else{c=Mini2.$join(['<div class="mi-file thumb " style="width:',e.thumbWidth+10,"px;height:",e.thumbHeight+10,'px;" target="_blank"  href="',b.url,'">','<div class="mi-file-inner thumb-inner" style="width:',e.thumbWidth,"px;height:",e.thumbHeight,'px;">','<img class="mi-file-image thumb-img" src="',b.thumb_url||b.url,'" data-original=',b.url,' style="height:100%;">',"</div>","</div>"])}}}c.attr("title",b.title);c.attr("data-file-id",b.file_id);if(e.isImgType(i)){c.addClass("image")}else{var j=i.substring(1);$(c).find(".mi-file-image").attr("src","/res/file_icon_256/"+j+".png")}return c},getFieldEl:function(){var c=this,d=c.slicer,b;if("large"==c.view){b=Mini2.$join(["<div>",'<div class="file-inner"  style=" padding:0px; height: ',c.thumbHeight+10,'px; overflow: hidden;">',"</div>","</div>"])}else{if("list"==c.view){b=Mini2.$join(["<div>",'<div class="file-inner"  style=" padding:0px; height: auto; ">',"</div>","</div>"])}}var a=$(b).children(".file-inner");b.css({width:c.width,height:c.height});if(c.readOnly){b.attr("readonly","readonly")}return b},addForText:function(d,a){var e=this;if(Mini2.isString(a)){var f=a.split("||");a={thumb_url:f[1]||f[0],url:f[0],title:f[2],code:f[3]||""}}try{var c=e.createFileEl(a);d.append(c)}catch(b){console.error("text",a);console.error("添加对象失败",b)}},renderer:function(t,h,b,o,p,c,q,r){var m=this,g;g=m.getFieldEl();try{var j=$(g).find(".file-inner");var d=0;if("text"==m.dataType){if(!Mini2.isBlank(t)){var l=t.split("\n");for(var k=0;k<l.length;k++){var s=l[k];if(Mini2.isBlank(s)){continue}try{m.addForText(j,s);d++}catch(e){console.error("text",s);console.error("添加对象失败",e)}}if(d==0){return""}}else{return""}}var n="boxer"+Mini2.newId();var a=j.children(".image");a.attr("rel",n);if("large"==m.view){j.css("width",d*(m.thumbWidth+10+12))}else{if("view"==m.view){j.css("height",d*(16))}}}catch(f){console.error("eeeeeeeeeeee",f)}return j},bindEvent:function(k,a,i,b,c,h,j){var g=this,f=a.find(".file-inner:first");a.children(".mi-grid-cell-inner").css("max-height",g.thumbHeight+36);var d=f.children();if(window.Viewer){if(0!==d.length){g.initPreviewEl(a,f)}}else{d.boxer({})}},initPreviewEl:function(a,c){var d=this,e=a.data("preview_time"),b=a.data("preview_el");if(e){e.resetStart();return}e=Mini2.setTimer(function(){if(b){b.update()}else{b=new Viewer(a[0],{url:"data-original"});a.data("preview_el",b)}},[1000,1]);a.data("preview_time",e)}});
Mini2.define("Mini2.ui.grid.column.PropertyColumn",{extend:"Mini2.ui.grid.column.Colunm",isPropertyColumn:true,dateFormat:"Y-m-d",trueText:"true",falseText:"false",propEditor:{},defaultRenderer:function(a){return a},renderer:function(h,d,a,e,f,b,g){var c=this,i=e.data.Type||"string";if("bool"==i&&Mini2.isBoolean(h)){return c.renderBool(h)}else{if("date"==i&&Mini2.isDate(h)){return Mini2.Date.format(h,c.dateFormat)}}return h},renderBool:function(a){return this[a?"trueText":"falseText"]},});
Mini2.define("Mini2.ui.grid.feature.Summary",{renderTo:Mini2.getBody(),grid:null,el:null,columns:null,height:30,width:1024,panelTpl:['<div class="mi-component mi-docked-summary mi-docked-summary-bottom  mi-component-default mi-docked-bottom mi-component-docked-bottom mi-component-default-docked-bottom mi-noborder-rbl" ','style="overflow: hidden; width: 489px; right: auto; left: 0px; top: 352px; height:30px;">','<div data-ref="innerCt" class="innerCt" role="presentation" style="width: 506px; position: absolute; ">',"</div>","</div>"],tableTpl:['<table data-ref="item" cellpadding="0" cellspacing="0" class="mi-grid-item mi-grid-with-col-lines" ',">","<tbody>",'<tr class="mi-grid-row-summary " tabindex="-1">',"</tr>","</tbody>","</table>"],cellTpl:['<td class="mi-grid-cell mi-grid-td mi-grid-cell-first mi-unselectable" ','style="width: 125px;" >','<div unselectable="on" class="mi-grid-cell-inner " style="text-align: left;">',"&nbsp;","</div>","</td>"],initComponent:function(){var a=this,b=a.store;a.items={}},bindStore:function(){var a=this,b=a.store;$(b).muBind("summarychnaged",a,a.store_summaryChnaged)},store_summaryChnaged:function(a,c){var b=a.data;if(c){b.setSummary.call(b,c)}},setSummary:function(e,i){var h=this,c=h.columns,g=h.items,a,f;if(Mini2.isString(e)){f={};f[e]=i}else{f=e}for(e in f){a=g[e];if(a){i=f[e];var b=h.findColumnByField(e);if(!Mini2.isBlank(b.summaryFormat)){if(Mini2.isNumber(i)&&!Mini2.String.isBlank(b.format)){try{i=Mini2.util.Format.number(i,b.format)}catch(d){console.error("格式化数字错误.",d)}}var j=$.format(b.summaryFormat,i);a.html(j)}else{a.html(i)}}}},findColumnByField:function(c){var e=this,b=e.columns,a;for(var d=0;d<b.length;d++){a=b[d];if(a.dataIndex==c){return a}}return null},createCell:function(c){var d=this,a,b;a=Mini2.$joinStr(d.cellTpl);b=a.children(".mi-grid-cell-inner");if(c.summaryType){b.data("me",c);d.items[c.dataIndex]=b;b.css({"font-size":"14px","font-weight":"bold"});b.css({"text-align":c.align})}return a},createCellGroups:function(){var e=this,d=0,b,c=e.columns,g,f,a,h=0;g=Mini2.$joinStr(e.tableTpl);f=g.find(".mi-grid-row-summary");for(;d<c.length;d++){b=c[d];if(!b){continue}a=e.createCell(b);a.css({width:(b.width-1)+"px"});a.children(".mi-grid-cell-inner").width(b.width-1);h+=b.width;f.append(a)}return g},setWidth:function(e){var c=this,a=c.el,b=c.innerCtEl,d=c.tableEl;c.width=e;a.css("width",e-20);b.css("width",e);return c},scrollLeft:function(d){var c=this,a=c.el,b=c.innerCtEl;b.css("left",-d);return c},resizeCellWidth:function(){var f=this,e,c,d=f.columns,h=f.tableEl,g,a,j=0;g=h.find(".mi-grid-row-summary");var b=$(g).children(".mi-grid-cell");for(e=0;e<d.length;e++){c=d[e];if(c.visible){a=$(b[e]);a.css({width:(c.width-1)+"px"});a.children(".mi-grid-cell-inner").width(c.width-9);j+=c.width;a.show()}else{a.hide()}}},reset:function(){var c=this,a=c.el,d,b;$(c.tableEl).remove();c.innerCtEl=b=a.children(".innerCt");c.tableEl=d=c.createCellGroups();b.append(d);var e=c.grid.getWidth();c.setWidth(e)},render:function(){var d=this,e=d.store,b=d.grid,a,c,f;d.el=a=Mini2.$joinStr(d.panelTpl);if(d.applyTo){$(d.applyTo).append(a)}else{$(d.renderTo).append(a)}d.innerCtEl=c=a.children(".innerCt");d.tableEl=f=d.createCellGroups();c.append(f);if(e&&e.summary){d.setSummary(e.summary)}d.bindStore();var g=d.grid.getWidth();d.setWidth(g)}},function(a){var b=this;Mini2.apply(b,a);b.initComponent()});
Mini2.define("Mini2.ui.grid.column.TreeColumn",{extend:"Mini2.ui.grid.column.Colunm",format:"0",align:"right",defaultValue:0,renderTpl:['<td role="gridcell" class="mi-grid-cell mi-grid-td mi-grid-cell-treecolumn">','<div class="mi-grid-cell-inner mi-grid-cell-inner-treecolumn tree-node" style="padding-top:0px;padding-bottom:0px;" >',"</div>","</td>"],defaultRenderer:function(a){return a},renderCell:function(){var c=this,a,b;a=c.getBufferCellEl();if(!a){a=Mini2.$joinStr(c.renderTpl);b=a.children(".mi-grid-cell-inner");b.css("text-align",c.align);c.setBufferCellEl(a)}a=a.clone();return a},renderer:function(o,f,b,h,l,c,m,q,k,a){var e=this,i,j=m.rootId,p=m.valueField,n=m.textField,g=m.parField;try{i='<i class="tree-icon tree-ocl" ></i><a class="tree-anchor"><i class="tree-icon tree-themeicon"></i> '+o+"</a>"}catch(d){alert(d.message)}return i},bindEvent:function(j,b,h,c,d,g,i){var f=this,a=b.find("i.tree-icon");$(a).muBind("mousedown",Mini2.emptyFn).muBind("mouseup",function(e){f.processEvent("mouseup",j,b,h,c,e,g,i);Mini2.EventManager.stopEvent(e)})},processEvent:function(m,n,a,k,b,d,j,l){var c=this,h=d.currentTarget,f,g=this.items,i=$(l).data("tree-node");n.toggleNode(i,l,a)}});
Mini2.define("Mini2.ui.grid.CellContext",{isCellContext:true,constructor:function(a){this.view=a},setPosition:function(c,a){var b=this;if(arguments.length===1){if(c.view){b.view=c.view}a=c.column;c=c.row}b.setRow(c);b.setColumn(a);return b},setRow:function(b){var a=this;if(b!==undefined){if(typeof b==="number"){a.row=Math.max(Math.min(b,a.view.dataSource.getCount()-1),0);a.record=a.view.dataSource.getAt(b)}else{if(b.isModel){a.record=b;a.row=a.view.indexOf(b)}else{if(b.tagName){a.record=a.view.getRecord(b);a.row=a.view.indexOf(a.record)}}}}},setColumn:function(a){var c=this,b=c.view.ownerCt.columnManager;if(a!==undefined){if(typeof a==="number"){c.column=a;c.columnHeader=b.getHeaderAtIndex(a)}else{if(a.isHeader){c.columnHeader=a;c.column=b.getHeaderIndex(a)}}}}});
Mini2.define("Mini2.ui.grid.CellEditor",{extend:"Mini2.ui.Editor",log:Mini2.Logger.getLogger("Mini2.ui.grid.CellEditor"),grid:null,el:null,inputObj:null,renderTo:Mini2.getBody(),rowEl:null,cellEl:null,record:null,columnHeader:null,xtype:"TextColumn",readOnly:false,isInput:true,initComponent:function(){var a=this},focus:function(){var b=this,a=b.log;b.inputObj.focus();return b},getBox:function(){var a=Mini2.$joinStr(['<div class="',"mi-editor ","mi-small-editor ","mi-grid-editor ","mi-grid-cell-editor ","mi-layer ","mi-editor-default ",'" ','style="right: auto;left: 0px;top: -91px;z-index: 19000;position: relative;" ',">","</div>"]);return a},css:function(c,d){var b=this,a=b.el;return a.css(c,d)},setSize:function(f,b){var d=this,a=arguments,e=a[0],c=d.inputObj;if(a.length&&typeof e=="object"){c.setWidth(e.width);c.setHeight(e.height)}else{c.setWidth(f);c.setHeight(b)}return d},setWidth:function(b){var a=this;a.inputObj.setWidth(b);return a.el.css("width",b)},setHeight:function(b){var a=this;a.inputObj.setHeight(b);return a.el.css("height",b)},show:function(){var a=this;a.visible=true;a.el.show();return a},setRowCell:function(c,a){var b=this;b.rowEl=c;b.cellEl=a;return b},setRow:function(b){var a=this;a.rowEl=b;return a},setCell:function(a){var b=this;b.cellEl=a;return b},setCellValue:function(c){var b=this,a=b.log;b.inputObj.setValue(c);return b},setValue:function(b){var a=this;a.setCellValue(b);return a},isVisible:function(){var b=this,a=b.el;return $(a).is(":visible")},isHidden:function(){var b=this,a=b.el;return $(a).is(":hidden")},hide:function(){var b=this,a=b.cellEl;if(!b.visible){return}b.visible=false;b.el.hide();if(b.editing&&b.lastKeyCode!="27"){b.inputSave(a);b.endEdit()}$(a).cFirst("div.mi-grid-cell-inner").show();b.cellEl=null;return b},layoutReset:function(){var a=this;a.inputObj.layoutReset()},inputSave:function(a,d){var h=this,g=h.log,e=h.inputObj;if(h.editing){if(h.autoTrim){var j=e.getValue();if(j&&Mini2.isString(j)){var b=Mini2.String.trim(j);if(b!=j){e.setValue(b)}}}var f=(e.isValueChanged?e.isValueChanged():true);if(f){var k=h.inputObj.getValue();var c=h.columnHeader.dataIndex;var i=h.getNewValuesForMap(h.record,e.curRecord);if(i){i[c]=i[c]||k}else{if(d&&h.mapItems&&d.keydown&&13===d.keyCode){}else{i={};i[c]=k}}if(i){h.record.set(i)}}}},getNewValuesForMap:function(g,j){var e=this,c=e.log,a,b,d=e.mapItems,f=null,k,h;if(j&&d){for(a=0;a<d.length;a++){b=d[a];h=b.srcField;if(""==h||""==b.targetField){continue}if(j){if(j.get){k=j.get(h)}else{k=j[h]}}else{k=null}f=f||{};f[b.targetField]=k}}return f},isFirstCursorPos:function(){var b=this,a=b.inputObj;if(a.isFirstCursorPos){return a.isFirstCursorPos()}return false},isLastCursorPos:function(){var b=this,a=b.inputObj;if(a.isLastCursorPos){return a.isLastCursorPos()}return false},proKeyEvent:function(a){var c=this,b=c.inputObj;c.onKeydown(a);return false},proKeyEvent2:function(a){var c=this,b=c.inputObj;if(b&&b.proKeyEvent){return b.proKeyEvent(a)}return false},lastKeyCode:0,onKeydown:function(b){var g=this,f=g.log,c=g.inputObj,a=g.cellEl;var d=b.keyCode;g.lastKeyCode=d;if(13==d){g.proKeyEvent2({keyCode:d});if(b.stoped){return}g.inputSave(g.cellEl,{keydown:true,keyCode:d});g.endEdit();Mini2.ui.FocusMgr.setControl(g.cellEl);g.visible=false;g.el.hide();$(a).cFirst("div.mi-grid-cell-inner").show();g.cellEl=null}else{if(9==d){g.inputSave(g.cellEl);g.endEdit();var h=$(g.cellEl).next();if(h.length){g.grid.autoFocusScroll(h);Mini2.EventManager.stopEvent(b)}g.visible=false;g.el.hide();$(a).cFirst("div.mi-grid-cell-inner").show();g.cellEl=null}else{if(27==d){g.record.cancelEdit();Mini2.ui.FocusMgr.setControl(g.cellEl);g.visible=false;g.el.hide();$(a).cFirst("div.mi-grid-cell-inner").show();g.cellEl=null;Mini2.EventManager.stopEvent(b)}else{}}}},gotoNextCell:function(i,b){var g=this,f=g.log,d=g.grid;var h=g.columnHeader.index+1;var a=d.m_Cols[h];if(a.miType=="checkcolumn"){g.hide();Mini2.ui.FocusMgr.setControl(i,d,null);return}else{if(a.miType=="rowcheckcolumn"){return}else{if(a.miType=="actioncolumn"){return}}}if(!a.editor||a.editorMode=="none"){Mini2.ui.FocusMgr.setControl(i,d,null)}else{var c=d.getEditor(a,g.record);d.showEditor(i,i,g.rowEl,a,g.record,c);Mini2.EventManager.stopEvent(b)}},onKeyup:function(a){var c=this,b=a.keyCode;if(9==b){var d=$(c.cellEl).next();if(d.length){c.gotoNextCell(d,a)}}else{if(13==b){console.debug("休息休息");Mini2.EventManager.stopEvent(a)}else{c.on("keyup",a)}}},bind_key:function(a){var b=this;a.bind("keydown",function(c){b.onKeydown(c)}).bind("keyup",function(c){b.onKeyup(c)})},bind_mouse:function(a){var b=this;$(b.inputObj).muBind("mousedown",function(c){b.on("mousedown",c)}).muBind("mouseup",function(c){b.on("mouseup",c)}).muBind("mousemove",function(c){})},render:function(a){var g=this,f=g.log,b="Mini2.ui.form.field",c,d,h,e;g.el=d=$(g.getBox());g.visible=false;d.data("me",g);switch(g.xtype.toLowerCase()){case"combobox":c=b+".ComboBox";break;case"comboboxbase":c=b+".ComboBoxBase";break;case"datefield":c=b+".Date";break;case"numberfield":c=b+".Number";break;case"trigger":c=b+".Trigger";break;case"textarea":c=b+".TextArea";break;case"timefield":c=b+".Time";break;case"more_file":c=b+".MoreFileEditor";break;case"password":c=b+".Password";break;default:c=b+".Text";break}h=Mini2.applyIf({renderTo:d,scope:g,grid:g.grid,autoTrim:g.autoTrim,labelable:{hideLabel:true},placeholder:g.placeholder},g.config);g.inputObj=e=Mini2.create(c,h);e.render();$(g.renderTo).append(d);g.bind_key(e);g.bind_mouse(e);$(g).muBind("focusin",function(i){var j=this;j.inputObj.focus()}).muBind("focusout",function(i,k){var j=this;if(k.data!=j.cellEl){if(27!=j.lastKeyCode){j.inputSave(k.data);j.endEdit()}}if(k.target!=j){j.hide();j.inputObj.on("focusout",k)}})},hideDropDownPanel:function(){var b=this,a=b.inputObj;if(a&&a.hideDropDownPanel){b.inputSave(b.cellEl);a.hideDropDownPanel()}return b},init:function(a){this.grid=a},onInit:function(){this.init()},isCellEditable:function(b,a){},input_mapping:function(a){var d=this,f={},b=d.inputObj,c=d.mapItems,e=d.record;if(c){$(c).each(function(){var g=this.srcField;var h=this.targetField;f[h]=a[g]})}e.set(f)},startEdit:function(f,b,c){var e=this,d=e.inputObj,a=b;f.beginEdit();e.record=f;e.columnHeader=a;c.originalValue=c.value=f.get(a.dataIndex);if(d.setOldValue){d.setOldValue(c.value)}else{d.oldValue=c.value}d.record=f;d.dataIndex=a.dataIndex;d.mapItems=e.mapItems;d.cellDisplayField=a.displayField;d.map=e.input_mapping;e.setCellValue(c.value);e.show();e.editing=true;return e},showEditor:function(b,a,c){},getEditor:function(b,a){},getCell:function(c,a){var b=this;return b.cell},cancelEdit:function(){var a=this,b=a.record;b.cancelEdit();a.editing=false},endEdit:function(){var a=this,b=a.record;b.endEdit();a.editing=false},onShow:function(){},onHide:function(){},afterRender:function(){},onEditorTab:function(){},startEditByPosition:function(c){var b=this,a=b.inputObj;b.css({left:c.left,top:c.top+2});if(a&&a.onPositionChanged){a.onPositionChanged()}return b},remove:function(){var a=this;a.el.remove();return a}});
Mini2.define("Mini2.ui.tree.Panel",{extend:"Mini2.ui.Component",log:Mini2.Logger.getLogger("Mini2.ui.tree.Panel",console),treeCls:Mini2.baseCSSPrefix+"tree-panel",rootId:"0",store:false,rowLines:false,lines:true,rootVisible:true,displayField:"text",checkbox:false,nodeRenderer:null,el:null,data:false,showMenu:true,showMenuDelete:true,showMenuNew:true,showMenuRename:true,valueField:"value",textField:"text",parField:"par_id",typeField:"type",iconField:"icon",autoExpand:true,nodeTypeText:"分类",rootText:"分类目录",dymLoad:true,showRoot:true,contextMenu:[],focusNode:null,triggerEvent_create:false,triggerEvent_rename:false,triggerEvent_remove:false,triggerEvent_selected:false,nodeSelected:function(a){this.bind("nodeSelected",a)},nodeExpand:function(a){this.bind("nodeExpand",a)},nodeRename:function(a){this.bind("nodeRename",a)},root:null,isTree:true,initComponent:function(){var me=this;console.debug("初始化 TreePanel.initComponent()");if(me.id&&undefined==me.clientId){me.clientId=me.id}if(me.selected){me.nodeSelected(me.selected);delete me.selected}if(me.expand){me.nodeExpand(me.expand);delete me.expand}if(me.rename){me.nodeRename(me.rename);delete me.rename}var nodeRenderer=me.nodeRenderer;if(nodeRenderer){if(Mini2.isString(nodeRenderer)){try{var funStr="(function(e, node){"+nodeRenderer+"})";var fun=eval(funStr);console.debug("fun = ",fun);delete me.nodeRenderer;me.nodeRenderer=fun}catch(ex){console.error("编译动态脚本 nodeRenderer 函数错误:"+funStr)}}}},setSize:function(d,b){var c=this,a=c.el;if(undefined!=d){a.css("width",d)}if(undefined!=b){a.css("height",b)}},css:function(c,d){var b=this,a=b.el;return a.css(c,d)},isVisible:function(){var b=this,a=b.el;return a.is(":visible")},getStore:function(){var a=this;if(!a.store){var b=Mini2.create("Mini2.data.Store",{storeId:"MiniStore_"+Mini2.getIdentity()});a.bindStore(b)}return a.store},initStore:function(){var a=this,b;if(a.store){console.info("开始初始化数据仓库 TreePanel.initStore().");b=Mini2.data.StoreManager.lookup(a.store);delete a.store;a.store=b;a.bindStore(b);a.proLineData(b.data)}},bindStore:function(b){var a=this;$(b).muBind("update",a,a.store_update).muBind("add",a,a.store_add).muBind("remove",a,a.store_remove).muBind("load",a,a.store_load).muBind("clear",a,a.store_clear)},store_remove:function(b,h){var f=b.data,e=f.log,a=f["delete"];for(var c=0;c<h.length;c++){var d=h[c];var g=f.id+"_NODE_"+d;a.call(f,g)}},store_update:function(a,f,e,d){var c=a.data,b=c.log;b.debug("TreeStore 触发 Update 事件")},store_clear:function(a){var c=a.data,b=c.log;b.debug("TreeStore 触发 Clear 事件");c.clear()},proLineData:function(p){var g=this,b=g.el,d,o,e=p.length,l=g.parField,n,j,q,h=[],a=g.checkNodes;var f=p;var c=g.toGroup(p);var m=g.rootId+"";var f=c[m]||[];var s=g.event_selected;g.event_selected=false;if(g.showRoot&&g.store){var t=g.store;var r=t.getById(m);if(r){r.expand=true;j=g.record_2_node.call(g,r)}else{r={};r[g.idField||g.valueField]=g.rootId;r[g.textField]=g.rootText;r.expand=true;j=g.record_2_node.call(g,r)}j.li_attr.child_loaded=true;g.add(j);g.proGroupsToTree.call(g,c,r,j,h);if($(b).jstree("is_closed",j)){$(b).jstree("toggle_node",j)}q=j}else{if(f&&f.length){for(d=0;d<f.length;d++){o=f[d];j=g.record_2_node.call(g,o);g.add(j);g.proGroupsToTree.call(g,c,o,j,h)}}}if(g.checkbox&&a){d=a.length;while(d--){a[d]=g.id+"_NODE_"+a[d]}g.checkNode(a);delete g.checkNodes;setTimeout(function(){var i=$(b).jstree("get_node",q,true).children(".jstree-children");var u=$(i).children(".jstree-open");$(u).each(function(){$(b).jstree("close_node",this,false)})},10)}g.event_selected=s;if(h){for(var d=0;d<h.length;d++){var j=h[d];if(j.has_child){var k=$("#"+j.id);k.removeClass("jstree-leaf").addClass("jstree-closed")}}}},store_add:function(a,c,h){var f=a.data,b,l,m=h,d=m.length,j=f.parField,k,g;var e=m;if(e&&e.length){for(b=0;b<e.length;b++){l=e[b];if(l.get){k=l.get(j)}else{k=l[j]}g=f.record_2_node.call(f,l);if(k+""==f.rootId+""){f.add(g.parent,g)}else{f.add(g.parent,g)}}}},store_load:function(b,l){var e=b.data,d=e.log,a=e.el,m=$(a).jstree("true"),c,j,f=[],k=l.data;d.debug("TreeStore 触发 load 事件. 共有 "+k.length+"记录.");e.add_ForRecord(k,f);if(e.focusNode){$(a).jstree("toggle_node",e.focusNode.node);if(f){console.debug("特殊处理...",f);for(var c=0;c<f.length;c++){var g=f[c];if(g.has_child){var h=$("#"+g.id);h.removeClass("jstree-leaf").addClass("jstree-closed")}}}}},proGroupsToTree:function(b,l,k,h){var f=this,c,j,n,o=f.idField||f.valueField,m,g,e;var a=f.checkNodes;m=l[o]+"";e=b[m];if(e&&e.length){for(c=0;c<e.length;c++){n=e[c];var d=n[o].toString();j=f.record_2_node.call(f,n);g=f.add(j.parent,j);if(h){h.push(j);if(n.has_child){j.has_child=true}}f.proGroupsToTree(b,n,j,h)}}},toGroup:function(j){var e=this,b,k,h,c=j.length,f=e.parField,g,a={},d;console.debug("records",j);for(b=0;b<c;b++){if(j.isArray||j.get){h=j.get(b)}else{h=j[b]}if("tree-model"==h.role){k=h;h=h.data}else{k=h}g=h[f];if(undefined===g){console.error("tree-model 的主键("+f+")　,值不能为空.",h);continue}g+="";d=a[g];if(undefined==d){d=[];a[g]=d}d.push(k)}return a},record_2_node:function(k,a){var f=this,u=f.idField||f.valueField,n=f.textField,j=f.parField,r=f.typeField,s,l,h,q,d,b,m,i,e,g,o,c=true;if("tree-model"==k.role){c=k.has_child;o=k;k=o}else{c=k.has_child;if(!c&&undefined==k.child_loaded){c=true}o=k}if(k.isModel){s=k.get(u);l=k.get(n);h=k.get(j)||"ROOT";b=k.get("expand");q=k.get(r);d=k.get(f.iconField);a=a||k.get("checked");m=k.get("tag")||""}else{s=k[u];l=k[n];h=k[j]||"ROOT";b=k.expand;q=k[r];d=k[f.iconField];a=a||k.checked;m=k.tag||""}a=!!a;i=f.id+"_NODE_"+h;e=f.id+"_NODE_"+s;g={id:e,text:l,a_attr:{nodeId:s,parNodeId:h,tag:m},parent:i,li_attr:{child_loaded:!c},state:{opened:false},data:k,raw:k};if(d){g.icon=d}if(b){g.state.opened=true}if(f.checkbox&&a){}return g},checkNode:function(c){var b=this,a=b.el,d=$(a).jstree("true");if(Mini2.isArray(c)){d.jstree("select_node",c,true,false)}else{if(Mini2.isString(c)){d.jstree("select_node",c,true,false)}else{d.check_node(c)}}},setNodeLoaded:function(c,g){var b=this,a=b.el,e=$(a).jstree(true);var f=e.get_node(c);f.li_attr.child_loaded=g;var d=$("#"+c);d.attr("child_loaded",g)},setTag:function(c,f){var b=this,a=b.el,d=$(a).jstree(true);var e=d.get_node(c);e.a_attr.tag=f;console.log("属性: ",e.a_attr)},getContainer:function(){var b=this,a=b.el;return a.children(".jstree-container-ul:first")},open_node:function(c){var b=this,a=b.el;a.jstree("open_node",c)},clear:function(){var d=this,c=d.el;var b=d.getContainer();var a=$(b).children("li");$(a).each(function(){$(c).jstree(true).delete_node(this)})},cancelRename:false,setNodeText:function(d,e,a){var c=this,b=c.el,f=$(f).jstree(true);c.cancelRename=!!a;b.jstree("rename_node",d,e);c.cancelRename=!c.cancelRename},add_ForRecord:function(h,e){var d=this,c=d.log,a=d.el,m=$(a).jstree(true),l,g,f,b,j,k;if(h){c.debug("批量添加 Tree.Panel.add_ForRecord(...), 上级="+d.parField);j=Mini2.isArray(h)?h:[h];if(j.isArray){j=j.items}for(b=0;b<j.length;b++){k=j[b];g=k[d.parField];f=d.record_2_node(k);if(g+""==d.rootId+""){d.add(null,f)}else{d.add(f.parent,f)}if(e){f.has_child=k.has_child;e.push(f)}}}else{c.debug("Tree.Panel.add_ForRecord(...) 没有记录需要添加")}},add:function(f,d,a){var c=this,b=c.el,e=c.nodeRenderer,h=$(b).jstree(true),g;if(arguments.length==1){d=arguments[0];if(e){e.call(c,{node:d,raw:d.raw||d.data},d)}g=h.create_node(c.focusNode,d,undefined,a)}else{if(e){e.call(c,{node:d,raw:d.raw||d.data},d)}g=h.create_node(f,d,undefined,a)}return g},removeChilds:function(g){var f=this,c=f.el,h=$(c).jstree(true);var b=h.get_node(g);var e=Mini2.clone(b.children);for(var d=0;d<e.length;d++){var a=e[d];console.debug("删除: ",a);h.delete_node(a)}},"delete":function(c){var b=this,a=b.el,d=$(a).jstree(true);d.delete_node(c)},edit:function(c){var b=this,a=b.el,e=$(a).jstree(true),d;e.edit(c)},setCheckedNode:function(b){var c=this,a=c.el,e=[],d;if(b){if(Mini2.isArray(b)){d=b}else{if(Mini2.isString(b)){d=b.split(",")}}$(d).each(function(f,g){e.push(c.id+"_NODE_"+g)});a.jstree("check_node",e.join(","))}},getJson:function(){var g=this,d=g.el,i={},h;if(g.focusNode&&g.focusNode.node){h=g.focusNode.node;var a=h.a_attr;var f=h.li_attr;i.select={value:a.nodeId,par_id:a.parNodeId,text:h.text,child_loaded:f.child_loaded,children:h.children,tag:a.tag}}if(g.renameParam){var j=g.renameParam;var c=false;if(j.li_attr){c=!!(j.li_attr.child_loaded)}i.rename={text:j.text,old:j.old,value:j.node.a_attr.nodeId,par_id:j.node.a_attr.parNodeId,child_loaded:c,children:h.children,tag:j.node.a_attr.tag}}if(g.moveNodeJson){i.move=g.moveNodeJson}if(g.checkbox){var b=g.getCheckedIds();var k=g.getUndeterminedIds();i.checked_ids=b;i.unde_ids=k}var e=Mini2.Json.toJson(i);return e},getCheckedIds:function(){var e=this,a=e.el,j=$(a).jstree("true"),g,b,d="",f,c,h=(e.id+"_NODE_").length;g=j.jstree("get_selected");for(b=0;b<g.length;b++){f=g[b];c=f.substring(h);if(b>0){d+=","}d+=c}return d},getUndeterminedIds:function(){var e=this,a=e.el,j=$(a).jstree("true"),g,b,d="",f,c,h=(e.id+"_NODE_").length;return""},getMenu:function(){var d=this,j=d.nodeTypeText,c,g=[];if(!d.showMenu){return null}c={ccp:false,};if(d.showMenuNew){g.push({id:Mini2.newId(),label:"创建"+j,action:function(k){var n=window.widget1;if(d.triggerEvent_create&&n){n.subMethod($("form:first"),{subName:d.id,subMethod:"OnCreating"})}var m=d.store;if(m){var l={subName:m.id,subMethod:"Insert",};try{widget1.subMethod("form:first",l)}catch(i){console.error("调用服务器 PreCommand 错误",i)}}},_disabled:function(i){}})}if(d.showMenuRename){g.push({id:Mini2.newId(),label:"重命名",action:function(i){d.edit(d.focusNode.node)},_disabled:function(i){}})}if(d.showMenuDelete){g.push({id:Mini2.newId(),label:"删除",action:function(k){var l=window.widget1;if(l){var i=d.focusNode.node;Mini2.Msg.confirm("询问",'确定删除 "'+i.text+'" ?',function(){if(d.triggerEvent_remove){l.subMethod($("form:first"),{subName:d.id,subMethod:"OnRemoveing"})}var n=d.store;if(n){try{widget1.subMethod("form:first",{subName:n.id,subMethod:"Delete",})}catch(m){console.error("调用服务器 PreCommand 错误",m)}}})}},_disabled:function(i){}})}var a=d.contextMenu;for(var b=0;b<a.length;b++){var f=a[b];var e={id:Mini2.newId(),label:f.text,command:f.command,command_params:f.command_params,click:f.click,action:function(i){d.menu_action.call(d,i,i.item)}};g.push(e)}for(var b=0;b<g.length;b++){var h=g[b];c[h.id]=h}return c},getFocusNodeConfig:function(){var e=this,c=e.focusNode,b=null;if(c&&c.node){node=c.node;var a=node.a_attr;var d=node.li_attr;b={value:a.nodeId,par_id:a.parNodeId,text:node.text,child_loaded:d.child_loaded,children:node.children,tag:a.tag}}return b},menu_action:function(g,c){var d=this;var i=window.widget1;if(c.click){var b=c.click.call(d,g,c);if(false===b){return}}if(i&&!Mini2.isBlank(c.command)){var e=d.getFocusNodeConfig();var f="node-"+Mini2.newId();var h={subName:d.id,subMethod:"PreCommand",actionPs:{cmdName:c.command,cmdParam:c.commandParam||"",node:"ref "+f,record:"ref xxxx"}};h.data={};h.data[f]=window.JSON.stringify(e);console.debug("sd = ",h);try{widget1.subMethod("form:first",h)}catch(a){console.error("调用服务器 PreCommand 错误",a)}}},createConfig:function(){var b=this,d=["html_data","themes","ui","crrm","contextmenu"],c,a;c=b.getMenu();a={core:{check_callback:true,strings:true,},plugins:d,lang:{loading:"加载中..."},contextmenu:{items:c}};if(b.allowDragDrop){d.push("dnd")}if(b.checkbox){a.checkbox={keep_selected_style:false};d.push("checkbox")}if(b.types){a.types=b.types;d.push("types");delete b.types}return a},focusNode:null,baseRender:function(){var c=this,b,a=c.createConfig();c.bind("nodeRename",function(d){if(d.text==d.old){return}c.renameParam=d;var h=window.widget1;if(c.triggerEvent_rename&&h){h.subMethod($("form:first"),{subName:c.id,subMethod:"OnRenaming"})}var g=c.store;if(g){try{widget1.subMethod("form:first",{subName:g.id,subMethod:"Rename",actionPs:{oldText:d.old,text:d.text}})}catch(f){console.error("调用服务器 PreCommand 错误",f)}}});if(c.data){if(Mini2.isArray(c.data)){}else{a.core.data=c.data;delete c.data}}if(c.applyTo){b=$(c.applyTo).jstree(a)}else{b=$(c.renderTo).jstree(a)}c.el=b;b.css("background-color","#FFFFFF");c.setSize(c.width,c.height);if(c.checkbox){b.bind("changed.jstree",function(e,d){if("select-hwq"==d.action){if(c.autoExpand&&$(b).jstree("is_closed",d.node)){$(b).jstree("toggle_node",d.node)}c.trigger_selected(e,d)}})}else{b.bind("select_node.jstree",function(e,d){if(c.autoExpand&&$(b).jstree("is_closed",d.node)){$(b).jstree("toggle_node",d.node)}c.trigger_selected(e,d)})}b.bind("open_node.jstree",function(e,d){c.trigger("nodeOpened",d)});b.bind("loaded.jstree",function(f,d){d.inst.open_all(-1)});b.bind("rename_node.jstree",function(e,d){if(!c.cancelRename){c.trigger("nodeRename",d)}});if(c.allowDragDrop){c.bind_DragDrop()}if(c.data&&Mini2.isArray(c.data)){c.proLineData(c.data)}c.initStore();return b},bind_DragDrop:function(){var b=this,a=b.el;a.bind("move_node.jstree",function(d,c){try{var f=c.parent.substring(b.id.length+"_NODE_".length);b.moveNodeJson={node_id:c.node.a_attr.nodeId,parent_id:f,pos:c.position};b.onNodeMoved()}catch(e){alert("ui.tree.Panel.bind_DragDrop() 提交数据错误")}})},onNodeMoved:function(){var a=this;if(a.event_move){var b=window.widget1;if(b){b.subMethod($("form:first"),{subName:a.id,subMethod:"OnNodeMoved"})}}},trigger_selected:function(c,b){var e=this,d=e.log,i=e.store;if(e.focusNode){$(e.focusNode.node).removeClass("jstree-focus-item")}$(b.node).addClass("jstree-focus-item");e.focusNode=b;if(i&&i.dymHasChild){var f=b.node;var a=f.a_attr;console.debug("节点 data",f.data);i.setCurrent(f.data);d.debug("问:需要加载远程节点?",f);if(!f.li_attr.child_loaded){d.debug("开始加载远程节点. ");if(e.remoteEnabled){var i=e.store,b=f.data,g;if(b.get){g=b.get(e.idField)}else{g=b[e.idField]}console.debug("开始加载远程数据...",e.remoteUrl);console.debug("上级节点...",f);var h={parent_id:g};Mini2.post(e.remoteUrl,h,function(k){console.debug("数据回来了...",k);i.add(k);f.li_attr.child_loaded=true})}else{var j=window.widget1;if(j){j.subMethod($("form:first"),{subName:i.id,subMethod:"LoadChilds"});f.li_attr.child_loaded=true}}}else{d.debug("无需加载远程节点. node.li_attr.child_loaded=",f.li_attr.child_loaded)}}if(e.event_selected){var j=window.widget1;if(j){j.subMethod($("form:first"),{subName:e.id,subMethod:"OnSelected"})}}e.trigger("nodeSelected",b)},render:function(){var b=this,a;a=b.baseRender();$(a).data("me",b)}});
Mini2.define("Mini2.ui.tab.Tab",{extend:"Mini2.ui.Component",tabPanel:null,padding:"10px 10px 10px 10px",closable:false,reandeTpl:['<a class="mi-tab ',"mi-unselectable ","mi-box-item ","mi-tab-default ","mi-top ","mi-tab-top ",'mi-tab-default-top" ','style="" ','role="button" hidefocus="on" unselectable="on" tabindex="0" >','<span class="mi-tab-wrap" unselectable="on">','<span class="mi-tab-button">','<span class="mi-tab-inner mi-tab-inner-center" unselectable="on">',"Tab","</span>","</span>","</span>","</a>"],iconCls:null,closeBtnTpl:['<span class="mi-tab-close-btn" title="" tabindex="0"></span>'],closeOverCls:"mi-tab-close-btn-over",getText:function(){var c=this,a=c.btnInnerEl;var b=$(a).html();return b},setText:function(c){var b=this,a=b.btnInnerEl;$(a).html(c)},hide:function(){var b=this,a=b.el;if(b.visible!=false){b.visible=false;a.hide();b.callParent()}return b},show:function(){var b=this,a=b.el;if(b.visible!=true){b.visible=true;a.show();b.callParent()}return b},setUrl:function(c){var b=this,a=b.contentEl;if(!b.iframe){console.error("当前 tab 不是 iframe 对象.");return b}b.url=c;$(a).attr("url",c);return b},getIFrameWindow:function(){var d=this,c=null,b=d.contentEl,a;if(!d.iframe){console.warn("当前 tab 不是 iframe 对象.",d);return d}if(!b||0==b.length){console.warn("当前 tab 不是 contentEl 对象.",b);return d}a=b[0];if(a){c=a.contentWindow}return c},setActive:function(){var e=this,g=e.ui,b="mi-tab-"+g,c=e.el;var a=["mi-active","mi-tab-active",b+"-active","mi-top-active","mi-tab-top-active",b+"-top-active"];var f=e.tabPanel;var d=f.curActiveTab;if(f.curActiveTab===e){return}f.lastActveTab=f.curActiveTab;f.curActiveTab=e;Mini2.ui.FocusMgr.setControl(e.scope||e);$(c).addCls(a);e.contentEl&&$(e.contentEl).removeClass("mi-hide-display");e.panel.show();e.panel.updateLayout();setTimeout(function(){e.panel.updateLayout()},50);e.resetPaint();if(d){$(d.el).removeCls(a);if(d.panel){d.panel.hide()}}e.trigger("action",{tab:e});return e},resetPaint:function(){var a=this;a.panel.resetPaint();return a},close:function(){var a=this;a.tabPanel.remove(a);return a},createCloseBtn:function(){var d=this,c=d.el,e=d.ui,b,a=d.closable;if(a){b=Mini2.$joinStr(d.closeBtnTpl);c.append(b);c.addCls("mi-closable","mi-tab-closable","mi-tab-"+e+"-closable","mi-closable-top","mi-tab-closable-top","mi-tab-"+e+"-closable-top");d.closeEl=b;b.mouseenter(function(){$(this).addClass(d.closeOverCls)}).mouseleave(function(){$(this).removeClass(d.closeOverCls)});b.muBind("mousedown",function(){}).muBind("mouseup",function(){d.close()})}},delayRender:function(){var b=this,a=$(b.applyTo);b.isDelayRender=true;a.attr("mi-delay-render","true");a.data("me",b);return b},render:function(){var e=this,f=e.ui,a="mi-tab-"+f,c,b;if(e.isDelayRender){}e.el=c=Mini2.$join(e.reandeTpl);c.addCls([a,a+"-top"]);e.btnEl=b=c.find(".mi-tab-button");e.btnInnerEl=b.children(".mi-tab-inner");if(e.iconCls||e.icon){c.addClass("mi-icon-text-left mi-btn-icon-text-left mi-tab-default-icon-text-left mi-btn-default-small-icon-text-left")}if(e.iconCls){var d=Mini2.$join(['<i class="mi-tab-icon-el fa ',e.iconCls,'"></i>']);b.append(d)}else{if(e.icon){var d=$('<span role="img" class="mi-tab-icon-el" unselectable="on" ></span>');b.append(d)}}e.setText(e.text||"按钮");e.createCloseBtn();c.css("left",e.left||0);c.mouseenter(function(){$(this).addClass("mi-tab-"+e.ui+"-over")}).mouseleave(function(){$(this).removeClass("mi-tab-"+e.ui+"-over")});c.muBind("mousedown",function(){}).muBind("mouseup",function(){e.tabPanel.setActiveTab(e)});if(e.applyTo){$(e.applyTo).replaceWith(c)}else{if(e.renderTo){$(e.renderTo).append(c)}}$(c).data("me",e)}});
Mini2.define("Mini2.ui.tab.Panel",{extend:"Mini2.ui.Component",log:Mini2.Logger.getLogger("Mini2.ui.tab.Panel",true),tabCls:Mini2.baseCSSPrefix+"tab-panel",curActiveTab:null,plain:false,tabHeight:32,dock:"top",region:"north",buttonVisible:true,state:"normal",tabLeft:0,renderTpl_body:['<div class="mi-panel-body ',"mi-panel-body-default ","mi-layout-fit ",'mi-noborder-trbl" ','style="width: 450px; left: 0px; top: 36px; height: 160px;" >',"</div>"],renderTpl_bar:['<div role="Tab-bar" class="mi-tab-bar ',"mi-header ","mi-header-horizontal ","mi-docked ","mi-unselectable ","mi-horizontal ","mi-tab-bar-horizontal ","mi-top ","mi-tab-bar-top ","mi-horizontal-noborder ","mi-tab-bar-horizontal-noborder ","mi-docked-top ","mi-tab-bar-docked-top ",'mi-noborder-trl" >','<div class="mi-tab-bar-body ',"mi-tab-bar-body-horizontal ","mi-tab-bar-body-top ","mi-tab-bar-body-horizontal-noborder ","mi-box-layout-ct ",'" style="width: 450px;position: static;" >','<div class="mi-box-inner mi-box-scroller-left ">','<div class="mi-box-scroller mi-tabbar-scroll-left" style="display:none;"></div>',"</div>",'<div class="mi-box-inner mi-horizontal-box-overflow-body" role="presentation" style="width:450px;height:31px;" >','<div class="mi-box-target" style="width: 450px;">',"</div>","</div>",'<div class="mi-tab-bar-buttons mi-box-scroller-right " style="text-align:right;top:0;right:10px;position: absolute;">','<a class="mi-tab-bar-close mi-box-inner mi-box-scroller-right" style="top:9px;margin-right:10px;" href="#">隐藏</a>','<a class="mi-tab-bar-max mi-box-inner mi-box-scroller-right" style="top:9px;margin-right:10px;" href="#">放大</a>',"</div>",'<div class="mi-box-inner mi-box-scroller-right ">','<div class="mi-box-scroller mi-tabbar-scroll-right" style="display:none;"></div>',"</div>","</div>","</div>"],renderTpl_bar_strip:['<div class="mi-tab-bar-strip ">',"</div>",],initComponent:function(){var a=this},setActiveTab:function(g){var e=this,d=e.log,c=e.items;if(Mini2.isNumber(g)){if(g<c.length){g=c[g]}}if(g){if(g.isDelayRender){var f=g.panel;f.render();var a=g.contentEl;var b=$(a);$(f.boxTarget).append(a);$(b).each(function(){var i=$(this).attr("id");if(i&&Mini2.delayRS){i="#"+i;var h=Mini2.delayRS[i];if(h){h.render();delete Mini2.delayRS[i];d.debug("加载:"+i)}}});f.boxTarget.css({display:"table-cell",height:"100%",width:e.width||"100%","vertical-align":"top"});delete g.isDelayRender;delete g.contentEl;g.bind("action",e,e.tab_action)}g.setActive()}},tab_action:function(a){var b=this;b.trigger("tabAction",{tab:a.tab,lastTab:b.lastActveTab})},setSize:function(p,h){var o=this,n=o.log,g=o.el,b=o.barEl,f=o.boxTargetEl,c=o.bodyEl,j,m=o.items,k,l;if(undefined!=p){o.width=p;$(g).children(".mi-panel:first").css("width",p);b.css("width",p);var a=$(b).children(".mi-tab-bar-body");var d=a.children(".mi-box-inner");var e=d.children(".mi-box-target");a.css("width",p);d.css({width:p-60});e.css({width:p});c.css("width",p)}if(undefined!=h){o.height=h;$(g).css("height",h);$(g).children(".mi-panel:first").css("height",h);if("pills"==o.ui){c.css("height",h-o.tabHeight)}else{c.css("height",h-o.tabHeight-6)}}o.refresh_tabPage()},add:function(m,n){var k=this,j=k.log,b=k.boxTargetEl,a=k.bodyEl,f,p=0,e,c;var i=k.items.length;console.debug("tab.parentPage=",m.parentPage);e=Mini2.applyIf(m,{ui:k.ui,left:p,tabPanel:k,ownerParent:k,tabIndex:i,renderTo:b});c=Mini2.create("Mini2.ui.tab.Tab",e);c.render();if(c.contentEl){var d=$(c.contentEl);c.contentEl=d.html()}else{if(c.iframe){c.contentEl=f=$('<iframe src="" frameborder="0" dock="full">框架窗体</iframe>');c.contentEl.attr("src",c.url);if(e.parentPage){f.bind("load",{owner:k,tab:c,parentPager:f[0].contentWindow},k.iframe_load);k.iFrameReady.call(k,f[0],function(){var h=f[0].contentWindow;h.ownerWindow=c;if(h.Mini2){h.Mini2.parentPage=e.parentPage}else{h.parentPage=e.parentPage}})}}}var o=k.width;var g=$(a).outerHeight();var l=Mini2.create("Mini2.ui.panel.Panel",{dock:"full",width:o,height:g,scroll:c.scroll,layout:{itemCls:"mi-box-item"},renderTo:a});c.panel=l;Mini2.Array.add(k.items,c);if(e.isDelayRender){l.delayRender()}else{l.render();l.hide();$(l.boxTarget).append(c.contentEl);l.boxTarget.css({display:"table-cell",height:"100%",width:o,"vertical-align":"top"});c.bind("action",k,k.tab_action)}if(undefined==n||false===n){k.refresh_btn()}return c},iframe_load:function(d){var g=this,f=$(g).attr("muid"),i=g.contentWindow,b,c=i.document,a=c.body;console.log("iframe 加载完成"+new Date().getTime(),i);if(!i.ownerWindow){console.log("iframe 加载完成 2");i.ownerWindow=d.data.tab;var h=d.data.parentPage;b=i.Mini2;if(b&&b.onwerPage){b.onwerPage.parentPage=d.data.parentPage}else{i.parentPage=h}}},iFrameReady:function(e,d){var h;var c=false;function f(){if(!c){c=true;clearTimeout(h);d.call(this)}}function g(){if(this.readyState==="complete"){f.call(this)}}function a(i,j,k){if(i.addEventListener){return i.addEventListener(j,k)}else{return i.attachEvent("on"+j,function(){return k.call(i,window.event)})}}a(e,"load",function(){f.call(e.contentDocument||e.contentWindow.document)});function b(){var i;if(e.contentDocument){i=e.contentDocument}if(!i&&e.contentWindow){i=e.contentWindow.document}if(i&&i.URL.indexOf("about:")!==0){if(i.readyState==="complete"){f.call(i)}else{a(i,"DOMContentLoaded",f);a(i,"readystatechange",g)}}else{h=setTimeout(b,1)}}b()},updateLayout:function(){var a=this;Mini2.awaitRun(a.muid,100,a,function(){a.refresh_btn();var b=a.getNextActiveTab();if(b){b.setActive()}})},getNextActiveTab:function(){var f=this,a,b,c=f.items,h=null,e=f.lastActveTab;if(e&&e.visible){return e}if(!e){for(a=0;a<c.length;a++){b=c[a];if(b.visible){h=b;break}}}else{var d=Mini2.Array.indexOf(c,e);var g=d;while(--g>=0){b=c[g];if(b.visible){h=b;break}}if(!h){for(a=d+1;a<c.length;a++){b=c[a];if(b.visible){h=b;break}}}}return h},render_btn:function(b,a){var f=this,d,e=f.items,c,g;if(e){delete f.items;f.items=[];g=[e.length];for(d=0;d<e.length;d++){c=e[d];f.add(c,false)}}},find:function(f){var e=this,b,a=null,c,d=e.items||[];for(b=0;b<d.length;b++){c=d[b];if(c.id==f){a=c;break}}return a},isVisible:function(){var b=this,a=b.el;return a.is(":visible")},remove:function(f){var e=this,b=e.curActiveTab,a,c,d=e.log;$(f.el).fadeOut(300,function(){f.el.remove();f.panel.el.remove();e.refresh_btn();c=Mini2.Array.remove(e.items,f);if(f===b){if(c>0){a=e.items[c-1];e.setActiveTab(a)}else{if(c==0){a=e.items[c];e.setActiveTab(a)}}}});return e},refresh_btn:function(){var b=this,a=b.log,c=b.tabLeft;$(b.items).each(function(){var d=this;if(d.visible&&d.setLeft){d.setLeft(c);c+=d.getWidth()+1}else{}});setTimeout(function(){c=b.tabLeft;$(b.items).each(function(){var d=this;if(d.visible&&d.setLeft){d.setLeft(c);c+=d.getWidth()+1}else{}})},1000)},refresh_tabPage:function(){var j=this,a=j.bodyEl,k,b,c,d,f=j.items,g=f.length,e;k=a.outerWidth();b=a.outerHeight();for(c=0;c<g;c++){d=f[c];e=d.panel;if(e&&e.visible){e.setSize(k,b)}}},baseRender:function(s){var p=this,n=p.log,t=p.ui,d="mi-tab-bar-strip-"+t,l,r=Mini2.SystemInfo,i=r.tabPanel;if(s){p.tabHeight=s}else{if(p.tabHeight!=i.tabHeight){p.tabHeight=i.tabHeight}}p.el=l=$('<div role="TabPanel"></div>');var q=Mini2.$join(['<div role="Tab-Body" class="mi-panel mi-border-box mi-panel-',p.ui," mi-tab-bar-",p.ui,'" style="width: 450px; height: 196px;" >',"</div>"]);q.css("width",p.width);var c=Mini2.$join(p.renderTpl_bar);var e=Mini2.$join(p.renderTpl_bar_strip);var h=c.find(".mi-box-target:first");var a=c.children(".mi-tab-bar-body");var g=a.children(".mi-horizontal-box-overflow-body");g.css({height:p.tabHeight});e.addCls(["mi-tab-bar-strip-top",d,d+"-horizontal",d+"-top",d+"-horizontal-noborder",d+"-docked-top"]);e.css({top:p.tabHeight-1});c.append(e);c.css("height",p.tabHeight);h.css("height",p.tabHeight);var f=Mini2.$join(p.renderTpl_body);f.addClass("mi-renderTpl_body");if("pills"==p.ui){f.css("top",p.tabHeight)}else{if("touch"==r.mode){f.css("top",p.tabHeight+8)}else{f.css("top",p.tabHeight-6)}}var b=c.find(".mi-tab-bar-buttons");var j=b.children(".mi-tab-bar-close");var o=b.children(".mi-tab-bar-max");if(p.buttonVisible){b.show()}else{b.hide()}o.click(function(){var u=$(window).height()-40;var v=$(this).parent();if(p.state=="max"){$(this).text("放大");Mini2.ui.Page.resetMaxControl(p);v.children(".mi-tab-bar-close").show();p.state="normal"}else{$(this).text("还原");Mini2.ui.Page.maxControl(p);v.children(".mi-tab-bar-close").hide();p.state="max"}f.show();Mini2.LoaderManager.preResize();return false});j.click(function(){var u=l.css("height");var v=$(this).parent();if(p.state=="min"){$(this).text("隐藏");l.removeCls("mi-state-max","mi-state-min");l.css("height",p.height);q.css("height",p.height);v.children(".mi-tab-bar-max").show();p.state="normal"}else{$(this).text("还原");l.addClass("mi-state-min");l.css("height",36);q.css("height",36);p.state="min";v.children(".mi-tab-bar-max").hide()}f.toggle(p.state!="min");Mini2.LoaderManager.preResize();return false});c.css("width",p.width);h.css("width",p.width);f.css("width",p.width);p.barEl=c;p.boxTargetEl=h;p.bodyEl=f;if(p.plain){c.addClass("mi-tab-bar-plain");var a=c.children(".mi-tab-bar-body");a.children(".mi-box-scroller-left").addClass("mi-box-scroller-plain");a.children(".mi-box-scroller-right").addClass("mi-box-scroller-plain")}p.render_btn(h,f);q.append(c);q.append(f);l.append(q);if(p.contentEl){var k=$(p.contentEl);var m=k.children();k.after(l);l.attr("id",k.attr("id"));k.remove()}else{if(p.applyTo){$(p.applyTo).replaceWith(l)}else{if(p.renderTo){$(p.renderTo).append(l)}}}if(p.visible==false){l.hide();delete p.visible}l.css("height",p.height);f.css("height",p.height-31-2);$(l).children(".mi-panel").css("height",p.height);l.data("me",p);p.refresh_tabPage();p.refresh_btn();setTimeout(function(){p.setActiveTab.call(p,0)},200)},render:function(){var a=this;if("pills"==a.ui){a.baseRender(40)}else{a.baseRender()}}});
Mini2.define("Mini2.ui.layout.container.Border",{targetCls:Mini2.baseCSSPrefix+"border-layout-ct",itemCls:[Mini2.baseCSSPrefix+"border-item",Mini2.baseCSSPrefix+"box-item"],type:"border",isBorderLayout:true,beginLayout:function(a){},getLayoutItems:function(){}});
Mini2.define("Mini2.ui.layout.container.Form",{targetCls:Mini2.baseCSSPrefix+"form-layout-ct",itemCls:[Mini2.baseCSSPrefix+"form-item",Mini2.baseCSSPrefix+"box-item"],type:"form",isFormLayout:true,initComponent:function(){var a=this;a.length=0},configureItem:function(b){var d=this,c=d.itemCls,e=d.owner.itemCls,a;b.ownerLayout=d;if(a){b.addCls(a)}},updateLayout:function(b){var a=this},beginLayout:function(a){console.log(me.owner.flowDirection)},getLayoutItems:function(){}});
Mini2.define("Mini2.ui.layout.container.HBox",{itemCls:[Mini2.baseCSSPrefix+"form-item",Mini2.baseCSSPrefix+"box-item"],initComponent:function(){var a=this;a.length=0},configureItem:function(b){var d=this,c=d.itemCls,e=d.owner.itemCls,a;b.ownerLayout=d;if(a){b.addCls(a)}},afterHeight:0,getItemObj:function(b){var a;if(b.muid){a=b}else{a=$(b).data("me")}return a},getItemWidth2:function(b){var c=this,a,d=0;$(b).each(function(){a=this;a=c.getItemObj(a);if(a){d+=a.getWidth(true)}else{if(Mini2.isDom(a)&&$(a).is(":visible")){d+=$(a).outerWidth(true)}}});return d},updateLayout:function(s){var p=this,b=s.boxTarget,c=s.el,r,l,m,n,x=0,y=0,f=0,z=0,a=p.align,t=s.padding,u=Mini2.SystemInfo.form,k=u.itemMarginBottom||0;r=s.targetWidth;l=$(b).children(":visible");m=0;n=l.length;if(a=="center"){m=p.getItemWidth2(l);x=(r-m)/2}else{if(a=="right"){m=p.getItemWidth2(l);x=r-m}}var o=0,e,g,j,v,d,q;for(e=0;e<n;e++){g=l[e];j=$(g);v=j.outerWidth(true);d=j.outerHeight(true);o=Math.max(o,d);q=p.getItemObj(g);if(undefined===q){if(j&&j.hasClass("mi-newline")){y+=o+k;x=0;o=0;f=0}continue}if(f>0&&x+v>r){y+=o+k;x=0;f=0;console.debug("换行2")}q.setLeft(x);q.setTop(y);z=y+o;f++;if(x+v<r){x+=v}else{y+=o+k;x=0;o=0;f=0}}z+=t.bottom+t.top;p.afterHeight=z;s.targetHeight=z},beginLayout:function(a){},getLayoutItems:function(){}});
Mini2.define("Mini2.ui.layout.container.VBox",{itemCls:[Mini2.baseCSSPrefix+"form-item",Mini2.baseCSSPrefix+"box-item"],initComponent:function(){var a=this;a.length=0},configureItem:function(b){var d=this,c=d.itemCls,e=d.owner.itemCls,a;b.ownerLayout=d;if(a){b.addCls(a)}},getItemObj:function(b){var a;if(b.muid){a=b}else{a=$(b).data("me")}return a},getItemWidth2:function(a){var b=this,c=0;$(a).each(function(){var d=b.getItemObj(this);if(d){c+=d.getWidth()}else{if(Mini2.isDom(this)&&$(this).is(":visible")){c+=$(this).outerWidth()}}});return c},updateLayout:function(g){var f=this,k=0,b=0,c,j=g.width,a=g.boxTarget,d;d=a.children();var e=f.getItemWidth2(d);$(d).each(function(){var h=f.getItemObj(this);if(h){h.setTop(k);h.setWidth(j);b=h.getHeight();k+=b}else{if(Mini2.isDom(this)&&$(this).is(":visible")){$(this).css({top:k,width:j});b=$(this).outerHeight();k+=b}}})},beginLayout:function(a){},getLayoutItems:function(){}});
Mini2.define("Mini2.ui.panel.Panel",{extend:"Mini2.ui.Component",log:Mini2.Logger.getLogger("Mini2.ui.panel.Panel",false),baseCls:Mini2.baseCSSPrefix+"panel",renderTpl:['<div role="Panel" style="right: auto; left: 0px; top: 0px;">','<div class="mi-box-inner " role="presentation" style="">','<div class="mi-box-target" style="width: 100%; "></div>',"</div>","</div>"],formMode:"auto",border:true,isPanel:true,width:"100%",dock:"top",region:"north",ui:"default",uiCls:[],userCls:null,lockable:false,flowDirection:"lefttoright",wrapContents:true,itemWidth:0,fixed:false,autoSize:false,ownerParent:null,callParent:function(){var a=this,b=a.ownerParent;b&&b.updateLayout()},initComponent:function(){var b=this,a=b.layout;if(Mini2.isString(a)){b.layout={type:a}}else{if(!a){b.layout={type:"auto"}}}b.oneShow=!!b.visible;b.itemMargin=Mini2.apply({left:0,top:0,right:0,bottom:0},b.itemMargin);b.padding=Mini2.apply({left:0,top:0,right:0,bottom:0},b.padding);if(b.layout.type=="toolbar"){b.baseCls=Mini2.baseCSSPrefix+"toolbar"}},scrollTop:function(c){var b=this,a=b.boxTarget;a.scrollTop(c);return b},resizeChilds:function(){var a=this},toggle:function(){var b=this,a=b.el;if(b.isVisible()){b.hide()}else{b.show()}return b},resize:function(a){var e=this,c,b=e.resizeFns||[],d,a;if(arguments.length==0){e.updateLayout(e);for(c=0,d=b.length;c<d;c++){a=b[c];a.call(e)}}else{if(!e.resizeFns){e.resizeFns=b}b.push(a)}},prepareItems_ForFlow:function(a){var b=this,c=[];return a},prepareItems_ForTable:function(a){var b=this,c=[];return a},getItemObj:function(b){var a;if(b.muid){a=b}else{a=$(b).data("me")}return a},prepareItems:function(g){var j=this,b,c,f,d,a=j.flowDirection,h=j.layout,e,k=[];$(g).each(function(){c=this;f=j.getItemObj(c);if(f){f.ownerParent=j;i=f.el;if(f.isVisible&&!f.isVisible()){return}k.push(f);if("lefttoright"==a){i.addClass("mi-form-item-float-left")}i.addClass("mi-anchor-form-item");if(h&&h.itemCls){i.addClass(h.itemCls)}if(j.itemWidth&&f.setWidth){if(f.width=="100%"){if(f.colspan){f.setWidth(j.itemWidth*f.colspan)}else{f.setWidth(j.itemWidth)}}}e=f.labelable;if(e){if(j.itemLabelWidth){e.setWidth(j.itemLabelWidth)}if(j.itemLabelAlign){e.setLabelAlign(j.itemLabelAlign)}if(j.itemLabelPad){e.setLabelPad(j.itemLabelPad)}}}else{if(Mini2.isDom(c)&&$(c).is(":visible")){k.push(c);var i=$(c);if(i.hasClass("mi-newline")){}else{if("lefttoright"==a){i.addClass("mi-form-item-float-left")}if(h&&h.itemCls){i.addClass(h.itemCls)}if(j.itemWidth){i.css("width",j.itemWidth)}}}}});return k},layoutEngine:null,offsetParent:function(c){var b=$(c),a="mi-border-box",d=0;if(b.hasClass(a)){return c}for(d;d<99;d++){b=b.parent();if(b.hasClass(a)){break}}return b},getTabItems:function(){var h=this,g=h.log,b,c,d,e=h.layout,f,a=h.boxTarget,i=[];d=a.children();if(e){f=e.type}$(d).each(function(){b=this;c=h.getItemObj(b);if(c&&c.tabStop){i.push(c)}});return i},itemsBuffer:null,updateLayout:function(h){var g=this,f=g.log,c,i,b=g.layoutEngine,d=g.layout,e=d.type,a=g.boxTarget;if(!g.isVisible()){return}i=g.offsetParent(g.el);if(!c){c=a.children();if("table"==e){c=g.prepareItems_ForTable(c)}else{c=g.prepareItems(c)}g.itemsBuffer=c}if(c&&c.length==0){return}if("form"==e){b=b||Mini2.create("Mini2.ui.layout.container.Form",{owner:g})}else{if("hbox"==e){b=b||Mini2.create("Mini2.ui.layout.container.HBox",{owner:g,align:d.align})}else{if("vbox"==e){b=b||Mini2.create("Mini2.ui.layout.container.VBox",{owner:g,align:d.align})}else{b=b||Mini2.create("Mini2.ui.container.DockingContainer",{owner:g,itemMargin:g.itemMargin,padding:g.padding});b.clearItems();if(c.length){b.addDocked(c)}}}}b.updateLayout(g);g.layoutEngine=b},getWidth:function(){return this.el.outerWidth()},getHeight:function(){return this.el.outerHeight()},getSize:function(){var a=this;return{width:a.getWidth(),height:a.getHeight()}},setLeft:function(c){var b=this,a=b.el;a.css("left",c);return b},getLeft:function(){var b=this,a=b.el;return a.css("left")},getTop:function(){var b=this,a=b.el;return a.css("top")},setTop:function(c){var b=this,a=b.el;a.css("top",c);return b},setSize:function(n,i,f){var k=this,j=k.log,g=k.el,l=k.minHeight,c=k.boxInner,d=k.boxTarget,m=k.padding,a=0;if(l&&i&&i<l){i=l}k.targetWidth=n||k.width;k.targetHeight=i||k.height;k.updateLayout(k);k.width=k.targetWidth||k.width;k.height=k.targetHeight||k.height;if(g){if(k.autoSize){if("vertical"==k.scroll){var e=k.width-(m.right+m.left);g.css({width:k.width});c.css({width:"100%"});d.css({width:e})}}else{var e=k.width-(m.right+m.left);var b=k.height-(m.bottom+m.top);g.css({width:k.width,height:k.height});c.css({width:"100%",height:b});d.css({width:e,height:b})}}k.resize();return k},animate:function(f,e,b,a){var d=this,c=d.el;c.animate(f,e,b,a);return d},hide:function(){var b=this,a=b.el;if(a){a.hide();b.callParent()}return b},show:function(){var b=this,a=b.el;if(a){a.show();b.callParent();b.callParent()}return b},css:function(c,d){var b=this,a=b.el;return a.css(c,d)},isVisible:function(){var b=this,a=b.el;return a&&a.is(":visible")},resetPaint:function(){var e=this,c=e.itemsBuffer||[],b,a,d=c.length;for(a=0;a<d;a++){b=c[a];if(b&&b.resetPaint){b.resetPaint.call(b)}}},baseRender:function(){var n=this,m=n.log,g,o=n.padding,c,d,p=n.width,j=n.height;n.el=g=Mini2.$join(n.renderTpl);n.boxInner=c=g.cFirst(".mi-box-inner");n.boxTarget=d=c.cFirst(".mi-box-target");g.mouseup(function(){Mini2.ui.FocusMgr.setControl(n)});if(n.visible==false){g.hide();delete n.visible}if(n.onResize){n.resize(n.onResize)}g.data("me",n);g.addCls(n.baseCls,"mi-box-layout-ct");if(n.ui){g.addCls(n.baseCls+"-"+n.ui)}if(n.anchorFixedType){if(n.anchorFixedType=="topbottom"){g.addClass("mi-panel-anchorfixed-topbotom")}}if("default"!=n.dock){if("none"!=n.dock){g.addCls("mi-docked","mi-docked-"+n.dock,n.baseCls+"-docked",n.baseCls+"-docked-"+n.dock);if(n.ui){g.addCls(n.baseCls+"-"+n.ui+"-docked-"+n.dock)}}}if(n.fixed){g.addClass("mi-fixed-layer");g.css("z-index",1009)}switch(n.scroll){case"none":d.css({overflow:"hide"});break;case"vertical":d.css({"overflow-x":"hidden","overflow-y":"auto"});break;case"horizontal":d.css({"overflow-x":"auto","overflow-y":"hidden"});break;default:d.css({overflow:"auto"});break}var a=["left","top","right","bottom","width","height","position"];var f={};for(var k=0;k<a.length;k++){var b=a[k];if(n[b]){f[b]=n[b]}}for(var k in o){var b="padding-"+k;f[b]=o[k]}if(n.maxWidth){g.css({"max-width":n.maxWidth});d.css({"max-width":n.maxWidth})}if(n.minWidth){g.css({"min-width":n.minWidth});d.css({"min-width":n.minWidth})}if(n.maxHeight){g.css({"max-height":n.maxHeight});d.css({"max-height":n.maxHeight})}if(n.minHeight){g.css({"max-height":n.minHeight});d.css({"max-height":n.minHeight})}if(n.margin){g.css({margin:n.margin})}if(n.marginLeft){g.css({"margin-left":n.marginLeft})}if(n.marginRight){g.css({"margin-right":n.marginRight})}if(n.marginTop){g.css({"margin-top":n.marginTop})}if(n.marginBottom){g.css({"margin-bottom":n.marginBottom})}g.css(f);if(n.right){}if(n.autoSize){d.css({position:"static",height:"auto"})}else{g.css({width:p});c.css({width:p,height:j});d.css({width:p,height:j})}if(n.userCls){g.addClass(n.userCls)}if(n.contentEl){var e=$(n.contentEl);var l=e.children();e.after(g);d.append(l);g.attr("id",e.attr("id"));e.remove()}else{if(n.applyTo){$(n.applyTo).replaceWith(g)}else{if(n.renderTo){$(n.renderTo).append(g)}}}},focus:function(){var a=this;Mini2.ui.FocusMgr.setControl(a);return a},afterRender:function(){var a=this;a.updateLayout()},delayRender:function(){var b=this,a=$(b.applyTo);b.isDelayRender=true;Mini2.delayRS=Mini2.delayRS||{};Mini2.delayRS[b.clientId]=b;a.attr("mi-delay-render","true");a.data("me",b)},delayRenderTimer:function(){var b=this,a=b.log;setTimeout(function(){var c=b.boxTarget.children();$(c).each(function(){var e=$(this).attr("id");if(e&&Mini2.delayRS){var d=Mini2.delayRS[e];if(!d){e="#"+e;d=Mini2.delayRS[e]}if(d){d.render();delete Mini2.delayRS[e]}}});b.updateLayout()},100);delete b.isDelayRender},render:function(){var e=this,d=e.log,f=e.padding,c=e.itemMargin,a=0;if(f.all&&"auto"!=f.all){a=parseInt(f.all)}Mini2.applyIf(f,{left:a,right:a,top:a,bottom:a});if(c.all&&"auto"!=c.all){a=parseInt(f.all)}Mini2.applyIf(c,{left:a,right:a,top:a,bottom:a});e.baseRender();if(e.isDelayRender){e.delayRenderTimer()}try{Mini2.ui.SecManager.reg(e.secFunCode,e)}catch(b){console.error("注册权限错误",b)}}},function(){var a=this;Mini2.apply(this,arguments[0]);a.initComponent();Mini2.LoaderManager.afterRender(a)});
Mini2.define("Mini2.ui.panel.FormPanel",{extend:"Mini2.ui.panel.Panel",log:Mini2.Logger.getLogger("Mini2.ui.panel.FormPanel",false),flowDirection:"topdown",findItems:function(d,b){var c=this;if(!b){b=[]}var a=$(d).children();$(a).each(function(){var e=this;var f=$(e).data("me");if(f){b.push(e);return false}else{c.findItems(e,b)}});return b},getBindItems:function(){var h=this,j=h.store,a=h.boxTarget,f=a.children(),g=f.length,d=0,c=[];f=h.prepareItems(f);var b=[];for(d=0;d<g;d++){var e=f[d];e=h.getItemObj(e);if(!e){h.findItems(f[d],b)}}f=f.concat(b);g=f.length;for(d=0;d<g;d++){var e=f[d];e=h.getItemObj(e);if(!e){continue}if(e.isRangeControl){if(e.startDataField||e.endDataField){c.push(e)}}else{if(e.dataField){c.push(e)}}}return c},item_focusout:function(b){var a=this;a.setStoreRecrod(b)},setCurRectValue:function(a,c,f){var d=this,b,e=d.store;if(e&&e.isStore){b=e.getCurrent();if(b){b.set(c,f);a.setDirty(true)}}return d},setRecord:function(b){var a=this;if(b){if(b.isModel){console.error("还没支持这种格式...可以加的...",b)}else{a.setObjectRecord(b)}}},setObjectRecord:function(e){var d=this,a,b;for(var c in e){a=d.findByDataField(c);b=e[c];d.setValueToControl(a,b)}},setValueToControl:function(a,c){var b=this;$(a).each(function(){this.setValue(c)});return b},setStoreRecrod:function(c){var b=this,a=c;if(a.readOnly||!a.isValueChanged()){return b}if(a.isRangeControl){if(a.startDataField&&a.isValueChanged("start")){var d=a.getStartValue();b.setCurRectValue(a,a.startDataField,d)}if(a.endDataField&&a.isValueChanged("end")){var d=a.getEndValue();b.setCurRectValue(a,a.endDataField,d)}}else{var d=a.getValue();b.setCurRectValue(a,a.dataField,d)}},getItemObj:function(b){var a=null;if(b){if(b.muid){a=b}else{a=$(b).data("me")}}return a},bindStore:function(c){var b=this,a=b.log;b.store=c;$(c).muBind("update",b,b.store_update).muBind("locked",b,b.store_locked).muBind("load",b,b.store_load).muBind("bulkremove",b,b.store_bulkRemove).muBind("invalid",b,b.store_invalid).muBind("clear",b,b.store_clear).muBind("currentchanged",b,b.store_currentChanged);b.store.onCurrentChanged()},store_bulkRemove:function(a,b){var c=a.data},store_invalid:function(f,g){var o=f.data;var d=g.errors;if(d.length>0){var m=d.items;for(var l in m){var k=m[l];var e="";for(var h=0;h<k.length;h++){if(k[h].type=="error"){e+=k[h].message}}var c=o.findByDataField(l);if(c&&c.length){var b=c.length;for(var n=0;n<b;n++){var a=c[n];a.markInvalid(e)}}}}},store_clear:function(a,b){var c=a.data},store_locked:function(a,b){var c=a.data},store_dataChanged:function(a,b){var c=a.data},store_update:function(event,record,operation,modifiedFieldNames){var me=event.data,i,j,modifiedField,items,len,isUpdateStyleField=false;if("COMMIT"==operation){for(i=0;i<modifiedFieldNames.length;i++){modifiedField=modifiedFieldNames[i];if("ROW_STYLE_JSON"==modifiedField){var jsonStr=record.get("ROW_STYLE_JSON");if(""==jsonStr){continue}var json=null;try{json=eval("("+jsonStr+")")}catch(ex){log.debug("json 解析数据错误"+jsonStr);continue}for(var k=0;k<json.cols.length;k++){var fieldSX=json.cols[k];items=me.findByDataField(fieldSX.name);var len=items.length;for(j=0;j<len;j++){var item=items[j];var msg="";for(var l=0;l<fieldSX.msgs.length;l++){if(l>0){msg+="\n"}msg+=fieldSX.msgs[l].message}item.markInvalid(msg)}}}else{items=me.findByDataField(modifiedField);len=items.length;for(j=0;j<len;j++){var item=items[j];var value=record.get(item.dataField);item.setDirty(false);if(item.oldValue!=value){item.oldValue=item.getValue();item.setValue(value)}}}}}else{if("EDIT"==operation){for(i=0;i<modifiedFieldNames.length;i++){modifiedField=modifiedFieldNames[i];items=me.findByDataField(modifiedField);len=items.length;for(j=0;j<len;j++){var item=items[j];var value=record.get(item.dataField);item.setDirty(false);if(item.oldValue!=value){item.oldValue=item.getValue();item.setValue(value)}}}}else{console.log("operation=",operation)}}var isLocked=record.isLocked();me.record_locked(record,isLocked);return isUpdateStyleField},findByDataField:function(c){var h=this,a=h.boxTarget,f=a.children(),g=f.length,j=[],e,d;f=h.prepareItems(f);var b=[];for(d=0;d<g;d++){var e=f[d];e=h.getItemObj(e);if(!e){h.findItems(f[d],b)}}f=f.concat(b);g=f.length;if(f&&f.length==0){return j}for(d=0;d<g;d++){e=f[d];e=h.getItemObj(e);if(!e||!e.dataField){continue}if(c!=e.dataField){continue}j.push(e)}return j},store_load:function(a,h){var e=a.data,d=e.log,b,f,g=h.data,c},record_locked:function(k,g){var j=this,h=j.log,l=j.store,a=j.boxTarget,e=a.children(),f=e.length,c=0;if(j.lockeState===g){return}j.lockeState=g;e=j.prepareItems(e);var b=[];for(c=0;c<f;c++){var d=e[c];d=j.getItemObj(d);if(!d){j.findItems(e[c],b)}}e=e.concat(b);f=e.length;for(c=0;c<f;c++){var d=e[c];d=j.getItemObj(d);if(!d){continue}if(!d.dataField){continue}if(false===d.allowChangeReadonly){continue}if(k.isLockedExclusionField(d.dataField)){d.setReadOnly(false)}else{d.setReadOnly(g)}}},store_currentChanged:function(b,d,k){var j=b.data,h=j.log;if(d>-1){var a=j.boxTarget;var g=a.children();g=j.prepareItems(g);if(g&&g.length==0){return}if(!k){return}for(var c=0;c<g.length;c++){var f=g[c];f=j.getItemObj(f);if(!f){continue}if(f.isRangeControl){if(f.startDataField){var l=k.get(f.startDataField);if(f.setOldValue){f.setOldValue("start",l)}else{f.startOldValue=l}f.setValue("start",l)}if(f.endDataField){var l=k.get(f.endDataField);if(f.setOldValue){f.setOldValue("end",l)}else{f.endOldValue=l}f.setValue("end",l)}}else{if(!f.dataField||!f.setValue){continue}var l=k.get(f.dataField);if(f.setOldValue){f.setOldValue(l)}else{f.oldValue=l}f.setValue(l)}}}if(k){var e=k.isLocked();j.record_locked(k,e)}},afterRender:function(){var e=this,b,c,d,a;c=e.getBindItems();d=c.length;for(a=0;a<d;a++){b=c[a];$(b).muBind("focusout",function(){e.item_focusout.call(e,this)});if(b.isCheckbox||b.isCheckGroup){$(b).muBind("changed",function(){e.setStoreRecrod.call(e,this)})}if(b.getReadOnly()){b.allowChangeReadonly=false}}},render:function(){var c=this,b=c.log;c.baseRender();if("auto"==c.formMode){if(c.store){var d=Mini2.data.StoreManager.lookup(c.store);c.store=d;c.bindStore(d)}}else{}if(c.isDelayRender){c.delayRenderTimer()}try{Mini2.ui.SecManager.reg(c.secFunCode,c)}catch(a){console.error("注册权限错误",a)}}});
Mini2.define("Mini2.ui.panel.AbstractTable",{log:Mini2.Logger,StrJoin:function(a){var c="";for(var b=0;b<a.length;b++){c+=a[b]}return c},renderTo:Mini2.getBody(),getStore:function(){var a=this,b;if(!a.store){b=Mini2.create("Mini2.data.Store",{storeId:"MiniStore_"+Mini2.newId(),model:"Mini2.data.FreeModel"});a.bindStore(b)}return a.store},bindStore:function(b){var a=this;a.store=b;$(b).muBind("update",a,a.store_update).muBind("add",a,a.store_add).muBind("datachanged",a,a.store_dataChanged).muBind("refresh",a,a.store_refresh).muBind("load",a,a.store_load).muBind("bulkremove",a,a.store_bulkRemove).muBind("invalid",a,a.store_invalid).muBind("clear",a,a.store_clear).muBind("currentchanged",a,a.store_currentChanged)},store_invalid:function(b,f,c){var e=b.data,g,h,d,a;g=e.getRowForRecord(f);h=$(g).index();for(d=0;d<c.length;d++){a=e.getColumnForDataIndex(c[d]);e.afterCellUpdate(a,g,f,h,c)}},getColumnForDataIndex:function(c){var f=this,a,b=f.m_Cols,d=b.length,e=[];while(d--){a=b[d];if(a.dataIndex==c){e.push(a)}}return e},getRowForRecord:function(c,b){var a=this,f=[],h=a.tbodyEl,e,d,g=h.children("tr");$(g).each(function(){d=this;e=$(d).data("record");if(e===c){f.push(d);if(b){return false}}});return f},afterCellUpdate:function(d,n,l,o,k){var j=this,c,e=d.dataIndex,m=l.index,f=d.renderer,a,i,h,b,p;a=$(n).children(":eq("+d.index+")");h=l.get(e);if(f&&f.call){try{p=f.call(d,h,c,c,l,o,e,j.store,j)}catch(g){}}else{p=h}p=Mini2.isBlank(p)?"&#160;":p;b=$(a).children(".mi-grid-cell-inner");if(l.isDisabledForField(e)){b.html('<hr style="border:none;border-top:1px dashed #b0b0b0;width:90%" />')}else{b.html(p)}i=l.isModified(e);$(a).toggleClass("mi-grid-dirty-cell",i);if(d.bindEvent){d.bindEvent.call(d,j,a,m,e,null,l,n)}j.preColumnInvalid(d,a,l)},store_currentChanged:function(b,d,g){var f=b.data,c="mi-grid-row-focused",h,i,j=$(f.tbodyEl).children(),e=f.lastRowFocused,a=null;if(d>-1){$(j).each(function(){h=this;i=$(h).data("record");if(i===g){a=h;return false}});$(a).addClass(c)}$(e).removeClass(c);f.lastRowFocused=a},store_clear:function(a){var b=a.data;b.itemRemoteAll();if(b.rowCheckColumn){b.rowCheckColumn.updateHeaderState()}},store_bulkRemove:function(d,a,f,g){var h=d.data,b=Mini2.Array,e,i,j,c=h.checkedRecords,k=h.tbodyEl.children("tr");$(k).each(function(){j=this;i=$(j).data("record");e=b.contains(a,i);if(e){$(j).remove();b.remove(c,i);return false}});h.itemsReset()},store_update_forRow:function(l,m,k,h){var f=this,c,e,a,b,g,o=f.rowStyleType,n=f.rowStyleField,d=false;for(c=0;c<h.length;c++){g=h[c];if(o&&g==n){d=true;continue}b=f.getColumnForDataIndex(g);e=b.length;while(e--){a=b[e];f.afterCellUpdate(a,l,k,m,h)}}return d},store_update_setInvalid:function(rowEl,record){var me=this,log=me.log,i,j,rowStyleType=me.rowStyleType,rowStyleField=me.rowStyleField,jsonStr=record.get(rowStyleField),json,cellEl,colStyle,colMsgs,colName,col,cols;if(!jsonStr){return}if(""==jsonStr){return}try{json=eval("("+jsonStr+")")}catch(ex){log.debug("json 解析数据错误"+jsonStr);return}var invalidCols={};record.clearInvalidAll();me.clearRowInvalid(rowEl,record);for(i=0;i<json.cols.length;i++){colStyle=json.cols[i];colMsgs=colStyle.msgs;colName=colStyle.name;cols=me.getColumnForDataIndex(colName);j=cols.length;while(j--){col=cols[j];cellEl=$(rowEl).children(":eq("+col.index+")");if(colMsgs&&colMsgs.length){col.markInvalid.call(col,record,cellEl,col.dataIndex,colMsgs);invalidCols[colName]=true}else{col.clearInvalid.call(col,record,cellEl,col.dataIndex)}}}},clearRowInvalid:function(g,f){var e=this,d,a,b,c=e.m_Cols;for(d=0;d<c.length;d++){b=c[d];a=$(g).children(":eq("+b.index+")");b.clearInvalid.call(b,f,a,b.dataIndex)}},store_update:function(d,j,i,h){var f=d.data,c="mi-grid-dirty-cell",b,l,k,a,g,e,m=f.getRowForRecord(j);$(m).each(function(){k=this;l=$(k).index();if(h){e=f.store_update_forRow(k,l,j,h);if(e){try{f.store_update_setInvalid(k,j)}catch(n){console.error("出现特殊错误",n);alert("处理单元格提示信息失败。\n\n"+n.message)}}}else{console.debug("-------------------------------    ",h);a=$(m).children("."+c);$(a).removeClass(c)}});if(f.rowCheckColumn){f.rowCheckColumn.updateHeaderState()}},store_refresh:function(a,g){var d=a.data,b,c,f=d.rowCheckColumn,e;d.itemRemoteAll();e=d.store.data;c=e.length;for(b=0;b<c;b++){d.itemAdd(e.get(b))}d.itemsReset();if(f){f.updateHeaderState()}},delayData:{},loopLoadItem:function(){var d=this,b,e,f,a=d.delayData,c=a.initCount||20;if(a.i>=a.len){return}b=a.i;if(b<c){e=a.len;if(e>c){e=c}for(b=0;b<e;b++){a.i++;f=a.items.get(b);d.itemInsert(b,f)}}else{a.i++;f=a.items.get(b);d.itemInsert(b,f)}setTimeout(function(){d.loopLoadItem()},1)},delayLoad:true,store_load:function(a,h){var d=a.data,b,e,f=h.data,c,g=d.rowCheckColumn;d.itemRemoteAll();c=f.length;if(d.delayLoad){d.delayData={i:0,len:c,initCount:20,items:f};d.loopLoadItem()}else{if(f.items){d.itemInsert(0,f.items)}else{d.itemInsert(0,f)}}if(g){g.updateHeaderState()}},store_dataChanged:function(b,c){var d=b.data,a=d.editor;if(a){a.hide()}},store_add:function(a,c,e){var d=a.data,b,f=d.rowCheckColumn;for(b=0;b<e.length;b++){d.itemInsert(c+b,e[b])}if(f){f.updateHeaderState()}},bind:function(b,e,a,g){var f=this,d=f.eventSet,c;if(!e){throw new Error("["+b+"] 必须指定绑定函数.")}if(!d){f.eventSet=d={}}c=d[b];if(!c){c=d[b]=[]}c.push({fun:e,owner:g,data:a});return f},off:function(a){var d=this,b=d.eventSet,c;if(b){c=b[a];if(c){delete b[a]}}return d},on:function(b,a){if(this.eventSet){var j=this,h,c,g,d,f=j.eventSet,e=f[b]||[];for(h=0;h<e.length;h++){c=e[h];g=c.fun;if(!g||!g.call){console.log("函数不存在...");console.log(g);continue}if(c.data){d=Mini2.clone(c.data)}else{d={}}d=Mini2.applyIf(d,a);g.call(c.owner||j,j,d)}}return this}});
Mini2.define("Mini2.ui.panel.Table",{extend:"Mini2.ui.panel.AbstractTable",log:Mini2.Logger.getLogger("Mini2.ui.panel.Table",console),scope:null,focusMgr:Mini2.ui.FocusMgr,scroll:"auto",visible:true,defaultEditorMode:"auto",isResetCellWidth:true,readOnly:false,rowLines:true,columnLines:true,focusBorders:true,isInit:false,columns:[],m_Cols:[],m_ColGroups:null,dock:"top",m_Table:null,tbodyEl:null,store:false,bodyEl:null,el:null,cellValues:{},autoRowCheck:false,m_NewRowIndex:0,lastRowFocused:null,curRowFocused:null,m_FocusCell:null,m_LastCell:null,m_LastEditor:null,width:"100%",height:"600px",headerContainer:null,checkedRecords:[],checkedRowEls:[],checkedMode:"MULTI",rowCheckColumn:null,pager:{},editor:null,sortable:true,pagerVisible:true,hidePagerRowCountSelect:false,cellTpl:['<td role="gridcell" class="mi-grid-cell mi-grid-td ">','<div class="mi-grid-cell-inner">',"</div>","</td>"],rowStyleType:"json",rowStyleField:"ROW_STYLE_JSON",rowStyleEnabled:true,rowAltEnabled:true,jsonMode:"simple",cellDbclickEvents:false,_cellDbclick:function(b){var c=this,a=c.cellDbclickEvents;if(Mini2.isFunction(b)){if(a==false){c.cellDbclickEvents=a=[]}a.push(b)}},onCellDbclick:function(g,a,f){var e=this,d,c,b=e.cellDbclickEvents;if(b){for(d=0;d<b.length;d++){c=b[d];c.call(e,{rowEl:g,cellEl:a,record:f})}}},updateLayout:function(d){var c=this,b=c.headerContainer,e,a;b.resetWidth();c.resetBodyWidth()},createColGroup:function(){var e=this,d=0,a,c=e.m_Cols,b="";for(;d<c.length;d++){a=c[d];b+=Mini2.join(["<colgroup>",'<col style="width:',a.width,'px;"  data-muid="',a.muid,'" />',"</colgroup>"])}return b},renderCell:function(r,f,p,q,g,n,s){var m=this,t=m.selModel,c=m.cellValues,u,a,l,j,b,h=f.dataIndex,e=f.renderer,d=f.innerCls;j=p.get(h);a=f.renderCell();$(r).append(a);l=a.children(":first");if(m.isResetCellWidth){l.css("width",(f.width-2)+"px")}if(e&&e.call){try{u=e.call(f,j,c,c,p,q,g,m.store,m,s,a)}catch(i){console.error("渲染对象 colRenderer ",e);throw new Error("渲染单元格的值错误, 字段名="+h)}}else{u=j}c.value=Mini2.isBlank(u)?"&#160;":u;a.addClass(f.tdCls);if(Mini2.isFunction(d)){$(l).addClass(d.call(f))}else{$(l).addClass(d)}if(p.isModified(h)){a.addClass("mi-grid-dirty-cell")}if(f.groupRoot){var k=f.groupRoot.groupIndex;if(undefined!=k&&k%2==0){a.addClass("mi-grid-td-group-back")}}if(f.isFirst&&g>0){var o=m.m_Cols[g-1];if(o&&!o.isLast){a.prev().addClass("mi-grid-td-group-last")}}if(f.isLast){a.addClass("mi-grid-td-group-last")}b=a.children(".mi-grid-cell-inner");if(p.isDisabledForField(h)){b.html('<hr style="border:none;border-top:1px dashed #b0b0b0;width:90%" />')}else{b.html(u)}if(f.bindEvent){f.bindEvent.call(f,m,a,q,g,null,p,s)}m.preColumnInvalid(f,a,p);return a},preColumnInvalid:function(b,a,g){var f=this,e=f.log,c=b.dataIndex;try{if(g&&c&&c!=""){if(g.errors){b.markInvalid.call(b,g,a,c)}else{b.clearInvalid.call(b,g,a,c)}}}catch(d){e.error("创建错误标记失败. column.markInvalid（....) ")}},renderRow:function(k,j,m,h){var g=this,f=g.log,e=0,l,b,a,c=g.m_Cols;l=$('<tr role="row" class="mi-grid-row  mi-grid-data-row" tabindex="-1" ></tr>');$(k).append(l);l.data("record",j);for(;e<c.length;e++){b=c[e];try{a=g.renderCell(l,b,j,m,e,h,l)}catch(d){throw new Error("初始化单元格错误.miType="+b.miType+"\r\n"+d.message)}}if(g.rowStyleEnabled){try{g.store_update_setInvalid(l,j)}catch(d){f.debug("设置异常提示信息失败.")}}return l},renderRows:function(b,c,a){},render_GridBody:function(){var c=this,a,b,e,d;a=c.createColGroup();d=Mini2.$join(['<div class="mi-panel-body ',"mi-grid-body ","mi-panel-body-default ","mi-layout-fit ","mi-panel-body-default ",'mi-noborder-rbl" ','style="width:',c.width,'; height: 284px; left: 0px; top: 0px; ">','<div class="mi-grid-view mi-fit-item mi-grid-view-default" ','style="overflow: auto; margin: 0px; width: ',c.width,'; height: 283px; " tabindex="-1" >',"</div>","</div>"]);e=Mini2.$join(['<table class="mi-grid-table" border="0" cellspacing="0" cellpadding="0" >',a,"<tbody>","</tbldy>","</table>"]);c.bodyEl=d;c.gridViewEl=b=d.children(".mi-grid-view:first");if(c.rowLines){c.el.addClass("mi-grid-with-row-lines")}if(c.columnLines){c.el.addClass("mi-grid-with-col-lines")}if("auto"!=c.scroll){if("none"==c.scroll){b.css("overflow","none")}}$(c.el).append(c.bodyEl);$(b).append(e);c.m_ColGroups=e.children("colgroup");c.m_Table=e;c.tbodyEl=e.children("tbody:first");$(c.tbodyEl).muBind("contextmenu",function(f){c.showCheckMenu(f);return false})},setSize:function(q,i){var l=this,k=l.log,f=l.el,a=l.bodyEl,g=l.gridViewEl,m=0,n,p=0,o=l.summary,j=l.headerContainer.height;if(undefined!=q){l.width=q;var c=$(f).css("border-left-width");var d=$(f).css("border-right-width");c=parseInt(c);d=parseInt(d);q-=(c+d);f.width(q);a.width(q);g.width(q);if(o){o.setWidth(q)}}if(undefined!=i){i=parseInt(i);if(l.minHeight&&i<l.minHeight){i=l.minHeight}l.height=i;var e=$(f).css("border-top-width");var b=$(f).css("border-bottom-width");e=parseInt(e);b=parseInt(b);i-=(e+b);m=l.getPagetHeight();p=l.getSummaryHeight();n=i-j-2-m-p;f.css("height",i);a.css("height",n);g.css("height",n)}return l},render_Panel:function(){var b=this,a;b.el=a=Mini2.$join(['<div class="mi-panel mi-panel-default-framed mi-grid" ','style="width: 100%; height: 350px; right: auto; left: 0px; top: 0px;      overflow: hidden;" >',"</div>"]);a.css({width:b.width,height:b.height});if(!b.visible){a.hide()}if(b.minHeight){a.css({"min-height":b.minHeight+"px"})}if(b.applyTo){$(b.applyTo).replaceWith(a)}else{$(b.renderTo).append(a)}return a},pager_click:function(b,c){var a=this;c.loadPage(b)},render_Pager:function(){var b=this,a,c=b.pager,d=!!b.pagerVisible;if((c&&c.visible==false)||b.pagerVisible==false){return}b.pagerVisible=d;a=Mini2.apply(b.pager,{renderTo:b.el,store:b.getStore(),visible:d,hideRowCountSelect:b.hidePagerRowCountSelect||false,click:b.pager_click});c=Mini2.create("Mini2.ui.Pagination",a);c.render();b.pager=c},render_Summary:function(){var a=this,b;if(a.summaryVisible){b=Mini2.create("Mini2.ui.grid.feature.Summary",{renderTo:a.el,grid:a,store:a.getStore(),columns:a.m_Cols});b.render();a.summary=b}},getSummaryHeight:function(){var a=this,b=a.summary;if(b&&b.muid){return b.height}return 0},getPagetHeight:function(){var a=this,b=a.pager;if(!a.pagerVisible){return 0}if(b&&b.muid){return Mini2.SystemInfo.pagination.height||24}return 0},delayRender:function(){var b=this,a=$(b.applyTo);Mini2.delayRS=Mini2.delayRS||{};Mini2.delayRS[b.applyTo]=b;b.isDelayRender=true;a.attr("mi-delay-render","true");a.data("me",b);return b},setFocus:function(){var b=this,d=b.tbodyEl;var c=$(d).children(".mi-grid-row:first");var a=$(c).children(":eq(2)");b.cell_focus(a)},render:function(f){var e=this,a=null,c,l=e.maxWidth||e.width,d=e.maxHeight||e.height,j=e.store,k=Mini2.SystemInfo.table;e.onInit();a=e.render_Panel();e.headerContainer=c=Mini2.create("Mini2.ui.grid.header.Container",{renderTo:a,columns:e.columns,width:l,height:k.headerHeight,rowHeight:k.rowHeight,grid:e});c.render();c.columnWidthResize(function(m){e.resetBodyWidth(m);var n=e.focusedRegion;if(n){e.setFocusRegion(n.itemA,n.itemB,true)}else{e.setFocusRegion()}});c.columnMoved=function(n){var m=e.srcColumns;Mini2.Array.move(m,n.fromIndex,n.toIndex);e.clearColumnAll();e.addColumn(m)};e.render_GridBody();e.render_Summary();e.render_Pager();e.setSize(l,d);e.syncScrollLeft();e.resetBodyWidth();if(j&&j.isStore){e.bindStore(j)}else{j=e.getStore()}j.load();var g=$(a).parent();var h=$(g).hasClass("mi-box-target");if(!h){$(window).resize(function(){var m=$(g).width();e.setSize(m,null)})}a.data("me",e);try{var i=Mini2.ui.SecManager;i.reg(e.secFunCode,e,"visible");i.reg(e.secReadonly,e,"readonly")}catch(b){console.error("注册权限错误",b)}return e},keydownEvent:[],setKeydownEvent:function(a){var c=this,b=c.keydownEvent;b.push(a)},onKeydownEvent:function(a){var f=this,b,d=f.keydownEvent||[];for(var c=0;c<d.length;c++){b=d[c];b.call(this,a)}},proKeyEvent:function(c){var j=this,i=Mini2.Logger,h=c.keyCode,o=j.curRowFocused,a=j.m_FocusCell,d=j.editor;j.onKeydownEvent(c);if(c.stoped){return}if(d&&d.isVisible()){d.proKeyEvent2(c);if(c.stoped){return}if(Mini2.onwerPage.typeahead.length){return}if(9==h){d.hide()}else{if(38==h||40==h){var m,l;if(40==h){m=$(o).next()}else{if(38==h){m=$(o).prev()}}if($(m).length>0){d.hide()}}else{if(37==h&&d.isFirstCursorPos()){d.hide()}else{if(39==h&&d.isLastCursorPos()){d.hide()}else{d.onKeydown(c);return}}}}}if(13==h){var q=$(a).index();var n=$(o).data("record");var b=j.m_Cols[q];var k=b.miType;if("rowcheckcolumn"==k){j.cell_click_rowCheckColumn(a,a,o,n);return}else{if("actioncolumn"==k){return}}if(j.autoRowCheck){j.setRowCheck(o,true)}if(j.readOnly||(j.store&&j.store.readOnly)){return}if(n.isLocked&&n.isLocked()){return}if("checkcolumn"==k){j.cell_click_checkColumn(a,a,b,n);return}if(Mini2.isFunction(b.click)){var f=n.get(b.dataIndex);var p=$(o).index();b.click.call(b,f,n,b,a,o,p,q,j.store,j)}console.debug("column header = ",b);if(b.readOnly){return}if(true!==b.readOnly&&b.editor&&"none"!=b.editorMode){var r=b.editor.xtype;if(b.isPropertyColumn){j.cell_click_propertyColumn(a,a,b,n)}if(Mini2.ui.grid.CellEditor){var d=j.getEditor(b,n);j.showEditor(a,a,o,b,n,d);Mini2.EventManager.stopEvent(c)}}}if(40==h||38==h){var m,l;if(40==h){m=$(o).next()}else{if(38==h){m=$(o).prev()}}if($(m).length){$(a).removeClass("mi-grid-cell-selected");var g=$(a).index();l=$(m).children(":eq("+g+")");n=$(m).data("record");j.store.setCurrent(n);j.cell_focus(l);Mini2.EventManager.stopEvent(c)}if($(m).length&&l){var o=m,a=l;var q=$(a).index();var n=$(o).data("record");var b=j.m_Cols[q];var k=b.miType;if("rowcheckcolumn"==k){j.cell_focus(l);Mini2.EventManager.stopEvent(c);return}else{if("actioncolumn"==k){j.cell_focus(l);Mini2.EventManager.stopEvent(c);return}}if(j.autoRowCheck){j.cell_focus(l);Mini2.EventManager.stopEvent(c)}if(j.readOnly||(j.store&&j.store.readOnly)){j.cell_focus(l);Mini2.EventManager.stopEvent(c);return}if(n.isLocked&&n.isLocked()){j.cell_focus(l);Mini2.EventManager.stopEvent(c);return}if("checkcolumn"==k){j.cell_focus(l);Mini2.EventManager.stopEvent(c);return}if(true!==b.readOnly&&b.editor&&"none"!=b.editorMode){var r=b.editor.xtype;if("text"!=r&&"numberfield"!=r){}else{if(b.isPropertyColumn){j.cell_click_propertyColumn(a,a,b,n);return}if(Mini2.ui.grid.CellEditor){var d=j.getEditor(b,n);j.showEditor(a,a,o,b,n,d);Mini2.EventManager.stopEvent(c);return}}}j.cell_focus(l);Mini2.EventManager.stopEvent(c)}}else{if(37==h||39==h||9==h){var l;if(37==h||(9==h&&c.shiftKey)){l=$(a).prev()}else{if(39==h||9==h){l=$(a).next()}}if($(l).length){$(a).removeClass("mi-grid-cell-selected");j.cell_focus(l);Mini2.EventManager.stopEvent(c)}else{if(39==h||9==h){m=$(o).next();if($(m).length){$(a).removeClass("mi-grid-cell-selected");var l=$(m).children(":eq(0)");n=$(m).data("record");j.store.setCurrent(n);j.cell_focus(l);Mini2.EventManager.stopEvent(c)}}}}else{if((h>=65&&h<=90)||(h>=96&&h<=105)){}}}},setTop:function(c){var b=this,a=b.el;a.css("top",c);return b},setLeft:function(b){var c=this,a=c.el;a.css("left",b);return c},getTop:function(){var b=this,a=b.el;return a.css("top")},getLeft:function(){var b=this,a=b.el;return a.css("left")},setWidth:function(b){var a=this;a.setSize(b,undefined);return a},setHeight:function(a){var b=this;b.setSize(undefined,a);return b},getWidth:function(){var b=this,a=b.el;return a.width()},getHeight:function(){var b=this,a=b.el;return a.height()},getSize:function(){var c=this,a=c.el,d=a.width(),b=a.height();return{width:d,height:b}},isVisible:function(){var b=this,a=b.el;return a&&a.is(":visible")},syncScrollLeft:function(){var b=this,a=b.gridViewEl;$(a).mousedown(function(c){b.focusMgr.setControl(b);Mini2.EventManager.clear()});a.scroll(function(c){var d=$(this).scrollLeft();b.headerContainer.scrollLeft(d);if(b.summary){b.summary.scrollLeft(d)}});return b},resizeCellWidth:function(c){var h=this,f,g,b=h.m_Cols,a,o,m=h.tbodyEl,l=m.children("tr.mi-grid-row"),k,n,e,d=-1;if(c){d=c.index}for(f=0;f<l.length;f++){k=l[f];if(d>-1){a=b[d];n=$(k).children("td.mi-grid-cell:eq("+d+")");e=$(n).children(".mi-grid-cell-inner:first");$(e).css("width",(a.width-2)+"px")}else{o=$(k).children("td.mi-grid-cell");for(g=0;g<b.length;g++){a=b[g];n=o[g];e=$(n).children(".mi-grid-cell-inner:first");$(e).css("width",(a.width-2)+"px")}}}if(h.summary){h.summary.resizeCellWidth.call(h.summary)}return h},resetBodyWidth:function(e){var g=this,f,d=g.m_Cols,a,b,j=0,h,c;h=$(g.bodyEl).find(".mi-grid-table:first");c=$(h).children("colgroup");for(f=0;f<d.length;f++){b=$(c[f]).children("col");a=d[f];if(a.visible){j+=a.width;b.css("width",a.width);b.show()}else{b.hide()}}g.m_Table.css("width",j);g.headerContainer.setWidth(j);if(g.editor){g.editor.hide()}if(g.isResetCellWidth){g.resizeCellWidth(e)}return g},itemRemoteAll:function(){var a=this,b=$(a.tbodyEl).children();$(b).remove();a.m_NewRowIndex=0;a.checkedRecords=[];a.checkedRowEls=[]},itemInsert:function(d,b,f){var e=this,n=e.tbodyEl,c,a,g,h,j,k=[],m,l;if(f){f.rowEls=k}m=$(n).children();a=m.length;if(d>a){d=a}if(Mini2.isArray(b)){h=b}else{h=[b]}for(c=0;c<h.length;c++){g=h[c];j=e.renderRow(e.tbodyEl,g,e.m_NewRowIndex);k.push(j)}if(a){if(d==0){l=$(m).eq(0);$(l).before(k)}else{l=$(m).eq(d-1);$(l).after(k)}}e.itemsReset();for(c=0;c<k.length;c++){j=k[c];g=h[c];e.bindEvent_ForRow(g,j);e.bindEvent_ForCell(g,j)}return e},getCellPosition:function(a){var c=this,d=0,e=0,b,j,h,i,f,g;i=a.index();h=a.parent();f=$(a).prevUntil();f.each(function(){if($(this).is(":visible")){d+=$(this).outerWidth()}});g=h.prevUntil();g.each(function(){if($(this).is(":visible")){e+=$(this).outerHeight()}});e+=c.headerContainer.height;b=d-c.gridViewEl.scrollLeft();j=e-c.gridViewEl.scrollTop();return{left:b,top:j}},getCellSize:function(a){var c,b;c=a.outerWidth()+1;b=a.outerHeight();return{width:c,height:b}},setHeaderCheck:function(a){var b=this;b.headerContainer.setHeaderCheck(a);return b},setRecordCheck:function(d,a){var b=this,e,f,c;f=$(b.tbodyEl).children();$(f).each(function(){e=$(this);c=e.data("record");if(c.getId()==d){b.setRowCheck(e,a);return false}});return b},setRowCheck_ForSingle:function(j,i,e,l,c,g){var h=this,a,k,d,b,f;if(g||"SINGLE"==h.checkedMode){a=$(j).parent();k=$(a).children("."+l);$(k).each(function(){j=$(this);d=j.data("record");if(d===i){return}b=j.children(":eq("+e.index+")");f=b.find("img:first");j.removeClass(l);$(f).removeClass(c)});h.checkedRecords.length=0;h.checkedRowEls.length=0}return h},setRowCheck:function(l,g,h){var i=this,b=Mini2.Array,e=i.rowCheckColumn,c,f,a=$(l),j=a.data("record"),k="mi-grid-row",m=k+"-selected",d="mi-grid-checkcolumn-checked";if(e!=null){c=a.children(":eq("+e.index+")");f=c.find("img:first");i.setRowCheck_ForSingle(l,j,e,m,d,h);a.toggleClass(m,g);$(f).toggleClass(d,g);if(g){b.include(i.checkedRowEls,a[0]);b.include(i.checkedRecords,j)}else{b.remove(i.checkedRowEls,a[0]);b.remove(i.checkedRecords,j)}e.onSelectChange();i.on("rowsChecked",{rowEls:i.checkedRowEls,records:i.checkedRecords})}return i},setRowCheckAll:function(e){var f=this,i,j,d,a,g,c=f.rowCheckColumn,h="mi-grid",k=h+"-row-selected",b=h+"-checkcolumn-checked";f.setHeaderCheck(e);j=$(f.tbodyEl).children();f.checkedRecords.length=0;f.checkedRowEls.length=0;$(j).each(function(){i=$(this);a=i.children("td:eq("+c.index+")");g=i.data("record");d=a.find("img.mi-grid-checkcolumn");i.toggleClass(k,e);d.toggleClass(b,e);if(e){f.checkedRecords.push(g);f.checkedRowEls.push(this)}});f.on("rowsChecked",{rowEls:f.checkedRowEls,records:f.checkedRecords});return f},cell_click_rowCheckColumn:function(a,b,g,f){var e=this,c,d;e.focusMgr.setControl(b,e,null);c=a.find("img:first");d=c.hasClass("mi-grid-checkcolumn-checked");e.setRowCheck(g,!d);return e},cell_click_checkColumn:function(a,b,d,h){var g=this,e,f,c="mi-grid-checkcolumn-checked";if(true===d.readOnly||"none"==d.editorMode){return}if(!g.readOnly){g.focusMgr.setControl(b,g,null);e=a.find("img:first");e.toggleClass(c);f=$(e).hasClass(c);h.set(d.dataIndex,f)}return g},cell_click_propertyColumn:function(a,b,c,p){var m=this,l=m.log,q=p.get("Type"),n=p.get("Name"),e,d,o;switch(q){case"int":e="numberfield";break;case"date":e="datefield";break;case"bool":e="combobox";break;case"enum":e="combobox";break;default:e="textfield";break}c.xtype=e;d=("enum"==q)?(n+"_"+e):e;o=c.propEditor[d];if(!o){o={xtype:e};c.propEditor[d]=o}if(!o.isInit){switch(q){case"bool":Mini2.apply(o,{fields:["value","text"],store:[{value:"true",text:"true"},{value:"false",text:"false"}]});break;case"enum":var h=[],g=p.get("Extend");if(Mini2.isArray(g)){for(var k=0;k<g.length;k++){var j=g[k];if(Mini2.isString(j)){h.push({value:j,text:j})}}}else{for(var f in g){var j=g[f];h.push({value:f,text:j})}}Mini2.apply(o,{fields:["value","text"],store:h});break}}return m},cell_focus:function(b){var e=this,a,h,i,g,c,f;if(!b){return}a=$(b);if(0==a.length){return}e.curRowFocused=h=a.parent();i=a.index();g=$(h).data("record");c=e.m_Cols[i];f=c.miType;e.m_LastCell=e.m_FocusCell;if(e.m_LastCell!=null){var d=$(e.m_LastCell).children(".mi-grid-cell-inner");d.show()}e.m_FocusCell=a;if("rowcheckcolumn"==f){e.focusMgr.setControl(b,e,null);e.autoFocusScroll_2(b);return}else{if("actioncolumn"==f){e.focusMgr.setControl(b,e,null);e.autoFocusScroll_2(b);return}}if("checkcolumn"==f){e.focusMgr.setControl(b,e,null);e.autoFocusScroll_2(b);return}if(true===c.readOnly||!c.editor||"none"==c.editorMode){e.focusMgr.setControl(b,e,null);e.autoFocusScroll_2(b);return}e.focusMgr.setControl(b,e,null);var j=c.editor.xtype;if(c.isPropertyColumn){e.focusMgr.setControl(b,e,null);e.autoFocusScroll_2(b)}if(Mini2.ui.grid.CellEditor){e.focusMgr.setControl(b,e,null);e.autoFocusScroll_2(b)}else{}},cell_dblclick:function(b){var e=this,a,h,i,g,c,f;if(!b){return}a=$(b);if(0==a.length){return}e.curRowFocused=h=a.parent();i=a.index();g=$(h).data("record");c=e.m_Cols[i];f=c.miType;e.m_LastCell=e.m_FocusCell;if(e.m_LastCell!=null){var d=$(e.m_LastCell).children(".mi-grid-cell-inner");d.show()}e.m_FocusCell=a;if("rowcheckcolumn"==f){e.cell_click_rowCheckColumn(a,b,h,g);return}else{if("actioncolumn"==f){return}}e.setRowCheck(h,true,true);e.onCellDbclick()},cell_Click:function(b){var h=this,a,k,m,j,c,i;if(!b){return}a=$(b);if(0==a.length){return}h.curRowFocused=k=a.parent();m=a.index();j=$(k).data("record");c=h.m_Cols[m];i=c.miType;h.m_LastCell=h.m_FocusCell;if(h.m_LastCell!=null){var g=$(h.m_LastCell).children(".mi-grid-cell-inner");g.show()}h.m_FocusCell=a;if("rowcheckcolumn"==i){h.cell_click_rowCheckColumn(a,b,k,j);return}else{if("actioncolumn"==i){return}}if(h.autoRowCheck){h.setRowCheck(k,true,true)}if(h.readOnly){return}var f=false;if(j.isLocked&&j.isLocked()){if(j.isLockedExclusionField(c.dataIndex)){f=true}else{return}}if(!f){if(j.isLockedForField(c.dataIndex)){return}if(j.isDisabledForField(c.dataIndex)){return}}if("checkcolumn"==i){h.cell_click_checkColumn(a,b,c,j);return}if(Mini2.isFunction(c.click)){var e=j.get(c.dataIndex);var l=$(k).index();c.click.call(c,e,j,c,b,k,l,m,h.store,h)}if(true===c.readOnly||!c.editor||"none"==c.editorMode){h.focusMgr.setControl(b,h,null);return}var n=c.editor.xtype;if(c.isPropertyColumn){h.cell_click_propertyColumn(a,b,c,j)}if(Mini2.ui.grid.CellEditor){var d=h.getEditor(c,j);h.showEditor(a,b,k,c,j,d)}else{In("Mini2.ui.grid.CellEditor",function(){var o=h.getEditor(c,j);h.showEditor(a,b,k,c,j,o)})}},showEditor:function(a,b,j,c,i,e){var g=this,f=g.log,d=a.children(".mi-grid-cell-inner"),k,h;if(!e){throw new Error("编辑控件不存在")}if(!e.isSaveed){e.isSaveed=true}if(c.innerAutoHide==false){}else{d.hide()}k=g.getCellSize(a);h=g.getCellPosition(a);h.left-=1;h.top-=1;k.height+=2;e.startEditByPosition(h).setSize(k).focus().setRowCell(j,b).startEdit(i,c,{});g.editor=e},hideEditor:function(){var b=this,a=b.editor;if(a){a.hide()}return b},getEditor:function(a,j){var f=this,k,b,e,c;if(a.isPropertyColumn){var h=a.propEditor,g=j.get("Name"),i=j.get("Type"),d=a.xtype;if("enum"==i){d=g+"_"+a.xtype}c=h[d];if(!c.isInit){k=a.xtype||"textcolumn";b=Mini2.applyIf({grid:f,renderTo:f.el,isInit:true,visible:false,xtype:k,placeholder:a.placeholder},c);e=Mini2.create("Mini2.ui.grid.CellEditor",b);e.config=c;e.render();h[d]=e}return h[d]}else{c=a.editor;if(c.isInit==false){k=c.xtype||"textcolumn";b=Mini2.applyIf({grid:f,renderTo:f.el,isInit:true,visible:false,placeholder:a.placeholder,autoTrim:a.autoTrim,column:a},c);e=Mini2.create("Mini2.ui.grid.CellEditor",b);e.config=c;e.render();a.editor=e}return a.editor}},clearSelectAndFocus:function(){var a=this,b="mi-grid-row",d=b+"-selected",c=a.tbodyEl.children("."+d);$(c).removeClass(d);return a},autoFocusScroll_2:function(f){var h=this,a=h.gridViewEl,d=$(f);if(d.length){var k=0,l=0,j=d.parent(),p=d.index(),o,i,c,b,g,e,m,n;o=h.getCellSize(d);i=h.getCellPosition(d);c=a.width();b=a.height();g=i.left+o.width;e=i.top+o.height;m=a.scrollLeft();n=a.scrollTop();if(g>c-15){k=g-c+15}else{if(i.left<0){k=i.left-2}}if(e>(b+16-2)){l=(e-b-16+2)}else{if(i.top<h.headerContainer.height){l=-(h.headerContainer.height-i.top)}}a.scrollLeft(m+k);a.scrollTop(n+l)}},autoFocusScroll:function(f){var h=this,a=h.gridViewEl,d=$(f);if(d.length){var k=0,l=0,j=d.parent(),p=d.index(),o,i,c,b,g,e,m,n;o=h.getCellSize(d);i=h.getCellPosition(d);c=a.width();b=a.height();g=i.left+o.width;e=i.top+o.height;m=a.scrollLeft();n=a.scrollTop();if(g>c-15){k=g-c+15}else{if(i.left<0){k=i.left-2}}if(e>(b+16-2)){l=(e-b-16+2)}else{if(i.top<h.headerContainer.height){l=-(h.headerContainer.height-i.top)}}a.scrollLeft(m+k);a.scrollTop(n+l);Mini2.EventManager.setMouseDown(f);Mini2.ui.FocusManager.setControl(f)}},getSelectRange:function(){var h=this,e=h.focusedRegion;var f=e.itemA||e.itemB;var g=e.itemB||e.itemA;var j=$(f).parent();var m=$(g).parent();var b=$(f).index();var d=$(g).index();var k=$(j).index();var n=$(m).index();var a=Math.min(b,d);var c=Math.max(b,d);var i=Math.min(k,n);var l=Math.max(k,n);return{colA:a,colB:c,rowA:i,rowB:l}},showCheckMenu:function(a){var b=this,c=b.menu;if(!c){function d(f){var h=b.focusedRegion,n=b.store;if(h&&(h.itemA||h.itemB)){var l=b.getSelectRange();for(var j=l.rowA;j<=l.rowB;j++){var k=b.tbodyEl.children(":eq("+j+")");var i=$(k).data("record");for(var g=l.colA;g<=l.colB;g++){var e=b.m_Cols[g];if("checkcolumn"!=e.miType){continue}if("reverse"==f){var m=!!i.get(e.dataIndex);i.set(e.dataIndex,!m)}else{i.set(e.dataIndex,f)}}}}}b.menu=c=Mini2.create("Mini2.ui.menu.Menu",{left:a.pageX,top:a.pageY,items:[{text:"全选",click:function(){d(true)}},{text:"反选",click:function(){d("reverse")}},{text:"全不选",click:function(){d(false)}}]});c.render()}else{c.setLocal(a.pageX,a.pageY).show()}},getSeelctCellText:function(){var e=this,d=e.focusedRegion,l=e.store,m="";if(d&&(d.itemA||d.itemB)){var j=e.getSelectRange();var i=0;for(var g=j.rowA;g<=j.rowB;g++){if(i++>0){m+="\n"}var h=e.tbodyEl.children(":eq("+g+")");var f=$(h).data("record");var c=0;for(var b=j.colA;b<=j.colB;b++){var a=e.m_Cols[b];var k=f.get(a.dataIndex);if(c++>0){m+="\t"}m+=k}}}return m},showFocusBorder:function(d){var f=this,e=f.el,b=f.$focusEl;if(f.focusBorders){if(!b){b=Mini2.$joinStr(['<div class="mi-grid-cell-focused" >','<div class="mi-focused-backdrop"></div>','<div class="mi-focused-border mi-focused-border-left"></div>','<div class="mi-focused-border mi-focused-border-top"></div>','<div class="mi-focused-border mi-focused-border-right"></div>','<div class="mi-focused-border mi-focused-border-bottom"></div>','<div class="mi-focused-handle"></div>',"</div>"]);f.gridViewEl.append(b);f.$focusEl=b;var c=b.children(".mi-focused-handle");var a=b.children(".mi-focused-border");c.muBind("mousedown",function(){}).muBind("mouseup",function(){});a.muBind("mousedown",function(){}).muBind("mouseup",function(){}).muBind("contextmenu",function(g){f.showCheckMenu(g);return false})}f.setFocusRegion(d)}return f},hideFocusBorder:function(b){var d=this,c=d.el,a=d.$focusEl;if(d.focusBorders){var b=a.data("cellEl");if(b===this){a.hide()}}return d},cell_mouse_button:null,setFocusRegion:function(u,g,h){var o=this,n=o.log,a=o.$focusEl,y=o.gridViewEl,k=u,l=g,m=o.focusedRegion,c,e,z,B,A,C;if(true!=h){if(!u&&!g){if(a){a.hide()}return}if(m&&m.itemA==k&&m.itemB==l){return}}if(a){o.focusedRegion={itemA:k,itemB:l};var p=y.offset();var t=y.scrollTop();var s=y.scrollLeft();c=$(k).offset();p.left-=s;p.top-=t;if(k&&l&&k!=l){e=$(l).offset();z=Math.min(c.left,e.left);B=Math.min(c.top,e.top);A=Math.max(c.left+$(k).width(),e.left+$(l).width());C=Math.max(c.top+$(k).height(),e.top+$(l).height())}else{z=c.left;B=c.top;A=c.left+$(k).width();C=c.top+$(k).height()}z-=p.left;B-=p.top;A-=p.left;C-=p.top;a.css({left:z-2,top:B-2,width:A-z+4,height:C-B+4}).show()}if(o.autoRowCheck&&l){var q=$(k).parent();var r=$(l).parent();var b=$(q).index();var d=$(r).index();var w=Math.min(b,d);var x=Math.max(b,d);var v=o.tbodyEl;var j=0;var f=o.rowCheckColumn;v.children().each(function(){var i=$(this).children(":eq("+f.index+")");var D=i.find("img:first");if(j>=w&&j<=x){if(D.hasClass("mi-grid-checkcolumn-checked")){}else{o.setRowCheck(this,true)}}else{if(D.hasClass("mi-grid-checkcolumn-checked")){o.setRowCheck(this,false)}else{}}j++})}return o},extendCellEvent:function(a){var c=this,b=c.log;$(a).on("focusin",function(){$(this).addClass("mi-grid-cell-selected");c.showFocusBorder(this)}).on("focusout",function(){$(this).removeClass("mi-grid-cell-selected");c.hideFocusBorder(this)});$(a).muBind("mousedown",function(d,e){c.cell_mouse_button=d.button;if(c.cell_mouse_button==0){c.autoFocusScroll(this)}}).muBind("mousemove",function(e,g){if(c.cell_mouse_button==0){var f=g.target;if(!$(f).hasClass("mi-grid-cell")){var d=$(f).parents(".mi-grid-cell");f=d[0]}if(f!=null&&this!==f){if($(f).hasClass("mi-grid-cell-row-numberer")){return}c.setFocusRegion(this,f)}}}).muBind("mouseup",function(e,h){var d;if($(h.target).hasClass("mi-grid-cell")){d=h.target}else{d=$(h.target).parents(".mi-grid-cell");d=d[0]}if(c.cell_mouse_button==0&&this===d){var g,f;g=$(this).parent();f=$(g).data("record");c.store.setCurrent(f);c.cell_Click(this)}c.cell_mouse_button=null}).on("dblclick",function(d){c.cell_dblclick(this)});return c},bindEvent_ForCell:function(b,c){var a=this,d=$(c).children("td");$(d).each(function(){a.extendCellEvent(this)})},bindEvent_ForRow:function(c,e){var a=this,d="mi-grid-row",b=d+"-over";$(e).mouseenter(function(f){$(this).addClass(b)}).mouseleave(function(f){$(this).removeClass(b)})},getColumnByType:function(g){var f=this,a,d=0,b=[],c=f.m_Cols,e=c.length;for(;d<e;d++){a=c[d];if(a.miType.toLowerCase()==g){b.push(a)}}return b},itemsReset:function(){var e=this,d=e.log,i=null,j,h,g=0,b=e.itemReseted,f=e.rowAltEnabled,a="mi-grid-row-alt",c="mi-grid-locked-row";j=$(e.tbodyEl).children(".mi-grid-row");h=e.getColumnByType("rownumberer");$(j).each(function(){var o=$(this),n,m,l=h.length;if(f){o.toggleClass(a,!(g%2))}if(l){n=o.data("record");m=n.isLocked();o.toggleClass(c,m);while(l--){e.afterCellUpdate(h[l],this,n,g)}}if(b){try{b.call(e,{rowEl:o,rowIndex:g,record:n})}catch(k){d.debug("调用刷新记录错误.")}}g++});e.m_NewRowIndex=g},fullDetailCols:function(f,l,c,e){var k=this,g,h,a,b=(c?c.length:0),d;e=e||1;if(b){for(g=0;g<b;g++){d=c[g];a=k.getColumnForConfig(d);a.groupRoot=a.groupRoot||l;a.parent=l;c[g]=a;if(d.columns){k.fullDetailCols(f,a,a.columns,e+1)}else{f.push(a)}if(e>1){a.isSub=true}}if(e>1){c[0].isFirst=true;c[b-1].isLast=true}if(e==1){h=0;for(g=0;g<b;g++){a=c[g];if(a.columns){a.groupIndex=h++}else{h=0}}}}return f.length},onInit:function(){var f=this,e=0,d,g=f.store,a,b;if(f.isInit){return}f.isInit=true;f.checkedRecords=[];f.checkedRowEls=[];if(f.cellDbclick){f._cellDbclick(f.cellDbclick);delete f.cellDbclick}f.cellDbclick=f._cellDbclick;delete f._cellDbclick;if(Mini2.isString(g)){g=Mini2.data.StoreManager.lookup(g);f.bindStore(g)}f.srcColumns=Mini2.clone(f.columns);delete f.m_Cols;f.m_Cols=b=[];f.fullDetailCols(b,null,f.columns);for(d=0;d<b.length;d++){a=b[d];a.index=d}f.cellTpl=f.StrJoin(f.cellTpl);if(f.rowsChecked){var c=f.rowsChecked;f.bind("rowsChecked",c);delete f.rowsChecked}},getColumnNameForMiType:function(b){var a="Mini2.ui.grid.column.";switch(b){case"booleancolumn":case"boolcolumn":a+="Boolean";break;case"checkcolumn":a+="CheckColumn";break;case"rownumberer":a+="RowNumberer";break;case"rowcheckcolumn":a+="RowCheckColumn";break;case"numbercolumn":a+="Number";break;case"datecolumn":a+="Date";break;case"actioncolumn":a+="Action";break;case"propertycolumn":a+="PropertyColumn";break;case"treecolumn":a+="TreeColumn";break;case"template":a+="Template";break;case"textareacolumn":a+="TextArea";break;case"morefilecolumn":a+="MoreFileColumn";break;case"timecolumn":a+="Time";break;case"passwordcolumn":a+="Password";break;default:a+="Colunm";break}return a},getColumnForConfig:function(b){var f=this,j=Mini2.SystemInfo.table,g,a,e=f.m_Cols,c,d;Mini2.applyIf(b,{miType:"col",width:120,headerAlign:j.headerAlign});b.width=b.width*j.headerWidthRaed;g=b.miType=b.miType.toLowerCase();d=f.getColumnNameForMiType(g);a=Mini2.create(d,b);switch(g){case"rowcheckcolumn":f.rowCheckColumn=a;break}a.grid=f;a.store=f.getStore();c=a.editor;if(c){c.isInit=false}if(c.store){var h,i;h=Mini2.clone(a.editor.store);i=Mini2.create("Mini2.data.Store",{storeId:"MiniStore_"+Mini2.newId(),idField:"value",fields:["value","text"],data:h});a.displayStore=i;c.store=i}if(!a.renderer){}return a},setReadOnly:function(b){var a=this;a.readOnly=b;return a},clearColumnEditor:function(a){var c=this,b=a.editor;if(b){if(b.remove){b.remove();delete a.editor}}},clearColumnAll:function(){var g=this,a,b=g.m_Cols,f=b.length,e,c=g.delayData,d=g.headerContainer;c.i=Number.MAX_VALUE;g.setFocusRegion();g.itemRemoteAll();g.m_LastEditor=null;for(e=0;e<f;e++){a=b[e];g.clearColumnEditor(a)}d.clear();return g},addColumn:function(e){var k=this,j,c,a,f=k.delayData,h=k.headerContainer,b,d;delete k.m_Cols;k.m_Cols=d=[];k.srcColumns=Mini2.clone(e);k.columns=e;k.fullDetailCols(d,null,k.columns);for(j=0;j<d.length;j++){b=d[j];b.index=j}h.add(e);$(k.m_ColGroups).remove();a=k.createColGroup();k.m_ColGroups=$(a);k.tbodyEl.before(k.m_ColGroups);k.setHeight(k.height);f.i=0;k.loopLoadItem();if(k.summaryVisible){k.summary.columns=d;try{k.summary.reset()}catch(g){console.error("重置合计 html 错误",g)}}return k},getJsonForRecord:function(d){var b=this,a;var c={action:"none",id:d.getId(),clientId:d.muid,index:0,values:{}};if(d.dirty){c.action="modified"}c.values=Mini2.clone(d.data);return c},onCommand:function(a,b,d){var c=this,f,e;if("full"==c.jsonMode){f=c.getJsonForRecord(d)}else{f={action:"none",id:d.getId(),clientId:d.muid,index:0,values:{}}}e=Mini2.Json.toJson(f);var h="record-"+Mini2.Guid.newGuid();var g={};g[h]=e;widget1.subMethod("form:first",{subName:c.id,subMethod:"PreCommand",actionPs:{cmdName:a,cmdParam:b,record:"ref "+h},data:g})},getCheckeds:function(c){var f=this,b=f.rowCheckColumn,h=[];if(!b){return h}var i,g,a,d,e,j=$(f.tbodyEl).children();$(j).each(function(){i=$(this);g=i.data("record");a=i.children("td:eq("+b.index+")");d=a.find("img:first");e=$(d).hasClass("mi-grid-checkcolumn-checked");if(e){if(c){var k={};$(c).each(function(){k[this]=g.get(this)});h.push(k)}else{h.push(Mini2.clone(g.data))}}});return h},getCheckRecords:function(f){var g=this,c=g.rowCheckColumn,b={records:[]};if(!c){return b}f=f||g.jsonMode;var i,h,a,d,e,j=$(g.tbodyEl).children();$(j).each(function(){i=$(this);h=i.data("record");a=i.children("td:eq("+c.index+")");d=a.find("img:first");e=$(d).hasClass("mi-grid-checkcolumn-checked");if(e){var k={action:"none",id:h.getId(),clientId:h.muid,index:i.index()};if(h.dirty){k.action="modified"}if(!k.id){k.action="added";k.values=Mini2.clone(h.data)}else{if("full"==f){k.values=Mini2.clone(h.data)}}b.records.push(k)}});return b},getJson:function(c){var d=this,b,a;a=d.getCheckRecords(c);b=Mini2.Json.toJson(a);return b}},function(){var b=this,a=Mini2.SystemInfo.table,c=arguments[0];Mini2.apply(this,{columnLines:a.columnLines,focusBorders:a.focusBorders});Mini2.apply(this,c)});
Mini2.define("Mini2.ui.panel.AbstractDataView",{log:Mini2.Logger,extend:"Mini2.ui.Component",renderTo:Mini2.getBody(),getStore:function(){var a=this,b;if(!a.store){b=Mini2.create("Mini2.data.Store",{storeId:"MiniStore_"+Mini2.newId(),model:"Mini2.data.FreeModel",data:a.data});a.bindStore(b)}return a.store},bindStore:function(b){var a=this;a.store=b;$(b).muBind("update",a,a.store_update).muBind("add",a,a.store_add).muBind("datachanged",a,a.store_dataChanged).muBind("refresh",a,a.store_refresh).muBind("load",a,a.store_load).muBind("bulkremove",a,a.store_bulkRemove).muBind("invalid",a,a.store_invalid).muBind("clear",a,a.store_clear).muBind("currentchanged",a,a.store_currentChanged).muBind("beginloaded",a,a.store_beginloaded).muBind("endloaded",a,a.store_endloaded);a.resetEmptyMsg()},getItemBoxForRecord:function(f,b){var d=this,a=[],c=d.itemlistEl,h,e=("first"===b),g,i=c.children(".mi-dataview-item");$(i).each(function(){g=this;h=$(g).data("record");if(h===f){a.push(g);if(e){return false}}});return a},store_invalid:function(a,c,b){console.debug("store_invalid")},firstStoreCurrentChanged:true,store_currentChanged:function(a,b,e){var d=a.data,c;if(!e){if(!d.readonly){d.setFocusItem(null)}return}c=d.getItemBoxForRecord(e);if(d.firstStoreCurrentChanged&&"none"!=d.checkedMode&&c.length){d.firstStoreCurrentChanged=false;d.itemSelect(c[0])}if(!d.readonly){d.setFocusItem(c)}},store_clear:function(a){var b=a.data;b.firstStoreCurrentChanged=true;b.itemRemoteAll();b.resetEmptyMsg()},store_bulkRemove:function(d,a,f,g){console.debug("store_bulkRemove");var h=d.data,c=h.boxTarget,b=Mini2.Array,e,i,j,k=c.children(".mi-dataview-item");$(k).each(function(){j=this;i=$(j).data("record");e=b.contains(a,i);if(e){$(j).remove()}});h.resetItmesIndex();h.resetEmptyMsg()},store_update:function(b,j,i,g){var f=b.data;if("EDIT"==i){var c=g;var e=c.length;var h;var a=f.getItemBoxForRecord(j,"first");a=$(a);var d=f.getBindItems(a);$(d).each(function(){var k=this;if(Mini2.Array.contains(c,k.dataField,true)){var l=j.get(k.dataField);k.setDirty(false);if(k.oldValue!=l){k.oldValue=k.getValue();k.setValue(l)}}})}},store_refresh:function(a,b){console.debug("store_refresh")},delayData:{},loopLoadItem:function(){var d=this,b,e,c=20,f,a=d.delayData;if(a.i>=a.len){return}b=a.i;if(b<c){e=a.len;if(e>c){e=c}for(b=0;b<e;b++){a.i++;f=a.items.get(b);d.itemInsert(b,f)}}else{a.i++;f=a.items.get(b);d.itemInsert(b,f)}setTimeout(function(){d.loopLoadItem()},1)},store_load:function(a,h){var d=a.data,h=this,b,e,f=h.data,c;if(h.isIncr){var g=h.curLoadData;d.itemInsert(b,g)}else{d.itemRemoteAll();c=f.length;d.delayData={i:0,len:c,items:f};d.loopLoadItem()}d.resetEmptyMsg()},__lastTimeStamp:null,store_dataChanged:function(a,b){var c=a.data,d=this;if(c.__lastTimeStamp===a.timeStamp){return}c.__lastTimeStamp=a.timeStamp;console.debug("发生变哈流....");c.resetEmptyMsg()},store_add:function(a,c,e){var d=a.data,b;console.debug("添加记录.....",e[b]);for(b=0;b<e.length;b++){d.itemInsert(c+b,e[b])}d.resetEmptyMsg()},store_beginloaded:function(a,b){var c=a.data;c.isLoading=true},store_endloaded:function(a,b){var c=a.data;c.isLoading=false;console.debug(" $(itemlistEl).length = ",$(c.itemlistEl).children().length);c.resetEmptyMsg()}});
Mini2.define("Mini2.ui.panel.DataView",{extend:"Mini2.ui.panel.AbstractDataView",baseCls:"mi-dataview",readonly:false,itemlistEl:null,emptyEl:null,laoderBtnEl:null,laoderEl:null,visible:true,engineName:"j",dock:"top",userCls:null,region:"north",selectCls:"mi-dataview-item-selected",focusCls:"mi-dataview-item-focused",itemDefaultCls:"mi-dataview-item-default",itemNotBorderCls:"mi-dataview-item-notborder",itemBorderHide:false,jsonMode:"simple",newItemIndex:0,renderTpl:['<div role="Panel" class="mi-dataview " style="">','<div class="mi-box-inner " role="presentation" style="">','<div class="mi-box-target" style="width: 100%;padding-right: 0px; position:static; ">','<div class="mi-dataview-itemlist" style="; width:100%; position:static;display: inline-block;" >',"</div>",'<div class="mi-dataview-empty" >',"没有相关记录!","</div>",'<div class="mi-box-loader" style="width:100%;height:100px;padding:6px;text-align: center; position:static;">','<a class="mi-btn mi-btn-loaders" style="width:90%;display:none;">加载更多...</a>',"</div>","</div>","</div>","</div>"],padding:{left:0,top:0,right:0,bottom:0},ui:"default",itemBoxTpl:['<div role="dataview-item" class="mi-dataview-item " style=" "></div>'],scope:null,scroll:"auto",visible:true,isInit:false,store:false,checkedMode:"multi",itemTemplate:false,editItemTemplate:false,pager:{},pagerVisible:true,hidePagerRowCountSelect:false,summaryVisible:false,selectedItems:null,focusItem:null,onInit:function(){var b=this,c=b.store,a=Mini2.isFunction;if(a(b.itemAdded)){b.bind("itemAdded",b.itemAdded)}if(a(b.itemRender)){b.bind("itemRender",b.itemRender)}if(a(b.itemRendering)){b.bind("itemRendering",b.itemRendering)}if(a(b.itemRendered)){b.bind("itemRendered",b.itemRendered)}if(a(b.itemRenderScript)){b.bind("itemRenderScript",b.itemRenderScript)}},isVisible:function(){return this.visible},getWidth:function(){return this.el.outerWidth()},getHeight:function(){return this.el.outerHeight()},getSize:function(){var a=this;return{width:a.getWidth(),height:a.getHeight()}},setLeft:function(c){var b=this,a=b.el;a.css("left",c);return b},getLeft:function(){var b=this,a=b.el;return a.css("left")},getTop:function(){var b=this,a=b.el;return a.css("top")},setTop:function(c){var b=this,a=b.el;a.css("top",c);return b},setHeight:function(b){var a=this;a.setSize(undefined,b);return a},setWidth:function(b){var a=this;a.setSize(b);return a},setSize:function(n,i,f){var k=this,j=k.log,g=k.el,l=k.minHeight,c=k.boxInner,d=k.boxTarget,m=k.padding,a=0;if(l&&i&&i<l){i=l}k.targetWidth=n||k.width;k.targetHeight=i||k.height;k.width=k.targetWidth||k.width;k.height=k.targetHeight||k.height;if(g){if(k.autoSize){}else{var e=k.width-(m.right+m.left);var b=k.height-(m.bottom+m.top)-k.getPagetHeight();g.css({width:k.width,height:k.height});c.css({width:"100%",height:b});d.css({width:e,height:b})}}k.resize();return k},resize:function(){},dymResult:null,targetEl_scroll:function(e){var d=this,c=d.laoderBtnEl,b=d.itemlistEl;var g=$(e).scrollTop();var f=$(e).height();var a=$(b).outerHeight();console.debug("tarTop=%d, tarHeight=%d, itemlistBoxHeight=%d ",g,f,a);if(f+g>a){if(d.store.isLastPage()){}else{if(!c.is(":visible")){c.show();setTimeout(function(){d.loadNextData()},500)}}}},isLoading:false,loadNextData:function(){var b=this,a=b.laoderBtnEl;a.hide();if(!b.dymResult){b.dymResult={}}var c=b.dymResult;b.store.nextPage(c)},scrollTime:null,baseRender:function(){var p=this,o=p.log,k,q=p.padding,d,e,r=p.width,l=p.height;p.el=k=Mini2.$join(p.renderTpl);p.boxInner=d=k.cFirst(".mi-box-inner");p.boxTarget=e=d.cFirst(".mi-box-target");p.itemlistEl=e.children(".mi-dataview-itemlist");p.emptyEl=e.children(".mi-dataview-empty");p.laoderEl=e.children(".mi-box-loader");p.laoderBtnEl=p.laoderEl.children(".mi-btn-loaders");if("none"==p.scroll){p.laoderEl.hide()}else{p.laoderBtnEl.on("click",function(){p.loadNextData()});$(e).scroll(function(h){var i=p.scrollTime;if(i){i.resetStart()}else{p.scrollTime=Mini2.setTimer(function(){p.log.debug("DataView isLoading = ",p.isLoading);if(p.isLoading){Mini2.EventManager.stopEvent(h);return false}p.targetEl_scroll(e)},[100,1])}})}p.render_Summary();p.render_Pager();k.mouseup(function(){Mini2.ui.FocusMgr.setControl(p)});if(p.itemBorderHide){e.addClass(p.itemNotBorderCls)}if(p.visible==false){k.hide();delete p.visible}if(p.onResize){p.resize(p.onResize)}k.data("me",p);k.addCls(p.baseCls,"mi-box-layout-ct");if(p.ui){k.addCls(p.baseCls+"-"+p.ui)}if("default"!=p.dock){if("none"!=p.dock){k.addCls("mi-docked","mi-docked-"+p.dock,p.baseCls+"-docked",p.baseCls+"-docked-"+p.dock);if(p.ui){k.addCls(p.baseCls+"-"+p.ui+"-docked-"+p.dock)}}}if(p.fixed){k.addClass("mi-fixed-layer");k.css("z-index",1009)}switch(p.scroll){case"none":e.css({overflow:"hide"});break;case"vertical":e.css({"overflow-x":"hidden","overflow-y":"auto"});break;case"horizontal":e.css({"overflow-x":"auto","overflow-y":"hidden"});break;default:e.css({overflow:"auto"});break}var a=["left","top","right","bottom","width","height","position"];var j={};for(var m=0;m<a.length;m++){var b=a[m];if(p[b]){j[b]=p[b]}}for(var m in q){var b="padding-"+m;j[b]=q[m]}if(p.maxWidth){k.css({"max-width":p.maxWidth});e.css({"max-width":p.maxWidth})}if(p.minWidth){k.css({"min-width":p.minWidth});e.css({"min-width":p.minWidth})}if(p.maxHeight){k.css({"max-height":p.maxHeight});e.css({"max-height":p.maxHeight})}if(p.minHeight){k.css({"max-height":p.minHeight});e.css({"max-height":p.minHeight})}if(p.margin){k.css({margin:p.margin})}if(p.marginLeft){k.css({"margin-left":p.marginLeft})}if(p.marginRight){k.css({"margin-right":p.marginRight})}if(p.marginTop){k.css({"margin-top":p.marginTop})}if(p.marginBottom){k.css({"margin-bottom":p.marginBottom})}k.css(j);if(p.right){}if(p.autoSize){e.css({position:"static",height:"auto"})}else{var f=p.width-(q.right+q.left);var c=p.height-(q.bottom+q.top)-p.getPagetHeight();k.css({width:p.width,height:p.height});d.css({width:"100%",height:c});e.css({width:f,height:c})}if(p.userCls){k.addClass(p.userCls)}if(p.contentEl){var g=$(p.contentEl);var n=g.children();g.after(k);e.append(n);k.attr("id",g.attr("id"));g.remove()}else{if(p.applyTo){$(p.applyTo).replaceWith(k)}else{if(p.renderTo){$(p.renderTo).append(k)}}}},render_Pager:function(){var b=this,a,c=b.pager,d=!!b.pagerVisible;if((c&&c.visible==false)||b.pagerVisible==false){return}console.debug("table.hidePagerRowCountSelect = ",b.hidePagerRowCountSelect);b.pagerVisible=d;a=Mini2.apply(b.pager,{renderTo:b.el,store:b.getStore(),visible:d,hideRowCountSelect:b.hidePagerRowCountSelect||false,click:b.pager_click});c=Mini2.create("Mini2.ui.Pagination",a);c.render();b.pager=c},pager_click:function(b,c){var a=this;c.loadPage(b)},render_Summary:function(){var a=this,b;if(a.summaryVisible){}},getSummaryHeight:function(){var a=this,b=a.summary;if(b&&b.muid){return b.height}return 0},getPagetHeight:function(){var a=this,b=a.pager;if(!a.pagerVisible){return 0}if(b&&b.muid){return Mini2.SystemInfo.pagination.height||24}return 0},renderItemInner:function(c,a){var d=this,f,e;e=d.renderer_j;try{f=e.call(d,c,a)}catch(b){console.error("输出错误 ",b);return""}return f},renderItemList:function(){var b=this,a,d=b.getStore(),c;if(d){c=d.data;if(!c){return}b.itemRemoteAll();a=c.length;b.delayData={i:0,len:a,items:c};b.loopLoadItem()}else{c=b.data;b.itemInsert(0,c)}},itemSelect_single:function(b,a){var d=this,e=d.selectCls,c=$(b);$(d.selectedItems).removeClass(e);if(a){$(b).toggleClass(e,true);if(Mini2.isArray(b)){d.selectedItems=b}else{d.selectedItems=[b]}}else{d.selectedItems=[]}},itemSelect_multi:function(b,a){var d=this,c=$(b);if(a){Mini2.Array.include(d.selectedItems,b)}else{Mini2.Array.remove(d.selectedItems,b)}},setFocusItem:function(b){var h=this,g,a=false,c=h.focusCls,e,d=h.focusItem,f=$(b);g=h.focusItem;e=f.hasClass(c);if(d&&b!==d){$(d).removeClass(c)}h.focusItem=b;f.addClass(c);h.trigger("itemFocused",{old:g,item:b})},itemSelect:function(c){var f=this,e=$(c),a=false,g=f.selectCls,d=f.focusCls,b=f.checkedMode;a=e.hasClass(g);a=!a;$(e).toggleClass(g,a);console.debug("itemSelect = ",e);console.debug("checkedMode = ",b);if("single"==b){f.itemSelect_single(c,a)}else{if("multi"==b){f.itemSelect_multi(c,a)}}},renderer_j:function(a,d){var c=this,b=c.jTemplate;if(!b){b=c.jTemplate=$.createTemplate(c.itemTemplate)}if("free"==d.fieldModeId){d=d.raw}return b.get(d,{index:a,})},itemRemoteAll:function(){var b=this,a=b.itemlistEl,c=$(a).children(".mi-dataview-item");$(c).remove();b.selectedItems=[];b.focusItem=null},resetItmesIndex:function(){},renderItemBox:function(c,d){var b=this,a=$(b.itemBoxTpl);a.attr("data-muid",c);a.css({width:b.itemWidth,height:b.itemHeight});a.data("record",d);a.addClass(b.itemDefaultCls);if(b.itemCls){a.addClass(b.itemCls)}return a},rendererHref_art:function(b,d){var c=this,e,a=b.data("artTemplate");if(!a){a=template.compile(b.attr("href"));b.data("artTemplate",a)}e=a({T:d});return e},item_command:function(k,a){var h=this,g=$(k),i,b,c;i=a.data("record");b=g.attr("command");if(!Mini2.isBlank(b)){c=g.attr("commandParam");h.onCommand(b,c,i)}else{var l=g.attr("target");var f=g.attr("href");var j=this.rendererHref_art;try{f=j.call(this,g,i)}catch(d){console.error("地址模板解析处理失败,",g);return}l=l.toLowerCase();if(Mini2.isBlank(l)){window.location.href=f}else{if("ecview"==l){EcView.show(f,g.attr("targetText"));return false}else{if("dialog"==l){var e=Mini2.createTop("widget.window",{url:f,text:g.attr("targetText"),width:400,height:300,mode:true,state:"max"});e.show();return false}else{console.debug("未知标识",l)}}}}},resetEmptyMsg:function(){var b=this,c=b.store,a=b.emptyEl;if(c.data.length){a.hide()}else{a.show()}},itemInsert:function(f,d,l){var j=this,h=j.itemlistEl,e,k,g,c,m,n,b,o=[],p;if(l){l.rowEls=o}p=$(h).children();c=p.length;if(f>c){f=c}if(Mini2.isArray(d)){n=d}else{n=[d]}if(0===n.length){return}for(e=0;e<n.length;e++){m=n[e];k=Mini2.newId();g=j.renderItemInner(e,m);var a=j.renderItemBox(k,m);a.append(g);o.push(a);b=a.find("*[command],a[target]");if(b.length){b.muBind("click",function(){return j.item_command(this,a)})}}h.append(o);$(o).each(function(){var q=this,i,r=$(q).data("record");i=j.trigger("itemRendering",{cancel:false,itemEl:this,record:r});if(true===i){return}i=j.trigger("itemRender",{itemEl:q,record:r});if(true===i){return}i=j.trigger("itemRenderScript",{itemEl:q,record:r});i=j.trigger("itemRendered",{itemEl:q,record:r});i=j.trigger("itemAdded",{itemEl:q,record:r});j.itemAfterRender(q,r)});j.resetItmesIndex();if(!j.readonly){$(o).each(function(){$(this).muBind("click",function(){var i=this,r=j.store;if("none"!=j.checkedMode){j.itemSelect(i)}if(r){var q=$(i).data("record");if(q){r.setCurrent(q)}}else{j.setFocusItem(i)}})})}return j},getJsonForRecord:function(d){var b=this,a;var c={action:"none",id:d.getId(),clientId:d.muid,index:0,values:{}};if(d.dirty){c.action="modified"}c.values=Mini2.clone(d.data);return c},onCommand:function(b,c,g){var f=this,i,h;if("full"==f.jsonMode){i=f.getJsonForRecord(g)}else{i={action:"none",id:g.getId(),clientId:g.muid,index:0,values:{}}}h=Mini2.Json.toJson(i);var e=this.id+"-"+Mini2.Guid.newGuid("N");var a={cmdName:b,cmdParam:c,record:"ref "+e};var d={};d[e]=h;widget1.subMethod("form:first",{subName:f.id,subMethod:"PreCommand",actionPs:a,data:d})},getJson:function(g){var h=this,e=h.itemlistEl,f,b={records:[]};g=g||h.jsonMode;var j,i,a,c,d,k=$(e).children("."+h.selectCls);$(k).each(function(){j=$(this);i=j.data("record");var l={action:"none",id:i.getId(),clientId:i.muid,index:j.index()};if(i.dirty){l.action="modified"}if(!l.id){l.action="added";l.values=Mini2.clone(i.data)}else{if("full"==g){l.values=Mini2.clone(i.data)}}b.records.push(l)});f=JSON.stringify(b);return f},render:function(){var b=this,c=b.store;if(Mini2.isArray(b.itemTemplate)){b.itemTemplate=Mini2.join(b.itemTemplate)}b.onInit();b.selectedItems=[];b.baseRender();b.itemBoxTpl=Mini2.join(b.itemBoxTpl);if(Mini2.isString(c)){c=Mini2.data.StoreManager.lookup(c);b.store=c}if(c&&c.isStore){b.bindStore(c)}else{c=b.getStore()}b.renderItemList();$(b.el).data("me",b);try{Mini2.ui.SecManager.reg(b.secFunCode,b)}catch(a){console.error("注册权限错误",a)}return b},itemAfterRender:function(f,g){var e=this,b,c,d,a;c=e.getBindItems(f);d=c.length;for(a=0;a<d;a++){b=c[a];if(b.setRecord){b.setRecord(g)}else{b.record=g}$(b).muBind("focusout",function(){e.itemWidget_focusout.call(e,this)});if(b.isCheckbox||b.isCheckGroup){$(b).muBind("changed",function(){e.itemWidget_changed.call(e,this)})}if(b.getReadOnly()){b.allowChangeReadonly=false}}},itemWidget_focusout:function(e){var c=this,b=e,f,a=b.dataField,d=b.record;if(b.readOnly||!b.isValueChanged()){return c}if(b.isRangeControl){if(b.startDataField&&b.isValueChanged("start")){var f=b.getStartValue();b.setDirty(true);d.set(b.startDataField,f)}if(b.endDataField&&b.isValueChanged("end")){var f=b.getEndValue();b.setDirty(true);d.set(b.endDataField,f)}}else{if(b.isValueChanged()){var f=b.getValue();b.setDirty(true);d.set(a,f)}}},itemWidget_changed:function(e){var c=this,b=e,f,a=b.dataField,d=b.record;f=b.getValue();b.setDirty(true);d.set(a,f)},findItems:function(d,b){var c=this;if(!b){b=[]}var a=$(d).children();$(a).each(function(){var e=this;var f=$(e).data("me");if(f){b.push(e)}else{c.findItems(e,b)}});return b},getBindItems:function(g){var f=this,h=f.store,d,e,b=0,a=[];d=f.findItems(g);e=d.length;for(b=0;b<e;b++){var c=d[b];c=f.getItemObj(c);if(!c){continue}if(c.isRangeControl){if(c.startDataField||c.endDataField){a.push(c)}}else{if(c.dataField){a.push(c)}}}return a},prepareItems_ForFlow:function(a){var b=this,c=[];return a},prepareItems_ForTable:function(a){var b=this,c=[];return a},getItemObj:function(b){var a;if(b.muid){a=b}else{a=$(b).data("me")}return a},prepareItems:function(f){var h=this,b,c,e,d,a=h.flowDirection,g=h.layout,j=[];$(f).each(function(){c=this;e=h.getItemObj(c);if(e){e.ownerParent=h;i=e.el;if(e.isVisible&&!e.isVisible()){return}j.push(e);if("lefttoright"==a){i.addClass("mi-form-item-float-left")}i.addClass("mi-anchor-form-item");if(g&&g.itemCls){i.addClass(g.itemCls)}if(h.itemWidth&&e.setWidth){if(e.width=="100%"){if(e.colspan){e.setWidth(h.itemWidth*e.colspan)}else{e.setWidth(h.itemWidth)}}}if(e.labelable){if(h.itemLabelWidth){e.labelable.setWidth(h.itemLabelWidth)}if(h.itemLabelAlign){e.labelable.setLabelAlign(h.itemLabelAlign)}}}else{if(Mini2.isDom(c)&&$(c).is(":visible")){j.push(c);var i=$(c);if(i.hasClass("mi-newline")){}else{if("lefttoright"==a){i.addClass("mi-form-item-float-left")}if(g&&g.itemCls){i.addClass(g.itemCls)}if(h.itemWidth){i.css("width",h.itemWidth)}}}}});return j}});
Mini2.define("Mini2.ui.panel.TreeTable",{extend:"Mini2.ui.panel.Table",rootId:"0",valueField:"ID",textField:"TEXT",parField:"P_ID",pagerVisible:false,store_refresh:function(a,f){var c=a.data,b,d,e;c.itemRemoteAll();e=c.store.data;for(b=0;b<e.length;b++){d=e.get(b);c.itemAdd(d)}c.itemsReset();if(c.rowCheckColumn){c.rowCheckColumn.updateHeaderState()}},rootNode:{childs:[]},store_load:function(a,k){var d=a.data,b,g,h=d.rootId,f=d.parField,m=k.getByGroup(h),l,c,j=d.rowCheckColumn;d.itemRemoteAll();c=m.length;var e={};for(var b=0;b<c;b++){l=m[b];g=l.data;d.itemInsert(b,g,e);d.proRowEls(null,e.rowEls,d.rootNode,0,k,l)}if(j){j.updateHeaderState()}},proRowEls:function(e,h,d,a,i,f){var b=this,g=d,c=a*24;if(!g.childs){g.childs=[]}$(h).each(function(){var m=$(this);g.childs.push(m);var j=b.findCellInnerEl(m);j.css("padding-left",c+"px");var l=m.data("record");var k=l.getId();if(!i.hasChilds(k)){j.addClass("tree-leaf")}m.attr("tree-dept",a).attr("tree-node-id",k).data("tree-node",{parentRowEl:e});b.displayRowsBuffer[k]=m})},displayRowsBuffer:{},findCellInnerEl:function(d){var c=this,a=d.children(".mi-grid-cell-treecolumn:first"),b=a.children(".mi-grid-cell-inner:first");return b},store_bulkRemove:function(b,a,d,e){var f=b.data,c,h,i,g,k,j=f.tbodyEl.children("tr");$(j).each(function(){i=$(this);h=i.data("record");c=Mini2.Array.contains(a,h);if(c){g=h.getId();k=h._ownerTreeNode;var l=i.data("tree-node");i.remove();Mini2.Array.remove(f.checkedRecords,h);delete f.displayRowsBuffer[g];f._deleteTreeNode(l.parentRowEl,h);return false}});f.itemsReset()},_deleteTreeNode:function(e,h){var c=this,g,a,b,f,d;if(e){f=h.getId();g=$(e).data("tree-node");for(b=0;b<g.childs.length;b++){a=g.childs[b];d=$(a).attr("tree-node-id");if(d==f){g.childs.splice(b,1);break}}}},store_add:function(b,d,g){var e=b.data,q=this,c,o,r,j=e.parField,m,p=e.rowCheckColumn;for(c=0;c<g.length;c++){o=g[c];r=o._ownerTreeNode;m=o.get(j);var l=e.displayRowsBuffer[m];if(l){var k=$(l).data("tree-node");var f=$(l).index()+1;if(k.childs){f+=k.childs.length}var a=$(l).attr("tree-dept");a=parseInt(a)+1;var h={};e.itemInsert(f,o,h);e.proRowEls(l,h.rowEls,k,a,q,r)}}if(p){p.updateHeaderState()}},deleteRows:function(b){var a=this;$(b).each(function(){var c=$(this).data("tree-node");a.deleteRows(c.childs);$(this).remove()})},expandNode:function(q,l,a){var g=this,n=g.store,c=$(l).attr("tree-dept"),b=$(a).children(".mi-grid-cell-inner");c=parseInt(c);var j=$(l).data("record");var e=j.getId();var k=n.rootId;var p=n.getByGroup(e);if(p){b.addClass("tree-open");q.expanded=true;var m=$(l).index()+1;var f=p.length;var h={};c+=1;for(var d=0;d<f;d++){var o=p[d];var j=o.data;g.itemInsert(m+d,j,h);g.proRowEls(l,h.rowEls,q,c,n)}}},collapseNode:function(e,d,a){var c=this,b=$(a).children(".mi-grid-cell-inner");b.removeClass("tree-open");if(e){e.expanded=false;c.deleteRows(e.childs);delete e.childs}},toggleNode:function(d,c,a){var b=this;if(d.expanded){b.collapseNode(d,c,a)}else{b.expandNode(d,c,a)}}});
Mini2.define("Mini2.ui.grid.property.Grid",{extend:"Mini2.ui.panel.Table",checkedMode:"SINGLE",onInit:function(){var b=this;if(b.isInit){return}b.isInit=true;b.pager={visible:false};b.columns=[{miType:"col",dataIndex:"Display",headerText:"名称",width:115},{miType:"propertyColumn",dataIndex:"Value",headerText:"值",editor:{xtype:"property"},width:120}];var c=Mini2.create("Mini2.data.Store",{storeId:"MiniStore_"+Mini2.getIdentity(),idField:"Name",fields:["Name","Value","Display","Type","Extend"]});b.bindStore(c);delete b.m_Cols;b.m_Cols=[];var a=0;$(b.columns).each(function(){b.getColumnForConfig(a,this);a++});b.cellTpl=b.StrJoin(b.cellTpl)}},function(){var a=this;Mini2.apply(this,arguments[0]);a.onInit(arguments[0]);a.muid=Mini2.getIdentity()});
Mini2.define("Mini2.ui.toolbar.Button",{extend:"Mini2.ui.Component",btnInner:undefined,baseCls:Mini2.baseCSSPrefix+"btn",iconCls:null,scale:"small",allowedScales:["small","medium","large"],renderTpl:['<a class="mi-btn ',"mi-unselectable ","mi-btn-toolbar ","mi-box-item ","mi-toolbar-item ","mi-btn-default-toolbar-small ",'" ','role="button" hidefocus="on" unselectable="on" tabindex="0" ','style="right: auto; left: 229px; top: 0px; margin: 0px;">','<span class="mi-btn-wrap" unselectable="on">','<span class="mi-btn-button">','<span class="mi-btn-inner mi-btn-inner-center" unselectable="on">',"</span>","</span>","</span>","</a>"],setText:function(c){var b=this,a=b.btnInner;b.text=c;if(a){a.html(c)}return b},getText:function(){var b=this,a=b.btnInner;return a.html()},isMouseEnter:false,tooltipEl:null,preMouseEnter:function(){var c=this,a=c.el,f=c.tooltipContentEl,e=c.tooltipEl;if(f){if(!e){c.tooltipEl=e=Mini2.create("Mini2.ui.menu.MenuPanel",{contentEl:f});e.render();e.bind("showing",function(){c.trigger("tooltipShowing")})}var d=a.offset();var b=a.height();e.setLocal(d.left,d.top+b+10);e.show()}},preMouseLeave:function(){var b=this,a=b.el},getInputEl:function(){var d=this,a=d.command,b,c,e=["mi-over","mi-btn-over","mi-btn-default-toolbar-small-over"],f=["mi-pressed","mi-btn-pressed","mi-btn-default-toolbar-small-pressed"];c=Mini2.$joinStr(d.renderTpl);c.css({width:d.width,height:d.height,left:d.left});if(d.id){c.attr("id",d.id)}if(!d.visible){c.css("display","none")}if(d.href){c.attr("href",d.href)}if(a&&a!=""){c.attr("command",a)}if(Mini2.isBlank(d.text)&&(d.icon||d.iconCls)){c.addCls("mi-btn-default-toolbar-small-icon")}else{if(d.text!=""&&(d.icon||d.iconCls)){c.addCls("mi-icon-text-left","mi-btn-icon-text-left","mi-btn-default-toolbar-small-icon-text-left")}}if(d.icon){d.imgEl=b=$('<img src="" class="mi-btn-icon-el  mi-btn-glyph"  />');b.attr("src",d.icon);c.find(".mi-btn-button").append(b)}else{if(d.iconCls){d.imgEl=b=Mini2.$join(['<i class="mi-btn-icon-el  mi-btn-glyph fa  ',d.iconCls,'"></i>']);c.find(".mi-btn-button").append(b)}}if(d.tooltip){c.attr("title",d.tooltip);if(c.tooltip){c.tooltip({placement:"auto",delay:300,container:Mini2.getBody()})}}if(d.userCls){c.addClass(d.userCls)}if(d.disabled){c.addCls(["mi-item-disabled","mi-disabled","mi-btn-disabled","mi-btn-default-small-disabled"])}d.btnInner=c.find(".mi-btn-inner:first");d.btnInner.html(d.text);c.on("mouseenter",function(){$(this).addCls(e);d.isMouseEnter=true;d.preMouseEnter()}).on("mouseleave",function(){$(this).removeCls(e);d.isMouseEnter=false;d.preMouseLeave()});c.muBind("mousedown",function(){$(this).addCls(f);Mini2.ui.FocusMgr.setControl(this)}).muBind("mouseup",function(g,i){$(this).removeCls(f);if(0==i.button){if(d.beforeClick){var h=d.beforeClick.call(d,g);if(false===h){return}}else{if(!Mini2.isBlank(d.beforeAskText)){return d.showAskMsg(d)}}d.callback_click.call(d)}});return c},showAskMsg:function(b){var a=b;Mini2.Msg.confirm("询问",a.beforeAskText,function(){a.click()});return false},serverForSubmit:function(){var a=this,b=a.widget||window.widget1;if(b){b.submit(a.el,{command:a.command,commandParam:a.commandParams})}},getWidth:function(){var b=this,a=b.el,c=0;c=$(a).outerWidth();if(c<=4){c=4}return c},render:function(){var e=this,b;var d=Mini2.ui.icon.Manager.getPlugin("btnConfig");var a;if(d){a=d.getItemConfig(e.text);if(a&&Mini2.isBlank(e.icon)&&Mini2.isBlank(e.iconCls)){e.icon=a.icon;e.iconCls=a.iconCls}}e.el=b=e.getInputEl();if(a){b.addClass(a.cls)}if(e.applyTo){$(e.applyTo).replaceWith(b)}else{$(e.renderTo).append(b)}if(e.click){e.userClick=e.click;delete e.click}e.click=e.callback_click;try{Mini2.ui.SecManager.reg(e.secFunCode,e)}catch(c){console.error("注册权限错误",c)}return e},callback_click:function(){var a=this;if(a.userClick){a.userClick.call(a)}else{if(a.command){a.serverForSubmit.call(a)}}}});
Mini2.define("Mini2.ui.toolbar.Hr",{extend:"Mini2.ui.Component",renderTpl:['<div class="mi-toolbar-separator  mi-toolbar-separator-horizontal mi-box-item mi-toolbar-item" ','style="right: auto; top: 5px; margin: 0px;">',"</div>"],getInputEl:function(){var b=this,a;a=Mini2.$joinStr(b.renderTpl);if(!b.visible){a.css("display","none")}return a},getWidth:function(){var b=this,a=b.el;return $(a).outerWidth()},render:function(){var c=this,a;c.el=a=c.getInputEl();if(c.applyTo){$(c.applyTo).replaceWith(a)}else{$(c.renderTo).append(a)}try{Mini2.ui.SecManager.reg(c.secFunCode,c)}catch(b){console.error(b)}}});Mini2.define("Mini2.ui.toolbar.Title",{extend:"Mini2.ui.Component",btnInner:undefined,baseCls:Mini2.baseCSSPrefix+"btn",scale:"small",allowedScales:["small","medium","large"],text:"标题",icon:false,renderTpl:['<div class="',"mi-unselectable ","mi-box-item ","mi-toolbar-item ",'mi-toolbar-title " ','role="button" hidefocus="on" unselectable="on" tabindex="0" ','style="">','<span class="mi-btn-wrap" unselectable="on">','<span class="mi-btn-button">','<span class="mi-btn-inner mi-btn-inner-center" unselectable="on" style="">',"</span>","</span>","</span>","</div>"],getInputEl:function(){var d=this,a=d.command,b,c,e=["mi-over","mi-btn-over","mi-btn-default-toolbar-small-over"],f=["mi-pressed","mi-btn-pressed","mi-btn-default-toolbar-small-pressed"];c=Mini2.$joinStr(d.renderTpl);c.css({width:d.width,height:d.height,left:d.left});if(a&&a!=""){c.attr("command",a)}if(d.icon){c.addCls("mi-icon-text-left","mi-btn-icon-text-left","mi-btn-default-toolbar-small-icon-text-left");d.imgEl=b=$('<img src="" class="mi-btn-icon-el  mi-btn-glyph"  />');b.attr("src",d.icon);c.find(".mi-btn-button").append(b)}d.btnInner=c.find(".mi-btn-inner:first");d.btnInner.html(d.text);c.muBind("mousedown",function(){Mini2.ui.FocusMgr.setControl(this)}).muBind("mouseup",function(){if(d.click){d.click.call(this)}else{if(d.command){d.serverForSubmit()}}});return c},serverForSubmit:function(){var a=this,b=a.widget||window.widget1;if(b){b.submit(a.el,{command:a.command,commandParams:a.commandParams})}},getWidth:function(){var b=this,a=b.el;return $(a).outerWidth()},render:function(){var c=this,a;c.el=a=c.getInputEl();if(c.applyTo){$(c.applyTo).replaceWith(a)}else{$(c.renderTo).append(a)}try{Mini2.ui.SecManager.reg(c.secFunCode,c)}catch(b){console.error(b)}}});
Mini2.define("Mini2.ui.toolbar.Template",{extend:"Mini2.ui.Component",renderTpl:['<div class="mi-box-item mi-toolbar-item mi-toolbar-template" ','style="right: auto; top: 5px; margin: 0px;">',"</div>"],content:null,getInputEl:function(){var b=this,a;a=Mini2.$joinStr(b.renderTpl);a.html(b.content);if(b.id){$(a).attr("id",b.id)}if(!b.visible){a.css("display","none")}return a},getWidth:function(){var b=this,a=b.el;return $(a).outerWidth()},render:function(){var c=this,a;c.el=a=c.getInputEl();if(c.applyTo){$(c.applyTo).replaceWith(a)}else{$(c.renderTo).append(a)}$(a).data("me",c);try{Mini2.ui.SecManager.reg(c.secFunCode,c)}catch(b){console.error("注册权限错误",b)}return c}});
Mini2.define("Mini2.ui.toolbar.Toolbar",{extend:"Mini2.ui.panel.Panel",baseCls:Mini2.baseCSSPrefix+"toolbar",defaultType:"button",items:[],height:24,region:"north",scroll:"none",userCls:null,uiType:"default",item_span:4,padding:{all:"4px"},initComponent:function(){var a=this},remove:function(d){var f=this,e=f.items,b,c,a;if(Mini2.isArray(d)){a=d}else{a=[d]}for(b=0;b<a.length;b++){d=a[b];d.el.remove();c=Mini2.Array.remove(e,d)}return f},createItem:function(a){var e=this,d,b,f="Mini2.ui.toolbar",c;a=Mini2.apply(a,{ownerParent:e,toolbar:e,renderTo:e.boxTarget});b=a.type;if("title"==b){c=f+".Title"}else{if("hr"==b){c=f+".Hr"}else{if("template"==b){c=f+".Template"}else{if("group"==b){c=f+".Group"}else{c=f+".Button"}}}}d=Mini2.create(c,a);d.render();if(d.el&&d.el.width){d.width=d.el.width()+6}else{d.width=d.getWidth()+6}return d},add:function(b){var d=this,c=d.items;if(!b){throw new Error("item 对象不能为 "+b)}if("-"==b){var a=Mini2.create("Mini2.ui.toolbar.Hr",{});b=a}b.toolbar=d,b.renderTo=d.boxTarget;c.push(b);b.render();return b},renderItems:function(){var e=this,a,b,c=e.items,d=c.length,f=[];delete e.items;for(a=0;a<d;a++){b=e.createItem(c[a]);f[a]=b;if(b.id){Mini2.onwerPage.controls[b.id]=b;window[b.id]=b}}e.items=f},getBtnWidth:function(e,a){var d=this,b=a.length,c=d.item_span;while(b--){e+=a[b].getWidth()+c}return e},setItemsLayout:function(g,d){var f=this,a,b,c=f.item_span,e=d.length;for(a=0;a<e;a++){b=d[a];if(b.visible){b.setLeft(g);if(b.updateLayout){b.updateLayout()}g+=b.getWidth()+c}else{}}},updateLayout:function(){var a=this;Mini2.awaitRun(a.muid,50,a,function(){a.baseUpdateLayout()});return a},baseUpdateLayout:function(){var h=this,c,k,b,e,d=h.item_span,f=h.items;if(f){b=f.length;var g=[],j=[],a=[];while(b--){c=f[b];switch(c.dock){case"right":j.push(c);break;case"center":a.push(c);break;default:g.push(c);break}if(c.updateLayout){c.updateLayout()}}g.reverse();h.setItemsLayout(0,g);if(a.length){k=h.getBtnWidth(0,a);e=h.width-k-b*d-20;a.reverse();h.setItemsLayout(k/2,a)}if(j.length){k=h.getBtnWidth(0,j);e=h.width-k-b*d-20;j.reverse();h.setItemsLayout(e,j)}}},delayRender:function(){var b=this,a=$(b.applyTo);Mini2.delayRS=Mini2.delayRS||{};Mini2.delayRS[b.applyTo]=b;b.isDelayRender=true;a.attr("mi-delay-render","true");a.data("me",b)},render:function(){var b=this;b.baseRender();b.renderItems();b.setSize();try{Mini2.ui.SecManager.reg(b.secFunCode,b)}catch(a){console.error(a)}}},function(){var c=this,b=Mini2.SystemInfo.toolbar,a=arguments[0];Mini2.apply(c,{item_span:b.item_span,height:b.height});Mini2.apply(c,a);if("large_flat"==c.uiType){Mini2.apply(c,{item_span:b.uiType_largeFlat.item_span,height:b.uiType_largeFlat.height});if(!c.userCls){c.userCls=""}c.userCls+=" mi-toolbar-largeflat"}else{if("button_group"==c.uiType){Mini2.apply(c,{item_span:b.uiType_buttonGroup.item_span,height:b.uiType_buttonGroup.height});if(!c.userCls){c.userCls=""}c.userCls+=" mi-toolbar-btns"}}});
Mini2.define("Mini2.ui.toolbar.Group",{extend:"Mini2.ui.Component",baseCls:Mini2.baseCSSPrefix+"toolbar-group",renderTpl:['<div class="mi-toolbar-group  mi-box-item" data-x="33">',"</div>"],clear:function(){var d=this,a=d.el,c=d.items,b=a.children();console.debug("清除子项目:",b.length);$(c).each(function(){var e=this;if(e.clear){e.clear()}});d.items=[];b.remove();return d},add:function(a){var d=this,b,c=d.items||[];b=d.createItem(a);if(b.id){Mini2.onwerPage.controls[b.id]=b;window[b.id]=b}c.push(b)},createItem:function(a){var f=this,c=f.el,e,b,g="Mini2.ui.toolbar",d;a=Mini2.apply(a,{ownerParent:f,toolbar:f,renderTo:c});b=a.type;if("title"==b){d=g+".Title"}else{if("hr"==b){d=g+".Hr"}else{if("template"==b){d=g+".Template"}else{if("group"==b){d=g+".Group"}else{d=g+".Button"}}}}e=Mini2.create(d,a);e.render();if(e.getWidth){e.width=e.getWidth()}else{if(e.el&&e.el.width){e.width=$(e.el).outerWidth()}}return e},getInputEl:function(){var b=this,a;a=Mini2.$join(b.renderTpl);if(b.applyTo){$(b.applyTo).replaceWith(a)}else{$(b.renderTo).append(a)}if(b.id){a.attr("id",b.id)}if(!b.visible){a.css("display","none")}if(b.disabled){a.addCls(["mi-item-disabled","mi-disabled","mi-btn-disabled","mi-btn-default-small-disabled"])}return a},getWidth:function(){var e=this,a,b,c=e.items,d=c.length,f=0;for(a=0;a<d;a++){b=c[a];f+=b.getWidth()}f=f-d+1;return f},updateLayout:function(){var b=this,a=b.items;b.setItemsLayout(0,a);return b},setItemsLayout:function(f,c){var e=this,a,b,c=c||e.items,d=c.length;f=f||0;for(a=0;a<d;a++){b=c[a];if(b.visible){b.setLeft(f);if(b.updateLayout){b.updateLayout()}f+=b.getWidth()-1}}return e},renderItems:function(){var e=this,c=e.items,d=c.length,a;for(a=0;a<d;a++){var b=e.createItem(c[a]);if(b.id){Mini2.onwerPage.controls[b.id]=b;window[b.id]=b}e.items[a]=b}},render:function(){var c=this,d,a;c.el=a=c.getInputEl();c.renderItems();c.setItemsLayout(0,c.items);d=c.getWidth();try{Mini2.ui.SecManager.reg(c.secFunCode,c)}catch(b){console.error("注册权限错误",b)}return c}});
Mini2.define("Mini2.ui.menu.Menu",{extend:"Mini2.ui.Component",initComponent:function(){},tpl:['<div class="mi-panel mi-layer mi-panel-default mi-menu mi-border-box" tabindex="-1" style="width: 146px; height: 79px; right: auto; left: 10px; top:0px; z-index: 19001;">','<div class="mi-panel-body mi-menu-body mi-unselectable mi-panel-body-default mi-box-layout-ct mi-panel-body-default mi-noborder-trbl" style="width: 144px; height: 77px; left: 0px; top: 0px;">','<div class="mi-box-inner mi-box-scroller-top">','<div id="menu-1075-before-scroller" class="mi-box-scroller mi-menu-scroll-top" style="display:none"></div>',"</div>",'<div class="mi-box-inner mi-vertical-box-overflow-body" role="presentation" style="height: 77px; width: 144px;">','<div class="mi-box-target" style="width: 144px;">',"</div>","</div>",'<div class="mi-box-inner mi-box-scroller-bottom">','<div id="menu-1075-after-scroller" class="mi-box-scroller mi-menu-scroll-bottom" style="display:none"></div>',"</div>","</div>","</div>"],renderItems:function(a){var f=this,e=f.items,d,b,g=[],c,h=0;for(c=0;c<e.length;c++){b=Mini2.clone(e[c]);if("-"==b.text){d=Mini2.create("Mini2.ui.menu.Separator",{owner:f.owner,renderTo:a,top:h+2});d.render();h+=d.getHeight()}else{b=Mini2.apply(b,{owner:f.owner,renderTo:a,top:h,text:b.text,click:b.click});d=Mini2.create("Mini2.ui.menu.Item",b);d.bind("click",function(){f.item_click.call(f,this)});d.render();h+=d.getHeight()}g.push(d)}delete f.items;f.items=g},item_click:function(b){var a=this;a.hide()},getItemsHeight:function(){var e=this,c=e.items,d=c.length,b,a=0;for(b=0;b<d;b++){a+=c[b].getHeight()}return a},getItemsWidth:function(){var d=this,b=d.items,c=b.length,a,e=0;for(a=0;a<c;a++){if(!b[a].isSeparator){e=Math.max(e,b[a].getWidth())}}return e},setItemsWidth:function(e){var d=this,b=d.items,c=b.length,a;for(a=0;a<c;a++){if(!b[a].isSeparator){b[a].setWidth(e)}}return d},callShow:function(){var b=this,a=b.el;b.trigger("showing");a.show();b.trigger("showed");return b},callHide:function(){var b=this,a=b.el;if(b.visible){a.hide();b.trigger("hidded")}return b},delayShow:function(){var a=this;Mini2.ui.menu.Manager.show(a);return a},show:function(){var a=this;a.callShow();return a},hide:function(){var b=this,a=b.el;if(b.visible){a.hide();b.trigger("hidded")}return b},baseRender:function(){var d=this,a,e=Mini2.SystemInfo.menu;d.el=a=Mini2.$joinStr(d.tpl);$(document.body).append(a);d.panelBodyEl=a.find(".mi-panel-body:first");d.boxInnerEl=d.panelBodyEl.children(".mi-vertical-box-overflow-body");d.boxTargetEl=d.boxInnerEl.children(".mi-box-target");d.renderItems(d.boxTargetEl);var b=d.getItemsHeight()+2;var c=d.getItemsWidth();a.css({top:d.top,left:d.left});var f={width:c,height:b};var g={width:c,height:b+e.paddingTop+e.paddingBottom};d.boxInnerEl.css({top:e.paddingTop});a.css(g);d.panelBodyEl.css(g);d.boxInnerEl.css(f);d.boxTargetEl.css(f);d.setItemsWidth(c);$(a).mousedown(function(h){}).mousemove(function(h){}).mouseup(function(h){Mini2.EventManager.stopEvent(h);Mini2.EventManager.clear(d.scope||d.el)});Mini2.ui.menu.Manager.register(d);return d},render:function(){var a=this;a.baseRender();a.show();return a}});
Mini2.define("Mini2.ui.menu.MenuPanel",{extend:"Mini2.ui.Component",initComponent:function(){},contentEl:null,item_click:function(b){var a=this;a.hide()},callShow:function(){var b=this,a=b.el;b.trigger("showing");a.show();b.trigger("showed");return b},callHide:function(){var b=this,a=b.el;if(b.visible){a.hide();b.trigger("hidded")}return b},delayShow:function(){var a=this;Mini2.ui.menu.Manager.show(a);return a},show:function(){var a=this;a.callShow();return a},hide:function(){var b=this,a=b.el;if(b.visible){a.hide();b.trigger("hidded")}return b},baseRender:function(){var b=this,a;b.el=a=$(b.contentEl);a.css({top:b.top,left:b.left});$(a).mousedown(function(c){}).mousemove(function(c){}).mouseup(function(c){Mini2.EventManager.stopEvent(c);Mini2.EventManager.clear(b.scope||b.el)});Mini2.ui.menu.Manager.register(b);return b},render:function(){var a=this;a.baseRender();a.show();return a}});
Mini2.define("Mini2.ui.menu.Item",{extend:"Mini2.ui.Component",menu:null,initComponent:function(){},isMouseOver:false,iconCls:null,icon:null,text:"菜单项目",tpl:['<div class="mi-component mi-hmenu-sort-asc mi-box-item mi-component-default mi-menu-item" style="right: auto; left: 0px; top: 0px; margin: 0px; ">','<a class="mi-menu-item-link" href="#" hidefocus="true" unselectable="on">','<div role="img" class="mi-menu-item-icon  " style=""></div>','<span class="mi-menu-item-text" unselectable="on"></span>','<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==">',"</a>","</div>"],setText:function(c){var b=this,a=b.itemTextEl;b.text=c;a.html(c);return b},getText:function(){var a=this;return a.text},getHeight:function(){var b=this,a=b.el;return $(a).outerHeight()},getWidth:function(){var b=this,a=b.el;return $(a).width()},setWidth:function(c){var b=this,a=b.el;a.css("min-width",c);return b},baseRender:function(){var e=this,a,c,b,d;e.el=a=Mini2.$joinStr(e.tpl);e.itemLinkEl=c=a.children(".mi-menu-item-link");e.itemTextEl=d=c.children(".mi-menu-item-text");d.html(e.text);a.css("top",e.top);$(e.renderTo).append(a);if(e.icon||e.iconCls){if(e.iconCls){e.iconEl=b=$('<i role="img" class="fa " style="margin-right:4px;"></i>');b.addClass(e.iconCls);d.prepend(b)}else{if(e.icon){}}}$(a).muBind("mousemove",function(){if(!e.isMouseOver){e.isMouseOver=true;$(a).addClass("mi-menu-item-active")}}).muBind("mouseout",function(){if(e.isMouseOver){e.isMouseOver=false;$(a).removeClass("mi-menu-item-active")}});$(a).muBind("mousedown",function(f){}).muBind("mousemove",function(f){}).muBind("mouseup",function(f){if(e.click){console.log("xxxxxxxxxxxxxxxxx");e.click.call(e)}e.trigger("click",e);Mini2.EventManager.stopEvent(f);Mini2.EventManager.clear(e.scope||e.el)})},render:function(){var a=this;a.baseRender()}});
Mini2.define("Mini2.ui.menu.Manager",{singleton:true,items:null,delay:300,curMenu:null,timer:null,onInit:function(){var a=this;a.items={}},show:function(c){var b=this,a=b.curMenu,d=b.timer;if(a===c){return}if(b.curMenu){b.curMenu.callHide()}b.curMenu=c;if(!d){b.timer=d=Mini2.setTimer(function(){if(b.curMenu){b.curMenu.callShow()}},{interval:b.delay,limit:1})}else{d.reset().start()}},register:function(c){var b=this,a=b.items;c.bind("showing",function(){b.hideAll(this)});a[c.muid]=c},unregister:function(c){var b=this,a=b.items;delete a[c.muid]},hideAll:function(e){var d=this,c=d.items;for(var a in c){var b=c[a];if(b==e){continue}if(b===d.curMenu){d.curMenu=null}b.hide()}}},function(){var a=this;a.onInit()});
Mini2.define("Mini2.ui.menu.Separator",{renderTpl:['<div class="mi-component mi-box-item mi-component-default mi-menu-item-separator mi-menu-item mi-menu-item-plain" ','style="border-width: 1px; right: auto; left: 0px; top: 50px; margin: 0px; width:100%;" >&nbsp;</div>'],isSeparator:true,getHeight:function(){var b=this,a=b.el;return 5},getWidth:function(){var b=this,a=b.el;return a.width()},baseRender:function(){var b=this,a;b.el=a=Mini2.$joinStr(b.renderTpl);a.css("top",b.top);$(b.renderTo).append(a)},render:function(){var a=this;a.baseRender()}});
